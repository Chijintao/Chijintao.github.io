<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","version":"8.6.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta property="og:type" content="website">
<meta property="og:title" content="池劲涛的博客">
<meta property="og:url" content="http://example.com/page/4/index.html">
<meta property="og:site_name" content="池劲涛的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="池劲涛">
<meta property="article:tag" content="Python Linux Vue">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/4/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/4/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>池劲涛的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">池劲涛的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="池劲涛"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">池劲涛</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">65</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/03/11/%E5%85%A8%E5%B1%80%E8%A7%A3%E9%87%8A%E5%99%A8%E9%94%81%EF%BC%88GIL%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/03/11/%E5%85%A8%E5%B1%80%E8%A7%A3%E9%87%8A%E5%99%A8%E9%94%81%EF%BC%88GIL%EF%BC%89/" class="post-title-link" itemprop="url">全局解释器锁（GIL）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-03-11 07:20:25" itemprop="dateCreated datePublished" datetime="2019-03-11T07:20:25+08:00">2019-03-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2019-04-01 12:22:34" itemprop="dateModified" datetime="2019-04-01T12:22:34+08:00">2019-04-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E5%B9%B6%E5%8F%91%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">网络并发系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="全局解释器锁（GIL）"><a href="#全局解释器锁（GIL）" class="headerlink" title="全局解释器锁（GIL）"></a>全局解释器锁（GIL）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span> pypy（没有全局解释器锁） cpython（<span class="number">99.999999</span>%）</span><br><span class="line">    -pypy python好多模块用不了，</span><br><span class="line"><span class="number">1</span> 全局解释器锁，GIL锁（cpython解释器的问题）</span><br><span class="line">    -当年python设计的时候，还是单核，没有多核的概念</span><br><span class="line">    -python需要做垃圾回收（gc）</span><br><span class="line">    -垃圾回收线程，进行垃圾回收</span><br><span class="line">    -设计了一个大锁（GIL锁），只有拿到这把锁的线程，才能执行</span><br><span class="line">    -同一时刻，在一个进程中，可以开多个线程，但是只能有一条线程在执行</span><br><span class="line">    -不能利用多核优势</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">只针对与cpython解释器（其他解释器，包括其他语言不这样）</span><br><span class="line"><span class="number">2</span> 如果是计算密集型：要开进程</span><br><span class="line"><span class="number">3</span> 如果是io密集型：要开线程</span><br></pre></td></tr></table></figure>



<h2 id="开启线程的两种方式"><a href="#开启线程的两种方式" class="headerlink" title="开启线程的两种方式"></a>开启线程的两种方式</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># def task():</span></span><br><span class="line"><span class="comment">#     time.sleep(1)</span></span><br><span class="line"><span class="comment">#     print(&#x27;我是子线程&#x27;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># if __name__ == &#x27;__main__&#x27;:</span></span><br><span class="line"><span class="comment">#     t=Thread(target=task)</span></span><br><span class="line"><span class="comment">#     t.start()</span></span><br><span class="line"><span class="comment">#     print(&#x27;我是主线程&#x27;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###第二种方式</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span>(<span class="params">Thread</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,a</span>):</span></span><br><span class="line">        self.a=a</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;我是子线程&#x27;</span>,self.a)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    t=MyThread(<span class="string">&#x27;aaaaa&#x27;</span>)</span><br><span class="line">    t.start()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;我是主线程&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="多线程与多进程比较"><a href="#多线程与多进程比较" class="headerlink" title="多线程与多进程比较"></a>多线程与多进程比较</h2><h3 id="开启速度比较"><a href="#开启速度比较" class="headerlink" title="开启速度比较"></a>开启速度比较</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#开线程消耗的资源，耗费的时间远远小于开进程</span></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span>():</span></span><br><span class="line">    time.sleep(<span class="number">0.1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;我是子线程&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment">####线程</span></span><br><span class="line">    <span class="comment"># ctime=time.time()</span></span><br><span class="line">    <span class="comment"># t=Thread(target=task)</span></span><br><span class="line">    <span class="comment"># t.start()</span></span><br><span class="line">    <span class="comment"># t.join() # 等待子线程执行完成主线程再执行</span></span><br><span class="line">    <span class="comment"># print(&#x27;我是主线程&#x27;)</span></span><br><span class="line">    <span class="comment"># print(time.time()-ctime)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">##进程</span></span><br><span class="line">    ctime=time.time()</span><br><span class="line">    t=Process(target=task)</span><br><span class="line">    t.start()</span><br><span class="line">    t.join() <span class="comment"># 等待子线程执行完成主线程再执行</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;我是主线程&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(time.time()-ctime)</span><br></pre></td></tr></table></figure>

<h3 id="内存数据的共享问题"><a href="#内存数据的共享问题" class="headerlink" title="内存数据的共享问题"></a>内存数据的共享问题</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 线程间数据共享</span></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span>():</span></span><br><span class="line">    <span class="keyword">global</span> n</span><br><span class="line">    n=<span class="number">10</span></span><br><span class="line">    <span class="built_in">print</span>(n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment">####线程</span></span><br><span class="line">    n=<span class="number">100</span></span><br><span class="line">    t=Thread(target=task)</span><br><span class="line">    t.start()</span><br><span class="line">    t.join() <span class="comment"># 等待子线程执行完成主线程再执行</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;我是主线程&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(n)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="Thread类的其他方法"><a href="#Thread类的其他方法" class="headerlink" title="Thread类的其他方法"></a>Thread类的其他方法</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span>():</span></span><br><span class="line">    <span class="comment"># time.sleep(0.01)</span></span><br><span class="line">    <span class="comment">#在子线程中执行</span></span><br><span class="line">    <span class="comment"># res = threading.currentThread()</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    res=threading.get_ident()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;子线程：&#x27;</span>,res)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;我是子线程&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    t=Thread(target=task)</span><br><span class="line">    t1=Thread(target=task)</span><br><span class="line"></span><br><span class="line">    t.start()</span><br><span class="line">    t1.start()</span><br><span class="line">    <span class="comment"># print(t.is_alive())  #看线程是否存活</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># print(t.getName() )  # 获取线程的名字</span></span><br><span class="line">    <span class="comment"># t.setName(&#x27;lqz&#x27;)   # 设置线程民资</span></span><br><span class="line">    <span class="comment"># print(t.getName() )</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># print(&#x27;主线程&#x27;)</span></span><br><span class="line">    <span class="comment"># time.sleep(0.02)</span></span><br><span class="line">    <span class="comment"># print(t.is_alive())</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 主线程中执行，返回当前线程对象</span></span><br><span class="line">    <span class="comment"># res=threading.currentThread()</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 返回当前进程中正在运行的子线程对象列表</span></span><br><span class="line">    <span class="comment"># res=threading.enumerate()</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 返回当前正在运行的线程个数</span></span><br><span class="line">    <span class="comment"># res=threading.activeCount()</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 线程id号</span></span><br><span class="line">    res=threading.get_ident()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;主线程：&#x27;</span>,res)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">   <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   t.is_alive()</span></span><br><span class="line"><span class="string">   t.getName()</span></span><br><span class="line"><span class="string">   t.setName(&#x27;lqz&#x27;) </span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">   threading:模块下的一些方法</span></span><br><span class="line"><span class="string">   res=threading.currentThread()</span></span><br><span class="line"><span class="string">   res=threading.enumerate()</span></span><br><span class="line"><span class="string">   res=threading.activeCount()</span></span><br><span class="line"><span class="string">   res=threading.get_ident()</span></span><br><span class="line"><span class="string">   &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="join方法"><a href="#join方法" class="headerlink" title="join方法"></a>join方法</h2><h2 id=""><a href="#" class="headerlink" title=""></a></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 等待子线程执行结束</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span>():</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;我是子线程&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    ll=[]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">        t=Thread(target=task)</span><br><span class="line"></span><br><span class="line">        t.start()</span><br><span class="line">        ll.append(t)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> ll:</span><br><span class="line">        i.join()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 主线程等待子线程执行完再执行</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;我是主线程，子线程全都执行完了&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="守护线程"><a href="#守护线程" class="headerlink" title="守护线程"></a>守护线程</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span>():</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;我是子线程&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    t=Thread(target=task)</span><br><span class="line">    t.setDaemon(<span class="literal">True</span>)  <span class="comment"># 如果主线程执行结束，子线程也结束（不执行了）</span></span><br><span class="line">    t.start()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#只要主线程执行结束，子线程也结束</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;主线程执行结束&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="同步锁（互斥锁）"><a href="#同步锁（互斥锁）" class="headerlink" title="同步锁（互斥锁）"></a>同步锁（互斥锁）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 多个线程操作同一个数据（变量），会出现并发安全的问题</span></span><br><span class="line"><span class="comment"># from threading import Thread,Lock</span></span><br><span class="line"><span class="comment"># import time</span></span><br><span class="line"><span class="comment"># import random</span></span><br><span class="line"><span class="comment"># def task():</span></span><br><span class="line"><span class="comment">#     global n</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     ### 临界区(加锁)</span></span><br><span class="line"><span class="comment">#     time.sleep(random.random())</span></span><br><span class="line"><span class="comment">#     temp=n</span></span><br><span class="line"><span class="comment">#     time.sleep(random.random())</span></span><br><span class="line"><span class="comment">#     temp=temp-1</span></span><br><span class="line"><span class="comment">#     n=temp</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     ##模拟不出来，因为太快了，没有cup的切换（io，时间片到了），模拟io，让cpu切换</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     # n-=1</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># if __name__ == &#x27;__main__&#x27;:</span></span><br><span class="line"><span class="comment">#     n=10</span></span><br><span class="line"><span class="comment">#     ll=[]</span></span><br><span class="line"><span class="comment">#     for i in range(10):</span></span><br><span class="line"><span class="comment">#         t=Thread(target=task)</span></span><br><span class="line"><span class="comment">#         t.start()</span></span><br><span class="line"><span class="comment">#         ll.append(t)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     for i in ll:</span></span><br><span class="line"><span class="comment">#         i.join()</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     print(n)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###出现了并发安全的问题，加锁解决</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread,Lock</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task_lock</span>(<span class="params">lock</span>):</span></span><br><span class="line">    <span class="keyword">global</span> n</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">### 临界区(加锁)</span></span><br><span class="line">    <span class="keyword">with</span> lock:</span><br><span class="line">        time.sleep(random.random())</span><br><span class="line">        temp=n</span><br><span class="line">        time.sleep(random.random())</span><br><span class="line">        temp=temp-<span class="number">1</span></span><br><span class="line">        n=temp</span><br><span class="line"></span><br><span class="line">    <span class="comment">##模拟不出来，因为太快了，没有cup的切换（io，时间片到了），模拟io，让cpu切换</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># n-=1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task_no_lock</span>():</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">global</span> n</span><br><span class="line">    time.sleep(random.random())</span><br><span class="line">    temp=n</span><br><span class="line">    time.sleep(random.random())</span><br><span class="line">    temp=temp-<span class="number">1</span></span><br><span class="line">    n=temp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    n=<span class="number">10</span></span><br><span class="line">    lock=Lock()</span><br><span class="line">    ll=[]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        <span class="comment"># t=Thread(target=task_lock,args=[lock,])</span></span><br><span class="line">        t=Thread(target=task_no_lock,args=[lock,])</span><br><span class="line">        t.start()</span><br><span class="line">        ll.append(t)</span><br><span class="line">        t.join()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># for i in ll:</span></span><br><span class="line">    <span class="comment">#     i.join()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">互斥锁和join的区别</span></span><br><span class="line"><span class="string">如果使用互斥锁：只锁临界区，只有临界区是串行，其他地方还是并发的</span></span><br><span class="line"><span class="string">如果使用join，整个过程全变成串行执行</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="信号量"><a href="#信号量" class="headerlink" title="信号量"></a>信号量</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 信号量可以理解为多把锁，同时允许多个线程来更改数据</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span>  threading <span class="keyword">import</span> Thread,Semaphore</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span>(<span class="params">sm,i</span>):</span></span><br><span class="line">    sm.acquire()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%s:这个人在上厕所&#x27;</span>%i)</span><br><span class="line">    time.sleep(random.random())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%s:这个人拉完了&#x27;</span>%i)</span><br><span class="line">    sm.release()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sm=Semaphore(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>):</span><br><span class="line">    t=Thread(target=task,args=[sm,i])</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure>

<h2 id="Event事件"><a href="#Event事件" class="headerlink" title="Event事件"></a>Event事件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Event事件:</span><br><span class="line">一些线程需要等到其他线程执行完成之后才能执行，类似于发射信号</span><br><span class="line">比如一个线程等待另一个线程执行结束再继续执行</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 一些线程需要等到其他线程执行完成之后才能执行，类似于发射信号</span></span><br><span class="line"><span class="comment"># 比如一个线程等待另一个线程执行结束再继续执行</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread, Event</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">girl</span>(<span class="params">event</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;赵丽颖现在在结婚状态&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># 离婚了，发送信号</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;赵丽颖离婚了&#x27;</span>)</span><br><span class="line">    event.<span class="built_in">set</span>()  <span class="comment"># 发送一个信号</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">boy</span>(<span class="params">i, event</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;屌丝%s：在等赵丽颖的离婚信号&#x27;</span>%i)</span><br><span class="line">    event.wait()  <span class="comment"># 收不到信号之前，一直卡在这</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;屌丝%s号，收到了离婚信号，开始追&#x27;</span> % i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">event = Event()</span><br><span class="line">t = Thread(target=girl, args=[event, ])</span><br><span class="line">t.start()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    t1 = Thread(target=boy, args=[i, event])</span><br><span class="line">    t1.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##  写两条线程，一条线程读一个文件的头2分之一，另一个线程读这个文件的后2分之一，但是必须第一个线程读完，发送信号后，第二个线程才能读</span></span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> GIL锁：全局解释器锁，在解释器之上的一把大锁，线程必须获得这把锁，才能执行，只针对与cpython解释器</span><br><span class="line"><span class="number">2</span> GIL和线程锁有什么区别？有了GIL锁，为什么还要线程锁？</span><br><span class="line">	-本身GIL和线程锁，都是线程级别的锁，GIL是内置的，解释器里的</span><br><span class="line">    -线程锁：开发者定义的</span><br><span class="line"><span class="number">3</span> 多核cpu： </span><br><span class="line">	如果是计算密集型：开进程</span><br><span class="line">    io密集型：开线程</span><br><span class="line">    </span><br><span class="line"><span class="number">4</span> 开启线程的两种方式（对比进程）</span><br><span class="line"><span class="number">5</span> 进程和线程的比较</span><br><span class="line">	-进程<span class="built_in">id</span>比较</span><br><span class="line">    -开启效率的比较</span><br><span class="line">    -共享变量</span><br><span class="line">    </span><br><span class="line"><span class="number">6</span> Thread类的其他方法，threading模块下的其他方法</span><br><span class="line"></span><br><span class="line"><span class="number">7</span> 线程join（等待子线程执行完成）</span><br><span class="line"><span class="number">8</span> 守护线程（如果主线程执行完成，子线程也结束）</span><br><span class="line"><span class="number">9</span> 互斥锁，同步锁：为了保证并发情况下数据安全，把对数据的操作过程变成串行，牺牲了效率，保证了数据安全</span><br><span class="line"><span class="number">10</span> 信号量，Event</span><br><span class="line">    </span><br><span class="line">    </span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/03/11/%E5%B9%B6%E5%8F%91%E3%80%81%E5%B9%B6%E8%A1%8C%E5%92%8C%E5%A4%9A%E8%BF%9B%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/03/11/%E5%B9%B6%E5%8F%91%E3%80%81%E5%B9%B6%E8%A1%8C%E5%92%8C%E5%A4%9A%E8%BF%9B%E7%A8%8B/" class="post-title-link" itemprop="url">并发、并行和多进程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-03-11 07:20:25" itemprop="dateCreated datePublished" datetime="2019-03-11T07:20:25+08:00">2019-03-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2019-04-01 12:22:34" itemprop="dateModified" datetime="2019-04-01T12:22:34+08:00">2019-04-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E5%B9%B6%E5%8F%91%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">网络并发系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="加入链接循环的套接字服务端"><a href="#加入链接循环的套接字服务端" class="headerlink" title="加入链接循环的套接字服务端"></a>加入链接循环的套接字服务端</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">sever = socket.socket()</span><br><span class="line">sever.bind((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8087</span>))</span><br><span class="line">sever.listen(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    sock, addr = sever.accept()</span><br><span class="line">    data = sock.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line">    sock.send(data.upper())</span><br><span class="line">    sock.close()</span><br><span class="line">sever.close()</span><br></pre></td></tr></table></figure>

<h2 id="加入通信循环的套接字服务端"><a href="#加入通信循环的套接字服务端" class="headerlink" title="加入通信循环的套接字服务端"></a>加入通信循环的套接字服务端</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">server=socket.socket(family=socket.AF_INET, <span class="built_in">type</span>=socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line">server.bind((<span class="string">&#x27;127.0.0.1&#x27;</span>,<span class="number">81</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;开始等待客户端连接了&#x27;</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">    sock,addr=server.accept()</span><br><span class="line">    <span class="built_in">print</span>(sock)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;客户端的地址是：&#x27;</span>,addr)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 等待客户端发送过来的数据，如果客户端没有发送数据，会一直等着</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data=sock.recv(<span class="number">1024</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(data)==<span class="number">0</span>: <span class="comment"># 这个表示客户端正常断开了，结束通信循环</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="built_in">print</span>(data.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">            sock.send(data.upper())</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(e) <span class="comment">#客户端非正常断开，需要异常捕获</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    sock.close()</span><br><span class="line">server.close()</span><br></pre></td></tr></table></figure>

<h2 id="基于UDP的套接字客户端和服务端-了解"><a href="#基于UDP的套接字客户端和服务端-了解" class="headerlink" title="基于UDP的套接字客户端和服务端(了解)"></a>基于UDP的套接字客户端和服务端(了解)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="comment"># udp的服务端</span></span><br><span class="line">server = socket.socket(<span class="built_in">type</span>=socket.SOCK_DGRAM)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 监听地址和端口</span></span><br><span class="line">server.bind((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">82</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不需要listen，直接建立链接</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;等待客户端发送数据：&#x27;</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"><span class="comment">#recvfrom回返回数据和客户端的地址</span></span><br><span class="line">    data,addr = server.recvfrom(<span class="number">1024</span>)</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line">    <span class="built_in">print</span>(addr)</span><br><span class="line">    server.sendto(data.upper(), addr)</span><br><span class="line"></span><br><span class="line">server.close()</span><br></pre></td></tr></table></figure>

<h2 id="操作系统的发展史"><a href="#操作系统的发展史" class="headerlink" title="操作系统的发展史"></a>操作系统的发展史</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 手工操作——穿孔卡片</span><br><span class="line">    -用户独占全机</span><br><span class="line">    -CPU的利用不充分</span><br><span class="line"><span class="number">2</span> 批处理</span><br><span class="line">    -把一个操作整个写到磁带中，以后要进行这个操作，直接拿着磁带，读入即可</span><br><span class="line">    -脱机批处理</span><br><span class="line">    -联机批处理</span><br><span class="line">    </span><br><span class="line"><span class="number">3</span> 多道程序系统(重要)</span><br><span class="line">    -当一道程序因I/O请求而暂停运行时，CPU便立即转去运行另一道程序</span><br><span class="line">    -各道程序轮流地用CPU，并交替运行</span><br><span class="line"><span class="number">4</span> 分时系统(重要)</span><br><span class="line">    -多个程序在运行，时间片的概念，cpu执行完固定的时间，就会转去另一个程序</span><br><span class="line"><span class="number">5</span> 通用操作系统</span><br><span class="line">    多道批处理系统，分时</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">io操作：（通通不占用cpu）(重要)</span><br><span class="line">    键盘输入，从硬盘拿数据，从网络加载数据---&gt;都叫输入</span><br><span class="line">    显示在显示器，写到硬盘，从网络发送数据---&gt;都叫输出</span><br></pre></td></tr></table></figure>



<h2 id="进程基础"><a href="#进程基础" class="headerlink" title="进程基础"></a>进程基础</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">狭义定义：进程是正在运行的程序的实例（an instance of a computer program that <span class="keyword">is</span> being executed）。</span><br><span class="line"></span><br><span class="line">广义定义：进程是一个具有一定独立功能的程序关于某个数据集合的一次运行活动。它是操作系统动态执行的基本单元，在传统的操作系统中，进程既是基本的分配单元</span><br><span class="line"></span><br><span class="line">(重要)↓↓↓</span><br><span class="line"><span class="comment"># 进程是资源分配的最小单位，线程是cpu执行的最小单位</span></span><br><span class="line"><span class="comment"># 一个程序运行，最少有一个进程</span></span><br><span class="line"><span class="comment"># 一个进程里最少有一条线程</span></span><br><span class="line"></span><br><span class="line">(重要)↓↓↓</span><br><span class="line"><span class="comment"># 进程和程序的区分</span></span><br><span class="line">    -程序可以作为一种软件资料长期存在，而进程是有一定生命期的。</span><br><span class="line">    -程序是永久的，进程是暂时的。</span><br><span class="line"></span><br><span class="line">(重要)↓↓↓</span><br><span class="line"><span class="comment"># 进程的状态（）</span></span><br><span class="line">    -就绪态：可以被cpu调度执行了，还没有执行，排着队</span><br><span class="line">    -运行态：在cpu中运行，正在运行（如果到了时间片，也会被调度出去，调度出去的程序是就绪态）</span><br><span class="line">    -阻塞态：io操作，把数据加载到内存中   </span><br></pre></td></tr></table></figure>

<p><img src="https://img2020.cnblogs.com/blog/2342210/202104/2342210-20210422195710649-959416771.png" alt="img"></p>
<h2 id="并发和并行"><a href="#并发和并行" class="headerlink" title="并发和并行"></a>并发和并行</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">并发：（你在跑步，鞋带开了，停下跑步，系鞋带，系完以后，继续跑步，在一个时间段内来看，你干了多个事）</span><br><span class="line">    -单核下的并发</span><br><span class="line">    :在一个时间段内，处理多件事</span><br><span class="line">    </span><br><span class="line">并行：（你在跑步，你用随身听在听着，同一时刻，在干多个事）</span><br><span class="line">    -只有多核才涉及到并行</span><br><span class="line">    ：在某一个时刻，有多件事同时被处理</span><br></pre></td></tr></table></figure>



<h2 id="开启多进程"><a href="#开启多进程" class="headerlink" title="开启多进程"></a>开启多进程</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#如果在win下开多进程，必须写main，否则报错(注意)</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wirte_file</span>(<span class="params">s</span>):</span></span><br><span class="line"></span><br><span class="line">    time.sleep(<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;a.txt&#x27;</span>,<span class="string">&#x27;a&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(s)</span><br><span class="line">        f.write(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    time.sleep(<span class="number">5</span>)</span><br><span class="line">    <span class="comment"># wirte_file()</span></span><br><span class="line">    <span class="comment"># 开启多进程的第一个方式</span></span><br><span class="line">    p=Process(target=wirte_file,args=[<span class="string">&#x27;lqz is nb&#x27;</span>])</span><br><span class="line">    <span class="comment"># 执行该进程</span></span><br><span class="line">    p.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 又开了一个进程</span></span><br><span class="line">    p1 = Process(target=wirte_file,args=[<span class="string">&#x27;egon is dsb&#x27;</span>])</span><br><span class="line">    <span class="comment"># 执行该进程</span></span><br><span class="line">    p1.start()</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 基于socket写TCP的客户端和服务端</span><br><span class="line">    -加入链接循环</span><br><span class="line">    -加入通信循环</span><br><span class="line">    -客户端主动断开----&gt;服务端一直收空</span><br><span class="line">    -客户端强制断开----&gt;服务端会报错</span><br><span class="line">    -同一时刻，只能有一个客户端与服务端交互</span><br><span class="line">    </span><br><span class="line"><span class="number">2</span> 基于UDP的客户端和服务端</span><br><span class="line">    -数据不可靠，应用场景比较少</span><br><span class="line">    </span><br><span class="line"><span class="number">3</span> 并发编程（进程，线程，协程）</span><br><span class="line"></span><br><span class="line"><span class="number">4</span> 进程：</span><br><span class="line">    -资源分配的最小单位，线程是cpu调度的最小单位</span><br><span class="line">    -食谱：程序</span><br><span class="line">    -拿到食谱做法的过程，叫进程</span><br><span class="line">    -进程：程序运行的过程，一堆数据+做一件事的过程的集合</span><br><span class="line">    </span><br><span class="line"><span class="number">5</span> python中如何开启进程</span><br><span class="line">    -p=Process(target=task)</span><br><span class="line">    -p.start()</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/03/11/%E6%AD%BB%E9%94%81%E9%97%AE%E9%A2%98%E4%B8%8E%E5%8D%8F%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/03/11/%E6%AD%BB%E9%94%81%E9%97%AE%E9%A2%98%E4%B8%8E%E5%8D%8F%E7%A8%8B/" class="post-title-link" itemprop="url">死锁问题与协程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-03-11 07:20:25" itemprop="dateCreated datePublished" datetime="2019-03-11T07:20:25+08:00">2019-03-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2019-04-01 12:22:34" itemprop="dateModified" datetime="2019-04-01T12:22:34+08:00">2019-04-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E5%B9%B6%E5%8F%91%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">网络并发系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="死锁问题（递归锁，可重入锁）"><a href="#死锁问题（递归锁，可重入锁）" class="headerlink" title="死锁问题（递归锁，可重入锁）"></a>死锁问题（递归锁，可重入锁）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 所谓死锁：是指两个或两个以上的进程或线程在执行过程中，因争夺资源而造成的一种互相等待的现象，若无外力作用，它们都将无法推进下去。此时称系统处于死锁状态或系统产生了死锁，这些永远在互相等待的进程称为死锁进程，如下就是死锁</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">2</span> 可重入锁，递归锁</span><br><span class="line"><span class="comment"># from threading import Thread, Lock</span></span><br><span class="line"><span class="comment"># import time</span></span><br><span class="line"><span class="comment"># import random</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># def eat1(lock_1, lock_2, name):</span></span><br><span class="line"><span class="comment">#     lock_1.acquire()</span></span><br><span class="line"><span class="comment">#     print(&#x27;%s:拿到了筷子&#x27; % name)</span></span><br><span class="line"><span class="comment">#     time.sleep(random.random())</span></span><br><span class="line"><span class="comment">#     lock_2.acquire()</span></span><br><span class="line"><span class="comment">#     print(&#x27;%s:拿到了面条&#x27; % name)</span></span><br><span class="line"><span class="comment">#     print(&#x27;开始吃面&#x27;)</span></span><br><span class="line"><span class="comment">#     time.sleep(random.random())</span></span><br><span class="line"><span class="comment">#     lock_2.release()</span></span><br><span class="line"><span class="comment">#     print(&#x27;%s放下了面条&#x27; % name)</span></span><br><span class="line"><span class="comment">#     lock_1.release()</span></span><br><span class="line"><span class="comment">#     print(&#x27;%s放下了筷子&#x27; % name)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># def eat2(lock_1, lock_2, name):</span></span><br><span class="line"><span class="comment">#     lock_2.acquire()</span></span><br><span class="line"><span class="comment">#     print(&#x27;%s:拿到了面条&#x27; % name)</span></span><br><span class="line"><span class="comment">#     time.sleep(random.random())</span></span><br><span class="line"><span class="comment">#     lock_1.acquire()</span></span><br><span class="line"><span class="comment">#     print(&#x27;%s:拿到了筷子&#x27; % name)</span></span><br><span class="line"><span class="comment">#     print(&#x27;开始吃面&#x27;)</span></span><br><span class="line"><span class="comment">#     time.sleep(random.random())</span></span><br><span class="line"><span class="comment">#     lock_1.release()</span></span><br><span class="line"><span class="comment">#     print(&#x27;%s放下了筷子&#x27; % name)</span></span><br><span class="line"><span class="comment">#     lock_2.release()</span></span><br><span class="line"><span class="comment">#     print(&#x27;%s放下了面条&#x27; % name)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># if __name__ == &#x27;__main__&#x27;:</span></span><br><span class="line"><span class="comment">#     lock_1 = Lock()</span></span><br><span class="line"><span class="comment">#     lock_2 = Lock()</span></span><br><span class="line"><span class="comment">#     for i in [&#x27;张三&#x27;, &#x27;李四&#x27;, &#x27;王五&#x27;]:</span></span><br><span class="line"><span class="comment">#         t = Thread(target=eat1, args=[lock_1, lock_2, i])</span></span><br><span class="line"><span class="comment">#         t.start()</span></span><br><span class="line"><span class="comment">#     for i in [&#x27;赵6&#x27;, &#x27;往7&#x27;, &#x27;傻逼&#x27;]:</span></span><br><span class="line"><span class="comment">#         t = Thread(target=eat2, args=[lock_1, lock_2, i])</span></span><br><span class="line"><span class="comment">#         t.start()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 解决死锁问题  RLock:可重入，可以重复acquire，获得几次，就要释放几次</span></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread, Lock,RLock</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">eat1</span>(<span class="params">lock_1, lock_2, name</span>):</span></span><br><span class="line">    lock_1.acquire()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%s:拿到了筷子&#x27;</span> % name)</span><br><span class="line">    time.sleep(random.random())</span><br><span class="line">    lock_2.acquire()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%s:拿到了面条&#x27;</span> % name)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;开始吃面&#x27;</span>)</span><br><span class="line">    time.sleep(random.random())</span><br><span class="line">    lock_2.release()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%s放下了面条&#x27;</span> % name)</span><br><span class="line">    lock_1.release()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%s放下了筷子&#x27;</span> % name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">eat2</span>(<span class="params">lock_1, lock_2, name</span>):</span></span><br><span class="line">    lock_2.acquire()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%s:拿到了面条&#x27;</span> % name)</span><br><span class="line">    time.sleep(random.random())</span><br><span class="line">    lock_1.acquire()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%s:拿到了筷子&#x27;</span> % name)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;开始吃面&#x27;</span>)</span><br><span class="line">    time.sleep(random.random())</span><br><span class="line">    lock_1.release()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%s放下了筷子&#x27;</span> % name)</span><br><span class="line">    lock_2.release()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%s放下了面条&#x27;</span> % name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    lock_1 = RLock()</span><br><span class="line">    lock_2 = lock_1</span><br><span class="line"></span><br><span class="line">    <span class="comment"># lock_1 = Lock()</span></span><br><span class="line">    <span class="comment"># lock_2 = lock_1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;王五&#x27;</span>]:</span><br><span class="line">        t = Thread(target=eat1, args=[lock_1, lock_2, i])</span><br><span class="line">        t.start()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="string">&#x27;赵6&#x27;</span>, <span class="string">&#x27;往7&#x27;</span>, <span class="string">&#x27;傻逼&#x27;</span>]:</span><br><span class="line">        t = Thread(target=eat2, args=[lock_1, lock_2, i])</span><br><span class="line">        t.start()</span><br></pre></td></tr></table></figure>

<h2 id="线程队列"><a href="#线程队列" class="headerlink" title="线程队列"></a>线程队列</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 线程Queue，解决线程间数据共享的问题</span><br><span class="line"><span class="number">2</span> 线程间数据共享可以使用共享变量（可能会存在并发安全的问题）</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">from</span> queue <span class="keyword">import</span> Queue,LifoQueue,PriorityQueue <span class="comment"># 线程queue</span></span><br><span class="line"><span class="comment"># Queue:先进先出</span></span><br><span class="line"><span class="comment">#LifoQueue：后进先出</span></span><br><span class="line"><span class="comment">#PriorityQueue：优先级队列</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># import time</span></span><br><span class="line"><span class="comment"># def task(queue):</span></span><br><span class="line"><span class="comment">#     time.sleep(3)</span></span><br><span class="line"><span class="comment">#     queue.put(&#x27;lqz&#x27;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># if __name__ == &#x27;__main__&#x27;:</span></span><br><span class="line"><span class="comment">#     queue=Queue()</span></span><br><span class="line"><span class="comment">#     t=Thread(target=task,args=[queue,])</span></span><br><span class="line"><span class="comment">#     t.start()</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     res=queue.get()</span></span><br><span class="line"><span class="comment">#     print(res)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Queue:先进先出</span></span><br><span class="line"><span class="comment"># LifoQueue：后进先出</span></span><br><span class="line"><span class="comment"># PriorityQueue：优先级队列</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># quque1=Queue()</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># quque1.put(1)</span></span><br><span class="line">    <span class="comment"># quque1.put(2)</span></span><br><span class="line">    <span class="comment"># print(quque1.get())</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># quque2=LifoQueue()</span></span><br><span class="line">    <span class="comment"># quque2.put(1)</span></span><br><span class="line">    <span class="comment"># quque2.put(2)</span></span><br><span class="line">    <span class="comment"># print(quque2.get())</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    quque3=PriorityQueue()</span><br><span class="line">    quque3.put((<span class="number">1</span>,<span class="string">&#x27;lqz&#x27;</span>))</span><br><span class="line">    quque3.put((<span class="number">100</span>,<span class="string">&#x27;egon&#x27;</span>))</span><br><span class="line">    <span class="comment"># 数字越小，优先级越高</span></span><br><span class="line">    <span class="built_in">print</span>(quque3.get())</span><br></pre></td></tr></table></figure>

<h2 id="进程池，线程池-重点"><a href="#进程池，线程池-重点" class="headerlink" title="进程池，线程池(重点)"></a>进程池，线程池(重点)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 线程池，进程池都在这个模块下concurrent.futures</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ProcessPoolExecutor,ThreadPoolExecutor</span><br><span class="line"></span><br><span class="line"><span class="comment"># def task(n):</span></span><br><span class="line"><span class="comment">#     print(os.getpid(), &#x27;开始执行了&#x27;)</span></span><br><span class="line"><span class="comment">#     time.sleep(random.random())</span></span><br><span class="line"><span class="comment">#     return n * n</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># def callback(result):</span></span><br><span class="line"><span class="comment">#     print(result)</span></span><br><span class="line"><span class="comment"># if __name__ == &#x27;__main__&#x27;:</span></span><br><span class="line"><span class="comment">#     # 开进程池去执行</span></span><br><span class="line"><span class="comment">#     # ProcessPoolExecutor实例化得到一个对象</span></span><br><span class="line"><span class="comment">#     pool_p=ProcessPoolExecutor(3)</span></span><br><span class="line"><span class="comment">#     # ll=[]</span></span><br><span class="line"><span class="comment">#     # for i in range(10):</span></span><br><span class="line"><span class="comment">#     #     # 把任务提交到进程池执行</span></span><br><span class="line"><span class="comment">#     #     f=pool_p.submit(task,n=i)</span></span><br><span class="line"><span class="comment">#     #     ll.append(f)</span></span><br><span class="line"><span class="comment">#     #</span></span><br><span class="line"><span class="comment">#     # # 等待所有子进程执行完成，主进程在执行</span></span><br><span class="line"><span class="comment">#     # pool_p.shutdown()</span></span><br><span class="line"><span class="comment">#     #</span></span><br><span class="line"><span class="comment">#     # for l in ll:</span></span><br><span class="line"><span class="comment">#     #     res=l.result()  # 取到当前进程执行任务的返回值</span></span><br><span class="line"><span class="comment">#     #     print(res)</span></span><br><span class="line"><span class="comment">#     #</span></span><br><span class="line"><span class="comment">#     # print(&#x27;我是主进程&#x27;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     # map取代for循环的，第一个参数是要执行的任务，第二个参数，是一个可迭代对象，迭代一次的结果，会传给任务</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     #   for i in range(10):</span></span><br><span class="line"><span class="comment">#     #     f=pool_p.submit(task,n=i)</span></span><br><span class="line"><span class="comment">#     # 等同于上面</span></span><br><span class="line"><span class="comment">#     # pool_p.map(task,range(10))</span></span><br><span class="line"><span class="comment">#     # pool_p.shutdown()</span></span><br><span class="line"><span class="comment">#     # print(&#x27;主进程&#x27;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     ## 回调</span></span><br><span class="line"><span class="comment">#     for i in range(10):</span></span><br><span class="line"><span class="comment">#         pool_p.submit(task,n=i).add_done_callback()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(os.getpid(), <span class="string">&#x27;开始执行了&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> n * n</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">callback</span>(<span class="params">result</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(result.result())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    pool_p = ProcessPoolExecutor(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        pool_p.submit(task, n=i).add_done_callback(callback)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">submit</span></span><br><span class="line"><span class="string">shutdown</span></span><br><span class="line"><span class="string">result</span></span><br><span class="line"><span class="string">map(了解)</span></span><br><span class="line"><span class="string">add_done_callback：回调</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="协程介绍"><a href="#协程介绍" class="headerlink" title="协程介绍"></a>协程介绍</h2><p><strong>协程是：程序级别的切换，单线程下实现并发</strong><br><strong>python的线程属于内核级别的，即由操作系统控制调度（如单线程遇到io或执行时间过长就会被迫交出cpu执行权限，切换其他线程运行）</strong><br><strong>单线程内开启协程，一旦遇到io，就会从应用程序级别（而非操作系统）控制切换，以此来提升效率（！！！非io操作的切换与效率无关）</strong></p>
<h2 id="greenlet模块（初级模块，实现了保存状态加切换）"><a href="#greenlet模块（初级模块，实现了保存状态加切换）" class="headerlink" title="greenlet模块（初级模块，实现了保存状态加切换）"></a>greenlet模块（初级模块，实现了保存状态加切换）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装第三方模块：在命令行下</span></span><br><span class="line"><span class="comment"># pip3 install greenlet</span></span><br><span class="line"><span class="comment"># pip3 uninstall greenlet  卸载第三方模块</span></span><br><span class="line"><span class="comment"># pip3 list   # 列出当前解释器环境下安装的第三方模块</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> greenlet <span class="keyword">import</span> greenlet</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">eat</span>(<span class="params">name</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(name,<span class="string">&#x27;在吃了一口&#x27;</span>)</span><br><span class="line">    g2.switch(name)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(name,<span class="string">&#x27;在吃了第二口&#x27;</span>)</span><br><span class="line">    g2.switch()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">play</span>(<span class="params">name</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(name, <span class="string">&#x27;玩了一下&#x27;</span>)</span><br><span class="line">    g1.switch()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(name, <span class="string">&#x27;玩了第二下&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">g1=greenlet(eat)</span><br><span class="line">g2=greenlet(play)</span><br><span class="line"></span><br><span class="line">g1.switch(<span class="string">&#x27;egon&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 写两个task，一个计算从1+1w，另一个计算从1乘以到1w，统计一下，切换执行时间快还是不切换快</span></span><br></pre></td></tr></table></figure>

<h2 id="gevent模块"><a href="#gevent模块" class="headerlink" title="gevent模块"></a>gevent模块</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## gevent模块，协程模块，遇到io可以自动切换</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># pip3 install gevent</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># def eat(name):</span></span><br><span class="line"><span class="comment">#     print(name, &#x27;在吃了一口&#x27;)</span></span><br><span class="line"><span class="comment">#     # 遇到了io</span></span><br><span class="line"><span class="comment">#     gevent.sleep(2)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     print(name, &#x27;在吃了第二口&#x27;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># def play(name):</span></span><br><span class="line"><span class="comment">#     print(name, &#x27;玩了一下&#x27;)</span></span><br><span class="line"><span class="comment">#     # 遇到了io，是gevent的io</span></span><br><span class="line"><span class="comment">#     gevent.sleep(3)</span></span><br><span class="line"><span class="comment">#     print(name, &#x27;玩了第二下&#x27;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># res1 = gevent.spawn(eat, &#x27;egon&#x27;)</span></span><br><span class="line"><span class="comment"># res2 = gevent.spawn(play, &#x27;egon&#x27;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ctime=time.time()</span></span><br><span class="line"><span class="comment"># # res1.join()</span></span><br><span class="line"><span class="comment"># # res2.join()  # 等地任务执行完成再执行下面那句</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># gevent.joinall([res1,res2])   # 相当于上面那两句</span></span><br><span class="line"><span class="comment"># print(&#x27;主线程&#x27;)</span></span><br><span class="line"><span class="comment"># print(time.time()-ctime)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###使用原来的time的io，不会切，并且变成了串行</span></span><br><span class="line"><span class="comment"># def eat(name):</span></span><br><span class="line"><span class="comment">#     print(name, &#x27;在吃了一口&#x27;)</span></span><br><span class="line"><span class="comment">#     time.sleep(2)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     print(name, &#x27;在吃了第二口&#x27;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># def play(name):</span></span><br><span class="line"><span class="comment">#     print(name, &#x27;玩了一下&#x27;)</span></span><br><span class="line"><span class="comment">#     time.sleep(3)</span></span><br><span class="line"><span class="comment">#     print(name, &#x27;玩了第二下&#x27;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># res1 = gevent.spawn(eat, &#x27;egon&#x27;)</span></span><br><span class="line"><span class="comment"># res2 = gevent.spawn(play, &#x27;egon&#x27;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ctime=time.time()</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># gevent.joinall([res1,res2])   # 相当于上面那两句</span></span><br><span class="line"><span class="comment"># print(&#x27;主线程&#x27;)</span></span><br><span class="line"><span class="comment"># print(time.time()-ctime)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### time的io也要切换</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 猴子补丁：把原来的io全都替换成gevent的io</span></span><br><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey;monkey.patch_all()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">eat</span>(<span class="params">name</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(name, <span class="string">&#x27;在吃了一口&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(name, <span class="string">&#x27;在吃了第二口&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">play</span>(<span class="params">name</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(name, <span class="string">&#x27;玩了一下&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="built_in">print</span>(name, <span class="string">&#x27;玩了第二下&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">res1 = gevent.spawn(eat, <span class="string">&#x27;egon&#x27;</span>)</span><br><span class="line">res2 = gevent.spawn(play, <span class="string">&#x27;egon&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ctime=time.time()</span><br><span class="line"></span><br><span class="line">gevent.joinall([res1,res2])   <span class="comment"># 相当于上面那两句</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;主线程&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(time.time()-ctime)</span><br></pre></td></tr></table></figure>

<h2 id="asyncio"><a href="#asyncio" class="headerlink" title="asyncio"></a>asyncio</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 内置模块   python 3.4 推出这个模块，python作者主导的</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="comment"># 这个函数是协程函数</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">task</span>():</span></span><br><span class="line">    res=threading.current_thread().getName()</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;xxx&#x27;</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;协程执行完成&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">task2</span>():</span></span><br><span class="line">    res=threading.current_thread().getName()</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;2222&#x27;</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;222协程执行完成&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ctime=time.time()</span><br><span class="line">loop=asyncio.get_event_loop()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tasks=[task(),task2()]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">loop.run_until_complete(asyncio.wait(tasks))</span><br><span class="line">loop.close()</span><br><span class="line"><span class="built_in">print</span>(time.time()-ctime) </span><br></pre></td></tr></table></figure>

<h1 id=""><a href="#" class="headerlink" title=""></a></h1>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/03/11/%E8%BF%9B%E7%A8%8BQueue%E4%B8%8E%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85%E6%A8%A1%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/03/11/%E8%BF%9B%E7%A8%8BQueue%E4%B8%8E%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85%E6%A8%A1%E5%9E%8B/" class="post-title-link" itemprop="url">进程Queue与生产者消费者模型</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-03-11 07:20:25" itemprop="dateCreated datePublished" datetime="2019-03-11T07:20:25+08:00">2019-03-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2019-04-01 12:22:34" itemprop="dateModified" datetime="2019-04-01T12:22:34+08:00">2019-04-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E5%B9%B6%E5%8F%91%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">网络并发系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="进程Queue介绍"><a href="#进程Queue介绍" class="headerlink" title="进程Queue介绍"></a>进程Queue介绍</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 进程间数据隔离，两个进程进行通信，借助于Queue</span><br><span class="line"></span><br><span class="line"><span class="number">2</span> 进程间通信：IPC</span><br><span class="line">    -借助于Queue实现进程间通信</span><br><span class="line">    -借助于文件</span><br><span class="line">    </span><br><span class="line">    -借助于数据库</span><br><span class="line">    -借助于消息队列：rabbitmq，kafka....</span><br></pre></td></tr></table></figure>



<h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process,Queue</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># maxsize表示Queue的大小是多少，能放多少东西</span></span><br><span class="line">    queue=Queue(<span class="number">3</span>)</span><br><span class="line">    <span class="comment">## 放数据</span></span><br><span class="line">    queue.put(<span class="string">&#x27;zhangsan&#x27;</span>)</span><br><span class="line">    queue.put(<span class="string">&#x27;liss&#x27;</span>)</span><br><span class="line">    queue.put(<span class="string">&#x27;wwwww&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    queue.put(<span class="string">&#x27;wwwww&#x27;</span>,timeout=<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># queue.put_nowait(&#x27;sdafsd&#x27;)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># res=queue.get()</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># res=queue.get()</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    res=queue.get()</span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># # 卡住</span></span><br><span class="line">    <span class="comment"># # res=queue.get()</span></span><br><span class="line">    <span class="comment"># res=queue.get_nowait()</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">  <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">  # 实例化得到一个对象，数字表示queue的大小(默认不传参，可以当成无限大，但其实有最大值)</span></span><br><span class="line"><span class="string">  queue=Queue(3)</span></span><br><span class="line"><span class="string">  # 放值</span></span><br><span class="line"><span class="string">  # block:是否阻塞</span></span><br><span class="line"><span class="string">  # timeout：等待的时间</span></span><br><span class="line"><span class="string">  queue.put()</span></span><br><span class="line"><span class="string">  # 取值</span></span><br><span class="line"><span class="string">  # block:是否阻塞</span></span><br><span class="line"><span class="string">  # timeout：等待的时间</span></span><br><span class="line"><span class="string">  queue.get()</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  # 不等待，如果满了，就报错</span></span><br><span class="line"><span class="string">  queue.put_nowait()</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  # 去取值，如果没有值，直接报错</span></span><br><span class="line"><span class="string">  res=queue.get_nowait()</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  # 查看这个queue是否满</span></span><br><span class="line"><span class="string">  queue.full()</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  # 查看queue是否是空的</span></span><br><span class="line"><span class="string">  queue.empty()</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  # 查看queue中有几个值</span></span><br><span class="line"><span class="string">  queue.qsize()</span></span><br><span class="line"><span class="string">  &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="通过Queue实现进程间通信"><a href="#通过Queue实现进程间通信" class="headerlink" title="通过Queue实现进程间通信"></a>通过Queue实现进程间通信</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process,Queue</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span>(<span class="params">queue</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;我这个进程%s开始放数据了&#x27;</span>%os.getpid())</span><br><span class="line">    time.sleep(<span class="number">10</span>)</span><br><span class="line">    queue.put(<span class="string">&#x27;lqz is handsome&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%s我放完了&#x27;</span> % os.getpid())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment">#不写数字，表示可以任意长度</span></span><br><span class="line">    queue=Queue()</span><br><span class="line">    p=Process(target=task,args=[queue,])</span><br><span class="line">    p.start()</span><br><span class="line"></span><br><span class="line">    res=queue.get()  <span class="comment">#会卡在这</span></span><br><span class="line">    <span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure>



<h2 id="批量生产数据放入Queue再批量取出"><a href="#批量生产数据放入Queue再批量取出" class="headerlink" title="批量生产数据放入Queue再批量取出"></a>批量生产数据放入Queue再批量取出</h2><h2 id=""><a href="#" class="headerlink" title=""></a></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process,Queue</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_task</span>(<span class="params">queue</span>):</span></span><br><span class="line">    res=queue.get()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%s这个进程取了数据：%s&#x27;</span>%(os.getpid(),res))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">put_task</span>(<span class="params">queue</span>):</span></span><br><span class="line">    queue.put(<span class="string">&#x27;%s:放了数据&#x27;</span>%os.getpid())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    queue=Queue(<span class="number">1</span>)</span><br><span class="line">    p1=Process(target=put_task,args=[queue])</span><br><span class="line">    p2=Process(target=put_task,args=[queue])</span><br><span class="line">    p1.start()</span><br><span class="line">    p2.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    p3=Process(target=get_task,args=[queue])</span><br><span class="line">    p4=Process(target=get_task,args=[queue])</span><br><span class="line">    p3.start()</span><br><span class="line">    p4.start()</span><br></pre></td></tr></table></figure>

<h2 id="生产者消费者模型-重点"><a href="#生产者消费者模型-重点" class="headerlink" title="生产者消费者模型(重点)"></a>生产者消费者模型(重点)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process, Queue</span><br><span class="line"><span class="comment"># import os</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># import time</span></span><br><span class="line"><span class="comment"># import random</span></span><br><span class="line"><span class="comment"># def producer(queue):</span></span><br><span class="line"><span class="comment">#     # 生产的东西，放到Queue中</span></span><br><span class="line"><span class="comment">#     for i in range(10):</span></span><br><span class="line"><span class="comment">#         data = &#x27;%s这个厨师，整了第%s个包子&#x27; % (os.getpid(), i)</span></span><br><span class="line"><span class="comment">#         print(data)</span></span><br><span class="line"><span class="comment">#         # 模拟一下延迟</span></span><br><span class="line"><span class="comment">#         time.sleep(random.randint(1,3))</span></span><br><span class="line"><span class="comment">#         queue.put(&#x27;第%s个包子&#x27;%i)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># def consumer(queue):</span></span><br><span class="line"><span class="comment">#     # 消费者从queue中取数据，消费（吃包子）</span></span><br><span class="line"><span class="comment">#     while True:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#         res=queue.get()</span></span><br><span class="line"><span class="comment">#         # 模拟一下延迟</span></span><br><span class="line"><span class="comment">#         time.sleep(random.randint(1, 3))</span></span><br><span class="line"><span class="comment">#         print(&#x27;%s这个消费者，吃了%s&#x27;%(os.getpid(),res))</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># if __name__ == &#x27;__main__&#x27;:</span></span><br><span class="line"><span class="comment">#     queue=Queue(3)</span></span><br><span class="line"><span class="comment">#     p=Process(target=producer,args=[queue,])</span></span><br><span class="line"><span class="comment">#     p.start()</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     p1=Process(target=consumer,args=[queue,])</span></span><br><span class="line"><span class="comment">#     p1.start()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###### 改良（生产者以及不生产东西了，但是消费者还在等着拿）</span></span><br><span class="line"><span class="comment"># import os</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># import time</span></span><br><span class="line"><span class="comment"># import random</span></span><br><span class="line"><span class="comment"># def producer(queue):</span></span><br><span class="line"><span class="comment">#     # 生产的东西，放到Queue中</span></span><br><span class="line"><span class="comment">#     for i in range(10):</span></span><br><span class="line"><span class="comment">#         data = &#x27;%s这个厨师，整了第%s个包子&#x27; % (os.getpid(), i)</span></span><br><span class="line"><span class="comment">#         print(data)</span></span><br><span class="line"><span class="comment">#         # 模拟一下延迟</span></span><br><span class="line"><span class="comment">#         time.sleep(random.randint(1,3))</span></span><br><span class="line"><span class="comment">#         queue.put(&#x27;第%s个包子&#x27;%i)</span></span><br><span class="line"><span class="comment">#     # 生产完了，在queue中放一个None</span></span><br><span class="line"><span class="comment">#     queue.put(None)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># def consumer(queue):</span></span><br><span class="line"><span class="comment">#     # 消费者从queue中取数据，消费（吃包子）</span></span><br><span class="line"><span class="comment">#     while True:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#         res=queue.get()</span></span><br><span class="line"><span class="comment">#         if not res:break # 如果去到空，说明打烊了（生产者不生产了），退出</span></span><br><span class="line"><span class="comment">#         # 模拟一下延迟</span></span><br><span class="line"><span class="comment">#         time.sleep(random.randint(1, 3))</span></span><br><span class="line"><span class="comment">#         print(&#x27;%s这个消费者，吃了%s&#x27;%(os.getpid(),res))</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># if __name__ == &#x27;__main__&#x27;:</span></span><br><span class="line"><span class="comment">#     queue=Queue(3)</span></span><br><span class="line"><span class="comment">#     p=Process(target=producer,args=[queue,])</span></span><br><span class="line"><span class="comment">#     p.start()</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     p1=Process(target=consumer,args=[queue,])</span></span><br><span class="line"><span class="comment">#     p1.start()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#### 把put none 放在主进程中执行</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># import time</span></span><br><span class="line"><span class="comment"># import random</span></span><br><span class="line"><span class="comment"># def producer(queue):</span></span><br><span class="line"><span class="comment">#     # 生产的东西，放到Queue中</span></span><br><span class="line"><span class="comment">#     for i in range(10):</span></span><br><span class="line"><span class="comment">#         data = &#x27;%s这个厨师，整了第%s个包子&#x27; % (os.getpid(), i)</span></span><br><span class="line"><span class="comment">#         print(data)</span></span><br><span class="line"><span class="comment">#         # 模拟一下延迟</span></span><br><span class="line"><span class="comment">#         time.sleep(random.randint(1,3))</span></span><br><span class="line"><span class="comment">#         queue.put(&#x27;第%s个包子&#x27;%i)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># def consumer(queue):</span></span><br><span class="line"><span class="comment">#     # 消费者从queue中取数据，消费（吃包子）</span></span><br><span class="line"><span class="comment">#     while True:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#         res=queue.get()</span></span><br><span class="line"><span class="comment">#         if not res:break # 如果去到空，说明打烊了（生产者不生产了），退出</span></span><br><span class="line"><span class="comment">#         # 模拟一下延迟</span></span><br><span class="line"><span class="comment">#         time.sleep(random.randint(1, 3))</span></span><br><span class="line"><span class="comment">#         print(&#x27;%s这个消费者，吃了%s&#x27;%(os.getpid(),res))</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># if __name__ == &#x27;__main__&#x27;:</span></span><br><span class="line"><span class="comment">#     queue=Queue(3)</span></span><br><span class="line"><span class="comment">#     p=Process(target=producer,args=[queue,])</span></span><br><span class="line"><span class="comment">#     p.start()</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     p1=Process(target=consumer,args=[queue,])</span></span><br><span class="line"><span class="comment">#     p1.start()</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     # 如果把put None放在这，会有问题</span></span><br><span class="line"><span class="comment">#     # 主进程会先执行这句话，消费进程读到None，直接结束，生产者进程没有结束，于是生产一直在生产，消费已经不消费了</span></span><br><span class="line"><span class="comment">#     # 直到Queue满了，就一直卡在这了</span></span><br><span class="line"><span class="comment">#     # queue.put(None)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     ### 现在就要放在这，你把问题解决</span></span><br><span class="line"><span class="comment">#     p.join()</span></span><br><span class="line"><span class="comment">#     queue.put(None)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="多个生产者多个消费者的生产者消费者模型"><a href="#多个生产者多个消费者的生产者消费者模型" class="headerlink" title="多个生产者多个消费者的生产者消费者模型"></a>多个生产者多个消费者的生产者消费者模型</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 多个生产者在生产，多个消费者在消费</span></span><br><span class="line"><span class="comment"># import time</span></span><br><span class="line"><span class="comment"># import random</span></span><br><span class="line"><span class="comment"># def producer(queue,food):</span></span><br><span class="line"><span class="comment">#     # 生产的东西，放到Queue中</span></span><br><span class="line"><span class="comment">#     for i in range(10):</span></span><br><span class="line"><span class="comment">#         data = &#x27;%s这个厨师，做了第%s个%s&#x27; % (os.getpid(), i,food)</span></span><br><span class="line"><span class="comment">#         print(data)</span></span><br><span class="line"><span class="comment">#         # 模拟一下延迟</span></span><br><span class="line"><span class="comment">#         time.sleep(random.randint(1,3))</span></span><br><span class="line"><span class="comment">#         queue.put(&#x27;第%s个%s&#x27;%(i,food))</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># def consumer(queue):</span></span><br><span class="line"><span class="comment">#     # 消费者从queue中取数据，消费（吃包子）</span></span><br><span class="line"><span class="comment">#     while True:</span></span><br><span class="line"><span class="comment">#         res=queue.get()</span></span><br><span class="line"><span class="comment">#         if not res:break # 如果去到空，说明打烊了（生产者不生产了），退出</span></span><br><span class="line"><span class="comment">#         # 模拟一下延迟</span></span><br><span class="line"><span class="comment">#         time.sleep(random.randint(1, 3))</span></span><br><span class="line"><span class="comment">#         print(&#x27;%s这个消费者，吃了%s&#x27;%(os.getpid(),res))</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># if __name__ == &#x27;__main__&#x27;:</span></span><br><span class="line"><span class="comment">#     queue=Queue(3)</span></span><br><span class="line"><span class="comment">#     ##起了三个生产者</span></span><br><span class="line"><span class="comment">#     p1=Process(target=producer,args=[queue,&#x27;包子&#x27;])</span></span><br><span class="line"><span class="comment">#     p2=Process(target=producer,args=[queue,&#x27;骨头&#x27;])</span></span><br><span class="line"><span class="comment">#     p3=Process(target=producer,args=[queue,&#x27;泔水&#x27;])</span></span><br><span class="line"><span class="comment">#     p1.start()</span></span><br><span class="line"><span class="comment">#     p2.start()</span></span><br><span class="line"><span class="comment">#     p3.start()</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     # 起了两个消费者</span></span><br><span class="line"><span class="comment">#     c1=Process(target=consumer,args=[queue,])</span></span><br><span class="line"><span class="comment">#     c2=Process(target=consumer,args=[queue,])</span></span><br><span class="line"><span class="comment">#     c1.start()</span></span><br><span class="line"><span class="comment">#     c2.start()</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     ##等三个生产者都生产完，放三个None</span></span><br><span class="line"><span class="comment">#     p1.join()</span></span><br><span class="line"><span class="comment">#     p2.join()</span></span><br><span class="line"><span class="comment">#     p3.join()</span></span><br><span class="line"><span class="comment">#     queue.put(None)</span></span><br><span class="line"><span class="comment">#     queue.put(None)</span></span><br><span class="line"><span class="comment">#     queue.put(None)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##如果消费者多，比生产者多出来的消费者不会停</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">producer</span>(<span class="params">queue, food,name</span>):</span></span><br><span class="line">    <span class="comment"># 生产的东西，放到Queue中</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        data = <span class="string">&#x27;%s:这个厨师，做了第%s个%s&#x27;</span> % (name, i, food)</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line">        <span class="comment"># 模拟一下延迟</span></span><br><span class="line">        time.sleep(random.randint(<span class="number">1</span>, <span class="number">3</span>))</span><br><span class="line">        queue.put(<span class="string">&#x27;第%s个%s&#x27;</span> % (i, food))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">consumer</span>(<span class="params">queue,name</span>):</span></span><br><span class="line">    <span class="comment"># 消费者从queue中取数据，消费（吃包子）</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            res = queue.get(timeout=<span class="number">20</span>)</span><br><span class="line">            <span class="comment"># 模拟一下延迟</span></span><br><span class="line">            time.sleep(random.randint(<span class="number">1</span>, <span class="number">3</span>))</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;%s这个消费者，吃了%s&#x27;</span> % (name, res))</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(e)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    queue = Queue(<span class="number">3</span>)</span><br><span class="line">    <span class="comment"># 起了三个生产者</span></span><br><span class="line">    p1 = Process(target=producer, args=[queue, <span class="string">&#x27;包子&#x27;</span>,<span class="string">&#x27;egon&#x27;</span>])</span><br><span class="line">    p2 = Process(target=producer, args=[queue, <span class="string">&#x27;骨头&#x27;</span>,<span class="string">&#x27;lqz&#x27;</span>])</span><br><span class="line">    p3 = Process(target=producer, args=[queue, <span class="string">&#x27;泔水&#x27;</span>,<span class="string">&#x27;jsason&#x27;</span>])</span><br><span class="line">    p1.start()</span><br><span class="line">    p2.start()</span><br><span class="line">    p3.start()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 起了两个消费者</span></span><br><span class="line">    c1 = Process(target=consumer, args=[queue, <span class="string">&#x27;孟良&#x27;</span>])</span><br><span class="line">    c2 = Process(target=consumer, args=[queue,<span class="string">&#x27;池劲涛&#x27;</span> ])</span><br><span class="line">    c3 = Process(target=consumer, args=[queue,<span class="string">&#x27;池劲涛&#x27;</span> ])</span><br><span class="line">    c4 = Process(target=consumer, args=[queue,<span class="string">&#x27;池劲涛&#x27;</span> ])</span><br><span class="line">    c1.start()</span><br><span class="line">    c2.start()</span><br><span class="line">    c3.start()</span><br><span class="line">    c4.start()</span><br></pre></td></tr></table></figure>

<h2 id="进程间数据共享（了解）"><a href="#进程间数据共享（了解）" class="headerlink" title="进程间数据共享（了解）"></a>进程间数据共享（了解）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process,Manager,Lock</span><br><span class="line"></span><br><span class="line"><span class="comment"># 魔法方法：类内以__开头__结尾的方法，都叫魔法方法,某种情况下会触发它的执行</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">__init__ ：类()触发</span></span><br><span class="line"><span class="string">__new__：</span></span><br><span class="line"><span class="string">__getattr__</span></span><br><span class="line"><span class="string">__setattr__</span></span><br><span class="line"><span class="string">__getitem__</span></span><br><span class="line"><span class="string">__setitem__</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># def task(dic,lock):</span></span><br><span class="line"><span class="comment">#     # lock.acquire()</span></span><br><span class="line"><span class="comment">#     # dic[&#x27;count&#x27;]-=1</span></span><br><span class="line"><span class="comment">#     # lock.release()</span></span><br><span class="line"><span class="comment">#     with lock:</span></span><br><span class="line"><span class="comment">#         dic[&#x27;count&#x27;] -= 1</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># if __name__ == &#x27;__main__&#x27;:</span></span><br><span class="line"><span class="comment">#     lock = Lock()</span></span><br><span class="line"><span class="comment">#     with Manager() as m:</span></span><br><span class="line"><span class="comment">#         # 如果直接定义dict，这个dict在多个进程中其实是多份，进程如果改，只改了自己的</span></span><br><span class="line"><span class="comment">#         #如果定义的是m.dict(&#123;&#x27;count&#x27;: 100&#125;)，多个进程之间就可以共享这个数据</span></span><br><span class="line"><span class="comment">#         dic = m.dict(&#123;&#x27;count&#x27;: 100&#125;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#         p_l = []</span></span><br><span class="line"><span class="comment">#         for i in range(100):</span></span><br><span class="line"><span class="comment">#             p = Process(target=task, args=(dic, lock))</span></span><br><span class="line"><span class="comment">#             p_l.append(p)</span></span><br><span class="line"><span class="comment">#             p.start()</span></span><br><span class="line"><span class="comment">#         for p in p_l:</span></span><br><span class="line"><span class="comment">#             p.join()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span>(<span class="params">dic,lock</span>):</span></span><br><span class="line">    <span class="keyword">with</span> lock:</span><br><span class="line">        dic[<span class="string">&#x27;count&#x27;</span>] -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    lock = Lock()</span><br><span class="line">    dic=&#123;<span class="string">&#x27;count&#x27;</span>:<span class="number">100</span>&#125;</span><br><span class="line">    p_l = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">        p = Process(target=task, args=(dic, lock))</span><br><span class="line">        p_l.append(p)</span><br><span class="line">        p.start()</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> p_l:</span><br><span class="line">        p.join()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(dic)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="线程概念"><a href="#线程概念" class="headerlink" title="线程概念"></a>线程概念</h2><h2 id="-1"><a href="#-1" class="headerlink" title=""></a></h2><p> <strong>如果把我们上课的过程看成一个进程的话，那么我们要做的是耳朵听老师讲课，手上还要记笔记，脑子还要思考问题，这样才能高效的完成听课的任务。</strong></p>
<p><strong>而如果只提供进程这个机制的话，上面这三件事将不能同时执行，同一时间只能做一件事，听的时候就不能记笔记，也不能用脑子思考，这是其一；</strong></p>
<p><strong>如果老师在黑板上写演算过程，我们开始记笔记，而老师突然有一步推不下去了，阻塞住了，他在那边思考着，而我们呢，也不能干其他事，即使你想趁此时思考一下刚才没听懂的一个问题都不行，这是其二</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进程是资源分配的最小单位，线程是CPU调度的最小单位。每一个进程中至少有一个线程。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">from</span> queue <span class="keyword">import</span> Queue</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span>():</span></span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;我是子线程执行的&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(os.getpid())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 启动线程</span></span><br><span class="line"></span><br><span class="line">    ctime = time.time()</span><br><span class="line">    t = Thread(target=task)</span><br><span class="line">    t.start()</span><br><span class="line">    <span class="comment"># task()</span></span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="built_in">print</span>(os.getpid())</span><br><span class="line">    <span class="built_in">print</span>(time.time() - ctime)</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> Queue:进程间通信</span><br><span class="line">    -实例化得到一个对象</span><br><span class="line">    -对象.put()</span><br><span class="line">    -对象.get()</span><br><span class="line">    </span><br><span class="line"><span class="number">2</span> 生产者消费者模型</span><br><span class="line"></span><br><span class="line"><span class="number">3</span> 通过共享变量来共享数据（进程间数据是隔离的）</span><br><span class="line">	-Manager实现多个进程操作同一个变量</span><br><span class="line">    -加锁</span><br><span class="line">    </span><br><span class="line"><span class="number">4</span> 线程，每个进程下最少有一个线程，cup调度的最小单位</span><br><span class="line"></span><br><span class="line"><span class="number">5</span> python如何开启线程</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/03/11/%E8%BF%9B%E7%A8%8B%E8%B0%83%E5%BA%A6%E3%80%81%E8%BF%9B%E7%A8%8B%E5%90%8C%E6%AD%A5%E4%B8%8E%E8%BF%9B%E7%A8%8B%E9%94%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/03/11/%E8%BF%9B%E7%A8%8B%E8%B0%83%E5%BA%A6%E3%80%81%E8%BF%9B%E7%A8%8B%E5%90%8C%E6%AD%A5%E4%B8%8E%E8%BF%9B%E7%A8%8B%E9%94%81/" class="post-title-link" itemprop="url">进程调度、进程同步与进程锁</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-03-11 07:20:25" itemprop="dateCreated datePublished" datetime="2019-03-11T07:20:25+08:00">2019-03-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2019-04-01 12:22:34" itemprop="dateModified" datetime="2019-04-01T12:22:34+08:00">2019-04-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E5%B9%B6%E5%8F%91%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">网络并发系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="进程调度算法-了解"><a href="#进程调度算法-了解" class="headerlink" title="进程调度算法(了解)"></a>进程调度算法(了解)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先来先服务调度算法</span></span><br><span class="line"><span class="comment"># 短作业优先调度算法</span></span><br><span class="line"><span class="comment"># 时间片轮转法</span></span><br><span class="line"><span class="comment"># 多级反馈队列</span></span><br></pre></td></tr></table></figure>



<h2 id="同步异步，阻塞非阻塞（了解）"><a href="#同步异步，阻塞非阻塞（了解）" class="headerlink" title="同步异步，阻塞非阻塞（了解）"></a>同步异步，阻塞非阻塞（了解）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 同步调用：提交了以后，一直等待结果返回</span><br><span class="line"><span class="number">2</span> 异步调用：提交了以后，返回一个标志，等执行完成后，有消息通知</span><br><span class="line"><span class="number">3</span> 同步，异步：指的是消息通知机制</span><br><span class="line"></span><br><span class="line"><span class="number">4</span> 阻塞，非阻塞：程序在等待调用结果的状态</span><br><span class="line"><span class="number">5</span> 同步阻塞：打电话要买书，如果电话没挂，我也一直在等待，</span><br><span class="line"><span class="number">6</span> 同步非阻塞：打电话买书，电话没挂，我一边干别的事，一边听一下电话</span><br><span class="line"><span class="number">7</span> 异步阻塞：打电话买书，电话先挂掉，过一会老板会回回来（回调），老板给回电话的过程一直在等待</span><br><span class="line"><span class="number">8</span> 异步非阻塞：打电话买书，电话先挂掉，过一会老板会回回来（回调），老板给回电话的过程中，在干别的事</span><br></pre></td></tr></table></figure>

<h2 id="Process类的参数（重点）"><a href="#Process类的参数（重点）" class="headerlink" title="Process类的参数（重点）"></a>Process类的参数（重点）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span>(<span class="params">name,age</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line">    <span class="built_in">print</span>(age)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># p=Process(target=task,args=[&#x27;lqz&#x27;,18])</span></span><br><span class="line">    <span class="comment"># p=Process(target=task,kwargs=&#123;&#x27;age&#x27;:19,&#x27;name&#x27;:&#x27;lqz&#x27;&#125;,name=&#x27;process01&#x27;)</span></span><br><span class="line">    p=Process(target=task,kwargs=&#123;<span class="string">&#x27;age&#x27;</span>:<span class="number">19</span>,<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;lqz&#x27;</span>&#125;)</span><br><span class="line">    p2=Process(target=task,kwargs=&#123;<span class="string">&#x27;age&#x27;</span>:<span class="number">19</span>,<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;lqz&#x27;</span>&#125;)</span><br><span class="line">    p.start()</span><br><span class="line">    p2.start()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(p.name)</span><br><span class="line">    <span class="built_in">print</span>(p2.name)</span><br><span class="line">    <span class="comment"># target=None, 你要执行的任务，函数</span></span><br><span class="line">    <span class="comment"># name=None,  进程名</span></span><br><span class="line">    <span class="comment"># args=(),    以位置参数给任务（函数）传递参数</span></span><br><span class="line">    <span class="comment"># kwargs=&#123;&#125;   以关键字的形式给任务（函数）传递参数</span></span><br></pre></td></tr></table></figure>

<h2 id="Process类的方法，属性（重点）"><a href="#Process类的方法，属性（重点）" class="headerlink" title="Process类的方法，属性（重点）"></a>Process类的方法，属性（重点）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span>(<span class="params">name,age</span>):</span></span><br><span class="line">    time.sleep(<span class="number">10</span>)</span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line">    <span class="built_in">print</span>(age)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    p=Process(target=task,kwargs=&#123;<span class="string">&#x27;age&#x27;</span>:<span class="number">19</span>,<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;lqz&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    p.start()  <span class="comment">#启动进程,必须调用start</span></span><br><span class="line">    <span class="comment"># p.run()    # 实际进程在执行的时候，执行的是run方法,但是调用run不会开进程，后面我们另一种开启进程的方案使用到它</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># p.join()    # 等待子进程执行完成</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(p.is_alive())   <span class="comment">#True</span></span><br><span class="line"></span><br><span class="line">    p.terminate() <span class="comment"># 杀死p这个进程，通知操作系统去杀死该进程</span></span><br><span class="line">    time.sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(p.is_alive())  <span class="comment">#可能还是True</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ssss&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(p.is_alive())  <span class="comment">#就是False</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(p)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">掌握↓↓↓ </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">p.start()  #启动进程,必须调用start</span></span><br><span class="line"><span class="string">p.run()    # 实际进程在执行的时候，执行的是run方法,但是调用run不会开进程，后面我们另一种开启进程的方案使用到它</span></span><br><span class="line"><span class="string">p.join()    # 等待子进程执行完成</span></span><br><span class="line"><span class="string">p.terminate() # 杀死p这个进程，通知操作系统去杀死该进程,并不是立即结束</span></span><br><span class="line"><span class="string">p.is_alive() #进程是否还存活</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span>(<span class="params">name,age</span>):</span></span><br><span class="line">    time.sleep(<span class="number">10</span>)</span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line">    <span class="built_in">print</span>(age)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    p=Process(target=task,kwargs=&#123;<span class="string">&#x27;age&#x27;</span>:<span class="number">19</span>,<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;lqz&#x27;</span>&#125;)</span><br><span class="line">    <span class="comment"># p.start()</span></span><br><span class="line">    <span class="comment"># print(p.name) # 进程名字</span></span><br><span class="line">    <span class="comment"># p.daemon=True  #主进程结束，子进程也结束，必须在start之前调用</span></span><br><span class="line">    p.start()</span><br><span class="line">    <span class="built_in">print</span>(p.pid)  <span class="comment"># 进程id号</span></span><br><span class="line">    time.sleep(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">掌握↓↓↓ </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">print(p.name) # 进程名字</span></span><br><span class="line"><span class="string">print(p.pid)  # 进程id号</span></span><br><span class="line"><span class="string">p.daemon=True  #主进程结束，子进程也结束，必须在start之前调用</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="主进程和子进程的进程号"><a href="#主进程和子进程的进程号" class="headerlink" title="主进程和子进程的进程号"></a>主进程和子进程的进程号</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span>(<span class="params">name,age</span>):</span></span><br><span class="line">    <span class="comment"># 如果在任务中取出进程id号，需要使用os模块</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;当前进程（子进程）id号是：&#x27;</span>,os.getpid()) <span class="comment">#当前进程id号</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;当前进程父进程的id号是：&#x27;</span>,os.getppid()) <span class="comment"># 当前进程父进程的id号</span></span><br><span class="line">    time.sleep(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line">    <span class="built_in">print</span>(age)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    p=Process(target=task,kwargs=&#123;<span class="string">&#x27;age&#x27;</span>:<span class="number">19</span>,<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;lqz&#x27;</span>&#125;)</span><br><span class="line">    p.start()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;p这个进程的id号是：&#x27;</span>,p.pid)  <span class="comment"># 进程id号</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;当前进程id（主进程）号是：&#x27;</span>, os.getpid())  <span class="comment"># 当前进程id号</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;当前进程父进程（pycharm）的id号是：&#x27;</span>, os.getppid())  <span class="comment"># 当前进程父进程的id号</span></span><br><span class="line">    time.sleep(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">掌握↓↓↓ </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">如果有p对象，就是用p.pid获取进程id号</span></span><br><span class="line"><span class="string">如果没有p对象，就是用os模块的</span></span><br><span class="line"><span class="string">os.getpid() #当前进程id号</span></span><br><span class="line"><span class="string">os.getppid() #父进程id号</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="同时开启多个进程"><a href="#同时开启多个进程" class="headerlink" title="同时开启多个进程"></a>同时开启多个进程</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment"># def task(name,age):</span></span><br><span class="line"><span class="comment">#     time.sleep(10)</span></span><br><span class="line"><span class="comment">#     print(name)</span></span><br><span class="line"><span class="comment">#     print(age)</span></span><br><span class="line"><span class="comment"># def task1():</span></span><br><span class="line"><span class="comment">#     time.sleep(2)</span></span><br><span class="line"><span class="comment">#     print(&quot;我是task1&quot;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># if __name__ == &#x27;__main__&#x27;:</span></span><br><span class="line"><span class="comment">#     p=Process(target=task,kwargs=&#123;&#x27;age&#x27;:19,&#x27;name&#x27;:&#x27;lqz&#x27;&#125;)</span></span><br><span class="line"><span class="comment">#     p.start()</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     p1=Process(target=task1)</span></span><br><span class="line"><span class="comment">#     p1.start()</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     print(&#x27;主进程&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task1</span>(<span class="params">i</span>):</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;我是task1&quot;</span>,i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    ctime=time.time()</span><br><span class="line">    ll=[]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        p1=Process(target=task1,args=[i,])</span><br><span class="line">        p1.start()</span><br><span class="line">        p1.join()  <span class="comment">#等待子进程执行完成</span></span><br><span class="line">        <span class="comment"># ll.append(p1)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># for p in ll:</span></span><br><span class="line">    <span class="comment">#     p.join()</span></span><br><span class="line">    [p.join()<span class="keyword">for</span> p <span class="keyword">in</span> ll]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;主进程&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(time.time()-ctime)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">掌握↓↓↓     </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">开启多个进程</span></span><br><span class="line"><span class="string">如果想等待多个进程同时执行完，先把进程开启完成，再统一join</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="开启进程的另一种方案"><a href="#开启进程的另一种方案" class="headerlink" title="开启进程的另一种方案"></a>开启进程的另一种方案</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 通过继承Process类的方式来实现,重写run方法，run方法就是你要执行的任务,实例化得到对象，调用start方法开启进程</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyProcess</span>(<span class="params">Process</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name1,age</span>):</span></span><br><span class="line">        self.name1=name1</span><br><span class="line">        self.age=age</span><br><span class="line">        <span class="comment"># 这个必须写</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>) :</span></span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line">        <span class="built_in">print</span>(self.name)</span><br><span class="line">        <span class="built_in">print</span>(self.name1)</span><br><span class="line">        <span class="built_in">print</span>(self.age)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    p=MyProcess(<span class="string">&#x27;lqz&#x27;</span>,<span class="number">19</span>)</span><br><span class="line">    p.start() <span class="comment">#调用p.start(),不要调用run</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;主进程&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="进程之间数据隔离"><a href="#进程之间数据隔离" class="headerlink" title="进程之间数据隔离"></a>进程之间数据隔离</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;我是task&#x27;</span>)</span><br><span class="line">    <span class="keyword">global</span> n</span><br><span class="line">    n=<span class="number">100</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;子进程的：&#x27;</span>,n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 在主进程中定义了一个n=10</span></span><br><span class="line">    n=<span class="number">10</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">###如果这样写，n会被改掉</span></span><br><span class="line">    <span class="comment"># task()</span></span><br><span class="line">    <span class="comment"># print(n)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">##如果这样写，n不会被改掉</span></span><br><span class="line">    p=Process(target=task)</span><br><span class="line">    p.start()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;主进程的：&#x27;</span>,n)</span><br></pre></td></tr></table></figure>

<h2 id="高并发的TCP服务端"><a href="#高并发的TCP服务端" class="headerlink" title="高并发的TCP服务端"></a>高并发的TCP服务端</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">talk</span>(<span class="params">sock,addr</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;客户端连接成功&#x27;</span>,addr)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data = sock.recv(<span class="number">1024</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(data) == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;从客户端收到了：&#x27;</span>, data)</span><br><span class="line">            sock.send(data.upper())</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(e)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    sock.close()</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    server = socket.socket()</span><br><span class="line">    server.bind((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">81</span>))</span><br><span class="line">    server.listen(<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;等待客户端连接&#x27;</span>)</span><br><span class="line">        sock, addr = server.accept()</span><br><span class="line">        p=Process(target=talk,args=[sock,addr])</span><br><span class="line">        p.start()</span><br><span class="line">    server.close()</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;我是task&#x27;</span>)</span><br><span class="line">    <span class="keyword">global</span> n</span><br><span class="line">    n=<span class="number">100</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;子进程的：&#x27;</span>,n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 在主进程中定义了一个n=10</span></span><br><span class="line">    n=<span class="number">10</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">###如果这样写，n会被改掉</span></span><br><span class="line">    <span class="comment"># task()</span></span><br><span class="line">    <span class="comment"># print(n)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">##如果这样写，n不会被改掉</span></span><br><span class="line">    p=Process(target=task)</span><br><span class="line">    p.start()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;主进程的：&#x27;</span>,n)</span><br></pre></td></tr></table></figure>

<h2 id="进程同步-进程锁-（次重点）"><a href="#进程同步-进程锁-（次重点）" class="headerlink" title="进程同步(进程锁)（次重点）"></a>进程同步(进程锁)（次重点）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="comment">## 不加锁</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process,Lock</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 查询票余额</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span>(<span class="params">i</span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;ticket&#x27;</span>, <span class="string">&#x27;rt&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        res = json.load(f)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%s:在查询票，票还剩%s张&#x27;</span> % (i, res[<span class="string">&#x27;count&#x27;</span>]))</span><br><span class="line">    <span class="keyword">if</span> res[<span class="string">&#x27;count&#x27;</span>] &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 抢票，票的余额减一</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">buy</span>(<span class="params">i</span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;ticket&#x27;</span>, <span class="string">&#x27;rt&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        res = json.load(f)</span><br><span class="line">    time.sleep(<span class="number">1</span>)  <span class="comment"># 模拟查票延迟</span></span><br><span class="line">    <span class="keyword">if</span> res[<span class="string">&#x27;count&#x27;</span>] &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;%s现在要买了，票数还是大于0&#x27;</span>%i)</span><br><span class="line">        res[<span class="string">&#x27;count&#x27;</span>] -= <span class="number">1</span></span><br><span class="line">        time.sleep(<span class="number">2</span>)  <span class="comment"># 模拟买票延迟</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;ticket&#x27;</span>, <span class="string">&#x27;wt&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f1:</span><br><span class="line">            json.dump(res, f1)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;%s这个人购票成功&#x27;</span> % i)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;%s这个人购票失败，票不够了，买不了了&#x27;</span> % i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span>(<span class="params">i,lock</span>):</span></span><br><span class="line">    res = check(i)</span><br><span class="line">    <span class="keyword">if</span> res:</span><br><span class="line">        lock.acquire()</span><br><span class="line">        buy(i)</span><br><span class="line">        lock.release()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##模拟10个人买票</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    lock=Lock()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        p = Process(target=task, args=[i,lock ])</span><br><span class="line">        p.start()</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h2 id=""><a href="#" class="headerlink" title=""></a></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 进程调度算法</span><br><span class="line">	-先来先服务</span><br><span class="line">    -短作业有限</span><br><span class="line">    -时间片轮转</span><br><span class="line">    -多级反馈队列</span><br><span class="line">    </span><br><span class="line"><span class="number">2</span> 同步，异步；阻塞，非阻塞</span><br><span class="line">	-同步和异步：指的是回调方式，如果有回调，就是异步，如果同步等待就是同步</span><br><span class="line">    -阻塞，非阻塞：指等待消息结果时的状态，如果在等的过程中，干了别的事，就是非阻塞，如果一直等就是阻塞</span><br><span class="line"><span class="number">3</span> 进程类Process类，实例化的时候的参数：</span><br><span class="line">	-target：要执行的任务</span><br><span class="line">    -args：以位置形式给任务传值</span><br><span class="line">    -kwargs：以关键字给任务传值</span><br><span class="line">    -name：进程名字（如果不写，会有个默认名字）</span><br><span class="line">    </span><br><span class="line"><span class="number">4</span> 进程对象的属性和方法</span><br><span class="line">	-属性</span><br><span class="line">    	-name</span><br><span class="line">        -pid：进程<span class="built_in">id</span>号，如果没有这个对象，需要借助os.getpid(),os.getppid()</span><br><span class="line">        -daemon:守护进程，如果设置为<span class="literal">True</span>，主进程挂掉，这个进程也会挂掉，需要在p.start之前执行</span><br><span class="line">    -方法：</span><br><span class="line">    	-is_alive()  进程是否存活</span><br><span class="line">        -terminate()  停止该进程</span><br><span class="line">        -join()       等待子进程执行结束，主进程再继续执行</span><br><span class="line">        -start()      子进程要执行，必须调用它</span><br><span class="line">        -run()        真正的任务</span><br><span class="line">        </span><br><span class="line"><span class="number">5</span> 开启进程的另一种方式（类的继承）</span><br><span class="line">	写一个类，继承Process类</span><br><span class="line">    重写run方法，就是你的任务</span><br><span class="line">    实例化得到我们写的类，调用这个类对象的.start()</span><br><span class="line">    </span><br><span class="line"><span class="number">6</span> 进程间数据是隔离的</span><br><span class="line"></span><br><span class="line"><span class="number">7</span> 进程锁</span><br><span class="line">	-多个进程操作同一个数据（文件中的数据，而不是内存中的数据：）</span><br><span class="line">    -lock=Lock()</span><br><span class="line">    -加锁：lock.acquire()</span><br><span class="line">    -解锁：lock.release()</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/03/11/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/03/11/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" class="post-title-link" itemprop="url">网络编程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-03-11 07:20:25" itemprop="dateCreated datePublished" datetime="2019-03-11T07:20:25+08:00">2019-03-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2019-04-01 12:22:34" itemprop="dateModified" datetime="2019-04-01T12:22:34+08:00">2019-04-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E5%B9%B6%E5%8F%91%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">网络并发系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="网络编程"><a href="#网络编程" class="headerlink" title="网络编程"></a>网络编程</h1><h2 id="osi-七层，tcp-ip-五层"><a href="#osi-七层，tcp-ip-五层" class="headerlink" title="osi 七层，tcp/ip 五层"></a>osi 七层，tcp/ip 五层</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> cs架构和bs架构</span><br><span class="line"></span><br><span class="line"><span class="number">2</span> 互联网</span><br><span class="line"></span><br><span class="line"><span class="number">3</span> osi七层 tcp/ip五层</span><br><span class="line">        -物理层</span><br><span class="line">            -网线、光纤</span><br><span class="line">        -数据链路层</span><br><span class="line">            -网卡</span><br><span class="line">        -网络层</span><br><span class="line">            -路由器</span><br><span class="line">        -传输层(也叫运输层)</span><br><span class="line">            -四层路由器</span><br><span class="line">        -应用层(会话层、表示层、应用层)</span><br><span class="line">            http协议、ftp协议、websocket协议...</span><br></pre></td></tr></table></figure>

<h2 id="每一层功能"><a href="#每一层功能" class="headerlink" title="每一层功能"></a>每一层功能</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 物理层</span><br><span class="line">    -网线 ----&gt; <span class="number">1010101</span>电信号 -----&gt; 从网线中传输电信号</span><br><span class="line">    -<span class="number">8</span>个比特位是<span class="number">1</span>个字节(重要)</span><br><span class="line"><span class="number">2</span> 数据链路层</span><br><span class="line">    -数据帧: 一组电信号就是一个数据帧/数据报，有头和数据部分</span><br><span class="line">    -网卡: ----&gt; mac地址 ----&gt; 全球唯一 -----&gt;网卡出厂----&gt;烧在网卡上</span><br><span class="line">    -<span class="number">48</span>位二进制 ----&gt; 看到的都是<span class="number">16</span>进制表示</span><br><span class="line">    -广播:</span><br><span class="line">        -局域网内通信，所有人都会接收到，通过mac地址确定是给谁的数据帧/数据报，如果不是自己的就不处理</span><br><span class="line">    -广播风暴</span><br><span class="line"><span class="number">3</span> 网络层</span><br><span class="line">    -跨局域网通信，需要经过网络层</span><br><span class="line">    -IP地址</span><br><span class="line">    -子网掩码</span><br><span class="line">    -ARP协议 : ip和mac的对照表</span><br><span class="line"><span class="number">4</span> 传输层</span><br><span class="line">    -端口: <span class="number">0</span>-<span class="number">65535</span>， 一个应用程序可以监听多个端口，但是一个端口只能属于一个应用程序</span><br><span class="line">    -TCP协议: 可靠传输</span><br><span class="line">    -UDP协议: 不可靠传输</span><br></pre></td></tr></table></figure>

<h2 id="常用端口号"><a href="#常用端口号" class="headerlink" title="常用端口号"></a>常用端口号</h2><table>
<thead>
<tr>
<th>应用程序</th>
<th>FTP</th>
<th>TFTP</th>
<th>TELNET</th>
<th>SMTP</th>
<th>DNS</th>
<th>HTTP</th>
<th>SSH</th>
<th>MYSQL</th>
</tr>
</thead>
<tbody><tr>
<td>熟知端口</td>
<td>21,20</td>
<td>69</td>
<td>23</td>
<td>25</td>
<td>53</td>
<td>80</td>
<td>22</td>
<td>3306</td>
</tr>
<tr>
<td>传输层协议</td>
<td>TCP</td>
<td>UDP</td>
<td>TCP</td>
<td>TCP</td>
<td>UDP</td>
<td>TCP</td>
<td>TCP</td>
<td>TCP</td>
</tr>
</tbody></table>
<p><strong>DNS： 把网址转换成IP地址</strong><br><strong>从浏览器发出去的数据，都是http协议，默认是80端口</strong></p>
<h2 id="TCP-三次握手四次挥手"><a href="#TCP-三次握手四次挥手" class="headerlink" title="TCP 三次握手四次挥手"></a>TCP 三次握手四次挥手</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> TCP：可靠传输：三次握手，四次挥手保证数据可靠</span><br><span class="line"></span><br><span class="line"><span class="number">2</span> 三次握手</span><br><span class="line">    -客户端向服务端发送链接请求    ----<span class="number">1</span></span><br><span class="line">    -服务端回复可以建立你，并且带着跟客户端建立链接的数据报  ----<span class="number">2</span></span><br><span class="line">    -客户端收到后，链接建好了     ----<span class="number">3</span></span><br><span class="line"><span class="number">3</span> 这个过程后就可以可靠传输数据</span><br><span class="line"></span><br><span class="line"><span class="number">4</span> 断开链接(四次挥手)</span><br><span class="line">    -客户端告诉服务器，要断开    ----<span class="number">1</span></span><br><span class="line">    -服务端收到，回复ok         ----<span class="number">2</span></span><br><span class="line">    -服务端可能还有数据在传递，暂时还没断开-----等数据传完</span><br><span class="line">    -服务端告诉客户端，我要断了   ----<span class="number">3</span></span><br><span class="line">    -客户端收到，回复ok         ----<span class="number">4</span></span><br></pre></td></tr></table></figure>

<h2 id="Socket层"><a href="#Socket层" class="headerlink" title="Socket层"></a>Socket层</h2><p><strong>1 Socket抽象层，从osi七层抽象出来的，抽象了网络层和传输层，跟语言无关，任何语言都会有socket的封装</strong><br><strong>2 专门给开发人员用的</strong></p>
<h2 id="基于TCP的socket套接字-重点"><a href="#基于TCP的socket套接字-重点" class="headerlink" title="基于TCP的socket套接字(重点)"></a>基于TCP的socket套接字(重点)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(简易版本)</span><br><span class="line">服务端</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">sever = socket.socket()</span><br><span class="line">sever.bind((<span class="string">&#x27;192.168.11.123&#x27;</span>, <span class="number">7777</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;服务端启动完成，等待连接...&#x27;</span>)</span><br><span class="line">sever.listen(<span class="number">5</span>)</span><br><span class="line">sock, addr = sever.accept()</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    data = sock.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;客户端发来的信息&#x27;</span>, data.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    msg = <span class="built_in">input</span>(<span class="string">&#x27;请输入: &#x27;</span>).strip()</span><br><span class="line">    <span class="keyword">if</span> msg == <span class="string">&#x27;q&#x27;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    sock.send(msg.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">sock.close()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">(客户端)</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">client = socket.socket()</span><br><span class="line">client.connect((<span class="string">&#x27;192.168.11.123&#x27;</span>, <span class="number">7777</span>))</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    msg = <span class="built_in">input</span>(<span class="string">&#x27;请输入: &#x27;</span>).strip()</span><br><span class="line">    <span class="keyword">if</span> msg ==<span class="string">&#x27;q&#x27;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    client.send(msg.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    data = client.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;服务端发来的信息: &#x27;</span>,data.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    client.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> osi 七层模型 ----&gt; 五层</span><br><span class="line">    -物理层</span><br><span class="line">        -<span class="number">10101000</span>电信号-----&gt;网线、光纤</span><br><span class="line">    -数据链路层</span><br><span class="line">        -网卡----&gt;mac地址，全球唯一</span><br><span class="line">        -广播: 局域网中通信</span><br><span class="line">    -网络层</span><br><span class="line">        -ip地址: ipv4，ipv6</span><br><span class="line">        -子网掩码+ip区分是不是属于同一个子网</span><br><span class="line">        -arp协议: ip和mac地址的映射表</span><br><span class="line">    -传输层(运输层)</span><br><span class="line">        -端口: <span class="number">0</span> --- <span class="number">65535</span></span><br><span class="line">        -端口是用来区分应用程序的</span><br><span class="line">        -TCP: 可靠传输，三次握手，四次挥手</span><br><span class="line">        -UDP: 不可靠传输</span><br><span class="line">    -应用层</span><br><span class="line">        -http，ftp</span><br><span class="line"><span class="number">2</span> 常用的端口(重要)</span><br><span class="line">    -<span class="number">80</span>： http协议，基于TCP</span><br><span class="line">    -<span class="number">3306</span> ：mysql</span><br><span class="line">    -<span class="number">53</span> DNS(域名解析)----&gt;基于UDP</span><br><span class="line"><span class="number">3</span> TCP/IP----&gt;socket抽象层----&gt;针对于程序员来写客户端，服务端的程序(更好写)</span><br><span class="line"><span class="number">4</span> 基于TCP的套接字(socket)的客户端和服务端</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/11/12/%E4%B8%8E%E7%94%A8%E6%88%B7%E4%BA%A4%E4%BA%92%E3%80%81%E8%BF%90%E7%AE%97%E7%AC%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/11/12/%E4%B8%8E%E7%94%A8%E6%88%B7%E4%BA%A4%E4%BA%92%E3%80%81%E8%BF%90%E7%AE%97%E7%AC%A6/" class="post-title-link" itemprop="url">与用户交互、运算符</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-11-12 07:20:25" itemprop="dateCreated datePublished" datetime="2018-11-12T07:20:25+08:00">2018-11-12</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-12-01 12:22:34" itemprop="dateModified" datetime="2018-12-01T12:22:34+08:00">2018-12-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Python%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">Python系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="程序与用户交互"><a href="#程序与用户交互" class="headerlink" title="程序与用户交互"></a>程序与用户交互</h1><h2 id="什么是与用户交互？"><a href="#什么是与用户交互？" class="headerlink" title="什么是与用户交互？"></a>什么是与用户交互？</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用户交互就是人往计算机中input/输入数据，计算机print/输出结果</span></span><br></pre></td></tr></table></figure>



<h2 id="为什么要与用户交互？"><a href="#为什么要与用户交互？" class="headerlink" title="为什么要与用户交互？"></a>为什么要与用户交互？</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">为了让计算机能够像人一样与用户沟通交流</span><br><span class="line"></span><br><span class="line">比如，过去我们去银行取钱，用户需要把帐号密码告诉柜员，而现在，柜员被ATM机取代，ATM机就是一台计算机，所以用户同样需要将帐号密码告诉计算机，于是我们的程序中必须有相应的机制来控制计算机接收用户输入的内容，并且输出结果</span><br></pre></td></tr></table></figure>



<h2 id="如何与用户交互？"><a href="#如何与用户交互？" class="headerlink" title="如何与用户交互？"></a>如何与用户交互？</h2><p><strong>交互的本质就是输入、输出</strong></p>
<h3 id="输入input"><a href="#输入input" class="headerlink" title="输入input"></a>输入input</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在python3中input功能会等待用户的输入，用户输入任何内容，都存成字符串类型，然后赋值给等号左边的变量名</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>username=<span class="built_in">input</span>(<span class="string">&#x27;请输入您的用户名：&#x27;</span>) </span><br><span class="line">请输入您的用户名：jack <span class="comment"># username = &quot;jack&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>password=<span class="built_in">input</span>(<span class="string">&#x27;请输入您的密码：&#x27;</span>) </span><br><span class="line">请输入您的密码：<span class="number">123</span> <span class="comment"># password = &quot;123&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 了解知识：</span></span><br><span class="line"><span class="comment"># 1、在python2中存在一个raw_input功能与python3中的input功能一模一样</span></span><br><span class="line"><span class="comment"># 2、在python2中还存在一个input功能，需要用户输入一个明确的数据类型，输入什么类型就存成什么类型</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l=<span class="built_in">input</span>(<span class="string">&#x27;输入什么类型就存成什么类型: &#x27;</span>)</span><br><span class="line">输入什么类型就存成什么类型: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(l)</span><br><span class="line">&lt;<span class="built_in">type</span> <span class="string">&#x27;list&#x27;</span>&gt;</span><br></pre></td></tr></table></figure>

<h3 id="输出print"><a href="#输出print" class="headerlink" title="输出print"></a>输出print</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">&#x27;hello world&#x27;</span>)  <span class="comment"># 只输出一个值</span></span><br><span class="line">hello world</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">&#x27;first&#x27;</span>,<span class="string">&#x27;second&#x27;</span>,<span class="string">&#x27;third&#x27;</span>)  <span class="comment"># 一次性输出多个值，值用逗号隔开</span></span><br><span class="line">first second third</span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认print功能有一个end参数，该参数的默认值为&quot;\n&quot;(代表换行)，可以将end参数的值改成任意其它字符</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;aaaa&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;bbbb&quot;</span>,end=<span class="string">&#x27;&amp;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;cccc&quot;</span>,end=<span class="string">&#x27;@&#x27;</span>)</span><br><span class="line"><span class="comment">#整体输出结果为：aaaabbbb&amp;cccc@</span></span><br></pre></td></tr></table></figure>

<h3 id="输出之格式化输出"><a href="#输出之格式化输出" class="headerlink" title="输出之格式化输出"></a>输出之格式化输出</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 什么是格式化输出？</span><br><span class="line">    把一段字符串里面的某些内容替换掉之后再输出，就是格式化输出</span><br><span class="line"><span class="number">2</span> 为什么要格式化输出？</span><br><span class="line">    我们经常会输出具有某种固定格式的内容，比如：<span class="string">&#x27;亲爱的xxx你好！你xxx月的话费是xxx，余额是xxx‘，我们需要做的就是将xxx替换为具体的内容。</span></span><br><span class="line"><span class="string">3 如何格式化输出？</span></span><br><span class="line"><span class="string">    # %s占位符：可以接收任意类型的值</span></span><br><span class="line"><span class="string">    # %d占位符：只能接收数字</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; print(&#x27;</span>亲爱的%s你好！你%s月的话费是%d，余额是%d<span class="string">&#x27; %(&#x27;</span>tony<span class="string">&#x27;,12,103,11))</span></span><br><span class="line"><span class="string">    亲爱的tony你好！你12月的话费是103，余额是11</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # 练习1：接收用户输入，打印成指定格式</span></span><br><span class="line"><span class="string">    name = input(&#x27;</span>your name: <span class="string">&#x27;)</span></span><br><span class="line"><span class="string">    age = input(&#x27;</span>your age: <span class="string">&#x27;) #用户输入18,会存成字符串18,无法传给%d</span></span><br><span class="line"><span class="string">    print(&#x27;</span>My name <span class="keyword">is</span> %s,my age <span class="keyword">is</span> %s<span class="string">&#x27; %(name,age))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # 练习2：用户输入姓名、年龄、工作、爱好 ，然后打印成以下格式</span></span><br><span class="line"><span class="string">    ------------ info of Tony -----------</span></span><br><span class="line"><span class="string">    Name  : Tony</span></span><br><span class="line"><span class="string">    Age   : 22</span></span><br><span class="line"><span class="string">    Sex   : male</span></span><br><span class="line"><span class="string">    Job   : Teacher </span></span><br><span class="line"><span class="string">    ------------- end -----------------</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<h1 id="基本运算符"><a href="#基本运算符" class="headerlink" title="基本运算符"></a>基本运算符</h1><h2 id="算术运算符"><a href="#算术运算符" class="headerlink" title="算术运算符"></a>算术运算符</h2><p><img src="https://img2020.cnblogs.com/blog/2342210/202104/2342210-20210423202605402-297731340.png" alt="img"></p>
<h2 id="比较运算符"><a href="#比较运算符" class="headerlink" title="比较运算符"></a>比较运算符</h2><p><img src="https://img2020.cnblogs.com/blog/2342210/202104/2342210-20210423202623769-1096281928.png" alt="img"></p>
<h2 id="赋值运算符"><a href="#赋值运算符" class="headerlink" title="赋值运算符"></a>赋值运算符</h2><p>​         <strong>python语法中除了有=号这种简单的赋值运算外，还支持增量赋值、链式赋值、交叉赋值、解压赋值，这些赋值运算符存在的意义都是为了让我们的代码看起来更加精简。我们以x=9，y=2为例先来介绍一下增量赋值</strong></p>
<h3 id="增量赋值"><a href="#增量赋值" class="headerlink" title="增量赋值"></a>增量赋值</h3><p><img src="https://img2020.cnblogs.com/blog/2342210/202104/2342210-20210423202630259-475851939.png" alt="img"></p>
<h3 id="链式赋值"><a href="#链式赋值" class="headerlink" title="链式赋值"></a>链式赋值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">如果我们想把同一个值同时赋值给多个变量名，可以这么做</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>z=<span class="number">10</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y=z</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x=y</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x,y,z</span><br><span class="line">(<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">链式赋值指的是可以用一行代码搞定这件事</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x=y=z=<span class="number">10</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x,y,z</span><br><span class="line">(<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<h3 id="交叉赋值"><a href="#交叉赋值" class="headerlink" title="交叉赋值"></a>交叉赋值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">我们定义两个变量m与n</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m=<span class="number">10</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>n=<span class="number">20</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">如果我们想将m与n的值交换过来，可以这么做</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>temp=m</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m=n</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>n=temp</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m,n</span><br><span class="line">(<span class="number">20</span>, <span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">交叉赋值指的是一行代码可以搞定这件事</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m=<span class="number">10</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>n=<span class="number">20</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m,n=n,m <span class="comment"># 交叉赋值</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m,n</span><br><span class="line">(<span class="number">20</span>, <span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<h3 id="解压赋值"><a href="#解压赋值" class="headerlink" title="解压赋值"></a>解压赋值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">如果我们想把列表中的多个值取出来依次赋值给多个变量名，可以这么做</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>nums=[<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>,<span class="number">44</span>,<span class="number">55</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a=nums[<span class="number">0</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b=nums[<span class="number">1</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c=nums[<span class="number">2</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d=nums[<span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>e=nums[<span class="number">4</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a,b,c,d,e</span><br><span class="line">(<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>, <span class="number">44</span>, <span class="number">55</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">解压赋值指的是一行代码可以搞定这件事</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a,b,c,d,e=nums <span class="comment"># nums包含多个值，就好比一个压缩包，解压赋值因此得名</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a,b,c,d,e</span><br><span class="line">(<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>, <span class="number">44</span>, <span class="number">55</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">注意，上述解压赋值，等号左边的变量名个数必须与右面包含值的个数相同,否则会报错</span><br><span class="line"><span class="comment">#1、变量名少了</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a,b=nums</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">ValueError: too many values to unpack (expected <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#2、变量名多了</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a,b,c,d,e,f=nums</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">ValueError: <span class="keyword">not</span> enough values to unpack (expected <span class="number">6</span>, got <span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">但如果我们只想取头尾的几个值，可以用*_匹配</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a,b,*_=nums</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a,b</span><br><span class="line">(<span class="number">11</span>, <span class="number">22</span>)</span><br></pre></td></tr></table></figure>

<p><strong>ps：字符串、字典、元组、集合类型都支持解压赋值</strong></p>
<h2 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h2><p><img src="https://img2020.cnblogs.com/blog/2342210/202104/2342210-20210423202640011-251028330.png" alt="img"></p>
<h3 id="连续多个and"><a href="#连续多个and" class="headerlink" title="连续多个and"></a>连续多个and</h3><p><strong>可以用and连接多个条件，会按照从左到右的顺序依次判断，一旦某一个条件为False，则无需再往右判断，可以立即判定最终结果就为False，只有在所有条件的结果都为True的情况下，最终结果才为True。</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">2</span> &gt; <span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span> != <span class="number">1</span> <span class="keyword">and</span> <span class="literal">True</span> <span class="keyword">and</span> <span class="number">3</span> &gt; <span class="number">2</span> <span class="comment"># 判断完第二个条件，就立即结束，得的最终结果为False</span></span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h3 id="连续多个or"><a href="#连续多个or" class="headerlink" title="连续多个or"></a>连续多个or</h3><p><strong>可以用or连接多个条件，会按照从左到右的顺序依次判断，一旦某一个条件为True，则无需再往右判断，可以立即判定最终结果就为True，只有在所有条件的结果都为False的情况下，最终结果才为False</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">2</span> &gt; <span class="number">1</span> <span class="keyword">or</span> <span class="number">1</span> != <span class="number">1</span> <span class="keyword">or</span> <span class="literal">True</span> <span class="keyword">or</span> <span class="number">3</span> &gt; <span class="number">2</span> <span class="comment"># 判断完第一个条件，就立即结束，得的最终结果为True</span></span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<h3 id="优先级not-gt-and-gt-or"><a href="#优先级not-gt-and-gt-or" class="headerlink" title="优先级not&gt;and&gt;or"></a>优先级not&gt;and&gt;or</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、三者的优先级关系：not&gt;and&gt;or，同一优先级默认从左往右计算。</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">3</span>&gt;<span class="number">4</span> <span class="keyword">and</span> <span class="number">4</span>&gt;<span class="number">3</span> <span class="keyword">or</span> <span class="number">1</span>==<span class="number">3</span> <span class="keyword">and</span> <span class="string">&#x27;x&#x27;</span> == <span class="string">&#x27;x&#x27;</span> <span class="keyword">or</span> <span class="number">3</span> &gt;<span class="number">3</span></span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#2、最好使用括号来区别优先级，其实意义与上面的一样</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">原理为：</span></span><br><span class="line"><span class="string">(1) not的优先级最高，就是把紧跟其后的那个条件结果取反，所以not与紧跟其后的条件不可分割</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(2) 如果语句中全部是用and连接，或者全部用or连接，那么按照从左到右的顺序依次计算即可</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(3) 如果语句中既有and也有or，那么先用括号把and的左右两个条件给括起来，然后再进行运算</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>(<span class="number">3</span>&gt;<span class="number">4</span> <span class="keyword">and</span> <span class="number">4</span>&gt;<span class="number">3</span>) <span class="keyword">or</span> (<span class="number">1</span>==<span class="number">3</span> <span class="keyword">and</span> <span class="string">&#x27;x&#x27;</span> == <span class="string">&#x27;x&#x27;</span>) <span class="keyword">or</span> <span class="number">3</span> &gt;<span class="number">3</span></span><br><span class="line"><span class="literal">False</span> </span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#3、短路运算：逻辑运算的结果一旦可以确定，那么就以当前处计算到的值作为最终结果返回</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">10</span> <span class="keyword">and</span> <span class="number">0</span> <span class="keyword">or</span> <span class="string">&#x27;&#x27;</span> <span class="keyword">and</span> <span class="number">0</span> <span class="keyword">or</span> <span class="string">&#x27;abc&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;egon&#x27;</span> == <span class="string">&#x27;dsb&#x27;</span> <span class="keyword">and</span> <span class="number">333</span> <span class="keyword">or</span> <span class="number">10</span> &gt; <span class="number">4</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">我们用括号来明确一下优先级</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>(<span class="number">10</span> <span class="keyword">and</span> <span class="number">0</span>) <span class="keyword">or</span> (<span class="string">&#x27;&#x27;</span> <span class="keyword">and</span> <span class="number">0</span>) <span class="keyword">or</span> <span class="string">&#x27;abc&#x27;</span> <span class="keyword">or</span> (<span class="string">&#x27;egon&#x27;</span> == <span class="string">&#x27;dsb&#x27;</span> <span class="keyword">and</span> <span class="number">333</span>) <span class="keyword">or</span> <span class="number">10</span> &gt; <span class="number">4</span></span><br><span class="line">短路：       <span class="number">0</span>      <span class="string">&#x27;&#x27;</span>            <span class="string">&#x27;abc&#x27;</span>                    </span><br><span class="line">            假     假              真</span><br><span class="line"></span><br><span class="line">返回：                            <span class="string">&#x27;abc&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#4、短路运算面试题：</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span> <span class="keyword">or</span> <span class="number">3</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span> <span class="keyword">and</span> <span class="number">3</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0</span> <span class="keyword">and</span> <span class="number">2</span> <span class="keyword">and</span> <span class="number">1</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0</span> <span class="keyword">and</span> <span class="number">2</span> <span class="keyword">or</span> <span class="number">1</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0</span> <span class="keyword">and</span> <span class="number">2</span> <span class="keyword">or</span> <span class="number">1</span> <span class="keyword">or</span> <span class="number">4</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0</span> <span class="keyword">or</span> <span class="literal">False</span> <span class="keyword">and</span> <span class="number">1</span></span><br><span class="line"><span class="literal">False</span> </span><br></pre></td></tr></table></figure>

<h2 id="成员运算符"><a href="#成员运算符" class="headerlink" title="成员运算符"></a>成员运算符</h2><p><img src="https://pic1.zhimg.com/80/v2-beecc7750f15f6600edce6b64ee41c18_720w.jpg" alt="img"></p>
<p><strong>注意：虽然下述两种判断可以达到相同的效果，但我们推荐使用第二种格式，因为not in语义更加明确</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">not</span> <span class="string">&#x27;lili&#x27;</span> <span class="keyword">in</span> [<span class="string">&#x27;jack&#x27;</span>,<span class="string">&#x27;tom&#x27;</span>,<span class="string">&#x27;robin&#x27;</span>]</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;lili&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">&#x27;jack&#x27;</span>,<span class="string">&#x27;tom&#x27;</span>,<span class="string">&#x27;robin&#x27;</span>]</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<h2 id="身份运算符"><a href="#身份运算符" class="headerlink" title="身份运算符"></a>身份运算符</h2><p><img src="https://pic3.zhimg.com/80/v2-7a653e8151847e64a6b97d6488e51766_720w.jpg" alt="img"></p>
<p><strong>需要强调的是：==双等号比较的是value是否相等，而is比较的是id是否相等</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1. id相同，内存地址必定相同，意味着type和value必定相同</span></span><br><span class="line"><span class="comment">#2. value相同type肯定相同，但id可能不同,如下</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x=<span class="string">&#x27;Info Tony:18&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y=<span class="string">&#x27;Info Tony:18&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(x),<span class="built_in">id</span>(y) <span class="comment"># x与y的id不同，但是二者的值相同</span></span><br><span class="line">(<span class="number">4327422640</span>, <span class="number">4327422256</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x == y <span class="comment"># 等号比较的是value</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(x),<span class="built_in">type</span>(y) <span class="comment"># 值相同type肯定相同</span></span><br><span class="line">(&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">str</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">str</span>&#x27;&gt;)</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">x</span> <span class="title">is</span> <span class="title">y</span> # <span class="title">is</span>比较的是<span class="title">id</span>，<span class="title">x</span>与<span class="title">y</span>的值相等但<span class="title">id</span>可以不同</span></span><br><span class="line"><span class="class"><span class="title">False</span></span></span><br></pre></td></tr></table></figure>


<p><img src="https://img2020.cnblogs.com/blog/2342210/202104/2342210-20210423202441740-895033702.png" alt="img"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/11/12/%E5%86%85%E5%AE%B9%E6%A6%82%E8%A6%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/11/12/%E5%86%85%E5%AE%B9%E6%A6%82%E8%A6%81/" class="post-title-link" itemprop="url">继承与派生</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-11-12 07:20:25" itemprop="dateCreated datePublished" datetime="2018-11-12T07:20:25+08:00">2018-11-12</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-12-01 12:22:34" itemprop="dateModified" datetime="2018-12-01T12:22:34+08:00">2018-12-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Python%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">Python系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="内容概要"><a href="#内容概要" class="headerlink" title="内容概要"></a>内容概要</h1><ul>
<li>继承介绍</li>
<li>继承与抽象</li>
<li>属性查找</li>
<li>继承的实现原理</li>
<li>派生与方法重用</li>
<li>组合</li>
</ul>
<h1 id="内容详细"><a href="#内容详细" class="headerlink" title="内容详细"></a>内容详细</h1><h2 id="继承介绍"><a href="#继承介绍" class="headerlink" title="继承介绍"></a>继承介绍</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">继承是一种创建新类的方式，在python中，新建的类可以继承一个或多个父类，新建的类可称为子类或派生类，父类又可称为基类或超类</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParentClass1</span>:</span> <span class="comment">#定义父类</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParentClass2</span>:</span> <span class="comment">#定义父类</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubClass1</span>(<span class="params">ParentClass1</span>):</span> <span class="comment">#单继承</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubClass2</span>(<span class="params">ParentClass1,ParentClass2</span>):</span> <span class="comment">#多继承</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">通过类的内置属性__bases__可以查看类继承的所有父类</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>SubClass2.__bases__</span><br><span class="line">(&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">__main__</span>.<span class="title">ParentClass1</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">__main__</span>.<span class="title">ParentClass2</span>&#x27;&gt;)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">在Python2中有经典类与新式类之分，没有显式地继承<span class="built_in">object</span>类的类，以及该类的子类，都是经典类，显式地继承<span class="built_in">object</span>的类，以及该类的子类，都是新式类。而在Python3中，即使没有显式地继承<span class="built_in">object</span>，也会默认继承该类，如下</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ParentClass1.__bases__</span><br><span class="line">(&lt;<span class="class"><span class="keyword">class</span> ‘<span class="title">object</span>&#x27;&gt;,)</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">ParentClass2</span>.<span class="title">__bases__</span></span></span><br><span class="line"><span class="class">(<span class="params">&lt;<span class="keyword">class</span> <span class="string">&#x27;object&#x27;</span>&gt;,</span>)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">因而在Python3中统一都是新式类，关于经典类与新式类的区别，我们稍后讨论</span><br><span class="line"></span><br><span class="line">提示：<span class="built_in">object</span>类提供了一些常用内置方法的实现，如用来在打印对象时返回字符串的内置方法__str__</span><br></pre></td></tr></table></figure>

<h2 id="继承与抽象"><a href="#继承与抽象" class="headerlink" title="继承与抽象"></a>继承与抽象</h2><p> <strong>要找出类与类之间的继承关系，需要先抽象，再继承，抽象即总结相似之处，总结对象之间的相似之处得到类，总结类与类之间的相似之处就可以得到父类：</strong></p>
<p><img src="https://pic1.zhimg.com/80/v2-10df80634dbda00e4dcb4113c2a75b3c_720w.jpg" alt="img"></p>
<p><img src="https://pic1.zhimg.com/80/v2-d22528a722bfbb1765b99d1d75d8f1a4_720w.jpg" alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">基于上图我们可以看出类与类之间的继承指的是什么’是’什么的关系（比如人类，猪类，猴类都是动物类）。子类可以继承／遗传父类所有的属性，因而继承可以用来解决类与类之间的代码重用性问题。比如我们按照定义Student类的方式再定义一个Teacher类</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Teacher</span>:</span></span><br><span class="line">    school=<span class="string">&#x27;清华大学&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name,sex,age</span>):</span></span><br><span class="line">        self.name=name</span><br><span class="line">        self.sex=sex</span><br><span class="line">        self.age=age</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">teach</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;%s is teaching&#x27;</span> %self.name)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">类Teacher与Student之间存在重复的代码，老师与学生都是人类，所以我们可以得出如下继承关系，实现代码重用</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span>:</span></span><br><span class="line">    school=<span class="string">&#x27;清华大学&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name,sex,age</span>):</span></span><br><span class="line">        self.name=name</span><br><span class="line">        self.sex=sex</span><br><span class="line">        self.age=age</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">People</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">choose</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;%s is choosing a course&#x27;</span> %self.name)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Teacher</span>(<span class="params">People</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">teach</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;%s is teaching&#x27;</span> %self.name)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Teacher类内并没有定义__init__方法，但是会从父类中找到__init__,因而仍然可以正常实例化，如下</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>teacher1=Teacher(<span class="string">&#x27;lili&#x27;</span>,<span class="string">&#x27;male&#x27;</span>,<span class="number">18</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>teacher1.school,teacher1.name,teacher1.sex,teacher1.age</span><br><span class="line">(<span class="string">&#x27;清华大学&#x27;</span>, <span class="string">&#x27;lili&#x27;</span>, <span class="string">&#x27;male&#x27;</span>, <span class="number">18</span>)</span><br></pre></td></tr></table></figure>

<h2 id="属性查找"><a href="#属性查找" class="headerlink" title="属性查找"></a>属性查找</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">有了继承关系，对象在查找属性时，先从对象自己的__dict__中找，如果没有则去子类中找，然后再去父类中找...</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">f1</span>(<span class="params">self</span>):</span></span><br><span class="line"><span class="meta">... </span>        <span class="built_in">print</span>(<span class="string">&#x27;Foo.f1&#x27;</span>)</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">f2</span>(<span class="params">self</span>):</span></span><br><span class="line"><span class="meta">... </span>        <span class="built_in">print</span>(<span class="string">&#x27;Foo.f2&#x27;</span>)</span><br><span class="line"><span class="meta">... </span>        self.f1()</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Bar</span>(<span class="params">Foo</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">f1</span>(<span class="params">self</span>):</span></span><br><span class="line"><span class="meta">... </span>        <span class="built_in">print</span>(<span class="string">&#x27;Foo.f1&#x27;</span>)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b=Bar()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b.f2()</span><br><span class="line">Foo.f2</span><br><span class="line">Foo.f1</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">b.f2()会在父类Foo中找到f2，先打印Foo.f2,然后执行到self.f1(),即b.f1()，仍会按照：对象本身-&gt;类Bar-&gt;父类Foo的顺序依次找下去，在类Bar中找到f1，因而打印结果为Foo.f1</span><br><span class="line"></span><br><span class="line">父类如果不想让子类覆盖自己的方法，可以采用双下划线<span class="string">&#x27;开头&#x27;</span>的方式将方法设置为私有的</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__f1</span>(<span class="params">self</span>):</span> <span class="comment"># 变形为_Foo__fa</span></span><br><span class="line"><span class="meta">... </span>        <span class="built_in">print</span>(<span class="string">&#x27;Foo.f1&#x27;</span>) </span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">f2</span>(<span class="params">self</span>):</span></span><br><span class="line"><span class="meta">... </span>        <span class="built_in">print</span>(<span class="string">&#x27;Foo.f2&#x27;</span>)</span><br><span class="line"><span class="meta">... </span>        self.__f1() <span class="comment"># 变形为self._Foo__fa,因而只会调用自己所在的类中的方法</span></span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Bar</span>(<span class="params">Foo</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__f1</span>(<span class="params">self</span>):</span> <span class="comment"># 变形为_Bar__f1</span></span><br><span class="line"><span class="meta">... </span>        <span class="built_in">print</span>(<span class="string">&#x27;Foo.f1&#x27;</span>)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b=Bar()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b.f2() <span class="comment">#在父类中找到f2方法，进而调用b._Foo__f1()方法，同样是在父类中找到该方法</span></span><br><span class="line">Foo.f2</span><br><span class="line">Foo.f1</span><br></pre></td></tr></table></figure>

<h2 id="继承的实现原理"><a href="#继承的实现原理" class="headerlink" title="继承的实现原理"></a>继承的实现原理</h2><h3 id="菱形问题"><a href="#菱形问题" class="headerlink" title="菱形问题"></a>菱形问题</h3><p><strong>大多数面向对象语言都不支持多继承，而在Python中，一个子类是可以同时继承多个父类的，这固然可以带来一个子类可以对多个不同父类加以重用的好处，但也有可能引发著名的 Diamond problem菱形问题(或称钻石问题，有时候也被称为“死亡钻石”)，菱形其实就是对下面这种继承结构的形象比喻</strong></p>
<p><img src="https://pic4.zhimg.com/80/v2-7c6088a106bbf1fc46de0cca9c03a037_720w.png" alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">A类在顶部，B类和C类分别位于其下方，D类在底部将两者连接在一起形成菱形。</span><br><span class="line">这种继承结构下导致的问题称之为菱形问题：如果A中有一个方法，B和/或C都重写了该方法，而D没有重写它，那么D继承的是哪个版本的方法：B的还是C的？如下所示</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;from A&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>(<span class="params">A</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;from B&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>(<span class="params">A</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;from C&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span>(<span class="params">B,C</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = D()</span><br><span class="line">obj.test() <span class="comment"># 结果为：from B</span></span><br><span class="line">要想搞明白obj.test()是如何找到方法test的，需要了解python的继承实现原理</span><br></pre></td></tr></table></figure>

<h3 id="继承原理"><a href="#继承原理" class="headerlink" title="继承原理"></a>继承原理</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python到底是如何实现继承的呢？ 对于你定义的每一个类，Python都会计算出一个方法解析顺序(MRO)列表，该MRO列表就是一个简单的所有基类的线性顺序列表，如下</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>D.mro() <span class="comment"># 新式类内置了mro方法可以查看线性列表的内容，经典类没有该内置该方法</span></span><br><span class="line">[&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">__main__</span>.<span class="title">D</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">__main__</span>.<span class="title">B</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">__main__</span>.<span class="title">C</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">__main__</span>.<span class="title">A</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">object</span>&#x27;&gt;]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">python会在MRO列表上从左到右开始查找基类,直到找到第一个匹配这个属性的类为止。 而这个MRO列表的构造是通过一个C3线性化算法来实现的。我们不去深究这个算法的数学原理,它实际上就是合并所有父类的MRO列表并遵循如下三条准则:</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>子类会先于父类被检查</span><br><span class="line"><span class="number">2.</span>多个父类会根据它们在列表中的顺序被检查</span><br><span class="line"><span class="number">3.</span>如果对下一个类存在两个合法的选择,选择第一个父类</span><br><span class="line">所以obj.test()的查找顺序是，先从对象obj本身的属性里找方法test，没有找到，则参照属性查找的发起者(即obj)所处类D的MRO列表来依次检索，首先在类D中未找到，然后再B中找到方法test</span><br><span class="line"></span><br><span class="line">ps：</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>由对象发起的属性查找，会从对象自身的属性里检索，没有则会按照对象的类.mro()规定的顺序依次找下去，</span><br><span class="line"><span class="number">2.</span>由类发起的属性查找，会按照当前类.mro()规定的顺序依次找下去，</span><br></pre></td></tr></table></figure>

<h3 id="深度优先和广度优先"><a href="#深度优先和广度优先" class="headerlink" title="深度优先和广度优先"></a>深度优先和广度优先</h3><p><strong>多继承结构为非菱形结构，此时，会按照先找B这一条分支，然后再找C这一条分支，最后找D这一条分支的顺序直到找到我们想要的属性</strong></p>
<p><img src="https://pic4.zhimg.com/80/v2-64faa1a6e825277233fe2bf40401b99b_720w.jpg" alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">E</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;from E&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">F</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;from F&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>(<span class="params">E</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;from B&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>(<span class="params">F</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;from C&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;from D&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>(<span class="params">B, C, D</span>):</span></span><br><span class="line">    <span class="comment"># def test(self):</span></span><br><span class="line">    <span class="comment">#     print(&#x27;from A&#x27;)</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(A.mro())</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[&lt;class &#x27;__main__.A&#x27;&gt;, &lt;class &#x27;__main__.B&#x27;&gt;, &lt;class &#x27;__main__.E&#x27;&gt;, &lt;class &#x27;__main__.C&#x27;&gt;, &lt;class &#x27;__main__.F&#x27;&gt;, &lt;class &#x27;__main__.D&#x27;&gt;, &lt;class &#x27;object&#x27;&gt;]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">obj = A()</span><br><span class="line">obj.test() <span class="comment"># 结果为：from B</span></span><br><span class="line"><span class="comment"># 可依次注释上述类中的方法test来进行验证</span></span><br></pre></td></tr></table></figure>

<p><strong>如果继承关系为菱形结构，那么经典类与新式类会有不同MRO，分别对应属性的两种查找方式：深度优先和广度优先</strong></p>
<p><img src="https://pic4.zhimg.com/80/v2-e95d9f13b01af6eb7da3b5043442f697_720w.jpg" alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">G</span>:</span> <span class="comment"># 在python2中，未继承object的类及其子类，都是经典类</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;from G&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">E</span>(<span class="params">G</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;from E&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">F</span>(<span class="params">G</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;from F&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>(<span class="params">E</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;from B&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>(<span class="params">F</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;from C&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span>(<span class="params">G</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;from D&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>(<span class="params">B,C,D</span>):</span></span><br><span class="line">    <span class="comment"># def test(self):</span></span><br><span class="line">    <span class="comment">#     print(&#x27;from A&#x27;)</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">obj = A()</span><br><span class="line">obj.test() <span class="comment"># 如上图，查找顺序为:obj-&gt;A-&gt;B-&gt;E-&gt;G-&gt;C-&gt;F-&gt;D-&gt;object</span></span><br><span class="line"><span class="comment"># 可依次注释上述类中的方法test来进行验证,注意请在python2.x中进行测试</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic4.zhimg.com/80/v2-08eb8fd2226110ae845da74805cb98fb_720w.jpg" alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">G</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;from G&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">E</span>(<span class="params">G</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;from E&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">F</span>(<span class="params">G</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;from F&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>(<span class="params">E</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;from B&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>(<span class="params">F</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;from C&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span>(<span class="params">G</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;from D&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>(<span class="params">B,C,D</span>):</span></span><br><span class="line">    <span class="comment"># def test(self):</span></span><br><span class="line">    <span class="comment">#     print(&#x27;from A&#x27;)</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">obj = A()</span><br><span class="line">obj.test() <span class="comment"># 如上图，查找顺序为:obj-&gt;A-&gt;B-&gt;E-&gt;C-&gt;F-&gt;D-&gt;G-&gt;object</span></span><br><span class="line"><span class="comment"># 可依次注释上述类中的方法test来进行验证</span></span><br></pre></td></tr></table></figure>

<h3 id="python-mixins机制"><a href="#python-mixins机制" class="headerlink" title="python mixins机制"></a>python mixins机制</h3><p> <strong>一个子类可以同时继承多个父类，这样的设计常被人诟病，一来它有可能导致可恶的菱形问题，二来在人的世界观里继承应该是个”is-a”关系。 比如轿车类之所以可以继承交通工具类，是因为基于人的世界观，我们可以说：轿车是一个(“is-a”)交通工具，而在人的世界观里，一个物品不可能是多种不同的东西，因此多重继承在人的世界观里是说不通的，它仅仅只是代码层面的逻辑。不过有没有这种情况，一个类的确是需要继承多个类呢？</strong></p>
<p> <strong>答案是有，我们还是拿交通工具来举例子:</strong></p>
<p> <strong>民航飞机、直升飞机、轿车都是一个（is-a）交通工具，前两者都有一个功能是飞行fly，但是轿车没有，所以如下所示我们把飞行功能放到交通工具这个父类中是不合理的</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vehicle</span>:</span>  <span class="comment"># 交通工具</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fly</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        飞行功能相应的代码        </span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;I am flying&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CivilAircraft</span>(<span class="params">Vehicle</span>):</span>  <span class="comment"># 民航飞机</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Helicopter</span>(<span class="params">Vehicle</span>):</span>  <span class="comment"># 直升飞机</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span>(<span class="params">Vehicle</span>):</span>  <span class="comment"># 汽车并不会飞，但按照上述继承关系，汽车也能飞了</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p> <strong>但是如果民航飞机和直升机都各自写自己的飞行fly方法，又违背了代码尽可能重用的原则（如果以后飞行工具越来越多，那会重复代码将会越来越多）。</strong></p>
<p> <strong>怎么办？？？为了尽可能地重用代码，那就只好在定义出一个飞行器的类，然后让民航飞机和直升飞机同时继承交通工具以及飞行器两个父类，这样就出现了多重继承。这时又违背了继承必须是”is-a”关系。这个难题该怎么解决？</strong></p>
<p> <strong>不同的语言给出了不同的方法，让我们先来了解Java的处理方法。Java提供了接口interface功能，来实现多重继承：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">// 抽象基类：交通工具类</span><br><span class="line">public abstract <span class="class"><span class="keyword">class</span> <span class="title">Vehicle</span> &#123;</span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">// 接口：飞行器</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">interface</span> <span class="title">Flyable</span> &#123;</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">void</span> <span class="title">fly</span>();</span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">// 类：实现了飞行器接口的类，在该类中实现具体的<span class="title">fly</span>方法，这样下面民航飞机与直升飞机在实现<span class="title">fly</span>时直接重用即可</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">FlyableImpl</span> <span class="title">implements</span> <span class="title">Flyable</span> &#123;</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">void</span> <span class="title">fly</span>() &#123;</span></span><br><span class="line"><span class="class">        <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span>(<span class="params"><span class="string">&quot;I am flying&quot;</span></span>);</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">// 民航飞机，继承自交通工具类，并实现了飞行器接口</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">CivilAircraft</span> <span class="title">extends</span> <span class="title">Vehicle</span> <span class="title">implements</span> <span class="title">Flyable</span> &#123;</span></span><br><span class="line"><span class="class">    <span class="title">private</span> <span class="title">Flyable</span> <span class="title">flyable</span>;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">CivilAircraft</span>() &#123;</span></span><br><span class="line"><span class="class">        <span class="title">flyable</span> = <span class="title">new</span> <span class="title">FlyableImpl</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">void</span> <span class="title">fly</span>() &#123;</span></span><br><span class="line"><span class="class">        <span class="title">flyable</span>.<span class="title">fly</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">// 直升飞机，继承自交通工具类，并实现了飞行器接口</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">Helicopter</span> <span class="title">extends</span> <span class="title">Vehicle</span> <span class="title">implements</span> <span class="title">Flyable</span> &#123;</span></span><br><span class="line"><span class="class">    <span class="title">private</span> <span class="title">Flyable</span> <span class="title">flyable</span>;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">Helicopter</span>() &#123;</span></span><br><span class="line"><span class="class">        <span class="title">flyable</span> = <span class="title">new</span> <span class="title">FlyableImpl</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">void</span> <span class="title">fly</span>() &#123;</span></span><br><span class="line"><span class="class">        <span class="title">flyable</span>.<span class="title">fly</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">// 汽车，继承自交通工具类，</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">Car</span> <span class="title">extends</span> <span class="title">Vehicle</span> &#123;</span></span><br><span class="line"><span class="class">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>现在我们的飞机同时具有了交通工具及飞行器两种属性，而且我们不需要重写飞行器中的飞行方法，同时我们没有破坏单一继承的原则。飞机就是一种交通工具，可飞行的能力是飞机的属性，通过继承接口来获取。</strong></p>
<p><strong>回到主题，Python语言可没有接口功能，但Python提供了Mixins机制，简单来说Mixins机制指的是子类混合(mixin)不同类的功能，而这些类采用统一的命名规范（例如Mixin后缀），以此标识这些类只是用来混合功能的，并不是用来标识子类的从属”is-a”关系的，所以Mixins机制本质仍是多继承，但同样遵守”is-a”关系，如下</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vehicle</span>:</span>  <span class="comment"># 交通工具</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FlyableMixin</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fly</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        飞行功能相应的代码        </span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;I am flying&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CivilAircraft</span>(<span class="params">FlyableMixin, Vehicle</span>):</span>  <span class="comment"># 民航飞机</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Helicopter</span>(<span class="params">FlyableMixin, Vehicle</span>):</span>  <span class="comment"># 直升飞机</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span>(<span class="params">Vehicle</span>):</span>  <span class="comment"># 汽车</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ps: 采用某种规范（如命名规范）来解决具体的问题是python惯用的套路</span></span><br></pre></td></tr></table></figure>

<p><strong>可以看到，上面的CivilAircraft、Helicopter类实现了多继承，不过它继承的第一个类我们起名为FlyableMixin，而不是Flyable，这个并不影响功能，但是会告诉后来读代码的人，这个类是一个Mixin类，表示混入(mix-in)，这种命名方式就是用来明确地告诉别人（python语言惯用的手法），这个类是作为功能添加到子类中，而不是作为父类，它的作用同Java中的接口。所以从含义上理解，CivilAircraft、Helicopter类都只是一个Vehicle，而不是一个飞行器。</strong></p>
<p><strong>使用Mixin类实现多重继承要非常小心</strong></p>
<p><strong>首先它必须表示某一种功能，而不是某个物品，python 对于mixin类的命名方式一般以 Mixin, able, ible 为后缀</strong><br><strong>其次它必须责任单一，如果有多个功能，那就写多个Mixin类，一个类可以继承多个Mixin，为了保证遵循继承的“is-a”原则，只能继承一个标识其归属含义的父类</strong><br><strong>然后，它不依赖于子类的实现</strong><br><strong>最后，子类即便没有继承这个Mixin类，也照样可以工作，就是缺少了某个功能。（比如飞机照样可以载客，就是不能飞了）</strong><br> <strong>Mixins是从多个类中重用代码的好方法，但是需要付出相应的代价，我们定义的Minx类越多，子类的代码可读性就会越差，并且更恶心的是，在继承的层级变多时，代码阅读者在定位某一个方法到底在何处调用时会晕头转向，如下</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Displayer</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">display</span>(<span class="params">self, message</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(message)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoggerMixin</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">log</span>(<span class="params">self, message, filename=<span class="string">&#x27;logfile.txt&#x27;</span></span>):</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;a&#x27;</span>) <span class="keyword">as</span> fh:</span><br><span class="line">            fh.write(message)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">display</span>(<span class="params">self, message</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().display(message) <span class="comment"># super的用法请参考下一小节</span></span><br><span class="line">        self.log(message)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySubClass</span>(<span class="params">LoggerMixin, Displayer</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">log</span>(<span class="params">self, message</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().log(message, filename=<span class="string">&#x27;subclasslog.txt&#x27;</span>) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = MySubClass()</span><br><span class="line">obj.display(<span class="string">&quot;This string will be shown and logged in subclasslog.txt&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 属性查找的发起者是obj,所以会参照类MySubClass的MRO来检索属性</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [&lt;class &#x27;__main__.MySubClass&#x27;&gt;, &lt;class &#x27;__main__.LoggerMixin&#x27;&gt;, &lt;class &#x27;__main__.Displayer&#x27;&gt;, &lt;class &#x27;object&#x27;&gt;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1、首先会去对象obj的类MySubClass找方法display，没有则去类LoggerMixin中找，找到开始执行代码</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、执行LoggerMixin的第一行代码：执行super().display(message)，参照MySubClass.mro(),super会去下一个类即类Displayer中找，找到display，开始执行代码，打印消息&quot;This string will be shown and logged in subclasslog.txt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、执行LoggerMixin的第二行代码：self.log(message)，self是对象obj，即obj.log(message)，属性查找的发起者为obj，所以会按照其类MySubClass.mro(),即MySubClass-&gt;LoggerMixin-&gt;Displayer-&gt;object的顺序查找，在MySubClass中找到方法log，开始执行super().log(message, filename=&#x27;subclasslog.txt&#x27;)，super会按照MySubClass.mro()查找下一个类，在类LoggerMixin中找到log方法开始执行，最终将日志写入文件subclasslog.txt</span></span><br></pre></td></tr></table></figure>

<h2 id="派生与方法重用"><a href="#派生与方法重用" class="headerlink" title="派生与方法重用"></a>派生与方法重用</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">子类可以派生出自己的新属性，在进行属性查找时，子类中的属性名会优先于父类被查找</span><br><span class="line"></span><br><span class="line">例如每个老师还有职称这一属性，我们就需要在teacher类中定义自己的__init__覆盖父类的</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">People</span>:</span></span><br><span class="line"><span class="meta">... </span>    school=<span class="string">&#x27;清华大学&#x27;</span></span><br><span class="line"><span class="meta">... </span>    </span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name,sex,age</span>):</span></span><br><span class="line"><span class="meta">... </span>        self.name=name</span><br><span class="line"><span class="meta">... </span>        self.sex=sex</span><br><span class="line"><span class="meta">... </span>        self.age=age</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Teacher</span>(<span class="params">People</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name,sex,age,title</span>):</span> <span class="comment"># 派生</span></span><br><span class="line"><span class="meta">... </span>        self.name=name</span><br><span class="line"><span class="meta">... </span>        self.sex=sex</span><br><span class="line"><span class="meta">... </span>        self.age=age</span><br><span class="line"><span class="meta">... </span>        self.title=title</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">teach</span>(<span class="params">self</span>):</span></span><br><span class="line"><span class="meta">... </span>        <span class="built_in">print</span>(<span class="string">&#x27;%s is teaching&#x27;</span> %self.name)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj=Teacher(<span class="string">&#x27;lili&#x27;</span>,<span class="string">&#x27;female&#x27;</span>,<span class="number">28</span>,<span class="string">&#x27;高级讲师&#x27;</span>) <span class="comment">#只会找自己类中的__init__，并不会自动调用父类的</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.name,obj.sex,obj.age,obj.title</span><br><span class="line">(<span class="string">&#x27;lili&#x27;</span>, <span class="string">&#x27;female&#x27;</span>, <span class="number">28</span>, <span class="string">&#x27;高级讲师&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">很明显子类Teacher中__init__内的前三行又是在写重复代码，若想在子类派生出的方法内重用父类的功能，有两种实现方式</span><br><span class="line"></span><br><span class="line">方法一：“指名道姓”地调用某一个类的函数</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Teacher</span>(<span class="params">People</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name,sex,age,title</span>):</span></span><br><span class="line"><span class="meta">... </span>        People.__init__(self,name,age,sex) <span class="comment">#调用的是函数,因而需要传入self</span></span><br><span class="line"><span class="meta">... </span>        self.title=title</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">teach</span>(<span class="params">self</span>):</span></span><br><span class="line"><span class="meta">... </span>        <span class="built_in">print</span>(<span class="string">&#x27;%s is teaching&#x27;</span> %self.name)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">方法二：<span class="built_in">super</span>()</span><br><span class="line"></span><br><span class="line">调用<span class="built_in">super</span>()会得到一个特殊的对象，该对象专门用来引用父类的属性，且严格按照MRO规定的顺序向后查找</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Teacher</span>(<span class="params">People</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name,sex,age,title</span>):</span></span><br><span class="line"><span class="meta">... </span>        <span class="built_in">super</span>().__init__(name,age,sex) <span class="comment">#调用的是绑定方法，自动传入self</span></span><br><span class="line"><span class="meta">... </span>        self.title=title</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">teach</span>(<span class="params">self</span>):</span></span><br><span class="line"><span class="meta">... </span>        <span class="built_in">print</span>(<span class="string">&#x27;%s is teaching&#x27;</span> %self.name)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">提示：在Python2中<span class="built_in">super</span>的使用需要完整地写成<span class="built_in">super</span>(自己的类名,self) ,而在python3中可以简写为<span class="built_in">super</span>()。</span><br><span class="line"></span><br><span class="line">这两种方式的区别是：　　　　<span class="number">1</span> 方式一是跟继承没有关系的　　　　<span class="number">2</span> 方式二的<span class="built_in">super</span>()是依赖于继承的，并且即使没有直接继承关系，<span class="built_in">super</span>()仍然会按照MRO继续往后查找</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment">#A没有继承B</span></span><br><span class="line"><span class="meta">... </span><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span></span><br><span class="line"><span class="meta">... </span>        <span class="built_in">super</span>().test()</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span></span><br><span class="line"><span class="meta">... </span>        <span class="built_in">print</span>(<span class="string">&#x27;from B&#x27;</span>)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">C</span>(<span class="params">A,B</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">pass</span></span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>C.mro() <span class="comment"># 在代码层面A并不是B的子类，但从MRO列表来看，属性查找时，就是按照顺序C-&gt;A-&gt;B-&gt;object，B就相当于A的“父类”</span></span><br><span class="line">[&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">__main__</span>.<span class="title">C</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">__main__</span>.<span class="title">A</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">__main__</span>.<span class="title">B</span>&#x27;&gt;,&lt;<span class="title">class</span> ‘<span class="title">object</span>&#x27;&gt;]</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">obj</span>=<span class="title">C</span>()</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">obj</span>.<span class="title">test</span>() # 属性查找的发起者是类<span class="title">C</span>的对象<span class="title">obj</span>，所以中途发生的属性查找都是参照<span class="title">C</span>.<span class="title">mro</span>()</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">obj.test()首先找到A下的test方法，执行<span class="built_in">super</span>().test()会基于MRO列表(以C.mro()为准)当前所处的位置继续往后查找()，然后在B中找到了test方法并执行。</span><br><span class="line"></span><br><span class="line">关于在子类中重用父类功能的这两种方式，使用任何一种都可以，但是在最新的代码中还是推荐使用<span class="built_in">super</span>()</span><br></pre></td></tr></table></figure>

<h2 id="组合"><a href="#组合" class="headerlink" title="组合"></a>组合</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在一个类中以另外一个类的对象作为数据属性，称为类的组合。组合与继承都是用来解决代码的重用性问题。不同的是：继承是一种“是”的关系，比如老师是人、学生是人，当类之间有很多相同的之处，应该使用继承；而组合则是一种“有”的关系，比如老师有生日，老师有多门课程，当类之间有显著不同，并且较小的类是较大的类所需要的组件时，应该使用组合，如下示例</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Course</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name,period,price</span>):</span></span><br><span class="line">        self.name=name</span><br><span class="line">        self.period=period</span><br><span class="line">        self.price=price</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tell_info</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&lt;%s %s %s&gt;&#x27;</span> %(self.name,self.period,self.price))</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Date</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,year,mon,day</span>):</span></span><br><span class="line">        self.year=year</span><br><span class="line">        self.mon=mon</span><br><span class="line">        self.day=day</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tell_birth</span>(<span class="params">self</span>):</span></span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&#x27;&lt;%s-%s-%s&gt;&#x27;</span> %(self.year,self.mon,self.day))</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span>:</span></span><br><span class="line">    school=<span class="string">&#x27;清华大学&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name,sex,age</span>):</span></span><br><span class="line">        self.name=name</span><br><span class="line">        self.sex=sex</span><br><span class="line">        self.age=age</span><br><span class="line"></span><br><span class="line"><span class="comment">#Teacher类基于继承来重用People的代码，基于组合来重用Date类和Course类的代码</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Teacher</span>(<span class="params">People</span>):</span> <span class="comment">#老师是人</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name,sex,age,title,year,mon,day</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__(name,age,sex)</span><br><span class="line">        self.birth=Date(year,mon,day) <span class="comment">#老师有生日</span></span><br><span class="line">        self.courses=[] <span class="comment">#老师有课程，可以在实例化后，往该列表中添加Course类的对象</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">teach</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;%s is teaching&#x27;</span> %self.name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">python=Course(<span class="string">&#x27;python&#x27;</span>,<span class="string">&#x27;3mons&#x27;</span>,<span class="number">3000.0</span>)</span><br><span class="line">linux=Course(<span class="string">&#x27;linux&#x27;</span>,<span class="string">&#x27;5mons&#x27;</span>,<span class="number">5000.0</span>)</span><br><span class="line">teacher1=Teacher(<span class="string">&#x27;lili&#x27;</span>,<span class="string">&#x27;female&#x27;</span>,<span class="number">28</span>,<span class="string">&#x27;博士生导师&#x27;</span>,<span class="number">1990</span>,<span class="number">3</span>,<span class="number">23</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># teacher1有两门课程</span></span><br><span class="line">teacher1.courses.append(python)</span><br><span class="line">teacher1.courses.append(linux)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重用Date类的功能</span></span><br><span class="line">teacher1.birth.tell_birth()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重用Course类的功能</span></span><br><span class="line"><span class="keyword">for</span> obj <span class="keyword">in</span> teacher1.courses: </span><br><span class="line">    obj.tell_info()</span><br><span class="line">此时对象teacher1集对象独有的属性、Teacher类中的内容、Course类中的内容于一身（都可以访问到），是一个高度整合的产物</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">继承与组合的区别：</span></span><br><span class="line"><span class="string">    继承：满足is a的关系</span></span><br><span class="line"><span class="string">    组合：满足has a的关系</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/11/12/%E5%87%BD%E6%95%B0%E7%9A%84%E5%8F%82%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/11/12/%E5%87%BD%E6%95%B0%E7%9A%84%E5%8F%82%E6%95%B0/" class="post-title-link" itemprop="url">函数的参数</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-11-12 07:20:25" itemprop="dateCreated datePublished" datetime="2018-11-12T07:20:25+08:00">2018-11-12</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-12-01 12:22:34" itemprop="dateModified" datetime="2018-12-01T12:22:34+08:00">2018-12-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Python%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">Python系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="内容概要"><a href="#内容概要" class="headerlink" title="内容概要"></a>内容概要</h1><ul>
<li>形参与实参介绍</li>
<li>形参与实参的具体使用</li>
</ul>
<h1 id="内容详细"><a href="#内容详细" class="headerlink" title="内容详细"></a>内容详细</h1><h2 id="形参与实参介绍"><a href="#形参与实参介绍" class="headerlink" title="形参与实参介绍"></a>形参与实参介绍</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">函数的参数分为<span class="string">&#x27;形式参数&#x27;</span>和<span class="string">&#x27;实际参数&#x27;</span>，简称<span class="string">&#x27;形参&#x27;</span>和<span class="string">&#x27;实参&#x27;</span>：</span><br><span class="line"></span><br><span class="line">形参 ： 即在<span class="string">&#x27;定义函数阶段&#x27;</span>时，括号内声明的参数，形参本质就是一个<span class="string">&#x27;变量名&#x27;</span>,用来接收外部传来的值</span><br><span class="line"></span><br><span class="line">实参 ： 即在<span class="string">&#x27;调用函数阶段&#x27;</span>时，括号内传入的<span class="string">&#x27;值&#x27;</span>，值可以是常量、变量、表达式或三者的组合</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1：实参是常量</span></span><br><span class="line">res = my_min(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2：实参是变量</span></span><br><span class="line">a = <span class="number">1</span></span><br><span class="line">b = <span class="number">2</span></span><br><span class="line">res = my_min(a, b)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3：实参是表达式</span></span><br><span class="line">res = my_min(<span class="number">10</span>*<span class="number">2</span>,<span class="number">10</span>*my_min(<span class="number">3</span>,<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4：实参可以是常量、变量、表达式的任意组合</span></span><br><span class="line">a = <span class="number">2</span></span><br><span class="line">my_min(<span class="number">1</span>,a,<span class="number">10</span>*my_min(<span class="number">3</span>,<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">在调用有参函数时，实参(值)会赋值给形参(变量名)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>在python中，变量名与值只是单纯的绑定关系，而对函数来说，这种绑定关系只在函数调用时生效，在调用结束后解除</strong></p>
<h2 id="形参与实参的具体使用"><a href="#形参与实参的具体使用" class="headerlink" title="形参与实参的具体使用"></a>形参与实参的具体使用</h2><h3 id="位置参数"><a href="#位置参数" class="headerlink" title="位置参数"></a>位置参数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">位置即顺序，位置参数指的是按顺序定义的参数，需要从两个角度去看：</span><br><span class="line"></span><br><span class="line"><span class="number">1</span> 在定义函数阶段时：按照从左到右的顺序依次定义形参，称为位置形参，凡是按照这种形式定义的形参都必须被传值</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span>(<span class="params">name,age,sex</span>):</span> <span class="comment"># 定义位置形参：name，age，sex  这三者都必须被传值</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Name: %s Age: %s Sex: %s&#x27;</span> % (name,age,sex))</span><br><span class="line">register() <span class="comment"># TypeError：缺少3个位置参数</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">2</span> 在调用函数阶段时：按照从左到右的顺序依次定义实参，称为位置实参，凡是按照这种形式定义的实参会按照从左到右的顺序与形参一一对应</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span>(<span class="params">name,age,sex</span>):</span> <span class="comment"># 定义位置形参：name，age，sex 这三者都必须被传值</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Name: %s Age: %s Sex: %s&#x27;</span> % (name,age,sex))</span><br><span class="line">register(<span class="string">&#x27;egon&#x27;</span>,<span class="number">18</span>,male) <span class="comment"># 实参从左到右与形参一一对应</span></span><br></pre></td></tr></table></figure>

<h3 id="关键字参数"><a href="#关键字参数" class="headerlink" title="关键字参数"></a>关键字参数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">在调用函数时，实参可以是key = value的形式，称为关键字参数，凡是按照这种形式定义的实参，可以完全不按照从左到右的顺序定义，但仍能为指定的形参赋值</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span>(<span class="params">name,age,sex</span>):</span> <span class="comment"># 定义位置形参：name，age，sex 这三者都必须被传值</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Name: %s Age: %s Sex: %s&#x27;</span> % (name,age,sex))</span><br><span class="line">register(sex = <span class="string">&#x27;male&#x27;</span>,name = <span class="string">&#x27;lili&#x27;</span>, age = <span class="number">18</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Name: lili Age: <span class="number">18</span> Sex: male</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">注意：</span><br><span class="line">      在调用函数时，实参也可以是按位置传参或按关键字传参混合使用，但是<span class="string">&#x27;必须保证关键字参数在位置参数后面，且不可以对一个形参重复赋值&#x27;</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>register(<span class="string">&#x27;lili&#x27;</span>,sex=<span class="string">&#x27;male&#x27;</span>,age=<span class="number">18</span>) <span class="comment">#正确使用</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>register(name=<span class="string">&#x27;lili&#x27;</span>,<span class="number">18</span>,sex=<span class="string">&#x27;male&#x27;</span>) <span class="comment">#SyntaxError：关键字参数name=‘lili’在位置参数18之前</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>register(<span class="string">&#x27;lili&#x27;</span>,sex=<span class="string">&#x27;male&#x27;</span>,age=<span class="number">18</span>,name=<span class="string">&#x27;jack&#x27;</span>) <span class="comment">#TypeError：形参name被重复赋值</span></span><br></pre></td></tr></table></figure>

<h3 id="默认参数"><a href="#默认参数" class="headerlink" title="默认参数"></a>默认参数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">在定义函数阶段时，就已经为形参赋值，这类形参称之为：默认参数，当函数有多个参数时，需要将值经常改变的参数定义成位置形参，而将值改变较少的参数定义成默认参数</span><br><span class="line"></span><br><span class="line">例如：编写一个注册学生信息的函数，如果大火书学生的性别都为男，那完全可以将形参sex定义成默认参数</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span>(<span class="params">name, age, sex = <span class="string">&#x27;male&#x27;</span></span>):</span> <span class="comment"># 默认sex的值为male</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Name:%s Age:%s Sex:%s&#x27;</span> %(name,age,sex))</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">这样在定义阶段时，就已经为参数sex赋值，意味着调用时可以不对sex赋值，这样就降低了函数调用的复杂度</span><br><span class="line"></span><br><span class="line">register(<span class="string">&#x27;tom&#x27;</span>, <span class="number">17</span>) <span class="comment"># 大多数情况，无需为sex传值，默认为male</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Name: tom Age: <span class="number">17</span> Sex: male</span><br><span class="line">register(<span class="string">&#x27;lili&#x27;</span>, <span class="number">18</span>, <span class="string">&#x27;female&#x27;</span>) <span class="comment"># 少数情况，可以为sex传值female</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Name: lili Age: <span class="number">18</span> Sex: female</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">注意：</span><br><span class="line">    <span class="number">1</span> 默认参数必须在位置参数之后</span><br><span class="line">    <span class="number">2</span> 默认参数的值仅在函数定义阶段被赋值一次</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">x = <span class="number">1</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">arg = x</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(arg)</span><br><span class="line">x = <span class="number">5</span> <span class="comment"># 定义阶段arg已经被赋值为1，此处的修改与默认参数arg没有任何关系</span></span><br><span class="line">foo()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">    <span class="number">3</span> 默认参数的值通常设为：不可变类型</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">n,arg = []</span>):</span></span><br><span class="line">    arg.append(n)</span><br><span class="line">    <span class="keyword">return</span> arg</span><br><span class="line">foo(<span class="number">1</span>)    </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[<span class="number">1</span>] </span><br><span class="line">foo(<span class="number">2</span>)    </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[<span class="number">1</span>, <span class="number">2</span>] </span><br><span class="line">foo(<span class="number">3</span>)    </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] <span class="comment"># 每一次调用都是在上一次的基础上向同一个列表增加值</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">修改后：</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">n,arg=<span class="literal">None</span></span>):</span>    </span><br><span class="line">     <span class="keyword">if</span> arg <span class="keyword">is</span> <span class="literal">None</span>:    </span><br><span class="line">         arg=[]    </span><br><span class="line">     arg.append(n)    </span><br><span class="line">     <span class="keyword">return</span> arg    </span><br><span class="line">foo(<span class="number">1</span>)    </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[<span class="number">1</span>] </span><br><span class="line">foo(<span class="number">2</span>)    </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[<span class="number">2</span>] </span><br><span class="line">foo(<span class="number">3</span>)    </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[<span class="number">3</span>] <span class="comment"># 脱裤子放屁 这样默认参数就没有了意义</span></span><br></pre></td></tr></table></figure>

<h2 id="可变长度的参数-与-的用法"><a href="#可变长度的参数-与-的用法" class="headerlink" title="可变长度的参数(与*的用法)"></a>可变长度的参数(与*的用法)</h2><p> <strong>参数的长度可变指的是：在调用函数的时候，实参的个数可以不固定</strong></p>
<p> <strong>在调用函数时：实参的定义无非是按位置传参或者按关键字传参两种形式，这就要求形参提供两种方案，来分别处理两种形式的可变长度的参数 ↓↓↓</strong></p>
<h3 id="可变长度的位置参数"><a href="#可变长度的位置参数" class="headerlink" title="可变长度的位置参数"></a>可变长度的位置参数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">如果在最后一个形参名前加 * 号，那么在调用函数时，溢出的位置实参，都会被 * 接收，以元组的形式保存下来赋值给该形参</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">x, y, z = <span class="number">1</span>, *args</span>):</span> <span class="comment"># 在最后一个形参名args前加 * 号</span></span><br><span class="line">    <span class="built_in">print</span>(x)</span><br><span class="line">    <span class="built_in">print</span>(y)</span><br><span class="line">    <span class="built_in">print</span>(z)</span><br><span class="line">    <span class="built_in">print</span>(args)</span><br><span class="line">foo(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>) <span class="comment"># 实参1,2,3按位置为形参x，y，z赋值，多余的位置实参4,5,6,7都被*接收，以元组的形式保存下来，赋值给args，即args = (4,5,6,7)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>(<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">如果我们事先生成了一个列表，仍然是可以传值给*args的</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">x, y, *args</span>):</span></span><br><span class="line">   <span class="built_in">print</span>(x)</span><br><span class="line">   <span class="built_in">print</span>(y)</span><br><span class="line">   <span class="built_in">print</span>(args)</span><br><span class="line">L = [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">foo(<span class="number">1</span>, <span class="number">2</span>, *L) <span class="comment"># *L就相当于位置参数3,4,5,foo(1,2,*L)就等同于foo(1,2,(3,4,5))</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>(<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">    <span class="number">1</span> 如果在传入L时没有加*,那L就只是一个普通的位置参数了</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">x, y, *args</span>):</span></span><br><span class="line">   <span class="built_in">print</span>(x)</span><br><span class="line">   <span class="built_in">print</span>(y)</span><br><span class="line">   <span class="built_in">print</span>(args)</span><br><span class="line">L = [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">foo(<span class="number">1</span>, <span class="number">2</span>, L)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>(<span class="number">3</span>,)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    <span class="number">2</span> 如果形参为常规的参数（位置或默认），实参仍可以是*的形式</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">x,y,z=<span class="number">3</span></span>):</span></span><br><span class="line">  <span class="built_in">print</span>(x)</span><br><span class="line">  <span class="built_in">print</span>(y)</span><br><span class="line">  <span class="built_in">print</span>(z)</span><br><span class="line">foo(*[<span class="number">1</span>,<span class="number">2</span>]) <span class="comment">#等同于foo(1,2)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">14</span></span><br><span class="line"></span><br><span class="line"><span class="number">4</span>、、</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">3</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">如果想要求多个值的和，*args就派上用场了</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">*args</span>):</span></span><br><span class="line">   res=<span class="number">0</span></span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> args:</span><br><span class="line">     res+=i</span><br><span class="line">   <span class="keyword">return</span> res</span><br><span class="line">add(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">15</span></span><br></pre></td></tr></table></figure>

<h3 id="可变长度的关键字参数"><a href="#可变长度的关键字参数" class="headerlink" title="可变长度的关键字参数"></a>可变长度的关键字参数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">如果在最后一个形参名前加 ** 号，那么在调用函数时，溢出的关键字参数，都会被 ** 接收，以字典的形式保存下来赋值给形参</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">x, **kwargs</span>):</span> <span class="comment"># 在最后一个参数kwargs前加**</span></span><br><span class="line">    <span class="built_in">print</span>(x)</span><br><span class="line">    <span class="built_in">print</span>(kwargs)</span><br><span class="line">foo(y=<span class="number">2</span>, x=<span class="number">1</span>, z=<span class="number">3</span>) <span class="comment"># 溢出的关键字实参y=2，z=3都被**接收，以字典的形式保存下来，赋值给kwargs</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>&#123;<span class="string">&#x27;z&#x27;</span> : <span class="number">3</span>, <span class="string">&#x27;y&#x27;</span> : <span class="number">2</span>&#125;</span><br><span class="line">如果我们事先生成了一个字典，仍然是可以传值给**kwargs的</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">x,y,**kwargs</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(x)</span><br><span class="line">    <span class="built_in">print</span>(y)</span><br><span class="line">    <span class="built_in">print</span>(kwargs)</span><br><span class="line"><span class="built_in">dict</span> = &#123;<span class="string">&#x27;a&#x27;</span> : <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span> : <span class="number">2</span>&#125;</span><br><span class="line">foo(<span class="number">1</span>, <span class="number">2</span>, **<span class="built_in">dict</span>) <span class="comment"># **dic就相当于关键字参数a=1，b=2，foo(1, 2, **dict)等同foo(1,2,a=1,b=2)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>&#123;<span class="string">&#x27;a&#x27;</span> : <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span> : <span class="number">2</span>&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">注意：</span></span><br><span class="line"><span class="string">    如果在传入dict时没有加**，那么dict就只是一个普通的位置参数了</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo(<span class="number">1</span>,<span class="number">2</span>,dic) <span class="comment">#TypeError:函数foo只需要2个位置参数，但是传了3个</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">如果形参为常规参数(位置或默认)，实参仍可以是**的形式</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">x,y,z=<span class="number">3</span></span>):</span></span><br><span class="line">    <span class="built_in">print</span>(x)</span><br><span class="line">    <span class="built_in">print</span>(y)</span><br><span class="line">    <span class="built_in">print</span>(z)</span><br><span class="line"></span><br><span class="line">foo(**&#123;<span class="string">&#x27;x&#x27;</span>:<span class="number">1</span>,<span class="string">&#x27;y&#x27;</span>:<span class="number">2</span>&#125;) <span class="comment"># 等同于foo(y=2,x=1)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">3</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">如果我们要编写一个用户认证的函数，起初可能只基于用户名密码的验证就可以了，可以使用**kwargs为日后的扩展提供良好的环境，同时保持了函数的简洁性</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">auth</span>(<span class="params">user,password,**kwargs</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<h2 id="命名关键字参数"><a href="#命名关键字参数" class="headerlink" title="命名关键字参数"></a>命名关键字参数</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">在定义了**kwargs参数后，函数调用者就可以传入任意的关键字参数(key = value)，如果函数体代码的执行需要依赖某个key，必须在函数内进行判断</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span>(<span class="params">name,age,**kwargs</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;sex&#x27;</span> <span class="keyword">in</span> kwargs:</span><br><span class="line">        <span class="comment"># 有sex参数</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;height&#x27;</span> <span class="keyword">in</span> kwargs:</span><br><span class="line">        <span class="comment"># 有height参数</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">想要限定函数，调用者必须以key = value的形式传值，python3提供了专门的语法：需要在定义形参时，用*作为一个分隔符号，*号之后的形参称为命名关键字参数，对于这类参数，在函数调用时，必须按照key = value的形式为其传值，</span><br><span class="line">且必须被传值</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">register</span>(<span class="params">name,age,*,sex,height</span>):</span> <span class="comment">#sex,height为命名关键字参数</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">pass</span></span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>register(<span class="string">&#x27;lili&#x27;</span>,<span class="number">18</span>,sex=<span class="string">&#x27;male&#x27;</span>,height=<span class="string">&#x27;1.8m&#x27;</span>) <span class="comment">#正确使用</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>register(<span class="string">&#x27;lili&#x27;</span>,<span class="number">18</span>,<span class="string">&#x27;male&#x27;</span>,<span class="string">&#x27;1.8m&#x27;</span>) <span class="comment"># TypeError:未使用关键字的形式为sex和height传值</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>register(<span class="string">&#x27;lili&#x27;</span>,<span class="number">18</span>,height=<span class="string">&#x27;1.8m&#x27;</span>) <span class="comment"># TypeError没有为命名关键字参数height传值。</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">命名关键字参数也可以有默认值，从而简化调用</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">register</span>(<span class="params">name,age,*,sex=<span class="string">&#x27;male&#x27;</span>,height</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(<span class="string">&#x27;Name:%s,Age:%s,Sex:%s,Height:%s&#x27;</span> %(name,age,sex,height))</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>register(<span class="string">&#x27;lili&#x27;</span>,<span class="number">18</span>,height=<span class="string">&#x27;1.8m&#x27;</span>)</span><br><span class="line">Name:lili,Age:<span class="number">18</span>,Sex:male,Height:<span class="number">1.8</span>m</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">需要强调的是：sex不是默认参数，height也不是位置参数，因为二者均在后，所以都是命名关键字参数，形参sex=’male’属于命名关键字参数的默认值，因而即便是放到形参height之前也不会有问题。另外，如果形参中已经有一个args了，命名关键字参数就不再需要一个单独的*作为分隔符号了</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; def register(name,age,*args,sex=&#x27;male&#x27;,height):</span><br><span class="line">...   print(&#x27;Name:%s,Age:%s,Args:%s,Sex:%s,Height:%s&#x27; %(name,age,args,sex,height))</span><br><span class="line">... </span><br><span class="line">&gt;&gt;&gt; register(&#x27;lili&#x27;,18,1,2,3,height=&#x27;1.8m&#x27;) #sex与height仍为命名关键字参数</span><br><span class="line">Name:lili,Age:18,Args:(1, 2, 3),Sex:male,Height:1.8m</span><br></pre></td></tr></table></figure>

<h2 id="组合使用"><a href="#组合使用" class="headerlink" title="组合使用"></a>组合使用</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">综上所述所有参数可任意组合使用，但定义顺序必须是：位置参数、默认参数、*args、命名关键字参数、**kwargs</span><br><span class="line"></span><br><span class="line">可变参数*args与关键字参数**kwargs通常是组合在一起使用的，如果一个函数的形参为*args与**kwargs，那么代表该函数可以接收任何形式、任意长度的参数</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args,**kwargs</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">pass</span></span><br><span class="line">...</span><br><span class="line">在该函数内部还可以把接收到的参数传给另外一个函数（这在<span class="number">4.6</span>小节装饰器的实现中大有用处）</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">x,y,z</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(x,y,z)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args,**kwargs</span>):</span></span><br><span class="line"><span class="meta">... </span>    func(*args,**kwargs)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>wrapper(<span class="number">1</span>,z=<span class="number">3</span>,y=<span class="number">2</span>)</span><br><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">按照上述写法，在为函数wrapper传参时，其实遵循的是函数func的参数规则，调用函数wrapper的过程分析如下：</span><br><span class="line"></span><br><span class="line">    <span class="number">1</span> 位置实参<span class="number">1</span>被接收，以元组的形式保存下来，赋值给args，即args=(<span class="number">1</span>,),关键字实参z=<span class="number">3</span>，y=<span class="number">2</span>被*接收，以字典的形式保存下来，赋值给kwargs，即kwargs=&#123;<span class="string">&#x27;y&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;z&#x27;</span>: <span class="number">3</span>&#125;</span><br><span class="line">    <span class="number">2</span> 执行func(args,kwargs),即func((<span class="number">1</span>,),* &#123;<span class="string">&#x27;y&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;z&#x27;</span>: <span class="number">3</span>&#125;),等同于func(<span class="number">1</span>,z=<span class="number">3</span>,y=<span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">  提示： *args、**kwargs中的args和kwargs被替换成其他名字并无语法错误，但使用args、kwargs是约定俗成的。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h1 id="重点："><a href="#重点：" class="headerlink" title="重点："></a>重点：</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">* 与 **</span><br><span class="line"></span><br><span class="line"><span class="number">1</span> 在形参中：</span><br><span class="line">    接受溢出的，属于汇总行为</span><br><span class="line">    *  会接受溢出的(位置)的值</span><br><span class="line">    ** 会接受溢出的(关键字)的值</span><br><span class="line">    </span><br><span class="line"><span class="number">2</span> 在实参中：</span><br><span class="line">    打散行为</span><br><span class="line">    *  后面可以跟<span class="string">&#x27;可以被for循环遍历的类型&#x27;</span>，* 会将其打散成位置实参</span><br><span class="line">    ** 后面跟的只能是<span class="string">&#x27;字典类型&#x27;</span>，** 会将其打散成关键字实参</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/11/12/%E5%87%BD%E6%95%B0%E9%80%92%E5%BD%92/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/11/12/%E5%87%BD%E6%95%B0%E9%80%92%E5%BD%92/" class="post-title-link" itemprop="url">函数递归</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-11-12 07:20:25" itemprop="dateCreated datePublished" datetime="2018-11-12T07:20:25+08:00">2018-11-12</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-12-01 12:22:34" itemprop="dateModified" datetime="2018-12-01T12:22:34+08:00">2018-12-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Python%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">Python系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="内容概要"><a href="#内容概要" class="headerlink" title="内容概要"></a>内容概要</h1><ul>
<li>函数递归调用介绍</li>
<li>回溯与递推</li>
</ul>
<h1 id="内容详细"><a href="#内容详细" class="headerlink" title="内容详细"></a>内容详细</h1><h2 id="函数递归调用介绍"><a href="#函数递归调用介绍" class="headerlink" title="函数递归调用介绍"></a>函数递归调用介绍</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">函数不仅可以嵌套定义，还可以嵌套调用，即在调用一个函数的过程中，函数内部又调用另一个函数，而函数的递归调用指的是在调用一个函数的过程中又直接或间接的调用该函数本身</span><br><span class="line"></span><br><span class="line">例如：直接调用</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&gt;&gt;&gt; f1&#x27;</span>)</span><br><span class="line">    f1()</span><br><span class="line">f1()</span><br></pre></td></tr></table></figure>

<p><img src="https://pic3.zhimg.com/80/v2-e409210099ed20bf4b6a01fc4f1a7c9e_720w.jpg" alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">在调用f1的过程中，又调用f2，而在调用f2的过程中又调用f1，这就是间接调用函数f1本身</span><br><span class="line"></span><br><span class="line">例如：间接调用</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;from f1&#x27;</span>)</span><br><span class="line">    f2()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;from f2&#x27;</span>)</span><br><span class="line">    f1()</span><br><span class="line"></span><br><span class="line">f1()</span><br></pre></td></tr></table></figure>

<p><img src="https://pic4.zhimg.com/80/v2-3190338dfab02a5e59a1f6d099801667_720w.jpg" alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">从上图可知：这两种情况下的递归调用都是一个无限循环的过程</span><br><span class="line"></span><br><span class="line">但在python中，对函数的递归调用的深度做了限制，因此并不会进入无限循环，而是会抛出异常</span><br><span class="line"></span><br><span class="line">要避免这种情况出现，就必须让递归调用在满足某个特定条件下终止</span><br><span class="line"></span><br><span class="line">ps ：  <span class="comment">#1. 可以使用sys.getrecursionlimit()去查看递归深度，默认值为1000，虽然可以使用sys.setrecursionlimit()去设定该值，但仍受限于主机操作系统栈大小的限制</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">#2. python不是一门函数式编程语言，无法对递归进行尾递归优化。</span></span><br></pre></td></tr></table></figure>

<h2 id="回溯与递推"><a href="#回溯与递推" class="headerlink" title="回溯与递推"></a>回溯与递推</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">例子：</span><br><span class="line"></span><br><span class="line">某公司四个员工坐在一起，问第四个人薪水，他说比第三个人多<span class="number">1000</span>，问第三个人薪水，第他说比第二个人多<span class="number">1000</span>，问第二个人薪水，他说比第一个人多<span class="number">1000</span>，最后第一人说自己每月<span class="number">5000</span>，请问第四个人的薪水是多少？</span><br><span class="line"></span><br><span class="line">思路解析：</span><br><span class="line"></span><br><span class="line">要知道第四个人的月薪，就必须知道第三个人的，第三个人的又取决于第二个人的，第二个人的又取决于第一个人的，而且每一个员工都比前一个多一千，数学表达式即：</span><br><span class="line"></span><br><span class="line">salary(<span class="number">4</span>)=salary(<span class="number">3</span>)+<span class="number">1000</span> </span><br><span class="line">salary(<span class="number">3</span>)=salary(<span class="number">2</span>)+<span class="number">1000</span> </span><br><span class="line">salary(<span class="number">2</span>)=salary(<span class="number">1</span>)+<span class="number">1000</span> </span><br><span class="line">salary(<span class="number">1</span>)=<span class="number">5000</span></span><br><span class="line">总结为： </span><br><span class="line">salary(n)=salary(n-<span class="number">1</span>)+<span class="number">1000</span> (n&gt;<span class="number">1</span>) </span><br><span class="line">salary(<span class="number">1</span>)=<span class="number">5000</span> (n=<span class="number">1</span>) </span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">很明显这是一个递归的过程，可以将该过程分为两个阶段：回溯与递推</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1 回溯阶段：</span></span><br><span class="line">    要求第n个员工的薪水，需要回溯得到(n-<span class="number">1</span>)个员工的薪水，以此类推，直到得到第一个员工的薪水，此时，salary(<span class="number">1</span>)已知，因而不必再向前回溯了。</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 递推阶段：</span></span><br><span class="line">    从第一个员工的薪水可以推算出第二个员工的薪水(<span class="number">6000</span>)，从第二个员工的薪水可以推算出第三个员工的薪水(<span class="number">7000</span>)，以此类推，一直推算出第第四个员工的薪水(<span class="number">8000</span>)为止，递归结束。</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 注意：递归一定要有一个结束条件，这里n=1就是结束条件。</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://pic3.zhimg.com/80/v2-b8756ae5141d371f4594408e3df84e56_720w.jpg" alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">代码实现：</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">salary</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">if</span> n==<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">5000</span></span><br><span class="line">    <span class="keyword">return</span> salary(n-<span class="number">1</span>)+<span class="number">1000</span></span><br><span class="line"></span><br><span class="line">s=salary(<span class="number">4</span>)</span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line"></span><br><span class="line">执行结果：</span><br><span class="line"></span><br><span class="line"><span class="number">8000</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">程序分析：</span><br><span class="line"></span><br><span class="line">在未满足n == <span class="number">1</span>的条件时，一直进行递归调用，即一直回溯 而在满足n == <span class="number">1</span>的条件时，终止递归调用，即结束回溯，从而进入递推阶段，依次推导直到得到最终的结果。</span><br><span class="line"></span><br><span class="line">递归本质就是在做重复的事情，所以理论上递归可以解决的问题循环也都可以解决，只不过在某些情况下，使用递归会更容易实现，比如有一个嵌套多层的列表，要求打印出所有的元素，代码实现如下</span><br><span class="line"></span><br><span class="line">items=[[<span class="number">1</span>,<span class="number">2</span>],<span class="number">3</span>,[<span class="number">4</span>,[<span class="number">5</span>,[<span class="number">6</span>,<span class="number">7</span>]]]]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">items</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> items:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(i,<span class="built_in">list</span>): <span class="comment">#满足未遍历完items以及if判断成立的条件时，一直进行递归调用</span></span><br><span class="line">            foo(i) </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(i,end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"></span><br><span class="line">foo(items) <span class="comment">#打印结果1 2 3 4 5 6 7</span></span><br></pre></td></tr></table></figure>

<p><strong>使用递归，我们只需要分析出要重复执行的代码逻辑，然后提取进入下一次递归调用的条件或者说递归结束的条件即可，代码实现起来简洁清晰</strong></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">池劲涛</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
