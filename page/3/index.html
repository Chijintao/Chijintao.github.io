<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","version":"8.6.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta property="og:type" content="website">
<meta property="og:title" content="池劲涛的博客">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="池劲涛的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="池劲涛">
<meta property="article:tag" content="Python Linux Vue">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/3/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/3/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>池劲涛的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">池劲涛的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="池劲涛"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">池劲涛</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">66</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/05/11/Django%E5%88%9D%E8%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/05/11/Django%E5%88%9D%E8%AF%86/" class="post-title-link" itemprop="url">Django初识</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-11 07:20:25" itemprop="dateCreated datePublished" datetime="2019-05-11T07:20:25+08:00">2019-05-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2019-06-01 12:22:34" itemprop="dateModified" datetime="2019-06-01T12:22:34+08:00">2019-06-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">Django系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="内容概要"><a href="#内容概要" class="headerlink" title="内容概要"></a>内容概要</h1><ul>
<li>我们自己写一个简易版本的web框架(代码无需掌握，重点在于理解思路)</li>
<li>django框架</li>
</ul>
<h1 id="内容详细"><a href="#内容详细" class="headerlink" title="内容详细"></a>内容详细</h1><h3 id="Django生命周期流程图"><a href="#Django生命周期流程图" class="headerlink" title="Django生命周期流程图"></a>Django生命周期流程图</h3><p> <img src="https://img2020.cnblogs.com/blog/2342210/202106/2342210-20210622080437779-1091380189.png" alt="img"></p>
<h3 id="软件开发架构"><a href="#软件开发架构" class="headerlink" title="软件开发架构"></a>软件开发架构</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cs架构</span><br><span class="line">bs架构</span><br><span class="line"><span class="comment"># 本质bs也是cs</span></span><br></pre></td></tr></table></figure>

<h3 id="纯手撸web框架"><a href="#纯手撸web框架" class="headerlink" title="纯手撸web框架"></a>纯手撸web框架</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># HTTP协议</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">网络协议</span></span><br><span class="line"><span class="string">HTTP协议                数据传输是明文</span></span><br><span class="line"><span class="string">HTTPS协议                数据传输是密文</span></span><br><span class="line"><span class="string">websocket协议            数据传输是密文</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">四大特性</span></span><br><span class="line"><span class="string">    1.基于请求响应</span></span><br><span class="line"><span class="string">    2.基于TCP、IP作用于应用层之上的协议</span></span><br><span class="line"><span class="string">    3.无状态</span></span><br><span class="line"><span class="string">    4.短/无链接</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">数据格式</span></span><br><span class="line"><span class="string">    请求首行</span></span><br><span class="line"><span class="string">    请求头</span></span><br><span class="line"><span class="string">    \r\n</span></span><br><span class="line"><span class="string">    请求体</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">响应状态码</span></span><br><span class="line"><span class="string">    1XX</span></span><br><span class="line"><span class="string">    2XX            200</span></span><br><span class="line"><span class="string">    3XX            </span></span><br><span class="line"><span class="string">    4XX            403 404</span></span><br><span class="line"><span class="string">    5XX            500</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 如何做到后缀的不同返回不同的内容</span></span><br><span class="line">    <span class="comment"># 拿到用户输入的后缀 做判断 </span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"><span class="comment"># 不足之处</span></span><br><span class="line">    <span class="number">1.</span>代码重复(服务端代码所有人都要重复写)</span><br><span class="line">      <span class="number">2.</span>手动处理http格式的数据 并且只能拿到url后缀 其他数据获取繁琐(数据格式一样处理的代码其实也大致一样 重复写)</span><br><span class="line">      <span class="number">3.</span>并发的问题</span><br></pre></td></tr></table></figure>

<h3 id="借助于wsgiref模块"><a href="#借助于wsgiref模块" class="headerlink" title="借助于wsgiref模块"></a>借助于wsgiref模块</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">urls.py                            路由与视图函数对应关系</span></span><br><span class="line"><span class="string">views.py                　　　　 视图函数(后端业务逻辑)</span></span><br><span class="line"><span class="string">templates文件夹　　　　　　　　　　　　　　　　　　　　专门用来存储html文件</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 按照功能的不同拆分之后 后续添加功能只需要在urls.py书写对应关系然后取views.py书写业务逻辑即可</span></span><br></pre></td></tr></table></figure>

<h3 id="动静态网页"><a href="#动静态网页" class="headerlink" title="动静态网页"></a>动静态网页</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">静态网页</span></span><br><span class="line"><span class="string">    页面上的数据是直接写死的 万年不变</span></span><br><span class="line"><span class="string">动态网页</span></span><br><span class="line"><span class="string">    数据是实时获取的</span></span><br><span class="line"><span class="string">    eg:</span></span><br><span class="line"><span class="string">        1.后端获取当前时间展示到html页面上</span></span><br><span class="line"><span class="string">        2.数据是从数据库中获取的展示到html页面上</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 动态网页制作</span></span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_time</span>(<span class="params">env</span>):</span></span><br><span class="line">    current_time = datetime.datetime.now().strftime(<span class="string">&#x27;%Y-%m-%d %X&#x27;</span>)</span><br><span class="line">    <span class="comment"># 如何将后端获取到的数据&quot;传递&quot;给html文件？</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&#x27;templates/03 mytime.html&#x27;</span>,<span class="string">&#x27;r&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">        <span class="comment"># data就是一堆字符串</span></span><br><span class="line">    data = data.replace(<span class="string">&#x27;dwadasdsadsadasdas&#x27;</span>,current_time)   <span class="comment"># 在后端将html页面处理好之后再返回给前端</span></span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将一个字典传递给html文件 并且可以在文件上方便快捷的操作字典数据</span></span><br><span class="line"><span class="keyword">from</span> jinja2 <span class="keyword">import</span> Template</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_dict</span>(<span class="params">env</span>):</span></span><br><span class="line">    user_dic = &#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;jason&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="number">18</span>,<span class="string">&#x27;hobby&#x27;</span>:<span class="string">&#x27;read&#x27;</span>&#125;</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&#x27;templates/04 get_dict.html&#x27;</span>,<span class="string">&#x27;r&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">    tmp = Template(data)</span><br><span class="line">    res = tmp.render(user=user_dic)</span><br><span class="line">    <span class="comment"># 给get_dict.html传递了一个值 页面上通过变量名user就能够拿到user_dict</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="comment"># 后端获取数据库中数据展示到前端页面</span></span><br></pre></td></tr></table></figure>

<h3 id="模版语法之Jinja2模块"><a href="#模版语法之Jinja2模块" class="headerlink" title="模版语法之Jinja2模块"></a>模版语法之Jinja2模块</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">pip3 install jinja2</span><br><span class="line"><span class="string">&quot;&quot;&quot;模版语法是在后端起作用的&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 模版语法(非常贴近python语法)</span></span><br><span class="line">&#123;&#123; user &#125;&#125;</span><br><span class="line">&#123;&#123; user.get(<span class="string">&#x27;username&#x27;</span>)&#125;&#125;</span><br><span class="line">&#123;&#123; user.age &#125;&#125;</span><br><span class="line">&#123;&#123; user[<span class="string">&#x27;hobby&#x27;</span>] &#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% <span class="keyword">for</span> user_dict <span class="keyword">in</span> user_list %&#125;</span><br><span class="line">                        &lt;tr&gt;</span><br><span class="line">                            &lt;td&gt;&#123;&#123; user_dict.<span class="built_in">id</span>&#125;&#125;&lt;/td&gt;</span><br><span class="line">                            &lt;td&gt;&#123;&#123; user_dict.username&#125;&#125;&lt;/td&gt;</span><br><span class="line">                            &lt;td&gt;&#123;&#123; user_dict.password&#125;&#125;&lt;/td&gt;</span><br><span class="line">                            &lt;td&gt;&#123;&#123; user_dict.hobby&#125;&#125;&lt;/td&gt;</span><br><span class="line">                        &lt;/tr&gt;</span><br><span class="line">&#123;% endfor%&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义简易版本web框架请求流程图"><a href="#自定义简易版本web框架请求流程图" class="headerlink" title="自定义简易版本web框架请求流程图"></a>自定义简易版本web框架请求流程图</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">wsgiref模块</span></span><br><span class="line"><span class="string">    1.请求来的时候解析http格式的数据 封装成大字典</span></span><br><span class="line"><span class="string">    2.响应走的时候给数据打包成符合http格式 再返回给浏览器</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="python三大主流web框架"><a href="#python三大主流web框架" class="headerlink" title="python三大主流web框架"></a>python三大主流web框架</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">django</span></span><br><span class="line"><span class="string">    特点:大而全 自带的功能特别特别特别的多 类似于航空母舰</span></span><br><span class="line"><span class="string">    不足之处:</span></span><br><span class="line"><span class="string">        有时候过于笨重</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">flask</span></span><br><span class="line"><span class="string">    特点:小而精  自带的功能特别特别特别的少 类似于游骑兵</span></span><br><span class="line"><span class="string">    第三方的模块特别特别特别的多，如果将flask第三方的模块加起来完全可以盖过django</span></span><br><span class="line"><span class="string">    并且也越来越像django</span></span><br><span class="line"><span class="string">    不足之处:</span></span><br><span class="line"><span class="string">        比较依赖于第三方的开发者</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">tornado</span></span><br><span class="line"><span class="string">    特点:异步非阻塞 支持高并发</span></span><br><span class="line"><span class="string">        牛逼到甚至可以开发游戏服务器</span></span><br><span class="line"><span class="string">    不足之处:</span></span><br><span class="line"><span class="string">        你不会~</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如何让你的计算机能够正常的启动django项目</span></span><br><span class="line">    <span class="number">1.</span>计算机的名称不能有中文</span><br><span class="line">      <span class="number">2.</span>一个pycharm窗口只开一个项目 <span class="comment"># 不要文件夹套文件夹</span></span><br><span class="line">      <span class="number">3.</span>项目里面所有的文件也尽量不要出现中文</span><br><span class="line">      <span class="number">4.</span>python解释器尽量使用<span class="number">3.4</span>~<span class="number">3.6</span>之间的版本</span><br><span class="line">      (如果你的项目报错 你点击最后一个报错信息</span><br><span class="line">    去源码中把逗号删掉)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># django版本问题</span></span><br><span class="line">    <span class="number">1.</span>X <span class="number">2.</span>X <span class="number">3.</span>X(最新版本)</span><br><span class="line">    </span><br><span class="line">      <span class="number">1.</span>X和<span class="number">2.</span>X本身差距也不大 </span><br><span class="line">      公司之前用的<span class="number">1.8</span>  有一些项目用的<span class="number">2.0</span></span><br><span class="line">  </span><br><span class="line">     django版本图</span><br><span class="line">  </span><br><span class="line"><span class="comment"># django安装</span></span><br><span class="line">    pip3 install django==<span class="number">1.11</span><span class="number">.11</span></span><br><span class="line">      如果已经安装了其他版本 无需自己卸载</span><br><span class="line">      直接重新装 会自动卸载安装新的</span><br><span class="line">  </span><br><span class="line">      如果报错 看看是不是timeout 如果是 那么只是网速波动</span><br><span class="line">      重新安装即可</span><br><span class="line"></span><br><span class="line">      验证是否安装成功的方式<span class="number">1</span></span><br><span class="line">        终端输入django-admin看看有没有反应</span><br></pre></td></tr></table></figure>

<h3 id="django基本操作"><a href="#django基本操作" class="headerlink" title="django基本操作"></a>django基本操作</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 命令行操作</span></span><br><span class="line">    <span class="comment"># 1.创建django项目</span></span><br><span class="line">      <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">      你可以先切换到对应的D盘 然后再创建</span></span><br><span class="line"><span class="string">      &quot;&quot;&quot;</span></span><br><span class="line">      django-admin startproject mysite</span><br><span class="line">    </span><br><span class="line">        mysite文件夹</span><br><span class="line">          manage.py</span><br><span class="line">          mysite文件夹</span><br><span class="line">            __init__.py</span><br><span class="line">            settings.py</span><br><span class="line">          urls.py</span><br><span class="line">          wsgi.py</span><br><span class="line"> <span class="comment"># 2.启动django项目</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        一定要先切换到项目目录下    </span></span><br><span class="line"><span class="string">        cd /mysite</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">  python3 manage.py runserver</span><br><span class="line">  <span class="comment"># http://127.0.0.1:8000/</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 3.创建应用</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Next, start your first app by running python manage.py startapp [app_label].</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">    python manage.py startapp app01</span><br><span class="line">    应用名应该做到见名知意</span><br><span class="line">      user</span><br><span class="line">      order</span><br><span class="line">      web</span><br><span class="line">      ...</span><br><span class="line">      但是我们教学统一就用app01/02/03/04</span><br><span class="line">      </span><br><span class="line">    有很多文件</span><br><span class="line">  </span><br><span class="line"><span class="comment"># pycharm操作</span></span><br><span class="line">    <span class="comment"># 1 new project 选择左侧第二个django即可</span></span><br><span class="line">  </span><br><span class="line">      <span class="comment"># 2 启动</span></span><br><span class="line">          <span class="number">1.</span>还是用命令行启动</span><br><span class="line">        <span class="number">2.</span>点击绿色小箭头即可</span><br><span class="line"></span><br><span class="line">      <span class="comment"># 3 创建应用</span></span><br><span class="line">          <span class="number">1.</span>pycharm提供的终端直接输入完整命令</span><br><span class="line">        <span class="number">2.</span>pycharm </span><br><span class="line">              tools </span><br><span class="line">                run manage.py task提示(前期不要用 给我背完整命令)</span><br><span class="line">     <span class="comment"># 4 修改端口号以及创建server    </span></span><br><span class="line">        edit confi....</span><br></pre></td></tr></table></figure>

<h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">django是一款专门用来开发app的web框架</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">django框架就类似于是一所大学(空壳子)</span></span><br><span class="line"><span class="string">app就类似于大学里面各个学院(具体功能的app)</span></span><br><span class="line"><span class="string">    比如开发淘宝</span></span><br><span class="line"><span class="string">        订单相关</span></span><br><span class="line"><span class="string">        用户相关</span></span><br><span class="line"><span class="string">        投诉相关</span></span><br><span class="line"><span class="string">        创建不同的app对应不同的功能</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    选课系统</span></span><br><span class="line"><span class="string">        学生功能</span></span><br><span class="line"><span class="string">        老师功能</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">一个app就是一个独立的功能模块</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">***********************创建的应用一定要去配置文件中注册**********************</span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">&#x27;django.contrib.admin&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.contenttypes&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.staticfiles&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;app01.apps.App01Config&#x27;</span>,  <span class="comment"># 全写</span></span><br><span class="line">      <span class="string">&#x27;app01&#x27;</span>,             <span class="comment"># 简写</span></span><br><span class="line">]</span><br><span class="line"><span class="comment"># 创建出来的的应用第一步先去配置文件中注册 其他的先不要给我干</span></span><br><span class="line">ps:你在用pycharm创建项目的时候 pycharm可以帮你创建一个app并且自动注册</span><br><span class="line">***********************************************************************</span><br></pre></td></tr></table></figure>

<h3 id="主要文件介绍"><a href="#主要文件介绍" class="headerlink" title="主要文件介绍"></a>主要文件介绍</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-mysite项目文件夹</span><br><span class="line">    --mysite文件夹</span><br><span class="line">      ---settings.py           配置文件</span><br><span class="line">    ---urls.py              路由与视图函数对应关系(路由层)</span><br><span class="line">    ---wsgi.py              wsgiref模块(不考虑)</span><br><span class="line">  --manage.py              django的入口文件</span><br><span class="line">  --db.sqlite3              django自带的sqlite3数据库(小型数据库 功能不是很多还有bug)</span><br><span class="line">  --app01文件夹</span><br><span class="line">      ---admin.py              django后台管理</span><br><span class="line">    ---apps.py              注册使用</span><br><span class="line">    ---migrations文件夹    数据库迁移记录</span><br><span class="line">    ---models.py          数据库相关的 模型类(orm)</span><br><span class="line">      ---tests.py              测试文件</span><br><span class="line">    ---views.py              视图函数(视图层)</span><br></pre></td></tr></table></figure>

<h3 id="命令行与pycharm创建的区别"><a href="#命令行与pycharm创建的区别" class="headerlink" title="命令行与pycharm创建的区别"></a>命令行与pycharm创建的区别</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1 命令行创建不会自动有templatew文件夹 需要你自己手动创建而pycharm会自动帮你创建并且还会自动在配置文件中配置对应的路径</span></span><br><span class="line"><span class="comment"># pycharm创建</span></span><br><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.template.backends.django.DjangoTemplates&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;DIRS&#x27;</span>: [os.path.join(BASE_DIR, <span class="string">&#x27;templates&#x27;</span>)]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"><span class="comment"># 命令行创建</span></span><br><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.template.backends.django.DjangoTemplates&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;DIRS&#x27;</span>: [],</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">也就意味着你在用命令创建django项目的时候不单单需要创建templates文件夹还需要去配置文件中配置路径</span></span><br><span class="line"><span class="string">&#x27;DIRS&#x27;: [os.path.join(BASE_DIR, &#x27;templates&#x27;)]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="django小白必会三板斧"><a href="#django小白必会三板斧" class="headerlink" title="django小白必会三板斧"></a>django小白必会三板斧</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">HttpResponse</span></span><br><span class="line"><span class="string">    返回字符串类型的数据</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">render</span></span><br><span class="line"><span class="string">    返回html文件的</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">redirect</span></span><br><span class="line"><span class="string">    重定向</span></span><br><span class="line"><span class="string">      return redirect(&#x27;https://www.mzitu.com/&#x27;)</span></span><br><span class="line"><span class="string">    return redirect(&#x27;/home/&#x27;)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/05/11/Django%E5%9F%BA%E7%A1%80%E4%B9%8Bauth%E6%A8%A1%E5%9D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/05/11/Django%E5%9F%BA%E7%A1%80%E4%B9%8Bauth%E6%A8%A1%E5%9D%97/" class="post-title-link" itemprop="url">Django基础之auth模块</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-11 07:20:25" itemprop="dateCreated datePublished" datetime="2019-05-11T07:20:25+08:00">2019-05-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2019-06-01 12:22:34" itemprop="dateModified" datetime="2019-06-01T12:22:34+08:00">2019-06-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">Django系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="内容概要"><a href="#内容概要" class="headerlink" title="内容概要"></a>内容概要</h1><ul>
<li>用户认证模块auth</li>
<li>auth模块补充</li>
<li>auth_user表扩展字段</li>
</ul>
<h1 id="内容详细"><a href="#内容详细" class="headerlink" title="内容详细"></a>内容详细</h1><h3 id="auth模块"><a href="#auth模块" class="headerlink" title="auth模块"></a>auth模块</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">主要是用来做用户相关的功能</span><br><span class="line">    注册 登录 验证 修改密码 注销</span><br><span class="line"></span><br><span class="line">访问admin需要管理员账号</span><br><span class="line">    该账号数据均来源于数据库迁移之后生成的auth_user表</span><br><span class="line">    </span><br><span class="line">如何创建admin管理员账号</span><br><span class="line">    createsuperuser</span><br></pre></td></tr></table></figure>

<h3 id="具体操作"><a href="#具体操作" class="headerlink" title="具体操作"></a>具体操作</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> auth</span><br><span class="line"></span><br><span class="line"><span class="comment"># 校验用户名密码是否正确</span></span><br><span class="line">auth.authenticate(request,username=username,password=password)</span><br><span class="line"><span class="comment"># 保存用户状态</span></span><br><span class="line">auth.login(request,user_obj)</span><br><span class="line"><span class="comment"># 查看用户是否登录</span></span><br><span class="line">request.user.is_authenticated()</span><br><span class="line"><span class="comment"># 获取用户对象</span></span><br><span class="line">request.user</span><br><span class="line"><span class="comment"># 校验原密码是否正确</span></span><br><span class="line">request.user.check_password()</span><br><span class="line"><span class="comment"># 修改密码</span></span><br><span class="line">request.user.set_password()</span><br><span class="line">request.user.save()</span><br><span class="line"><span class="comment"># 校验是否登录装饰器</span></span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.decorators <span class="keyword">import</span> login_required</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">跳转全局配置</span></span><br><span class="line"><span class="string">    LOGIN_URL = &#x27;/lg/&#x27;</span></span><br><span class="line"><span class="string">跳转局部配置</span></span><br><span class="line"><span class="string">    @login_required(login_url=&#x27;/lg/&#x27;)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<h3 id="auth模块补充"><a href="#auth模块补充" class="headerlink" title="auth模块补充"></a>auth模块补充</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1.用户注册</span><br><span class="line">from django.contrib.auth.models import AbstractUser,User</span><br><span class="line">    # 操作auth_user写入数据不能使用create方法 密码不会自动加密</span><br><span class="line">        # User.objects.create(username=username,password=password,email=email)</span><br><span class="line">        # 创建普通用户</span><br><span class="line">        User.objects.create_user(username=username,password=password,email=email)</span><br><span class="line">        # 创建超级用户</span><br><span class="line">        User.objects.create_superuser(username=username, password=password, email=email)</span><br><span class="line">2.用户注销</span><br><span class="line">    auth.logout(request)</span><br></pre></td></tr></table></figure>

<h3 id="auth模块用户表扩展字段"><a href="#auth模块用户表扩展字段" class="headerlink" title="auth模块用户表扩展字段"></a>auth模块用户表扩展字段</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">在auth_user表的基础之上还想增加额外的字段 并且还可以使用auth模块所有的功能</span><br><span class="line"><span class="comment"># 配合文件配置</span></span><br><span class="line"><span class="comment"># 告诉django使用我们自己定义的表来取代auth_user表</span></span><br><span class="line">AUTH_USER_MODEL = <span class="string">&#x27;app01.Userinfo&#x27;</span>  <span class="comment"># 应用名.表名</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 一对一表关联(了解)</span></span><br><span class="line"><span class="comment"># 面向对象继承(掌握)</span></span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> AbstractUser</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Userinfo</span>(<span class="params">AbstractUser</span>):</span></span><br><span class="line">    <span class="comment"># 扩展AbstractUser表中没有的字段</span></span><br><span class="line">    phone = models.BigIntegerField()</span><br><span class="line">    info = models.CharField(max_length=<span class="number">255</span>)</span><br></pre></td></tr></table></figure>

<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>：校验用户名与密码</span><br><span class="line"></span><br><span class="line">      auth.authenticate(username=username, ...)</span><br><span class="line"> </span><br><span class="line"><span class="number">2</span>：保存用户信息</span><br><span class="line">      auth.login(request, user_obj)</span><br><span class="line"> </span><br><span class="line"><span class="number">3</span>：判断用户是否登录</span><br><span class="line">      request.user.is_authenticated()</span><br><span class="line"> </span><br><span class="line"><span class="number">4</span>：装饰器</span><br><span class="line">      form django.contrib.auth.decorators <span class="keyword">import</span> login_required</span><br><span class="line">      局部：@login_required(login_url=<span class="string">&#x27;/login/&#x27;</span>) (灵活)</span><br><span class="line">      全局：配置---&gt;LOGIN_URL = <span class="string">&#x27;/login/&#x27;</span> （省事）</span><br><span class="line"> </span><br><span class="line"><span class="number">5</span>：验证原密码(修改密码)</span><br><span class="line">      request.user.check_password(原密码)</span><br><span class="line"> </span><br><span class="line"><span class="number">6</span>：修改密码（两步）</span><br><span class="line">      request.user.set_password(新密码)</span><br><span class="line">      request.user.save()</span><br><span class="line"> </span><br><span class="line"><span class="number">7</span>：创建用户</span><br><span class="line">　　命令行创建：createsupperuser（超级用户）（管理一般不会使用逻辑代码创建）</span><br><span class="line">       <span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User</span><br><span class="line">　　User.objexts.create()（创建的用户密码是明文）（不推荐）</span><br><span class="line">       User.objexts.create_user()（普通用户）</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/05/11/Django%E5%9F%BA%E7%A1%80%E4%B9%8BAjax/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/05/11/Django%E5%9F%BA%E7%A1%80%E4%B9%8BAjax/" class="post-title-link" itemprop="url">Django基础之Ajax</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-11 07:20:25" itemprop="dateCreated datePublished" datetime="2019-05-11T07:20:25+08:00">2019-05-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2019-06-01 12:22:34" itemprop="dateModified" datetime="2019-06-01T12:22:34+08:00">2019-06-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">Django系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="内容概要"><a href="#内容概要" class="headerlink" title="内容概要"></a>内容概要</h1><ul>
<li><p>Ajax异步提交</p>
</li>
<li><p>前后端传输数据的编码格式</p>
</li>
<li><p>Ajax发送json格式数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">json.dumps</span><br><span class="line">json.loads</span><br><span class="line"><span class="comment"># js</span></span><br><span class="line">JSON.stringfy</span><br><span class="line">JSON.parse</span><br></pre></td></tr></table></figure></li>
<li><p>Ajax发送文件数据</p>
</li>
<li><p>Ajax结合sweetalert插件实现删除的二次确认</p>
</li>
</ul>
<h1 id="内容详细"><a href="#内容详细" class="headerlink" title="内容详细"></a>内容详细</h1><h3 id="Ajax"><a href="#Ajax" class="headerlink" title="Ajax"></a>Ajax</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">异步提交 局部刷新</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">同步:提交任务之后原地等待任务结果期间不做任何事</span></span><br><span class="line"><span class="string">异步:提交任务之后不原地等待任务结果 等任务产生结果通过异步回调机制</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">前戏页面</span><br><span class="line">    博客园注册页面</span><br><span class="line">    github注册页面</span><br><span class="line"> </span><br><span class="line">能够发送网络请求的方法</span><br><span class="line">    a               get请求</span><br><span class="line">    form表单         get请求、post请求</span><br><span class="line">    ajax              get请求、post请求</span><br><span class="line"> </span><br><span class="line">ajax不是一门独立的语言 而是一个功能</span><br><span class="line">    能够实现ajax功能的书写方式有很多 </span><br><span class="line">        eg:原生js代码 jQuery封装代码 组件框架代码...</span><br><span class="line">    我们这里学习jQuery版本</span><br><span class="line"> </span><br><span class="line">ajax前戏</span><br><span class="line">    需求:保证页面不刷新的情况下完成数字的和</span><br></pre></td></tr></table></figure>

<h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// ajax发送给后端</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">            url:<span class="string">&#x27;&#x27;</span>,  // 控制提交地址    规律与form标签的action参数一致</span><br><span class="line">            <span class="built_in">type</span>:<span class="string">&#x27;post&#x27;</span>,  // 控制请求方式</span><br><span class="line">            data:&#123;<span class="string">&#x27;i1&#x27;</span>:i1Val,<span class="string">&#x27;i2&#x27;</span>:i2Val&#125;,  // 发送的数据</span><br><span class="line">            success:function (args) &#123;</span><br><span class="line">                    // 异步回调函数</span><br><span class="line">                    &#123;<span class="comment">#alert(args)#&#125;</span></span><br><span class="line">                    // 查看<span class="built_in">input</span>框并且写入数据</span><br><span class="line">                    $(<span class="string">&#x27;#i3&#x27;</span>).val(args)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure>

<h3 id="参数补充"><a href="#参数补充" class="headerlink" title="参数补充"></a>参数补充</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">contentType</span><br><span class="line">    前后端数据传输格式主要有三种</span><br><span class="line">        application/x-www-form-urlencoded</span><br><span class="line">        multipart/form-data</span><br><span class="line">        application/json</span><br><span class="line">    朝后端发送数据的时候针对不同的方式后端有不同的处理措施</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># form表单默认是urlencoded编码格式</span></span><br><span class="line">    数据格式username=jason&amp;password=<span class="number">234</span></span><br><span class="line">    django后端针对符合urlencoded格式的数据会自动解析并封装到request.POST中</span><br><span class="line">    django后端针对form-data格式的数据文件自动封装到request.FILES中 普通的符合urlencoded还是封装到request.POST中</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ajax默认是urlencoded编码格式</span></span><br><span class="line">        <span class="number">1.</span>ajax发送json格式数据</span><br><span class="line">            django后端不做任何处理 直接以二进制形式存放在request.body中</span><br><span class="line">            data</span><br><span class="line">            contentType</span><br><span class="line">        <span class="number">2.</span>ajax发送文件数据</span><br><span class="line">            $(<span class="string">&#x27;#d1&#x27;</span>).on(<span class="string">&#x27;click&#x27;</span>,function () &#123;</span><br><span class="line">                // <span class="number">1.</span>先生成一个内置对象</span><br><span class="line">                let formDataObj = new FormData();</span><br><span class="line">                // <span class="number">2.</span>添加符合urlencoded格式的普通键值对数据</span><br><span class="line">                formDataObj.append(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;jason&#x27;</span>);</span><br><span class="line">                formDataObj.append(<span class="string">&#x27;password&#x27;</span>,<span class="number">123</span>);</span><br><span class="line">                // <span class="number">3.</span>添加文件数据</span><br><span class="line">                formDataObj.append(<span class="string">&#x27;myfile&#x27;</span>,$(<span class="string">&#x27;#myfile&#x27;</span>)[<span class="number">0</span>].files[<span class="number">0</span>]);</span><br><span class="line">                // ajax发送给后端</span><br><span class="line">                $.ajax(&#123;</span><br><span class="line">                    url:<span class="string">&#x27;&#x27;</span>,  // 控制提交地址    规律与form标签的action参数一致</span><br><span class="line">                    <span class="built_in">type</span>:<span class="string">&#x27;post&#x27;</span>,  // 控制请求方式</span><br><span class="line">                    data:formDataObj,  // 发送的数据</span><br><span class="line"></span><br><span class="line">                    // 额外指定两个参数</span><br><span class="line">                    contentType:false,  // 不采用任何编码 后端能够直接识别formdata对象</span><br><span class="line">                    processData:false,  // 不处理formdata对象 直接发送即可</span><br><span class="line"></span><br><span class="line">                    success:function (args) &#123;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;);</span><br><span class="line">dataType</span><br><span class="line">    django后端如果使用JsonResponse给回调函数返回json格式字符串</span><br><span class="line">    回调函数会自动反序列成js中的自定义对象</span><br><span class="line">    django后端不使用JsonResponse而是自己通过json模块序列化的数据 回调函数接收到之后不会自动反序列</span><br></pre></td></tr></table></figure>

<h3 id="基于ajax实现二次确认"><a href="#基于ajax实现二次确认" class="headerlink" title="基于ajax实现二次确认"></a>基于ajax实现二次确认</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">        $(<span class="string">&#x27;.del_link&#x27;</span>).on(<span class="string">&#x27;click&#x27;</span>,function (a) &#123;</span><br><span class="line">            var $aEle = $(this);</span><br><span class="line">            var deleteId = $(this).attr(<span class="string">&#x27;delete_id&#x27;</span>);</span><br><span class="line">            // 提示二次确认</span><br><span class="line">            res = confirm(<span class="string">&#x27;你确定真的要删吗?&#x27;</span>);</span><br><span class="line">            // 判断是否删除</span><br><span class="line">            <span class="keyword">if</span> (res)&#123;</span><br><span class="line">                // 发送ajax请求</span><br><span class="line">                $.ajax(&#123;</span><br><span class="line">                    url:<span class="string">&quot;/book_delete/&quot;</span> + deleteId,</span><br><span class="line">                    <span class="built_in">type</span>:<span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">                    data:&#123;&#125;,</span><br><span class="line">                    success:function (args) &#123;</span><br><span class="line">                        // <span class="number">1.</span>页面刷新  不推荐使用</span><br><span class="line">                        window.location.reload();</span><br><span class="line">                        // <span class="number">2.</span>DOM操作   正规 用户体验好</span><br><span class="line">                        $aEle.parent().parent().remove()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                alert(<span class="string">&#x27;怂逼不敢删啦&#x27;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/05/11/Django%E5%9F%BA%E7%A1%80%E4%B9%8Bcookie%E4%B8%8Esession/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/05/11/Django%E5%9F%BA%E7%A1%80%E4%B9%8Bcookie%E4%B8%8Esession/" class="post-title-link" itemprop="url">Django基础之cookie与session</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-11 07:20:25" itemprop="dateCreated datePublished" datetime="2019-05-11T07:20:25+08:00">2019-05-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2019-06-01 12:22:34" itemprop="dateModified" datetime="2019-06-01T12:22:34+08:00">2019-06-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">Django系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="cookie与session"><a href="#cookie与session" class="headerlink" title="cookie与session"></a>cookie与session</h1><h3 id="由来及简介"><a href="#由来及简介" class="headerlink" title="由来及简介"></a>由来及简介</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">HTTP协议四大特性</span><br><span class="line">    <span class="number">1.</span>基于请求响应</span><br><span class="line">    <span class="number">2.</span>基于TCP、IP作用于应用层之上</span><br><span class="line">    <span class="number">3.</span>无连接</span><br><span class="line">    <span class="number">4.</span>无状态</span><br><span class="line">        </span><br><span class="line">基于HTTP协议的通信无法记录客户端状态</span><br><span class="line">但是现在很多软件都需要记录用户的状态 为了解决这个问题</span><br><span class="line">发明了cookie session等一系列的技术</span><br><span class="line"></span><br><span class="line">cookie</span><br><span class="line">    保存在客户端浏览器上面的键值对数据</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    eg:当用户登录成功之后 浏览器保存用户的关键信息</span></span><br><span class="line"><span class="string">    以后访问的时候浏览器自动发送关键信息从而实现身份识别</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    关键型数据直接保存在浏览器上不安全</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span> </span><br><span class="line">session</span><br><span class="line">    保存在服务器上面的键值对数据(数据类型不固定)</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    eg:当用户登录成功之后 服务端返回给浏览器一个随机字符串</span></span><br><span class="line"><span class="string">    之后访问都将随机字符串发送给服务端</span></span><br><span class="line"><span class="string">    服务端内部做比对</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># session需要依赖于cookie才可以工作</span></span><br><span class="line">客户端浏览器可以保存服务端发送过来的cookie数据也可以选择拒绝</span><br></pre></td></tr></table></figure>

<h3 id="cookie操作"><a href="#cookie操作" class="headerlink" title="cookie操作"></a>cookie操作</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">视图函数返回的HttpResponse对象</span><br><span class="line"><span class="keyword">return</span> HttpResponse()</span><br><span class="line"><span class="keyword">return</span> render()</span><br><span class="line"><span class="keyword">return</span> redirect()</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = HttpResponse()</span><br><span class="line"><span class="keyword">return</span> obj</span><br><span class="line">obj = render()</span><br><span class="line"><span class="keyword">return</span> obj</span><br><span class="line">obj = redirect()</span><br><span class="line"><span class="keyword">return</span> obj</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户登录</span></span><br><span class="line">    设置cookie</span><br><span class="line">        obj = HttpResponse(<span class="string">&quot;登录成功&quot;</span>)</span><br><span class="line">        obj.set_cookie(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;jason&#x27;</span>)</span><br><span class="line">    获取cookie</span><br><span class="line">        request.COOKIES.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    删除cookie</span><br><span class="line">        obj.delete_cookie(<span class="string">&quot;name&quot;</span>)</span><br></pre></td></tr></table></figure>



<h3 id="session操作"><a href="#session操作" class="headerlink" title="session操作"></a>session操作</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">session设置</span><br><span class="line">    request.session[<span class="string">&#x27;name&#x27;</span>] = <span class="string">&#x27;jason&#x27;</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    1.自动产生一个随机字符串</span></span><br><span class="line"><span class="string">    2.将随机字符串和数据存入django_session表中</span></span><br><span class="line"><span class="string">    3.将随机字符串返回给客户端浏览器保存</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">session读取</span><br><span class="line">    request.session.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    1.客户端请求中获取随机字符串</span></span><br><span class="line"><span class="string">    2.拿着随机字符串去django_session表中比对</span></span><br><span class="line"><span class="string">    3.如果比对成功获取对应的数据并且解析放到request.session中</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># django session默认的过期时间14d 可以人为修改</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除当前会话的所有Session数据</span></span><br><span class="line">    request.session.delete()  <span class="comment"># 只删客户端浏览器</span></span><br><span class="line">　　</span><br><span class="line"><span class="comment"># 删除当前的会话数据并删除会话的Cookie。</span></span><br><span class="line">    request.session.flush()  <span class="comment"># 客户端浏览器和服务端都删</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 设置会话Session和Cookie的超时时间</span></span><br><span class="line">    request.session.set_expiry(value)</span><br><span class="line">        * 如果value是个整数，session会在些秒数后失效。</span><br><span class="line">        * 如果value是个datatime或timedelta，session就会在这个时间后失效</span><br><span class="line">        * 如果value是<span class="number">0</span>,用户关闭浏览器session就会失效。</span><br><span class="line">        * 如果value是<span class="literal">None</span>,session会依赖全局session失效策略。</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/05/11/Django%E5%9F%BA%E7%A1%80%E4%B9%8B%E4%B8%AD%E9%97%B4%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/05/11/Django%E5%9F%BA%E7%A1%80%E4%B9%8B%E4%B8%AD%E9%97%B4%E4%BB%B6/" class="post-title-link" itemprop="url">Django基础之中间件</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-11 07:20:25" itemprop="dateCreated datePublished" datetime="2019-05-11T07:20:25+08:00">2019-05-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2019-06-01 12:22:34" itemprop="dateModified" datetime="2019-06-01T12:22:34+08:00">2019-06-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">Django系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="内容概要"><a href="#内容概要" class="headerlink" title="内容概要"></a>内容概要</h1><ul>
<li>django中间件</li>
<li>csrf跨站请求伪造</li>
</ul>
<h1 id="内容详细"><a href="#内容详细" class="headerlink" title="内容详细"></a>内容详细</h1><h3 id="django中间件"><a href="#django中间件" class="headerlink" title="django中间件"></a>django中间件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">类似于是django的门户 请求来的时候和响应走的时候都必须经过它</span><br><span class="line"></span><br><span class="line">配置文件中</span><br><span class="line">MIDDLEWARE = [</span><br><span class="line">    ...</span><br><span class="line">]</span><br><span class="line"><span class="comment"># django默认有七个中间件</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;每个中间件你可以简单的理解为具有不同的功能&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># django中间件有五个我们需要知道的方法</span></span><br><span class="line">    需要掌握</span><br><span class="line">        process_request</span><br><span class="line">        process_response</span><br><span class="line">    需要了解</span><br><span class="line">        process_view</span><br><span class="line">        process_exception</span><br><span class="line">        process_template_response</span><br><span class="line"><span class="comment"># django支持用户自定义中间件</span></span><br><span class="line">    django中间件可以用于编写全局相关的功能</span><br><span class="line">        eg:全局身份校验  全局防爬校验 </span><br></pre></td></tr></table></figure>

<h3 id="中间件使用"><a href="#中间件使用" class="headerlink" title="中间件使用"></a>中间件使用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.utils.deprecation <span class="keyword">import</span> MiddlewareMixin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyMiddleware1</span>(<span class="params">MiddlewareMixin</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span>(<span class="params">self,request</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;from 自定义MyMiddleware1 process_request方法&#x27;</span>)</span><br><span class="line"><span class="comment"># 1.请求来的时候会依次(从上往下)执行配置文件中注册了的中间件里面的process_request方法 如果没有直接跳过</span></span><br><span class="line"><span class="comment"># 2.该方法如果直接返回了HttpResponse对象那么请求不再继续往下而是直接原路返回</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_response</span>(<span class="params">self,request,response</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;from 自定义MyMiddleware1 process_response方法&#x27;</span>)</span><br><span class="line"><span class="comment"># 1.响应走的时候从下往上依次执行注册了的中间件里面的process_response方法如果没有则直接跳过</span></span><br><span class="line"><span class="comment"># 2.该方法需要将形参response返回 该response其实就是视图函数返回给浏览器的数据</span></span><br><span class="line"><span class="comment"># 3.该方法还可以拦截返回给浏览器的数据 并且还支持自定义返回内容</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">当process_request自己返回HttpResponse对象之后</span></span><br><span class="line"><span class="string">响应是从同级别的process_response依次返回</span></span><br><span class="line"><span class="string">而不是所有的process_response</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="了解方法"><a href="#了解方法" class="headerlink" title="了解方法"></a>了解方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">process_view</span><br><span class="line">    路由匹配成功之后执行视图函数之前自动触发</span><br><span class="line">    self,request,view_name,*args,**kwargs</span><br><span class="line"></span><br><span class="line">process_exception</span><br><span class="line">    当视图函数报错之后自动执行</span><br><span class="line">    self,request,exception</span><br><span class="line">   </span><br><span class="line">process_template_response</span><br><span class="line">    self,request,response</span><br><span class="line">    图函数返回的对象有一个response()方法（或者表明该对象是一个TemplateResponse对象或等价方法）</span><br></pre></td></tr></table></figure>

<h3 id="csrf跨站请求伪造"><a href="#csrf跨站请求伪造" class="headerlink" title="csrf跨站请求伪造"></a>csrf跨站请求伪造</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">钓鱼网站</span><br><span class="line"></span><br><span class="line">理论:</span><br><span class="line">    做一个与正规网站一模一样的界面 用户在上面操作</span><br><span class="line">    比如转账</span><br><span class="line">    转账请求确实是发送给了正规的网站后台只不过收款人变成了</span><br><span class="line">    钓鱼网站指定的账户</span><br><span class="line">原理:</span><br><span class="line">    获取用户输入的表单内</span><br><span class="line">    给用户展示了一个没有name属性的框</span><br><span class="line">    自己偷偷的写了一个既有name又有value的隐藏框</span><br></pre></td></tr></table></figure>

<h3 id="csrf使用"><a href="#csrf使用" class="headerlink" title="csrf使用"></a>csrf使用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>form表单</span><br><span class="line">    表单中直接书写下列的语句即可</span><br><span class="line">    &#123;% csrf_token %&#125;</span><br><span class="line"> </span><br><span class="line"><span class="number">2.</span>ajax</span><br><span class="line">    方式<span class="number">1</span>:借助于&#123;% csrf_token %&#125;生成的标签(不推荐)</span><br><span class="line">    $(<span class="string">&quot;[name = &#x27;csrfmiddlewaretoken&#x27;]&quot;</span>).val()</span><br><span class="line">    </span><br><span class="line">    方式<span class="number">2</span>:借助于模板语法直接获取</span><br><span class="line">    <span class="string">&#x27;&#123;&#123; csrf_token &#125;&#125;&#x27;</span></span><br><span class="line">    </span><br><span class="line">    方式<span class="number">3</span>:借助于官方提供的js文件自动获取</span><br><span class="line">    js文件导入即可</span><br></pre></td></tr></table></figure>

<h3 id="csrf相关装饰器"><a href="#csrf相关装饰器" class="headerlink" title="csrf相关装饰器"></a>csrf相关装饰器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.views.decorators.csrf <span class="keyword">import</span> csrf_exempt, csrf_protect</span><br><span class="line"><span class="comment"># csrf_exempt   局部不校验csrf</span></span><br><span class="line"><span class="comment"># csrf_protect  局部校验csrf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># @csrf_protect</span></span><br><span class="line"><span class="comment"># @csrf_exempt</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.POST.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        money = request.POST.get(<span class="string">&#x27;money&#x27;</span>)</span><br><span class="line">        target_user = request.POST.get(<span class="string">&#x27;target_user&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;%s 给 %s 转了 %s 元钱&#x27;</span>%(username,target_user,money))</span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.utils.decorators <span class="keyword">import</span> method_decorator</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> views</span><br><span class="line"><span class="comment"># @method_decorator(csrf_protect,name=&#x27;post&#x27;)  # 第二种  行</span></span><br><span class="line"><span class="comment"># @method_decorator(csrf_exempt,name=&#x27;post&#x27;)  # 第二种  不行</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyLogin</span>(<span class="params">views.View</span>):</span></span><br><span class="line">    <span class="comment"># @method_decorator(csrf_protect)  # 第三种 所有的方法都会加上该功能</span></span><br><span class="line"><span class="meta">    @method_decorator(<span class="params">csrf_exempt</span>)  </span><span class="comment"># 第三种 所有的方法都会加上该功能</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dispatch</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>().dispatch(request,*args,**kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self,request</span>):</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;from get&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># @method_decorator(csrf_protect)  # 第一种  行</span></span><br><span class="line">    <span class="comment"># @method_decorator(csrf_exempt)  # 第一种  不行</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self,request</span>):</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;from post&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">csrf_exempt该装饰器在CBV中只能给dispatch装才能生效</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/05/11/Django%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%A8%A1%E5%9E%8B%E5%B1%82/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/05/11/Django%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%A8%A1%E5%9E%8B%E5%B1%82/" class="post-title-link" itemprop="url">Django基础之模型层</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-11 07:20:25" itemprop="dateCreated datePublished" datetime="2019-05-11T07:20:25+08:00">2019-05-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2019-06-01 12:22:34" itemprop="dateModified" datetime="2019-06-01T12:22:34+08:00">2019-06-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">Django系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="内容概要"><a href="#内容概要" class="headerlink" title="内容概要"></a>内容概要</h1><ul>
<li><p>查询关键字</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">MySQL</span><br><span class="line">    select</span><br><span class="line">    <span class="keyword">from</span> </span><br><span class="line">    where</span><br><span class="line">    group by</span><br><span class="line">    having</span><br><span class="line">    order by</span><br><span class="line">    distinct</span><br><span class="line">    limit</span><br><span class="line">    regexp</span><br><span class="line">    <span class="comment"># SQL语句内也支持写流程控制</span></span><br><span class="line">Django ORM</span><br></pre></td></tr></table></figure></li>
<li><p>神奇的双下线查询</p>
</li>
<li><p>多表查询</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">子查询</span><br><span class="line">    基于对象的跨表查询</span><br><span class="line">连表操作</span><br><span class="line">    基于双下划线的跨表查询</span><br><span class="line">ps:ORM远比SQL语句简单</span><br></pre></td></tr></table></figure></li>
<li><p>分组与聚合</p>
</li>
<li><p>F与Q查询</p>
</li>
<li><p>ORM查询优化(only与defer…)</p>
</li>
<li><p>ORM字段补充</p>
</li>
</ul>
<h1 id="内容详细"><a href="#内容详细" class="headerlink" title="内容详细"></a>内容详细</h1><h3 id="关键字"><a href="#关键字" class="headerlink" title="关键字"></a>关键字</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"> 　　<span class="comment"># 增     1.create()</span></span><br><span class="line"><span class="comment"># models.Books.objects.create(title=&#x27;三国演义&#x27;,price=456.23)</span></span><br><span class="line"><span class="comment"># models.Books.objects.create(title=&#x27;水浒传&#x27;,price=876.45)</span></span><br><span class="line"><span class="comment"># models.Books.objects.create(title=&#x27;聊斋志异&#x27;,price=123.69)</span></span><br><span class="line"><span class="comment"># models.Books.objects.create(title=&#x27;草堂笔记&#x27;,price=456.96)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查     2.all()</span></span><br><span class="line"><span class="comment"># res = models.Books.objects.all()</span></span><br><span class="line"><span class="comment"># print(res)  # QuerySet对象</span></span><br><span class="line"><span class="comment"># print(res.query)  # 只要是QuerySet对象就可以点query查看内部SQL语句</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查     3.filter()</span></span><br><span class="line"><span class="comment"># res1 = models.Books.objects.filter()  # pk特指当前表的主键字段</span></span><br><span class="line"><span class="comment"># print(res1)  # QuerySet对象</span></span><br><span class="line"><span class="comment"># print(res1.query)</span></span><br><span class="line"><span class="comment"># print(res1.first())  # 获取列表中第一个数据对象</span></span><br><span class="line"><span class="comment"># print(res1.last())  # 获取列表中最后一个数据对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.values与5.values_list</span></span><br><span class="line"><span class="comment"># res2 = models.Books.objects.values(&#x27;title&#x27;,&#x27;price&#x27;)</span></span><br><span class="line"><span class="comment"># print(res2)  # QuerySet对象   可以看成列表套字典</span></span><br><span class="line"><span class="comment"># print(res2.query)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># res3 = models.Books.objects.values_list(&#x27;title&#x27;,&#x27;price&#x27;)</span></span><br><span class="line"><span class="comment"># print(res3)  # QuerySet对象     可以看成列表套元祖</span></span><br><span class="line"><span class="comment"># print(res3.query)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.查 get()     不推荐使用</span></span><br><span class="line"><span class="comment"># res4 = models.Books.objects.get(pk=1)</span></span><br><span class="line"><span class="comment"># print(res4)  # 数据对象</span></span><br><span class="line"><span class="comment"># res5 = models.Books.objects.get(pk=100)</span></span><br><span class="line"><span class="comment"># print(res5)  # 数据对象</span></span><br><span class="line"><span class="comment"># res6 = models.Books.objects.filter(pk=100)</span></span><br><span class="line"><span class="comment"># print(res6)  # 数据对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.取反  exclude()</span></span><br><span class="line"><span class="comment"># res7 = models.Books.objects.exclude(pk=1)</span></span><br><span class="line"><span class="comment"># print(res7)  # QuerySet</span></span><br><span class="line"><span class="comment"># print(res7.query)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 8.排序   order_by()      默认是升序(asc)    字段前面加负号降序(desc)</span></span><br><span class="line"><span class="comment"># res8 = models.Books.objects.order_by(&#x27;price&#x27;)</span></span><br><span class="line"><span class="comment"># res8 = models.Books.objects.order_by(&#x27;-price&#x27;)</span></span><br><span class="line"><span class="comment"># select * from books order by price desc,price asc;</span></span><br><span class="line"><span class="comment"># res8 = models.Books.objects.order_by(&#x27;-price&#x27;,&#x27;price&#x27;)</span></span><br><span class="line"><span class="comment"># print(res8)  # QuerySet对象</span></span><br><span class="line"><span class="comment"># print(res8.query)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 9.反转  reverse()       必须先有顺序才可以反转</span></span><br><span class="line"><span class="comment"># res9 = models.Books.objects.all()</span></span><br><span class="line"><span class="comment"># res9 = models.Books.objects.order_by(&#x27;price&#x27;).reverse()</span></span><br><span class="line"><span class="comment"># print(res9)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 10.去重 distinct()</span></span><br><span class="line"><span class="comment"># res10 = models.Books.objects.all().distinct()</span></span><br><span class="line"><span class="comment"># res10 = models.Books.objects.values(&#x27;title&#x27;,&#x27;price&#x27;).distinct()</span></span><br><span class="line"><span class="comment"># print(res10)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 11.计数 count()</span></span><br><span class="line"><span class="comment"># res11 = models.Books.objects.count()</span></span><br><span class="line"><span class="comment"># print(res11)  # 6</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 12.判断是否有数据   exists()</span></span><br><span class="line"><span class="comment"># res12 = models.Books.objects.filter(pk=999).exists()</span></span><br><span class="line"><span class="comment"># print(res12)  # False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 13.update()</span></span><br><span class="line"><span class="comment"># 14.delete()</span></span><br></pre></td></tr></table></figure>

<h3 id="神奇的双下划线"><a href="#神奇的双下划线" class="headerlink" title="神奇的双下划线"></a>神奇的双下划线</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">　　</span><br><span class="line"><span class="comment"># 查询价格大于200的书籍</span></span><br><span class="line">    <span class="comment"># res = models.Books.objects.filter(price__gt=200)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># res1 = models.Books.objects.filter(price__lt=200)</span></span><br><span class="line">    <span class="comment"># print(res1)</span></span><br><span class="line">    <span class="comment"># res2 = models.Books.objects.filter(price__gte=456.23)</span></span><br><span class="line">    <span class="comment"># print(res2)</span></span><br><span class="line">    <span class="comment"># res3 = models.Books.objects.filter(price__lte=456.23)</span></span><br><span class="line">    <span class="comment"># print(res3)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 成员运算</span></span><br><span class="line">    <span class="comment"># res4 = models.Books.objects.filter(price__in=(456.23,111))</span></span><br><span class="line">    <span class="comment"># print(res4)</span></span><br><span class="line">    <span class="comment"># 范围查询</span></span><br><span class="line">    <span class="comment"># res5 = models.Books.objects.filter(price__range=(100,456.23))</span></span><br><span class="line">    <span class="comment"># print(res5)</span></span><br><span class="line">    <span class="comment"># 模糊查询</span></span><br><span class="line">    <span class="comment"># 查询书籍名称中含有字母a的书</span></span><br><span class="line">    <span class="comment"># res6 = models.Books.objects.filter(title__contains=&#x27;a&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res6)  # 区分</span></span><br><span class="line">    <span class="comment"># res7 = models.Books.objects.filter(title__icontains=&#x27;a&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res7)  # 忽略</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 日期相关</span></span><br><span class="line">    <span class="comment"># 查看出版月份是五月的书</span></span><br><span class="line">    <span class="comment"># res8 = models.Books.objects.filter(publish_time__month=5)</span></span><br><span class="line">    <span class="comment"># print(res8)</span></span><br><span class="line">    <span class="comment"># print(res8.query)</span></span><br><span class="line">    <span class="comment"># res9 = models.Books.objects.filter(publish_time__year=2021)</span></span><br><span class="line">    <span class="comment"># print(res9)</span></span><br></pre></td></tr></table></figure>

<h3 id="外键字段增删改查"><a href="#外键字段增删改查" class="headerlink" title="外键字段增删改查"></a>外键字段增删改查</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 增</span></span><br><span class="line"><span class="comment"># models.Book.objects.create(title=&#x27;三国演义&#x27;,price=345.43,publish_id=1)</span></span><br><span class="line"><span class="comment"># models.Book.objects.create(title=&#x27;红楼梦&#x27;,price=678.31,publish_id=2)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># publish_obj = models.Publish.objects.filter(pk=2).first()</span></span><br><span class="line"><span class="comment"># models.Book.objects.create(title=&#x27;三国演义&#x27;,price=345.43,publish=publish_obj)</span></span><br><span class="line"><span class="comment"># models.Book.objects.create(title=&#x27;七龙珠&#x27;,price=908.43,publish=publish_obj)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 改</span></span><br><span class="line"><span class="comment"># models.Book.objects.filter(pk=2).update(publish_id=1)</span></span><br><span class="line"><span class="comment"># models.Book.objects.filter(pk=2).update(publish=publish_obj)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删 级联更新级联删除</span></span><br><span class="line"><span class="comment"># models.Publish.objects.filter(pk=1).delete()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 多对多</span></span><br><span class="line"><span class="comment"># book_obj = models.Book.objects.filter(pk=3).first()</span></span><br><span class="line"><span class="comment"># 绑定关系</span></span><br><span class="line"><span class="comment"># book_obj.authors.add(1)  # 去书与作者的关系表中绑定关系</span></span><br><span class="line"><span class="comment"># book_obj.authors.add(1,2)  # 去书与作者的关系表中绑定关系</span></span><br><span class="line"><span class="comment"># book_obj.authors.add(author_obj1)</span></span><br><span class="line"><span class="comment"># book_obj.authors.add(author_obj1,author_obj2)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改关系</span></span><br><span class="line"><span class="comment"># book_obj.authors.set([1,])</span></span><br><span class="line"><span class="comment"># book_obj.authors.set([1,2])</span></span><br><span class="line"><span class="comment"># book_obj.authors.set([author_obj,])</span></span><br><span class="line"><span class="comment"># book_obj.authors.set([author_obj1,author_obj2])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 移除关系</span></span><br><span class="line"><span class="comment"># book_obj.authors.remove(1)</span></span><br><span class="line"><span class="comment"># book_obj.authors.remove(1,2)</span></span><br><span class="line"><span class="comment"># book_obj.authors.remove(author_obj,)</span></span><br><span class="line"><span class="comment"># book_obj.authors.remove(author_obj1,author_obj2)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 清空关系</span></span><br><span class="line"><span class="comment"># book_obj.authors.clear()</span></span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<h3 id="重要概念"><a href="#重要概念" class="headerlink" title="重要概念"></a>重要概念</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 多表查询</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    正向查询</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">    反向查询</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    当前查询对象是否含有外键字段</span></span><br><span class="line"><span class="string">        如果有就是正向</span></span><br><span class="line"><span class="string">        没有无则是反向</span></span><br><span class="line"><span class="string">    口诀:</span></span><br><span class="line"><span class="string">        正向查询按外键字段</span></span><br><span class="line"><span class="string">            多对多需要额外再加一个.all()</span></span><br><span class="line"><span class="string">            一对多和一对一不需要加</span></span><br><span class="line"><span class="string">        反向查询按表名小写</span></span><br><span class="line"><span class="string">            一对多与多对多</span></span><br><span class="line"><span class="string">                _set.all()</span></span><br><span class="line"><span class="string">            一对一</span></span><br><span class="line"><span class="string">                不需要加</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#####################基于对象的跨表查询#####################</span></span><br><span class="line">    <span class="comment"># 子查询:将一张表的查询结果当做另外一条SQL语句的条件(括号括起来)</span></span><br><span class="line">    <span class="comment"># 1.查询书籍主键为4的出版社名称</span></span><br><span class="line">    <span class="comment"># 先查询书籍对象</span></span><br><span class="line">    <span class="comment"># book_obj = models.Book.objects.filter(pk=4).first()</span></span><br><span class="line">    <span class="comment"># 外键字段在书这里 所以是正向查询</span></span><br><span class="line">    <span class="comment"># res = book_obj.publish</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># print(res.title)</span></span><br><span class="line">    <span class="comment"># print(res.addr)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.查询书籍主键为3的作者姓名</span></span><br><span class="line">    <span class="comment"># 先查询书籍对象</span></span><br><span class="line">    <span class="comment"># book_obj = models.Book.objects.filter(pk=3).first()</span></span><br><span class="line">    <span class="comment"># 外键字段在书这里 所以是正向查询</span></span><br><span class="line">    <span class="comment"># res = book_obj.authors</span></span><br><span class="line">    <span class="comment"># print(res)  # app01.Author.None</span></span><br><span class="line">    <span class="comment"># res = book_obj.authors.all()</span></span><br><span class="line">    <span class="comment"># print(res)  # &lt;QuerySet [&lt;Author: 作者对象:oscar&gt;, &lt;Author: 作者对象:egon&gt;]&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3.查询作者jason的地址</span></span><br><span class="line">    <span class="comment"># 先查询jason数据对象</span></span><br><span class="line">    <span class="comment"># author_obj = models.Author.objects.filter(name=&#x27;jason&#x27;).first()</span></span><br><span class="line">    <span class="comment"># 外键字段在作者这里 所以是正向查询</span></span><br><span class="line">    <span class="comment"># res = author_obj.author_detail</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># print(res.addr)</span></span><br><span class="line">    <span class="comment"># print(res.phone)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4.查询东方出版社出版的书籍</span></span><br><span class="line">    <span class="comment"># 先查询出版社对象</span></span><br><span class="line">    <span class="comment"># publish_obj = models.Publish.objects.filter(title=&#x27;东方出版社&#x27;).first()</span></span><br><span class="line">    <span class="comment"># 外键字段在书那里自己没有 所以是反向</span></span><br><span class="line">    <span class="comment"># res = publish_obj.book_set</span></span><br><span class="line">    <span class="comment"># print(res)  # app01.Book.None</span></span><br><span class="line">    <span class="comment"># res = publish_obj.book_set.all()</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5.查询jason写过的书籍</span></span><br><span class="line">    <span class="comment"># 先查询jason数据对象</span></span><br><span class="line">    <span class="comment"># author_obj = models.Author.objects.filter(name=&#x27;jason&#x27;).first()</span></span><br><span class="line">    <span class="comment"># 外键字段在书那里自己没有 所以是反向</span></span><br><span class="line">    <span class="comment"># res = author_obj.book_set</span></span><br><span class="line">    <span class="comment"># print(res)  # app01.Book.None</span></span><br><span class="line">    <span class="comment"># res = author_obj.book_set</span></span><br><span class="line">    <span class="comment"># print(res)  # app01.Book.None</span></span><br><span class="line">    <span class="comment"># res = author_obj.book_set.all()</span></span><br><span class="line">    <span class="comment"># print(res)  # app01.Book.None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 6.查询电话是120的作者</span></span><br><span class="line">    <span class="comment"># 先查询120数据对象</span></span><br><span class="line">    <span class="comment"># author_detail_obj = models.AuthorDetail.objects.filter(phone=120).first()</span></span><br><span class="line">    <span class="comment"># 外键字段在作者那里本身没有 所以是反向</span></span><br><span class="line">    <span class="comment"># res = author_detail_obj.author</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># print(res.name)</span></span><br><span class="line">    <span class="comment"># print(res.age)</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">########################基于双下滑线的跨表查询</span></span><br><span class="line">    <span class="comment"># 1.查询书籍主键为4的出版社名称</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(pk=4).values(&#x27;publish__title&#x27;,&#x27;publish__addr&#x27;,&#x27;title&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.查询书籍主键为3的作者姓名</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(pk=3).values(&#x27;authors__name&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3.查询作者jason的地址</span></span><br><span class="line">    <span class="comment"># res = models.Author.objects.filter(name=&#x27;jason&#x27;).values(&#x27;author_detail__addr&#x27;,&#x27;name&#x27;,&#x27;age&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4.查询北方出版社出版的书籍名称</span></span><br><span class="line">    <span class="comment"># res = models.Publish.objects.filter(title=&#x27;北方出版社&#x27;).values(&#x27;book__title&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5.查询jason写过的书籍</span></span><br><span class="line">    <span class="comment"># res = models.Author.objects.filter(name=&#x27;jason&#x27;).values(&#x27;book__title&#x27;,&#x27;name&#x27;,&#x27;age&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 6.查询电话是120的作者</span></span><br><span class="line">    <span class="comment"># res = models.AuthorDetail.objects.filter(phone=120).values(&#x27;author__name&#x27;,&#x27;author__age&#x27;,&#x27;addr&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">############进阶操作#############</span></span><br><span class="line">    <span class="comment"># 1.查询书籍主键为4的出版社名称</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(pk=4).values(&#x27;publish__title&#x27;,&#x27;publish__addr&#x27;,&#x27;title&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># 反向查询高阶部分</span></span><br><span class="line">    <span class="comment"># res = models.Publish.objects.filter(book__pk=4)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.查询书籍主键为3的作者姓名</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(pk=3).values(&#x27;authors__name&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># 反向查询高阶部分</span></span><br><span class="line">    <span class="comment"># res = models.Author.objects.filter(book__pk=3)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3.查询作者jason的地址</span></span><br><span class="line">    <span class="comment"># res = models.Author.objects.filter(name=&#x27;jason&#x27;).values(&#x27;author_detail__addr&#x27;,&#x27;name&#x27;,&#x27;age&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># 反向查询高阶部分</span></span><br><span class="line">    <span class="comment"># res = models.AuthorDetail.objects.filter(author__name=&#x27;jason&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查询书籍主键为3的作者的电话号码</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(pk=3).values(&#x27;authors__author_detail__phone&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># res = models.AuthorDetail.objects.filter(author__book__pk=3).values(&#x27;phone&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># res = models.Author.objects.filter(book__pk=3).values(&#x27;author_detail__phone&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br></pre></td></tr></table></figure>

<h3 id="F查询"><a href="#F查询" class="headerlink" title="F查询"></a>F查询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">　　 <span class="comment"># F查询</span></span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> F</span><br><span class="line"><span class="comment"># 1.查询库存数大于卖出数的书籍</span></span><br><span class="line"><span class="comment"># res = models.Book.objects.filter(kucun__gt=F(&#x27;maichu&#x27;))</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"><span class="comment"># 2.将所有的书籍价格上涨100块</span></span><br><span class="line"><span class="comment"># res = models.Book.objects.update(price=F(&#x27;price&#x27;) + 100)</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"><span class="comment"># 3.将所有的书籍名称加上&quot;爆款&quot;后缀</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;针对字符串不能直接拼接 需要额外导入模块操作&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># models.Book.objects.update(title=F(&#x27;title&#x27;) + &#x27;爆款&#x27;)</span></span><br><span class="line"><span class="comment"># from django.db.models.functions import Concat</span></span><br><span class="line"><span class="comment"># from django.db.models import Value</span></span><br><span class="line"><span class="comment"># ret3 = models.Book.objects.update(title=Concat(F(&#x27;title&#x27;), Value(&#x27;爆款&#x27;)))</span></span><br></pre></td></tr></table></figure>

<h3 id="Q查询"><a href="#Q查询" class="headerlink" title="Q查询"></a>Q查询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">　　 <span class="comment"># 1.查询书名是三国演义爆款或者库存是100的书籍</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;filter()括号内可以写多个参数 逗号隔开  默认只支持and连接&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line"><span class="comment"># res = models.Book.objects.filter(title=&#x27;三国演义爆款&#x27;,kucun=100)</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"><span class="comment"># res1 = models.Book.objects.filter(Q(title=&#x27;三国演义爆款&#x27;),Q(kucun=100))  # and</span></span><br><span class="line"><span class="comment"># res1 = models.Book.objects.filter(Q(title=&#x27;三国演义爆款&#x27;)|Q(kucun=100))  # or</span></span><br><span class="line"><span class="comment"># res1 = models.Book.objects.filter(~Q(title=&#x27;三国演义爆款&#x27;)|Q(kucun=100))  # not</span></span><br><span class="line"><span class="comment"># print(res1.query)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;Q进阶用法&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># condition = input(&#x27;请输入你需要按照什么字段查询数据&gt;&gt;&gt;:&#x27;)</span></span><br><span class="line"><span class="comment"># data = input(&#x27;请输入你需要查询的数据名称&gt;&gt;&gt;:&#x27;)</span></span><br><span class="line"><span class="comment"># q = Q()  # 生成一个Q对象</span></span><br><span class="line"><span class="comment"># q.children.append((condition,data))</span></span><br><span class="line"><span class="comment"># res = models.Book.objects.filter(q)</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line">q = Q()</span><br><span class="line">q.connector = <span class="string">&#x27;or&#x27;</span>  <span class="comment"># 可以修改连接条件</span></span><br><span class="line">q.children.append((<span class="string">&#x27;title__contains&#x27;</span>,<span class="string">&#x27;三&#x27;</span>))</span><br><span class="line">q.children.append((<span class="string">&#x27;price__gt&#x27;</span>,<span class="number">200</span>))  <span class="comment"># 可以添加多个条件 并且也是and关系</span></span><br><span class="line">res = models.Book.objects.<span class="built_in">filter</span>(q)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"><span class="built_in">print</span>(res.query)</span><br></pre></td></tr></table></figure>

<h3 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">1.事务四大特性    ACID</span></span><br><span class="line"><span class="string">    原子性</span></span><br><span class="line"><span class="string">    一致性</span></span><br><span class="line"><span class="string">    独立性</span></span><br><span class="line"><span class="string">    持久性</span></span><br><span class="line"><span class="string">2.数据库设计三大范式</span></span><br><span class="line"><span class="string">    课下百度搜索自己概括</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">MySQL</span></span><br><span class="line"><span class="string">    start transcation</span></span><br><span class="line"><span class="string">    commit</span></span><br><span class="line"><span class="string">    rollback</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> transaction</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> transaction.atomic():</span><br><span class="line">            <span class="comment"># 创建一条订单数据</span></span><br><span class="line">            models.Order.objects.create(num=<span class="string">&quot;110110111&quot;</span>, product_id=<span class="number">1</span>, count=<span class="number">1</span>)</span><br><span class="line">            <span class="comment"># 能执行成功</span></span><br><span class="line">            models.Product.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=<span class="number">1</span>).update(kucun=F(<span class="string">&quot;kucun&quot;</span>) - <span class="number">1</span>, maichu=F(<span class="string">&quot;maichu&quot;</span>) + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br></pre></td></tr></table></figure>

<h3 id="执行原生SQL语句"><a href="#执行原生SQL语句" class="headerlink" title="执行原生SQL语句"></a>执行原生SQL语句</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">res = models.Book.objects.raw(<span class="string">&#x27;select * from app01_book&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<h3 id="模型层字段及参数"><a href="#模型层字段及参数" class="headerlink" title="模型层字段及参数"></a>模型层字段及参数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">models.CharField(max_length=<span class="number">32</span>)         <span class="comment"># varchar(32)</span></span><br><span class="line">models.IntergeField()                   <span class="comment"># int()</span></span><br><span class="line">models.DateField()                      <span class="comment"># date</span></span><br><span class="line">models.DateTimeField()                  <span class="comment"># datetime</span></span><br><span class="line">    auto_now</span><br><span class="line">    auto_now_add</span><br><span class="line">models.DecimalField()                   <span class="comment"># float()</span></span><br><span class="line">models.BooleanField()</span><br><span class="line">    给这个字段传布尔值会自动转换成数字<span class="number">0</span>或<span class="number">1</span></span><br><span class="line">    一般用在状态二选一</span><br><span class="line">TextField()</span><br><span class="line">     存储大段文本(bbs项目会使用)</span><br><span class="line">EmailField()</span><br><span class="line">    存储邮箱格式数据</span><br><span class="line">FileField()</span><br><span class="line">    存储数据路径(bbs项目会使用)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;自定义字段&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Field</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCharField</span>(<span class="params">Field</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,max_length,*args,**kwargs</span>):</span></span><br><span class="line">        self.max_length = max_length</span><br><span class="line">        <span class="built_in">super</span>().__init__(max_length=max_length,*args,**kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">db_type</span>(<span class="params">self, connection</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;char(%s)&#x27;</span>%self.max_length </span><br></pre></td></tr></table></figure>

<h3 id="常见参数"><a href="#常见参数" class="headerlink" title="常见参数"></a>常见参数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">max_length</span><br><span class="line">varbose_name</span><br><span class="line">default</span><br><span class="line">null</span><br><span class="line">auto_now</span><br><span class="line">auto_now_add</span><br><span class="line">to</span><br><span class="line">unique</span><br><span class="line">db_index</span><br><span class="line">choices</span><br><span class="line"></span><br><span class="line"><span class="comment"># choices参数</span></span><br><span class="line">创建用户表</span><br><span class="line">    性别</span><br><span class="line">        两到三种状态</span><br><span class="line">    学历</span><br><span class="line">        也是有限个</span><br><span class="line">    在职状态</span><br><span class="line">        也是有限个</span><br><span class="line">    婚姻</span><br><span class="line">        也是有限个</span><br><span class="line">    ...</span><br><span class="line"><span class="string">&quot;&quot;&quot;针对某个字段可以列举完全的情况 一般都是使用choices参数&quot;&quot;&quot;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Server</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    host = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">    status_choices = (</span><br><span class="line">        (<span class="number">1</span>,<span class="string">&#x27;在线&#x27;</span>),</span><br><span class="line">        (<span class="number">2</span>,<span class="string">&#x27;待上线&#x27;</span>),</span><br><span class="line">        (<span class="number">3</span>,<span class="string">&#x27;宕机&#x27;</span>),</span><br><span class="line">        (<span class="number">4</span>,<span class="string">&#x27;待上架&#x27;</span>)</span><br><span class="line">    )</span><br><span class="line">    status = models.IntegerField(choices=status_choices)</span><br><span class="line"></span><br><span class="line">    desc_choices = (</span><br><span class="line">        (<span class="string">&#x27;哈哈&#x27;</span>,<span class="string">&#x27;哈哈哈哈哈哈&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;呵呵&#x27;</span>,<span class="string">&#x27;呵呵呵呵呵呵&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;嘿嘿&#x27;</span>,<span class="string">&#x27;嘿嘿嘿嘿嘿嘿&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;嘻嘻&#x27;</span>,<span class="string">&#x27;嘻嘻嘻嘻嘻嘻&#x27;</span>),</span><br><span class="line">    )</span><br><span class="line">    desc = models.CharField(max_length=<span class="number">32</span>,choices=desc_choices)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取对应关系</span></span><br><span class="line">.get_字段名_display()</span><br></pre></td></tr></table></figure>



<h3 id="ORM查询优化"><a href="#ORM查询优化" class="headerlink" title="ORM查询优化"></a>ORM查询优化</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 惰性查询</span></span><br><span class="line">    用不到的数据即使写了orm语句也不会执行</span><br><span class="line"><span class="number">1.</span>only与defer</span><br><span class="line"><span class="number">2.</span>select_related与prefech_related</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.only与defer</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># res = models.Book.objects.values(&#x27;title&#x27;)  # 列表套字典</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># res1 = models.Book.objects.only(&#x27;title&#x27;)  # 列表套对象</span></span><br><span class="line">    <span class="comment"># print(res1)</span></span><br><span class="line">    <span class="comment"># for i in res1:</span></span><br><span class="line">    <span class="comment">#     # print(i.title)</span></span><br><span class="line">    <span class="comment">#     print(i.price)</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    only括号内写什么字段</span></span><br><span class="line"><span class="string">        生成的对象就含有对应的属性 在查找该属性的时候不再走数据库查询</span></span><br><span class="line"><span class="string">        但是一旦查找括号内没有的字段属性 则每次都会走数据库查询</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># res1 = models.Book.objects.defer(&#x27;title&#x27;)</span></span><br><span class="line">    <span class="comment"># # print(res1)  # 列表套对象</span></span><br><span class="line">    <span class="comment"># for i in res1:</span></span><br><span class="line">    <span class="comment">#     # print(i.title)</span></span><br><span class="line">    <span class="comment">#     print(i.title)</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    defer与only刚好相反</span></span><br><span class="line"><span class="string">        生成的对象就不含有对应的属性 在查找该属性的时候需要每次走数据库查询</span></span><br><span class="line"><span class="string">        但是一旦查找括号内没有的字段属性 则不需要走数据库查询</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(pk=3).first()</span></span><br><span class="line">    <span class="comment"># print(res.publish.title)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># res = models.Book.objects.select_related(&#x27;publish&#x27;)</span></span><br><span class="line">    <span class="comment"># for i in res:</span></span><br><span class="line">    <span class="comment">#     print(i.publish.title)</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    select_related相当于连表操作</span></span><br><span class="line"><span class="string">        先将models后面的表和括号内外键字段关联的表连接起来</span></span><br><span class="line"><span class="string">        之后一次性把所有的数据封装到数据对象中</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    res = models.Book.objects.prefetch_related(<span class="string">&#x27;publish&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">        <span class="built_in">print</span>(i.publish.title)</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    prefetch_related相当于子查询</span></span><br><span class="line"><span class="string">        先查询models后面的表的所有的数据</span></span><br><span class="line"><span class="string">        然后将括号内关联的表的数据全部查询出来</span></span><br><span class="line"><span class="string">        之后整合到一起</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"> </span><br></pre></td></tr></table></figure>



<h3 id="常用及非常用字段"><a href="#常用及非常用字段" class="headerlink" title="常用及非常用字段"></a>常用及非常用字段</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">AutoField(Field)</span><br><span class="line">- <span class="built_in">int</span>自增列，必须填入参数 primary_key=<span class="literal">True</span></span><br><span class="line"></span><br><span class="line">BigAutoField(AutoField)</span><br><span class="line">- bigint自增列，必须填入参数 primary_key=<span class="literal">True</span></span><br><span class="line"></span><br><span class="line">注：当model中如果没有自增列，则自动会创建一个列名为<span class="built_in">id</span>的列</span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span>(<span class="params">models.Model</span>):</span></span><br><span class="line"><span class="comment"># 自动创建一个列名为id的且为自增的整数列</span></span><br><span class="line">username = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Group</span>(<span class="params">models.Model</span>):</span></span><br><span class="line"><span class="comment"># 自定义自增列</span></span><br><span class="line">nid = models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">SmallIntegerField(IntegerField):</span><br><span class="line">- 小整数 -<span class="number">32768</span> ～ <span class="number">32767</span></span><br><span class="line"></span><br><span class="line">PositiveSmallIntegerField(PositiveIntegerRelDbTypeMixin, IntegerField)</span><br><span class="line">- 正小整数 <span class="number">0</span> ～ <span class="number">32767</span></span><br><span class="line">IntegerField(Field)</span><br><span class="line">- 整数列(有符号的) -<span class="number">2147483648</span> ～ <span class="number">2147483647</span></span><br><span class="line"></span><br><span class="line">PositiveIntegerField(PositiveIntegerRelDbTypeMixin, IntegerField)</span><br><span class="line">- 正整数 <span class="number">0</span> ～ <span class="number">2147483647</span></span><br><span class="line"></span><br><span class="line">BigIntegerField(IntegerField):</span><br><span class="line">- 长整型(有符号的) -<span class="number">9223372036854775808</span> ～ <span class="number">9223372036854775807</span></span><br><span class="line"></span><br><span class="line">BooleanField(Field)</span><br><span class="line">- 布尔值类型</span><br><span class="line"></span><br><span class="line">NullBooleanField(Field):</span><br><span class="line">- 可以为空的布尔值</span><br><span class="line"></span><br><span class="line">CharField(Field)</span><br><span class="line">- 字符类型</span><br><span class="line">- 必须提供max_length参数， max_length表示字符长度</span><br><span class="line"></span><br><span class="line">TextField(Field)</span><br><span class="line">- 文本类型</span><br><span class="line"></span><br><span class="line">EmailField(CharField)：</span><br><span class="line">- 字符串类型，Django Admin以及ModelForm中提供验证机制</span><br><span class="line"></span><br><span class="line">IPAddressField(Field)</span><br><span class="line">- 字符串类型，Django Admin以及ModelForm中提供验证 IPV4 机制</span><br><span class="line"></span><br><span class="line">GenericIPAddressField(Field)</span><br><span class="line">- 字符串类型，Django Admin以及ModelForm中提供验证 Ipv4和Ipv6</span><br><span class="line">- 参数：</span><br><span class="line">protocol，用于指定Ipv4或Ipv6， <span class="string">&#x27;both&#x27;</span>,<span class="string">&quot;ipv4&quot;</span>,<span class="string">&quot;ipv6&quot;</span></span><br><span class="line">unpack_ipv4， 如果指定为<span class="literal">True</span>，则输入::ffff:<span class="number">192.0</span><span class="number">.2</span><span class="number">.1</span>时候，可解析为<span class="number">192.0</span><span class="number">.2</span><span class="number">.1</span>，开启此功能，需要protocol=<span class="string">&quot;both&quot;</span></span><br><span class="line"></span><br><span class="line">URLField(CharField)</span><br><span class="line">- 字符串类型，Django Admin以及ModelForm中提供验证 URL</span><br><span class="line"></span><br><span class="line">SlugField(CharField)</span><br><span class="line">- 字符串类型，Django Admin以及ModelForm中提供验证支持 字母、数字、下划线、连接符（减号）</span><br><span class="line"></span><br><span class="line">CommaSeparatedIntegerField(CharField)</span><br><span class="line">- 字符串类型，格式必须为逗号分割的数字</span><br><span class="line"></span><br><span class="line">UUIDField(Field)</span><br><span class="line">- 字符串类型，Django Admin以及ModelForm中提供对UUID格式的验证</span><br><span class="line"></span><br><span class="line">FilePathField(Field)</span><br><span class="line">- 字符串，Django Admin以及ModelForm中提供读取文件夹下文件的功能</span><br><span class="line">- 参数：</span><br><span class="line">path,                      文件夹路径</span><br><span class="line">match=<span class="literal">None</span>,                正则匹配</span><br><span class="line">recursive=<span class="literal">False</span>,           递归下面的文件夹</span><br><span class="line">allow_files=<span class="literal">True</span>,          允许文件</span><br><span class="line">allow_folders=<span class="literal">False</span>,       允许文件夹</span><br><span class="line"></span><br><span class="line">FileField(Field)</span><br><span class="line">- 字符串，路径保存在数据库，文件上传到指定目录</span><br><span class="line">- 参数：</span><br><span class="line">upload_to = <span class="string">&quot;&quot;</span>      上传文件的保存路径</span><br><span class="line">storage = <span class="literal">None</span>      存储组件，默认django.core.files.storage.FileSystemStorage</span><br><span class="line"></span><br><span class="line">ImageField(FileField)</span><br><span class="line">- 字符串，路径保存在数据库，文件上传到指定目录</span><br><span class="line">- 参数：</span><br><span class="line">upload_to = <span class="string">&quot;&quot;</span>      上传文件的保存路径</span><br><span class="line">storage = <span class="literal">None</span>      存储组件，默认django.core.files.storage.FileSystemStorage</span><br><span class="line">width_field=<span class="literal">None</span>,   上传图片的高度保存的数据库字段名（字符串）</span><br><span class="line">height_field=<span class="literal">None</span>   上传图片的宽度保存的数据库字段名（字符串）</span><br><span class="line"></span><br><span class="line">DateTimeField(DateField)</span><br><span class="line">- 日期+时间格式 YYYY-MM-DD HH:MM[:ss[.uuuuuu]][TZ]</span><br><span class="line"></span><br><span class="line">DateField(DateTimeCheckMixin, Field)</span><br><span class="line">- 日期格式      YYYY-MM-DD</span><br><span class="line"></span><br><span class="line">TimeField(DateTimeCheckMixin, Field)</span><br><span class="line">- 时间格式      HH:MM[:ss[.uuuuuu]]</span><br><span class="line"></span><br><span class="line">DurationField(Field)</span><br><span class="line">- 长整数，时间间隔，数据库中按照bigint存储，ORM中获取的值为datetime.timedelta类型</span><br><span class="line"></span><br><span class="line">FloatField(Field)</span><br><span class="line">- 浮点型</span><br><span class="line"></span><br><span class="line">DecimalField(Field)</span><br><span class="line">- <span class="number">10</span>进制小数</span><br><span class="line">- 参数：</span><br><span class="line">max_digits，小数总长度</span><br><span class="line">decimal_places，小数位长度</span><br><span class="line"></span><br><span class="line">BinaryField(Field)</span><br><span class="line">- 二进制类型</span><br></pre></td></tr></table></figure>



<h4 id="对应关系"><a href="#对应关系" class="headerlink" title="对应关系"></a>对应关系</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">对应关系：</span><br><span class="line">    <span class="string">&#x27;AutoField&#x27;</span>: <span class="string">&#x27;integer AUTO_INCREMENT&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;BigAutoField&#x27;</span>: <span class="string">&#x27;bigint AUTO_INCREMENT&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;BinaryField&#x27;</span>: <span class="string">&#x27;longblob&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;BooleanField&#x27;</span>: <span class="string">&#x27;bool&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;CharField&#x27;</span>: <span class="string">&#x27;varchar(%(max_length)s)&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;CommaSeparatedIntegerField&#x27;</span>: <span class="string">&#x27;varchar(%(max_length)s)&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;DateField&#x27;</span>: <span class="string">&#x27;date&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;DateTimeField&#x27;</span>: <span class="string">&#x27;datetime&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;DecimalField&#x27;</span>: <span class="string">&#x27;numeric(%(max_digits)s, %(decimal_places)s)&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;DurationField&#x27;</span>: <span class="string">&#x27;bigint&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;FileField&#x27;</span>: <span class="string">&#x27;varchar(%(max_length)s)&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;FilePathField&#x27;</span>: <span class="string">&#x27;varchar(%(max_length)s)&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;FloatField&#x27;</span>: <span class="string">&#x27;double precision&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;IntegerField&#x27;</span>: <span class="string">&#x27;integer&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;BigIntegerField&#x27;</span>: <span class="string">&#x27;bigint&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;IPAddressField&#x27;</span>: <span class="string">&#x27;char(15)&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;GenericIPAddressField&#x27;</span>: <span class="string">&#x27;char(39)&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NullBooleanField&#x27;</span>: <span class="string">&#x27;bool&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;OneToOneField&#x27;</span>: <span class="string">&#x27;integer&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;PositiveIntegerField&#x27;</span>: <span class="string">&#x27;integer UNSIGNED&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;PositiveSmallIntegerField&#x27;</span>: <span class="string">&#x27;smallint UNSIGNED&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SlugField&#x27;</span>: <span class="string">&#x27;varchar(%(max_length)s)&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SmallIntegerField&#x27;</span>: <span class="string">&#x27;smallint&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;TextField&#x27;</span>: <span class="string">&#x27;longtext&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;TimeField&#x27;</span>: <span class="string">&#x27;time&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;UUIDField&#x27;</span>: <span class="string">&#x27;char(32)&#x27;</span>,</span><br></pre></td></tr></table></figure>



<h3 id="ORM字段参数"><a href="#ORM字段参数" class="headerlink" title="ORM字段参数"></a>ORM字段参数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#### null</span></span><br><span class="line"></span><br><span class="line">用于表示某个字段可以为空。</span><br><span class="line"></span><br><span class="line"><span class="comment">#### **unique**</span></span><br><span class="line"></span><br><span class="line">如果设置为unique=<span class="literal">True</span> 则该字段在此表中必须是唯一的 。</span><br><span class="line"></span><br><span class="line"><span class="comment">#### **db_index**</span></span><br><span class="line"></span><br><span class="line">如果db_index=<span class="literal">True</span> 则代表着为此字段设置索引。</span><br><span class="line"></span><br><span class="line"><span class="comment">#### **default**</span></span><br><span class="line"></span><br><span class="line">为该字段设置默认值。</span><br><span class="line"></span><br><span class="line"><span class="comment">###  DateField和DateTimeField</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#### auto_now_add</span></span><br><span class="line"></span><br><span class="line">配置auto_now_add=<span class="literal">True</span>，创建数据记录的时候会把当前时间添加到数据库。</span><br><span class="line"></span><br><span class="line"><span class="comment">#### auto_now</span></span><br><span class="line"></span><br><span class="line">配置上auto_now=<span class="literal">True</span>，每次更新数据记录的时候会更新该字段。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">null                数据库中字段是否可以为空</span><br><span class="line">db_column           数据库中字段的列名</span><br><span class="line">db_tablespace</span><br><span class="line">default             数据库中字段的默认值</span><br><span class="line">primary_key         数据库中字段是否为主键</span><br><span class="line">db_index            数据库中字段是否可以建立索引</span><br><span class="line">unique              数据库中字段是否可以建立唯一索引</span><br><span class="line">unique_for_date     数据库中字段【日期】部分是否可以建立唯一索引</span><br><span class="line">unique_for_month    数据库中字段【月】部分是否可以建立唯一索引</span><br><span class="line">unique_for_year     数据库中字段【年】部分是否可以建立唯一索引</span><br><span class="line"></span><br><span class="line">verbose_name        Admin中显示的字段名称</span><br><span class="line">blank               Admin中是否允许用户输入为空</span><br><span class="line">editable            Admin中是否可以编辑</span><br><span class="line">help_text           Admin中该字段的提示信息</span><br><span class="line">choices             Admin中显示选择框的内容，用不变动的数据放在内存中从而避免跨表操作</span><br><span class="line">如：gf = models.IntegerField(choices=[(<span class="number">0</span>, <span class="string">&#x27;何穗&#x27;</span>),(<span class="number">1</span>, <span class="string">&#x27;大表姐&#x27;</span>),],default=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">error_messages      自定义错误信息（字典类型），从而定制想要显示的错误信息；</span><br><span class="line">字典健：null, blank, invalid, invalid_choice, unique, <span class="keyword">and</span> unique_for_date</span><br><span class="line">如：&#123;<span class="string">&#x27;null&#x27;</span>: <span class="string">&quot;不能为空.&quot;</span>, <span class="string">&#x27;invalid&#x27;</span>: <span class="string">&#x27;格式错误&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">validators          自定义错误验证（列表类型），从而定制想要的验证规则</span><br><span class="line"><span class="keyword">from</span> django.core.validators <span class="keyword">import</span> RegexValidator</span><br><span class="line"><span class="keyword">from</span> django.core.validators <span class="keyword">import</span> EmailValidator,URLValidator,DecimalValidator,\</span><br><span class="line">MaxLengthValidator,MinLengthValidator,MaxValueValidator,MinValueValidator</span><br><span class="line">如：</span><br><span class="line">test = models.CharField(</span><br><span class="line">max_length=<span class="number">32</span>,</span><br><span class="line">error_messages=&#123;</span><br><span class="line"><span class="string">&#x27;c1&#x27;</span>: <span class="string">&#x27;优先错信息1&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;c2&#x27;</span>: <span class="string">&#x27;优先错信息2&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;c3&#x27;</span>: <span class="string">&#x27;优先错信息3&#x27;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">validators=[</span><br><span class="line">RegexValidator(regex=<span class="string">&#x27;root_\d+&#x27;</span>, message=<span class="string">&#x27;错误了&#x27;</span>, code=<span class="string">&#x27;c1&#x27;</span>),</span><br><span class="line">RegexValidator(regex=<span class="string">&#x27;root_112233\d+&#x27;</span>, message=<span class="string">&#x27;又错误了&#x27;</span>, code=<span class="string">&#x27;c2&#x27;</span>),</span><br><span class="line">EmailValidator(message=<span class="string">&#x27;又错误了&#x27;</span>, code=<span class="string">&#x27;c3&#x27;</span>), ]</span><br><span class="line">                            )</span><br></pre></td></tr></table></figure>



<h2 id="关系字段"><a href="#关系字段" class="headerlink" title="关系字段"></a>关系字段</h2><h3 id="ForeignKey"><a href="#ForeignKey" class="headerlink" title="ForeignKey"></a>ForeignKey</h3><p>外键类型在ORM中用来表示外键关联关系，一般把ForeignKey字段设置在 ‘一对多’中’多’的一方。</p>
<p>ForeignKey可以和其他表做关联关系同时也可以和自身做关联关系。</p>
<h4 id="to"><a href="#to" class="headerlink" title="to"></a>to</h4><p>设置要关联的表</p>
<h4 id="to-field"><a href="#to-field" class="headerlink" title="to_field"></a>to_field</h4><p>设置要关联的表的字段</p>
<h4 id="related-name"><a href="#related-name" class="headerlink" title="related_name"></a>related_name</h4><p>反向操作时，使用的字段名，用于代替原反向查询时的’表名_set’。</p>
<p>例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Classes</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    theclass = models.ForeignKey(to=<span class="string">&quot;Classes&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>当我们要查询某个班级关联的所有学生（反向查询）时，我们会这么写：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">models.Classes.objects.first().student_set.<span class="built_in">all</span>()</span><br></pre></td></tr></table></figure>

<p>当我们在ForeignKey字段中添加了参数 related_name 后，</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    theclass = models.ForeignKey(to=<span class="string">&quot;Classes&quot;</span>, related_name=<span class="string">&quot;students&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>当我们要查询某个班级关联的所有学生（反向查询）时，我们会这么写：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">models.Classes.objects.first().students.<span class="built_in">all</span>()</span><br></pre></td></tr></table></figure>

<h4 id="related-query-name"><a href="#related-query-name" class="headerlink" title="related_query_name"></a><strong>related_query_name</strong></h4><p>反向查询操作时，使用的连接前缀，用于替换表名。</p>
<h4 id="on-delete"><a href="#on-delete" class="headerlink" title="on_delete"></a><strong>on_delete</strong></h4><p>　　当删除关联表中的数据时，当前表与其关联的行的行为。</p>
<p>　　<strong>models.CASCADE</strong><br>　　删除关联数据，与之关联也删除</p>
<p>　　<strong>models.DO_NOTHING</strong><br>　　删除关联数据，引发错误IntegrityError</p>
<p>　　<strong>models.PROTECT</strong><br>　　删除关联数据，引发错误ProtectedError</p>
<p>　　<strong>models.SET_NULL</strong><br>　　删除关联数据，与之关联的值设置为null（前提FK字段需要设置为可空）</p>
<p>　　<strong>models.SET_DEFAULT</strong><br>　　删除关联数据，与之关联的值设置为默认值（前提FK字段需要设置默认值）</p>
<p>　　<strong>models.SET</strong></p>
<p>　　删除关联数据，<br>　　a. 与之关联的值设置为指定值，设置：models.SET(值)<br>　　b. 与之关联的值设置为可执行对象的返回值，设置：models.SET(可执行对象)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyModel</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    user = models.ForeignKey(</span><br><span class="line">        to=<span class="string">&quot;User&quot;</span>,</span><br><span class="line">        to_field=<span class="string">&quot;id&quot;</span>，</span><br><span class="line">        on_delete=models.SET(func)</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<h4 id="db-constraint"><a href="#db-constraint" class="headerlink" title="db_constraint"></a>db_constraint</h4><p>是否在数据库中创建外键约束，默认为True。</p>
<h3 id="OneToOneField"><a href="#OneToOneField" class="headerlink" title="OneToOneField"></a>OneToOneField</h3><p>一对一字段。</p>
<p>通常一对一字段用来扩展已有字段。</p>
<p>一对一的关联关系多用在当一张表的不同字段查询频次差距过大的情况下，将本可以存储在一张表的字段拆开放置在两张表中，然后将两张表建立一对一的关联关系。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    info = models.OneToOneField(to=<span class="string">&#x27;AuthorInfo&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AuthorInfo</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    phone = models.CharField(max_length=<span class="number">11</span>)</span><br><span class="line">    email = models.EmailField()</span><br></pre></td></tr></table></figure>

<h4 id="to-1"><a href="#to-1" class="headerlink" title="to"></a>to</h4><p>设置要关联的表。</p>
<h4 id="to-field-1"><a href="#to-field-1" class="headerlink" title="to_field"></a>to_field</h4><p>设置要关联的字段。</p>
<h4 id="on-delete-1"><a href="#on-delete-1" class="headerlink" title="on_delete"></a>on_delete</h4><p>同ForeignKey字段。</p>
<h3 id="ManyToManyField"><a href="#ManyToManyField" class="headerlink" title="ManyToManyField"></a>ManyToManyField</h3><p>用于表示多对多的关联关系。在数据库中通过第三张表来建立关联关系</p>
<h4 id="to-2"><a href="#to-2" class="headerlink" title="to"></a>to</h4><p>设置要关联的表</p>
<h4 id="related-name-1"><a href="#related-name-1" class="headerlink" title="related_name"></a>related_name</h4><p>同ForeignKey字段。</p>
<h4 id="related-query-name-1"><a href="#related-query-name-1" class="headerlink" title="related_query_name"></a>related_query_name</h4><p>同ForeignKey字段。</p>
<h4 id="symmetrical"><a href="#symmetrical" class="headerlink" title="symmetrical"></a>symmetrical</h4><p>仅用于多对多自关联时，指定内部是否创建反向操作的字段。默认为True。</p>
<p>举个例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">16</span>)</span><br><span class="line">    friends = models.ManyToManyField(<span class="string">&quot;self&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>此时，person对象就没有person_set属性。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">16</span>)</span><br><span class="line">    friends = models.ManyToManyField(<span class="string">&quot;self&quot;</span>, symmetrical=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<p>此时，person对象现在就可以使用person_set属性进行反向查询。</p>
<h4 id="through"><a href="#through" class="headerlink" title="through"></a>through</h4><p>在使用ManyToManyField字段时，Django将自动生成一张表来管理多对多的关联关系。</p>
<p>但我们也可以手动创建第三张表来管理多对多关系，此时就需要通过through来指定第三张表的表名。</p>
<h4 id="through-fields"><a href="#through-fields" class="headerlink" title="through_fields"></a><strong>through_fields</strong></h4><p>设置关联的字段。</p>
<h4 id="db-table"><a href="#db-table" class="headerlink" title="db_table"></a>db_table</h4><p>默认创建第三张表时，数据库中表的名称。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/05/11/Django%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%A8%A1%E6%9D%BF%E5%B1%82/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/05/11/Django%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%A8%A1%E6%9D%BF%E5%B1%82/" class="post-title-link" itemprop="url">Django基础之模板层</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-11 07:20:25" itemprop="dateCreated datePublished" datetime="2019-05-11T07:20:25+08:00">2019-05-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2019-06-01 12:22:34" itemprop="dateModified" datetime="2019-06-01T12:22:34+08:00">2019-06-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">Django系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="内容概要"><a href="#内容概要" class="headerlink" title="内容概要"></a>内容概要</h1><ul>
<li><p>模板层(模板语法)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">模板语法传值</span><br><span class="line"></span><br><span class="line">模板语法过滤器(内置方法)</span><br><span class="line"></span><br><span class="line">模板语法标签(流程控制)</span><br><span class="line"></span><br><span class="line">自定义过滤器和标签(了解)</span><br></pre></td></tr></table></figure></li>
<li><p>模板的导入与继承(面向对象)</p>
</li>
</ul>
<h1 id="内容详细"><a href="#内容详细" class="headerlink" title="内容详细"></a>内容详细</h1><h3 id="模板层之模板语法传值"><a href="#模板层之模板语法传值" class="headerlink" title="模板层之模板语法传值"></a>模板层之模板语法传值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">https://www.cnblogs.com/Dominic-Ji/articles/<span class="number">11109067.</span>html<span class="comment">#_label15</span></span><br><span class="line">    </span><br><span class="line">注释</span><br><span class="line">    &lt;!--HTML注释--&gt;   浏览器能够查看</span><br><span class="line">    &#123;<span class="comment">#模板语法注释#&#125;    浏览器查看不了</span></span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reg</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="comment"># python基本数据类型</span></span><br><span class="line">    f = <span class="number">1.1</span></span><br><span class="line">    i = <span class="number">11</span></span><br><span class="line">    s = <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line">    l = [<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>,<span class="number">44</span>]</span><br><span class="line">    d = &#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&quot;jason&quot;</span>,<span class="string">&#x27;password&#x27;</span>:<span class="number">123</span>&#125;</span><br><span class="line">    t = (<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>,<span class="number">44</span>,<span class="number">55</span>,<span class="number">66</span>,<span class="number">77</span>)</span><br><span class="line">    se = &#123;<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>,<span class="number">44</span>,<span class="number">55</span>,<span class="number">66</span>&#125;</span><br><span class="line">    b = <span class="literal">True</span></span><br><span class="line">    <span class="comment"># 函数(自动加括号调用函数 展示的是函数的返回值)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">args</span>):</span>  <span class="comment"># 模板语法不支持给函数传递额外的参数</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;from func&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;下午有点困&#x27;</span></span><br><span class="line">    <span class="comment"># 面向对象</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>(<span class="params"><span class="built_in">object</span></span>):</span>  <span class="comment"># 自动加括号实例化产生对象</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_obj</span>(<span class="params">self</span>):</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;from obj&#x27;</span></span><br><span class="line"><span class="meta">        @classmethod</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_cls</span>(<span class="params">cls</span>):</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;from cls&#x27;</span></span><br><span class="line"><span class="meta">        @staticmethod</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_func</span>():</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;from func&#x27;</span></span><br><span class="line">    obj = MyClass()</span><br><span class="line">    <span class="comment"># 1.指名道姓的传(需要传的值较少)</span></span><br><span class="line">    <span class="comment"># return render(request,&#x27;reg.html&#x27;,&#123;...&#125;)</span></span><br><span class="line">    <span class="comment"># 2.一次性批量传(效率偏低)  为了教学方便我们使用locals居多</span></span><br><span class="line">    <span class="comment"># return render(request, &#x27;reg.html&#x27;,locals())</span></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">&#x27;reg.html&#x27;</span>,<span class="built_in">locals</span>())</span><br></pre></td></tr></table></figure>

<h3 id="模板语法取值"><a href="#模板语法取值" class="headerlink" title="模板语法取值"></a>模板语法取值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">取值只能使用句点符(.)</span><br><span class="line">&lt;p&gt;&#123;&#123; l<span class="number">.0</span> &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; d.username &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; d.hobby<span class="number">.3</span>.addr &#125;&#125;&lt;/p&gt;</span><br></pre></td></tr></table></figure>

<h3 id="模板语法之过滤器-内置方法"><a href="#模板语法之过滤器-内置方法" class="headerlink" title="模板语法之过滤器(内置方法)"></a>模板语法之过滤器(内置方法)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;过滤器:  管道符 左侧当做过滤器的第一个参数 右侧有时候还可以支持再传一个参数(冒号开头)&lt;/p&gt;</span><br><span class="line">&lt;p&gt;统计长度:&#123;&#123; l|length &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;自增运算:&#123;&#123; i|add:<span class="number">123</span> &#125;&#125;、拼接操作:&#123;&#123; s|add:<span class="string">&#x27;去你妹的&#x27;</span> &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;日期转换:&#123;&#123; ctime &#125;&#125;、&#123;&#123; ctime|date:<span class="string">&#x27;Y-m-d&#x27;</span> &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;文件大小:&#123;&#123; file_size|filesizeformat &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;截取字符(三个点也算):&#123;&#123; desc|truncatechars:<span class="number">6</span> &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;截取单词(三个点不算):&#123;&#123; desc|truncatewords:<span class="number">3</span> &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;切片操作:&#123;&#123; s|<span class="built_in">slice</span>:<span class="string">&#x27;0:4&#x27;</span> &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;默认值(判断布尔值):&#123;&#123; b|default:<span class="string">&#x27;这个东西布尔值是False&#x27;</span> &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;文本转义:&#123;&#123; ht|safe &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;文本转义:&#123;&#123; xss &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;文本转义:&#123;&#123; ht1 &#125;&#125;&lt;/p&gt;</span><br><span class="line">    </span><br><span class="line">后端转义</span><br><span class="line"><span class="keyword">from</span> django.utils.safestring <span class="keyword">import</span> mark_safe</span><br><span class="line">ht1 = <span class="string">&#x27;&lt;h1&gt;一级标题&lt;/h1&gt;&#x27;</span></span><br><span class="line">ht1 = mark_safe(ht1)</span><br></pre></td></tr></table></figure>

<h3 id="模板语法之标签-流程控制"><a href="#模板语法之标签-流程控制" class="headerlink" title="模板语法之标签(流程控制)"></a>模板语法之标签(流程控制)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#125;&#125;    变量相关(引用变量值)</span><br><span class="line">&#123;%%&#125;    逻辑相关(流程控制 模块方法)</span><br><span class="line"></span><br><span class="line">&lt;p&gt;标签: 流程控制&lt;/p&gt;</span><br><span class="line">&#123;% <span class="keyword">for</span> i <span class="keyword">in</span> lll %&#125;</span><br><span class="line">    &#123;% <span class="keyword">if</span> forloop.first %&#125;</span><br><span class="line">        &lt;p&gt;这是我的第一次循环&lt;/p&gt;</span><br><span class="line">    &#123;% <span class="keyword">elif</span> forloop.last %&#125;</span><br><span class="line">        &lt;p&gt;这是我的最后一次循环&lt;/p&gt;</span><br><span class="line">    &#123;% <span class="keyword">else</span> %&#125;</span><br><span class="line">        &lt;p&gt;&#123;&#123; i &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">    &#123;% empty %&#125;</span><br><span class="line">        &lt;p&gt;该对象里面没有值&lt;/p&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义过滤器、标签、inclusion-tag"><a href="#自定义过滤器、标签、inclusion-tag" class="headerlink" title="自定义过滤器、标签、inclusion_tag"></a>自定义过滤器、标签、inclusion_tag</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>在应用下创建一个名字必须叫templatetags文件夹</span><br><span class="line"><span class="number">2.</span>在该文件夹内创建一个任意名称的py文件</span><br><span class="line"><span class="number">3.</span>在py文件内必须要书写两行固定的代码</span><br><span class="line">    <span class="keyword">from</span> django.template <span class="keyword">import</span> Library</span><br><span class="line">     register = Library()</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 自定义过滤器</span></span><br><span class="line"><span class="meta">@register.filter(<span class="params">is_safe=<span class="literal">False</span>,name=<span class="string">&#x27;aaa&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_plus</span>(<span class="params">a,b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义标签(自定义函数)</span></span><br><span class="line"><span class="meta">@register.simple_tag(<span class="params">name=<span class="string">&#x27;bbb&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">a,b,c,d</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;%s-%s-%s-%s&#x27;</span>%(a,b,c,d)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义inclusion_tag(自行概括)</span></span><br><span class="line"><span class="meta">@register.inclusion_tag(<span class="params">filename=<span class="string">&#x27;ccc.html&#x27;</span>,name=<span class="string">&#x27;myinc&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">n</span>):</span></span><br><span class="line">    new_l = [<span class="string">&#x27;第%s页&#x27;</span>%i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,n+<span class="number">1</span>)]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">locals</span>()</span><br></pre></td></tr></table></figure>

<h3 id="模板的继承-使用频率较高"><a href="#模板的继承-使用频率较高" class="headerlink" title="模板的继承(使用频率较高)"></a>模板的继承(使用频率较高)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">需求</span><br><span class="line">    页面主体不变 部分区域变化</span><br><span class="line"></span><br><span class="line">模板继承</span><br><span class="line">    <span class="number">1.</span>需要现在母版中使用block提前划定区域</span><br><span class="line">        &#123;% block 区域名称 %&#125;</span><br><span class="line">        &#123;% endblock %&#125;</span><br><span class="line">    <span class="number">2.</span>在子版中先继承再局部替换</span><br><span class="line">        &#123;% extends <span class="string">&#x27;模版.html&#x27;</span> %&#125;</span><br><span class="line">        &#123;% block 区域名称 %&#125;</span><br><span class="line">            </span><br><span class="line">        &#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">总结</span><br><span class="line">    模板一般情况下都应该至少含有三个区域</span><br><span class="line">        css区域</span><br><span class="line">        content区域</span><br><span class="line">        js区域</span><br><span class="line">    </span><br><span class="line">补充</span><br><span class="line">    &#123;&#123; block.<span class="built_in">super</span> &#125;&#125;  调用模版内容</span><br></pre></td></tr></table></figure>

<h3 id="模板的导入"><a href="#模板的导入" class="headerlink" title="模板的导入"></a>模板的导入</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% include <span class="string">&#x27;myform.html&#x27;</span> %&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/05/11/Django%E5%9F%BA%E7%A1%80%E4%B9%8B%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E9%A1%B5%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/05/11/Django%E5%9F%BA%E7%A1%80%E4%B9%8B%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E9%A1%B5%E5%99%A8/" class="post-title-link" itemprop="url">Django基础之自定义分页器</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-11 07:20:25" itemprop="dateCreated datePublished" datetime="2019-05-11T07:20:25+08:00">2019-05-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2019-06-01 12:22:34" itemprop="dateModified" datetime="2019-06-01T12:22:34+08:00">2019-06-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">Django系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="自定义分页器"><a href="#自定义分页器" class="headerlink" title="自定义分页器"></a>自定义分页器</h1><p><strong>针对批量插入的数据，我们在前端展示的时候发现一个很严重的问题，一页展示了所有的数据，数据量太大，查看不方便</strong></p>
<p><strong>针对数据量大但又需要全部展示给用户观看的情况下，我们统一做法都是做分页处理</strong></p>
<h2 id="分页推导"><a href="#分页推导" class="headerlink" title="分页推导"></a>分页推导</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">首先我们需要明确的时候，get请求也是可以携带参数的，所以我们在朝后端发送查看数据的同时可以携带一个参数告诉后端我们想看第几页的数据</span><br><span class="line"></span><br><span class="line">其次我们还需要知道一个点，queryset对象是支持索引取值和切片操作的，但是不支持负数索引情况</span><br><span class="line"></span><br><span class="line">接下来我们就可以推导我们的自定义分页器步骤了</span><br><span class="line"></span><br><span class="line">current_page = request.GET.get(<span class="string">&quot;page&quot;</span>,<span class="number">1</span>)  <span class="comment"># 获取用户想访问的页码  如果没有 默认展示第一页</span></span><br><span class="line"><span class="keyword">try</span>:  <span class="comment"># 由于后端接受到的前端数据是字符串类型所以我们这里做类型转换处理加异常捕获</span></span><br><span class="line">  current_page = <span class="built_in">int</span>(current_page)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">  current_page = <span class="number">1</span></span><br><span class="line"><span class="comment"># 还需要定义页面到底展示几条数据</span></span><br><span class="line">per_page_num = <span class="number">10</span>  <span class="comment"># 一页展示10条数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 需要对总数据进行切片操作 需要确定切片起始位置和终止位置</span></span><br><span class="line">start_page = ? </span><br><span class="line">end_page = ?</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">下面需要研究current_page、per_page_num、start_page、end_page四个参数之间的数据关系</span></span><br><span class="line"><span class="string">per_page_num = 10</span></span><br><span class="line"><span class="string">current_page                start_page                  end_page</span></span><br><span class="line"><span class="string">    1                           0                           10</span></span><br><span class="line"><span class="string">    2                           10                          20</span></span><br><span class="line"><span class="string">    3                           20                          30  </span></span><br><span class="line"><span class="string">    4                           30                          40</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">per_page_num = 5</span></span><br><span class="line"><span class="string">current_page                start_page                  end_page</span></span><br><span class="line"><span class="string">    1                           0                           5</span></span><br><span class="line"><span class="string">    2                           5                           10</span></span><br><span class="line"><span class="string">    3                           10                          15  </span></span><br><span class="line"><span class="string">    4                           15                          20</span></span><br><span class="line"><span class="string">可以很明显的看出规律</span></span><br><span class="line"><span class="string">start_page = (current_page - 1) * per_page_num</span></span><br><span class="line"><span class="string">end_page =  current_page* per_page_num</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="数据总页面获取"><a href="#数据总页面获取" class="headerlink" title="数据总页面获取"></a>数据总页面获取</h2><p><strong>当我问你下面几个问题的时候，你的内心肯定是鄙视的，不信的话那就请听题</strong></p>
<p><strong>问题1:总数据有100条，每页展示10条，总共需要几页？</strong></p>
<p><strong>答案:10条</strong></p>
<p><strong>问题2:总数据有101条，每页展示10条，总共需要几页?</strong></p>
<p><strong>答案:11条</strong></p>
<p><strong>问题3:如何通过代码算出到底需要多少条？</strong></p>
<p><strong>答案:去你妹的，不会！！！</strong></p>
<h3 id="内置方法之divmod"><a href="#内置方法之divmod" class="headerlink" title="内置方法之divmod"></a>内置方法之divmod</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">divmod</span>(<span class="number">100</span>,<span class="number">10</span>)</span><br><span class="line">(<span class="number">10</span>, <span class="number">0</span>)  <span class="comment"># 10页</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">divmod</span>(<span class="number">101</span>,<span class="number">10</span>)</span><br><span class="line">(<span class="number">10</span>, <span class="number">1</span>)  <span class="comment"># 11页</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">divmod</span>(<span class="number">99</span>,<span class="number">10</span>)</span><br><span class="line">(<span class="number">9</span>, <span class="number">9</span>)  <span class="comment"># 10页</span></span><br><span class="line"><span class="comment"># 余数只要不是0就需要在第一个数字上加一</span></span><br><span class="line">我们可以判断元祖的第二个数字是否为<span class="number">0</span>从而确定到底需要多少页来展示数据</span><br><span class="line"></span><br><span class="line">book_queryset = models.Book.objects.<span class="built_in">all</span>()</span><br><span class="line">all_count = book_queryset.count()  <span class="comment"># 数据总条数</span></span><br><span class="line">all_pager, more = <span class="built_in">divmod</span>(all_count, per_page_num)</span><br><span class="line"><span class="keyword">if</span> more:  <span class="comment"># 有余数则总页数加一</span></span><br><span class="line">  all_pager += <span class="number">1</span></span><br><span class="line">至此分页器大致的功能及思路我们就已经大致清楚了</span><br><span class="line"></span><br><span class="line">最后我们只需要利用start_page和end_page对总数据进行切片取值再传入前端页面就能够实现分页展示</span><br><span class="line"></span><br><span class="line">book_list = models.Book.objects.<span class="built_in">all</span>()[start_page:end_page]</span><br><span class="line"><span class="keyword">return</span> render(request,<span class="string">&#x27;booklist.html&#x27;</span>,<span class="built_in">locals</span>())</span><br><span class="line">接下来就是前端页面的代码编写了</span><br><span class="line"></span><br><span class="line">&#123;% <span class="keyword">for</span> book <span class="keyword">in</span> book_list %&#125;</span><br><span class="line">    &lt;p&gt;&#123;&#123; book.title &#125;&#125;&lt;/p&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p><strong>现在我们实现了最简单的分页，但是前端没有按钮去让用户点击需要看第几页，所以我们需要渲染分页器相关代码，这里我们不做要求直接去bootstrap框架拷贝代码即可</strong></p>
<h2 id="终极大法"><a href="#终极大法" class="headerlink" title="终极大法"></a>终极大法</h2><p>上面是自定义分页器开发流程的基本思路，我们不需要掌握代码的编写，只需要掌握基本用法即可</p>
<p>自定义分页器封装代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pagination</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, current_page, all_count, per_page_num=<span class="number">2</span>, pager_count=<span class="number">11</span></span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        封装分页相关数据</span></span><br><span class="line"><span class="string">        :param current_page: 当前页</span></span><br><span class="line"><span class="string">        :param all_count:    数据库中的数据总条数</span></span><br><span class="line"><span class="string">        :param per_page_num: 每页显示的数据条数</span></span><br><span class="line"><span class="string">        :param pager_count:  最多显示的页码个数</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            current_page = <span class="built_in">int</span>(current_page)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            current_page = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> current_page &lt; <span class="number">1</span>:</span><br><span class="line">            current_page = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        self.current_page = current_page</span><br><span class="line"></span><br><span class="line">        self.all_count = all_count</span><br><span class="line">        self.per_page_num = per_page_num</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 总页码</span></span><br><span class="line">        all_pager, tmp = <span class="built_in">divmod</span>(all_count, per_page_num)</span><br><span class="line">        <span class="keyword">if</span> tmp:</span><br><span class="line">            all_pager += <span class="number">1</span></span><br><span class="line">        self.all_pager = all_pager</span><br><span class="line"></span><br><span class="line">        self.pager_count = pager_count</span><br><span class="line">        self.pager_count_half = <span class="built_in">int</span>((pager_count - <span class="number">1</span>) / <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> (self.current_page - <span class="number">1</span>) * self.per_page_num</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">end</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.current_page * self.per_page_num</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">page_html</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 如果总页码 &lt; 11个：</span></span><br><span class="line">        <span class="keyword">if</span> self.all_pager &lt;= self.pager_count:</span><br><span class="line">            pager_start = <span class="number">1</span></span><br><span class="line">            pager_end = self.all_pager + <span class="number">1</span></span><br><span class="line">        <span class="comment"># 总页码  &gt; 11</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 当前页如果&lt;=页面上最多显示11/2个页码</span></span><br><span class="line">            <span class="keyword">if</span> self.current_page &lt;= self.pager_count_half:</span><br><span class="line">                pager_start = <span class="number">1</span></span><br><span class="line">                pager_end = self.pager_count + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 当前页大于5</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 页码翻到最后</span></span><br><span class="line">                <span class="keyword">if</span> (self.current_page + self.pager_count_half) &gt; self.all_pager:</span><br><span class="line">                    pager_end = self.all_pager + <span class="number">1</span></span><br><span class="line">                    pager_start = self.all_pager - self.pager_count + <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    pager_start = self.current_page - self.pager_count_half</span><br><span class="line">                    pager_end = self.current_page + self.pager_count_half + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        page_html_list = []</span><br><span class="line">        <span class="comment"># 添加前面的nav和ul标签</span></span><br><span class="line">        page_html_list.append(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                    &lt;nav aria-label=&#x27;Page navigation&gt;&#x27;</span></span><br><span class="line"><span class="string">                    &lt;ul class=&#x27;pagination&#x27;&gt;</span></span><br><span class="line"><span class="string">                &#x27;&#x27;&#x27;</span>)</span><br><span class="line">        first_page = <span class="string">&#x27;&lt;li&gt;&lt;a href=&quot;?page=%s&quot;&gt;首页&lt;/a&gt;&lt;/li&gt;&#x27;</span> % (<span class="number">1</span>)</span><br><span class="line">        page_html_list.append(first_page)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.current_page &lt;= <span class="number">1</span>:</span><br><span class="line">            prev_page = <span class="string">&#x27;&lt;li class=&quot;disabled&quot;&gt;&lt;a href=&quot;#&quot;&gt;上一页&lt;/a&gt;&lt;/li&gt;&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            prev_page = <span class="string">&#x27;&lt;li&gt;&lt;a href=&quot;?page=%s&quot;&gt;上一页&lt;/a&gt;&lt;/li&gt;&#x27;</span> % (self.current_page - <span class="number">1</span>,)</span><br><span class="line"></span><br><span class="line">        page_html_list.append(prev_page)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(pager_start, pager_end):</span><br><span class="line">            <span class="keyword">if</span> i == self.current_page:</span><br><span class="line">                temp = <span class="string">&#x27;&lt;li class=&quot;active&quot;&gt;&lt;a href=&quot;?page=%s&quot;&gt;%s&lt;/a&gt;&lt;/li&gt;&#x27;</span> % (i, i,)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                temp = <span class="string">&#x27;&lt;li&gt;&lt;a href=&quot;?page=%s&quot;&gt;%s&lt;/a&gt;&lt;/li&gt;&#x27;</span> % (i, i,)</span><br><span class="line">            page_html_list.append(temp)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.current_page &gt;= self.all_pager:</span><br><span class="line">            next_page = <span class="string">&#x27;&lt;li class=&quot;disabled&quot;&gt;&lt;a href=&quot;#&quot;&gt;下一页&lt;/a&gt;&lt;/li&gt;&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            next_page = <span class="string">&#x27;&lt;li&gt;&lt;a href=&quot;?page=%s&quot;&gt;下一页&lt;/a&gt;&lt;/li&gt;&#x27;</span> % (self.current_page + <span class="number">1</span>,)</span><br><span class="line">        page_html_list.append(next_page)</span><br><span class="line"></span><br><span class="line">        last_page = <span class="string">&#x27;&lt;li&gt;&lt;a href=&quot;?page=%s&quot;&gt;尾页&lt;/a&gt;&lt;/li&gt;&#x27;</span> % (self.all_pager,)</span><br><span class="line">        page_html_list.append(last_page)</span><br><span class="line">        <span class="comment"># 尾部添加标签</span></span><br><span class="line">        page_html_list.append(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                                           &lt;/nav&gt;</span></span><br><span class="line"><span class="string">                                           &lt;/ul&gt;</span></span><br><span class="line"><span class="string">                                       &#x27;&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(page_html_list)</span><br></pre></td></tr></table></figure>

<h2 id="自定义分页器使用"><a href="#自定义分页器使用" class="headerlink" title="自定义分页器使用"></a>自定义分页器使用</h2><h3 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_book</span>(<span class="params">request</span>):</span></span><br><span class="line">  book_list = models.Book.objects.<span class="built_in">all</span>()</span><br><span class="line">  current_page = request.GET.get(<span class="string">&quot;page&quot;</span>,<span class="number">1</span>)</span><br><span class="line">  all_count = book_list.count()</span><br><span class="line">  page_obj = Pagination(current_page=current_page,all_count=all_count,per_page_num=<span class="number">10</span>)</span><br><span class="line">  page_queryset = book_list[page_obj.start:page_obj.end]</span><br><span class="line">  <span class="keyword">return</span> render(request,<span class="string">&#x27;booklist.html&#x27;</span>,<span class="built_in">locals</span>())</span><br></pre></td></tr></table></figure>

<h3 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">row</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-8 <span class="title">col</span>-<span class="title">md</span>-<span class="title">offset</span>-2&quot;&gt;</span></span><br><span class="line"><span class="class">            &#123;% <span class="title">for</span> <span class="title">book</span> <span class="title">in</span> <span class="title">page_queryset</span> %&#125;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">p</span>&gt;&#123;&#123; <span class="title">book</span>.<span class="title">title</span> &#125;&#125;&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">            &#123;% <span class="title">endfor</span> %&#125;</span></span><br><span class="line"><span class="class">            &#123;&#123; <span class="title">page_obj</span>.<span class="title">page_html</span>|<span class="title">safe</span> &#125;&#125;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/05/11/Django%E5%9F%BA%E7%A1%80%E4%B9%8B%E8%B7%AF%E7%94%B1%E5%B1%82/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/05/11/Django%E5%9F%BA%E7%A1%80%E4%B9%8B%E8%B7%AF%E7%94%B1%E5%B1%82/" class="post-title-link" itemprop="url">Django基础之路由层</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-11 07:20:25" itemprop="dateCreated datePublished" datetime="2019-05-11T07:20:25+08:00">2019-05-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2019-06-01 12:22:34" itemprop="dateModified" datetime="2019-06-01T12:22:34+08:00">2019-06-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">Django系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="内容概要"><a href="#内容概要" class="headerlink" title="内容概要"></a>内容概要</h1><ul>
<li>路由匹配</li>
<li>无名有名分组</li>
<li>反向解析</li>
<li>无名有名分组反向解析(难理解)</li>
<li>路由分发</li>
<li>名称空间</li>
<li>伪静态</li>
</ul>
<h1 id="内容详细"><a href="#内容详细" class="headerlink" title="内容详细"></a>内容详细</h1><h3 id="路由匹配"><a href="#路由匹配" class="headerlink" title="路由匹配"></a>路由匹配</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">urls.py</span><br><span class="line"></span><br><span class="line">url()方法第一个参数其实是一个正则表达式</span><br><span class="line">第一个参数只要能够匹配到内容就算是符合匹配条件直接停止匹配执行视图函数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 路由匹配</span></span><br><span class="line">url(<span class="string">r&#x27;^test/$&#x27;</span>,views.test),</span><br><span class="line">url(<span class="string">r&#x27;^testadd/$&#x27;</span>,views.testadd)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取消自动加斜杠(默认为True)</span></span><br><span class="line">APPEND_SLASH = <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h3 id="无名分组"><a href="#无名分组" class="headerlink" title="无名分组"></a>无名分组</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在路由匹配的时候如果给正则表达式加上了括号</span><br><span class="line">那么匹配到路由之后会将括号内正则表达式匹配的到内容当做位置参数传递给视图函数</span><br><span class="line">url(<span class="string">r&#x27;^test/(\d+)/(\d+)/&#x27;</span>,views.test)  <span class="comment"># test(request,正则匹配的内容)</span></span><br></pre></td></tr></table></figure>

<h3 id="有名分组"><a href="#有名分组" class="headerlink" title="有名分组"></a>有名分组</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在路由匹配的时候如果给正则表达式加上了括号并且命名</span><br><span class="line">那么匹配到路由之后会将括号内正则表达式匹配的到内容当做关键字参数传递给视图函数</span><br><span class="line">url(<span class="string">r&#x27;^testadd/(?P&lt;user_id&gt;\d+)/&#x27;</span>,views.testadd)  <span class="comment"># testadd(request,user_id=正则匹配的内容)</span></span><br></pre></td></tr></table></figure>

<h3 id="两者结合使用"><a href="#两者结合使用" class="headerlink" title="两者结合使用?"></a>两者结合使用?</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r&#x27;^testsub/(\d+)/(?P&lt;sub_id&gt;\d+)/&#x27;</span>,views.sub)</span><br><span class="line">无名有名分组两者不能混合使用!!!</span><br><span class="line"></span><br><span class="line">单独的情况下可以重复多次!!!</span><br><span class="line">url(<span class="string">r&#x27;^testsub/(\d+)/(\d+)/&#x27;</span>)</span><br><span class="line">url(<span class="string">r&#x27;^testsub/(?P&lt;sub_id&gt;\d+)/(?P&lt;sub_id&gt;\d+)/&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="反向解析"><a href="#反向解析" class="headerlink" title="反向解析"></a>反向解析</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">通过别名反向解析到一个结果</span></span><br><span class="line"><span class="string">该结果可以访问到对应的视图函数</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">前端页面反向解析</span><br><span class="line">    &#123;% url <span class="string">&#x27;index_view&#x27;</span> %&#125;</span><br><span class="line">后端流程反向解析</span><br><span class="line">    <span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, HttpResponse, redirect, reverse</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">request</span>):</span></span><br><span class="line">        <span class="comment"># 第一种</span></span><br><span class="line">        _url = reverse(<span class="string">&#x27;index_view&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(_url)</span><br><span class="line">        <span class="comment"># return redirect(&#x27;/index/&#x27;)</span></span><br><span class="line">        <span class="comment"># 第二种</span></span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;index_view&#x27;</span>)  <span class="comment"># 还可以直接写别名</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># 起别名不能冲突</span></span><br></pre></td></tr></table></figure>

<h3 id="无名有名反向解析"><a href="#无名有名反向解析" class="headerlink" title="无名有名反向解析"></a>无名有名反向解析</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r&#x27;^login/(\d+)/&#x27;</span>,views.login,name=<span class="string">&#x27;login_view&#x27;</span>)</span><br><span class="line">reverse(<span class="string">&#x27;login_view&#x27;</span>,args=(<span class="number">1</span>,))</span><br><span class="line">&#123;% url <span class="string">&#x27;login_view&#x27;</span> <span class="number">1</span> %&#125;</span><br><span class="line"><span class="comment"># 数字只要能够让\d+匹配到就可以 在实际项目中一般都是动态获取</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url(<span class="string">r&#x27;^reg/(?P&lt;user_id&gt;\d+)/&#x27;</span>,views.reg,name=<span class="string">&#x27;reg_view&#x27;</span>)</span><br><span class="line">reverse(<span class="string">&#x27;reg_view&#x27;</span>,kwargs=&#123;<span class="string">&#x27;user_id&#x27;</span>:<span class="number">666</span>&#125;)</span><br><span class="line">&#123;% url <span class="string">&#x27;reg_view&#x27;</span> user_id=<span class="number">123</span> %&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;无论是无名分组还是有名分组的反向解析都可以使用一样的格式&quot;&quot;&quot;</span></span><br><span class="line">url(<span class="string">r&#x27;^reg/(?P&lt;user_id&gt;\d+)/&#x27;</span>,views.reg,name=<span class="string">&#x27;reg_view&#x27;</span>)</span><br><span class="line">reverse(<span class="string">&#x27;reg_view&#x27;</span>,args=(<span class="number">123</span>,))</span><br><span class="line">&#123;% url <span class="string">&#x27;reg_view&#x27;</span> <span class="number">123</span> %&#125;</span><br></pre></td></tr></table></figure>

<h3 id="路由分发"><a href="#路由分发" class="headerlink" title="路由分发"></a>路由分发</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">当django的app特别多的时候 一个urls.py太过冗余</span><br><span class="line">在django中每一个app都可以拥有自己的urls.py static文件夹 templates文件夹</span><br><span class="line"></span><br><span class="line">路由分发</span><br><span class="line">    总路由不再做url与视图函数直接匹配</span><br><span class="line">    而是先根据url分辨出请求哪个业务</span><br><span class="line">    之后分配给下面的app再去匹配视图函数</span><br><span class="line">    </span><br><span class="line">复杂版本</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> urls <span class="keyword">as</span> app01_urls</span><br><span class="line"><span class="keyword">from</span> app02 <span class="keyword">import</span> urls <span class="keyword">as</span> app02_urls</span><br><span class="line">url(<span class="string">r&#x27;^app01/&#x27;</span>,include(app01_urls)),</span><br><span class="line">url(<span class="string">r&#x27;^app02/&#x27;</span>,include(app02_urls)),</span><br><span class="line"></span><br><span class="line">简化版本</span><br><span class="line">url(<span class="string">r&#x27;^app01/&#x27;</span>,include(<span class="string">&#x27;app01.urls&#x27;</span>)),</span><br><span class="line">url(<span class="string">r&#x27;^app02/&#x27;</span>,include(<span class="string">&#x27;app02.urls&#x27;</span>)),</span><br><span class="line"></span><br><span class="line"><span class="comment"># 子路由还是按照之前总路由的写法</span></span><br></pre></td></tr></table></figure>

<h3 id="名称空间"><a href="#名称空间" class="headerlink" title="名称空间"></a>名称空间</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">多个应用在反向解析的时候出现了别名冲突的情况</span><br><span class="line">django是无法做到一一对应的        &gt;&gt;&gt;名称空间</span><br><span class="line"></span><br><span class="line">url(<span class="string">r&#x27;^app01/&#x27;</span>,include(<span class="string">&#x27;app01.urls&#x27;</span>,namespace=<span class="string">&#x27;app01&#x27;</span>)),</span><br><span class="line">url(<span class="string">r&#x27;^app02/&#x27;</span>,include(<span class="string">&#x27;app02.urls&#x27;</span>,namespace=<span class="string">&#x27;app02&#x27;</span>)),</span><br><span class="line">reverse(<span class="string">&#x27;app01:index_view&#x27;</span>)</span><br><span class="line">reverse(<span class="string">&#x27;app02:index_view&#x27;</span>)</span><br><span class="line">&#123;% url <span class="string">&#x27;app01:index_view&#x27;</span> %&#125;</span><br><span class="line">&#123;% url <span class="string">&#x27;app02:index_view&#x27;</span> %&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 名称空间其实也可以不需要使用</span></span><br><span class="line">只需要确保多个应用之间别名也不冲突的情况</span><br><span class="line">    eg:起别名的时候加上应用名前缀</span><br></pre></td></tr></table></figure>

<h3 id="伪静态页面"><a href="#伪静态页面" class="headerlink" title="伪静态页面"></a>伪静态页面</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">静态页面</span><br><span class="line">    页面上的数据一般都是直接写死的</span><br><span class="line">伪静态页面</span><br><span class="line">    目的是为了提升网页被SEO查询出来的概率</span><br><span class="line"> </span><br><span class="line">如何优化都干不过RMB玩家</span><br><span class="line"><span class="string">&quot;&quot;&quot;所有的搜索引擎都是爬虫程序&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/05/11/Django%E5%9F%BA%E7%A1%80%E4%B9%8B%E8%A7%86%E5%9B%BE%E5%B1%82/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/05/11/Django%E5%9F%BA%E7%A1%80%E4%B9%8B%E8%A7%86%E5%9B%BE%E5%B1%82/" class="post-title-link" itemprop="url">Django基础之视图层</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-11 07:20:25" itemprop="dateCreated datePublished" datetime="2019-05-11T07:20:25+08:00">2019-05-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2019-06-01 12:22:34" itemprop="dateModified" datetime="2019-06-01T12:22:34+08:00">2019-06-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">Django系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="内容概要"><a href="#内容概要" class="headerlink" title="内容概要"></a>内容概要</h1><ul>
<li>小白必会三板斧</li>
<li>request对象方法初识</li>
<li>form表单上传文件</li>
<li>Jsonresponse</li>
<li>FBV与CBV</li>
</ul>
<h1 id="内容详细"><a href="#内容详细" class="headerlink" title="内容详细"></a>内容详细</h1><h3 id="小白必会三板斧"><a href="#小白必会三板斧" class="headerlink" title="小白必会三板斧"></a>小白必会三板斧</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HttpResponse</span><br><span class="line">render</span><br><span class="line">redirect</span><br><span class="line"><span class="comment"># 视图函数必须返回一个HttpResponse对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体参考HttpResponse源码</span></span><br></pre></td></tr></table></figure>

<h3 id="request方法初识"><a href="#request方法初识" class="headerlink" title="request方法初识"></a>request方法初识</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">request对象：（</span></span><br><span class="line"><span class="string">1：request.method（判断请求格式）</span></span><br><span class="line"><span class="string">2：request.POST（.get、.getlist）</span></span><br><span class="line"><span class="string">3：request.GET（.get、.getlist）</span></span><br><span class="line"><span class="string">4：request.body（一串二进制）</span></span><br><span class="line"><span class="string">5：request.files（接收文件）</span></span><br><span class="line"><span class="string">6：request.path</span></span><br><span class="line"><span class="string">7：request.path_info</span></span><br><span class="line"><span class="string">8：request.get_full_path（接收完整url及？号后面的参数）</span></span><br><span class="line"><span class="string"> ...</span></span><br><span class="line"><span class="string">）</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span> </span><br></pre></td></tr></table></figure>

<h3 id="form表单上传文件"><a href="#form表单上传文件" class="headerlink" title="form表单上传文件"></a>form表单上传文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">必须要指定的参数</span><br><span class="line">    <span class="number">1.</span>method=<span class="string">&#x27;post&#x27;</span></span><br><span class="line">    <span class="number">2.</span>enctype=<span class="string">&#x27;/multipart/form-data/&#x27;</span></span><br><span class="line">&lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">    &lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;myfile&quot;</span> multiple&gt;</span><br><span class="line">    &lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;submit&quot;</span> <span class="class"><span class="keyword">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">primary</span> <span class="title">btn</span>-<span class="title">block</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">def</span> <span class="title">index</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="comment"># print(request.POST)</span></span><br><span class="line">        <span class="comment"># print(request.GET)</span></span><br><span class="line">        <span class="comment"># print(request.FILES)  # 获取文件数据</span></span><br><span class="line">        file_obj = request.FILES.get(<span class="string">&#x27;myfile&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(file_obj.name)  <span class="comment"># 获取文件名</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file_obj.name,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> chunk <span class="keyword">in</span> file_obj.chunks():</span><br><span class="line">                f.write(chunk)</span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<h3 id="Jsonresponse"><a href="#Jsonresponse" class="headerlink" title="Jsonresponse"></a>Jsonresponse</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">JsonRespanse：（</span><br><span class="line"><span class="keyword">return</span> JsonRespanse（<span class="built_in">dict</span>）（默认只能传字典，需要传其他类型需要将safe参数改为<span class="literal">False</span>）</span><br><span class="line">） </span><br></pre></td></tr></table></figure>

<h3 id="FBV与CBVFBV-基于函数的视图"><a href="#FBV与CBVFBV-基于函数的视图" class="headerlink" title="FBV与CBVFBV 基于函数的视图"></a>FBV与CBVFBV 基于函数的视图</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">    FBV使用频率较低(基础阶段)</span><br><span class="line">CBV     基于类的视图</span><br><span class="line">    CBV实际开发项目使用频率较高(高级阶段)</span><br><span class="line">views.py视图层</span><br><span class="line">    视图函数</span><br><span class="line">        不仅仅可以是函数也可以是类</span><br><span class="line">            <span class="number">1.</span>面向过程式编程</span><br><span class="line">            <span class="number">2.</span>面向对象式编程</span><br><span class="line">       </span><br><span class="line"><span class="comment"># FBV</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment"># CBV</span></span><br><span class="line">视图层代码</span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mylogin</span>(<span class="params">View</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self,request</span>):</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;get方法&#x27;</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self,request</span>):</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;post方法&#x27;</span>)</span><br><span class="line">路由层代码</span><br><span class="line">url(<span class="string">r&#x27;^login/&#x27;</span>, views.Mylogin.as_view())</span><br><span class="line">========================================================</span><br><span class="line"> CBV：</span><br><span class="line">    url(<span class="string">r&#x27;^index/&#x27;</span>,views.类名.as_view())</span><br><span class="line"></span><br><span class="line"> FBV:    </span><br><span class="line"></span><br><span class="line">    url(r^index/<span class="string">&#x27;,views.视图函数名)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   1：as_view()里面返回了一个view函数（所以CBV本质也是FBV）</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   2：匹配路由调用view时，view里面生成了一个当前类（自己写的类）的对象，并返回了一个dispatch方法</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   3：dispatch方法里判断了当前请求的格式并将其变形成全小写的字符串，再判断当前请求格式是否合法，如果合法，就将该字符串通过反射方法将其调用并返回（get、post）---&gt; def get:.../def post:...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">CBV的本质也是和FBV一样，都是路由+视图函数内存地址</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">=====================================</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">CBV添加装饰器的三种方式：(先导入method_decorader模块)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1：放方法头上（指名道姓）</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2：放他父类头上（可针对性的加装饰器，扩展性强）</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3：重写dispatch方法（放dispatch头上）（作用于所有方法）</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">FBV：导入：from django.view.decorators.csrf import csrf_protect,csrf_exempt</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">csrf_protect：需要校验</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">csrf_exempt：忽视校验</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">正常添加装饰器即可</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">CBV：csrf_protect：可以正常按CBV三种添加方式</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     csrf_exempt：只能在dispath上加装饰器</span></span><br></pre></td></tr></table></figure>



<h3 id="CBV源码"><a href="#CBV源码" class="headerlink" title="CBV源码"></a>CBV源码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切入点</span></span><br><span class="line">url(<span class="string">r&#x27;^login/&#x27;</span>, views.Mylogin.as_view())</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;类名点名字还加括号  名字要么是绑定给类的方法 要么是无参函数&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>as_view()绑定给类的方法</span><br><span class="line"><span class="meta">    @classonlymethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">as_view</span>(<span class="params">cls, **initkwargs</span>)</span></span><br><span class="line"><span class="function">2.<span class="title">CBV</span>路由匹配本质与<span class="title">FBV</span>一致</span></span><br><span class="line"><span class="function">    # <span class="title">CBV</span></span></span><br><span class="line"><span class="function">    <span class="title">url</span>(<span class="params"><span class="string">r&#x27;^login/&#x27;</span>, views.Mylogin.as_view(<span class="params"></span>)</span>)</span></span><br><span class="line"><span class="function">    # <span class="title">CBV</span>本质</span></span><br><span class="line"><span class="function">    # <span class="title">url</span>(<span class="params"><span class="string">r&#x27;^login/&#x27;</span>, views.view</span>)</span></span><br><span class="line"><span class="function">3.匹配成功之后执行<span class="title">view</span>函数代码</span></span><br><span class="line"><span class="function">    <span class="title">def</span> <span class="title">view</span>(<span class="params">request, *args, **kwargs</span>):</span></span><br><span class="line">         self = cls(**initkwargs)</span><br><span class="line">         <span class="keyword">return</span> self.dispatch(request, *args, **kwargs)</span><br><span class="line"><span class="number">4.</span>查看dispatch方法(对象查找属性和方法一定要严格按照顺序来)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dispatch</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="comment"># 判断当前请求方法是否符合八个默认的请求方法中</span></span><br><span class="line">        <span class="comment"># 1.get</span></span><br><span class="line">        <span class="keyword">if</span> request.method.lower() <span class="keyword">in</span> self.http_method_names:</span><br><span class="line">            <span class="comment"># getattr(对象,&#x27;get&#x27;,&#x27;拿不到的报错信息&#x27;)  &gt;&gt;&gt; Mylogin里面的get方法</span></span><br><span class="line">            handler = <span class="built_in">getattr</span>(self, request.method.lower(), self.http_method_not_allowed)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            handler = self.http_method_not_allowed</span><br><span class="line">        <span class="keyword">return</span> handler(request, *args, **kwargs)  <span class="comment"># get(request,...)</span></span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p><img src="https://img2020.cnblogs.com/blog/2342210/202106/2342210-20210602210244572-1235900068.png" alt="img"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">池劲涛</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
