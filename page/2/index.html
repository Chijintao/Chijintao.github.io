<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","version":"8.6.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta property="og:type" content="website">
<meta property="og:title" content="池劲涛的博客">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="池劲涛的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="池劲涛">
<meta property="article:tag" content="Python Linux Vue">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>池劲涛的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">池劲涛的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="池劲涛"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">池劲涛</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">67</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/02/17/MySQL%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%A4%9A%E8%A1%A8%E8%BF%9E%E6%8E%A5%E4%B8%8E%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/02/17/MySQL%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%A4%9A%E8%A1%A8%E8%BF%9E%E6%8E%A5%E4%B8%8E%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2/" class="post-title-link" itemprop="url">MySQL基础之多表连接与多表查询</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-02-17 07:20:25" itemprop="dateCreated datePublished" datetime="2020-02-17T07:20:25+08:00">2020-02-17</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-03-01 12:22:34" itemprop="dateModified" datetime="2020-03-01T12:22:34+08:00">2020-03-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MySQL%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">MySQL系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="内容概要"><a href="#内容概要" class="headerlink" title="内容概要"></a>内容概要</h1><ul>
<li>查询关键字</li>
<li>多表查询的思想</li>
<li>子查询</li>
<li>连表操作</li>
<li>Navicat可视化软件</li>
<li>鼠标点点点完成数据库的操作(内部还是SQL语句)</li>
<li>多表查询练习题(重点)</li>
</ul>
<h1 id="内容详细"><a href="#内容详细" class="headerlink" title="内容详细"></a>内容详细</h1><h2 id="查询关键字"><a href="#查询关键字" class="headerlink" title="查询关键字"></a>查询关键字</h2><h3 id="表准备"><a href="#表准备" class="headerlink" title="表准备"></a>表准备</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">create table emp(</span><br><span class="line">  <span class="built_in">id</span> <span class="built_in">int</span> primary key auto_increment,</span><br><span class="line">  name varchar(<span class="number">20</span>) <span class="keyword">not</span> null,</span><br><span class="line">  sex enum(<span class="string">&#x27;male&#x27;</span>,<span class="string">&#x27;female&#x27;</span>) <span class="keyword">not</span> null default <span class="string">&#x27;male&#x27;</span>, <span class="comment">#大部分是男的</span></span><br><span class="line">  age <span class="built_in">int</span>(<span class="number">3</span>) unsigned <span class="keyword">not</span> null default <span class="number">28</span>,</span><br><span class="line">  hire_date date <span class="keyword">not</span> null,</span><br><span class="line">  post varchar(<span class="number">50</span>),</span><br><span class="line">  post_comment varchar(<span class="number">100</span>),</span><br><span class="line">  salary double(<span class="number">15</span>,<span class="number">2</span>),</span><br><span class="line">  office <span class="built_in">int</span>, <span class="comment">#一个部门一个屋子</span></span><br><span class="line">  depart_id <span class="built_in">int</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">#插入记录</span></span><br><span class="line"><span class="comment">#三个部门：教学，销售，运营</span></span><br><span class="line">insert into emp(name,sex,age,hire_date,post,salary,office,depart_id) values</span><br><span class="line">(<span class="string">&#x27;jason&#x27;</span>,<span class="string">&#x27;male&#x27;</span>,<span class="number">18</span>,<span class="string">&#x27;20170301&#x27;</span>,<span class="string">&#x27;张江第一帅形象代言&#x27;</span>,<span class="number">7300.33</span>,<span class="number">401</span>,<span class="number">1</span>), <span class="comment">#以下是教学部</span></span><br><span class="line">(<span class="string">&#x27;tom&#x27;</span>,<span class="string">&#x27;male&#x27;</span>,<span class="number">78</span>,<span class="string">&#x27;20150302&#x27;</span>,<span class="string">&#x27;teacher&#x27;</span>,<span class="number">1000000.31</span>,<span class="number">401</span>,<span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;kevin&#x27;</span>,<span class="string">&#x27;male&#x27;</span>,<span class="number">81</span>,<span class="string">&#x27;20130305&#x27;</span>,<span class="string">&#x27;teacher&#x27;</span>,<span class="number">8300</span>,<span class="number">401</span>,<span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;tony&#x27;</span>,<span class="string">&#x27;male&#x27;</span>,<span class="number">73</span>,<span class="string">&#x27;20140701&#x27;</span>,<span class="string">&#x27;teacher&#x27;</span>,<span class="number">3500</span>,<span class="number">401</span>,<span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;owen&#x27;</span>,<span class="string">&#x27;male&#x27;</span>,<span class="number">28</span>,<span class="string">&#x27;20121101&#x27;</span>,<span class="string">&#x27;teacher&#x27;</span>,<span class="number">2100</span>,<span class="number">401</span>,<span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;jack&#x27;</span>,<span class="string">&#x27;female&#x27;</span>,<span class="number">18</span>,<span class="string">&#x27;20110211&#x27;</span>,<span class="string">&#x27;teacher&#x27;</span>,<span class="number">9000</span>,<span class="number">401</span>,<span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;jenny&#x27;</span>,<span class="string">&#x27;male&#x27;</span>,<span class="number">18</span>,<span class="string">&#x27;19000301&#x27;</span>,<span class="string">&#x27;teacher&#x27;</span>,<span class="number">30000</span>,<span class="number">401</span>,<span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;sank&#x27;</span>,<span class="string">&#x27;male&#x27;</span>,<span class="number">48</span>,<span class="string">&#x27;20101111&#x27;</span>,<span class="string">&#x27;teacher&#x27;</span>,<span class="number">10000</span>,<span class="number">401</span>,<span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;哈哈&#x27;</span>,<span class="string">&#x27;female&#x27;</span>,<span class="number">48</span>,<span class="string">&#x27;20150311&#x27;</span>,<span class="string">&#x27;sale&#x27;</span>,<span class="number">3000.13</span>,<span class="number">402</span>,<span class="number">2</span>),<span class="comment">#以下是销售部门</span></span><br><span class="line">(<span class="string">&#x27;呵呵&#x27;</span>,<span class="string">&#x27;female&#x27;</span>,<span class="number">38</span>,<span class="string">&#x27;20101101&#x27;</span>,<span class="string">&#x27;sale&#x27;</span>,<span class="number">2000.35</span>,<span class="number">402</span>,<span class="number">2</span>),</span><br><span class="line">(<span class="string">&#x27;西西&#x27;</span>,<span class="string">&#x27;female&#x27;</span>,<span class="number">18</span>,<span class="string">&#x27;20110312&#x27;</span>,<span class="string">&#x27;sale&#x27;</span>,<span class="number">1000.37</span>,<span class="number">402</span>,<span class="number">2</span>),</span><br><span class="line">(<span class="string">&#x27;乐乐&#x27;</span>,<span class="string">&#x27;female&#x27;</span>,<span class="number">18</span>,<span class="string">&#x27;20160513&#x27;</span>,<span class="string">&#x27;sale&#x27;</span>,<span class="number">3000.29</span>,<span class="number">402</span>,<span class="number">2</span>),</span><br><span class="line">(<span class="string">&#x27;拉拉&#x27;</span>,<span class="string">&#x27;female&#x27;</span>,<span class="number">28</span>,<span class="string">&#x27;20170127&#x27;</span>,<span class="string">&#x27;sale&#x27;</span>,<span class="number">4000.33</span>,<span class="number">402</span>,<span class="number">2</span>),</span><br><span class="line">(<span class="string">&#x27;僧龙&#x27;</span>,<span class="string">&#x27;male&#x27;</span>,<span class="number">28</span>,<span class="string">&#x27;20160311&#x27;</span>,<span class="string">&#x27;operation&#x27;</span>,<span class="number">10000.13</span>,<span class="number">403</span>,<span class="number">3</span>), <span class="comment">#以下是运营部门</span></span><br><span class="line">(<span class="string">&#x27;程咬金&#x27;</span>,<span class="string">&#x27;male&#x27;</span>,<span class="number">18</span>,<span class="string">&#x27;19970312&#x27;</span>,<span class="string">&#x27;operation&#x27;</span>,<span class="number">20000</span>,<span class="number">403</span>,<span class="number">3</span>),</span><br><span class="line">(<span class="string">&#x27;程咬银&#x27;</span>,<span class="string">&#x27;female&#x27;</span>,<span class="number">18</span>,<span class="string">&#x27;20130311&#x27;</span>,<span class="string">&#x27;operation&#x27;</span>,<span class="number">19000</span>,<span class="number">403</span>,<span class="number">3</span>),</span><br><span class="line">(<span class="string">&#x27;程咬铜&#x27;</span>,<span class="string">&#x27;male&#x27;</span>,<span class="number">18</span>,<span class="string">&#x27;20150411&#x27;</span>,<span class="string">&#x27;operation&#x27;</span>,<span class="number">18000</span>,<span class="number">403</span>,<span class="number">3</span>),</span><br><span class="line">(<span class="string">&#x27;程咬铁&#x27;</span>,<span class="string">&#x27;female&#x27;</span>,<span class="number">18</span>,<span class="string">&#x27;20140512&#x27;</span>,<span class="string">&#x27;operation&#x27;</span>,<span class="number">17000</span>,<span class="number">403</span>,<span class="number">3</span>);</span><br><span class="line"><span class="number">1</span> select</span><br><span class="line">    - 用来指定表的字段数据</span><br><span class="line">    select * <span class="keyword">from</span> emp;</span><br><span class="line">    select <span class="built_in">id</span>,name <span class="keyword">from</span> emp;</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    在工作中很少使用*号 ---&gt; 内容大</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    </span><br><span class="line"><span class="number">2</span> <span class="keyword">from</span></span><br><span class="line">    - 后面跟需要查询的表名</span><br><span class="line">    </span><br><span class="line"><span class="number">3</span> where</span><br><span class="line">    筛选数据</span><br></pre></td></tr></table></figure>

<h2 id="查询关键字之where"><a href="#查询关键字之where" class="headerlink" title="查询关键字之where"></a>查询关键字之where</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1 查询id大于等于3小于等于6的数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 查询薪资是20000或者18000或者17000的数据</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">模糊查询：</span></span><br><span class="line"><span class="string">    关键字 ---&gt; like</span></span><br><span class="line"><span class="string">    关键符号</span></span><br><span class="line"><span class="string">        %：匹配任意个数的任意字符</span></span><br><span class="line"><span class="string">        _：匹配单个个数的任意字符</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3 查询姓名中带有字母o的员工姓名和薪资</span></span><br><span class="line">select name,salary <span class="keyword">from</span> emp where name like <span class="string">&#x27;%o%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4 查询姓名由四个字符组成的员工姓名和薪资</span></span><br><span class="line">select name,salary <span class="keyword">from</span> emp where name like<span class="string">&#x27;____&#x27;</span>;</span><br><span class="line">select name,salary <span class="keyword">from</span> emp where char_length(name) = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5 查询id小于3或者大于6的数据</span></span><br><span class="line">select * <span class="keyword">from</span> emp where <span class="built_in">id</span> &lt; <span class="number">3</span> <span class="keyword">or</span> <span class="built_in">id</span> &gt; <span class="number">6</span>;</span><br><span class="line">select * <span class="keyword">from</span> emp where <span class="built_in">id</span> <span class="keyword">not</span> between <span class="number">3</span> <span class="keyword">and</span> <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6 查询薪资不在20000,18000,17000范围的数据</span></span><br><span class="line">select * <span class="keyword">from</span> emp where salary <span class="keyword">not</span> <span class="keyword">in</span> (<span class="number">20000</span>,<span class="number">18000</span>,<span class="number">17000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7 查询岗位描述为空的员工名与岗位名 针对null不能用&#x27;=&#x27;,只能用is</span></span><br><span class="line">select name,post <span class="keyword">from</span> emp where post_comment = NULL; <span class="comment"># 查询为空</span></span><br><span class="line">select name,post <span class="keyword">from</span> emp where post_comment <span class="keyword">is</span> NULL;</span><br><span class="line">select name,post <span class="keyword">from</span> emp where post_comment <span class="keyword">is</span> <span class="keyword">not</span> NULL;</span><br></pre></td></tr></table></figure>

<h2 id="查询关键字之group-by分组"><a href="#查询关键字之group-by分组" class="headerlink" title="查询关键字之group by分组"></a>查询关键字之group by分组</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">分组 ---&gt; 将单个单个的个体按照指定的条件分成一个个整体</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">分组之后默认只能直接获取分组的依据</span></span><br><span class="line"><span class="string">其他字段无法再直接获取(可以间接获取)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 严格模式</span></span><br><span class="line"><span class="built_in">set</span> <span class="keyword">global</span> sql_mode=<span class="string">&#x27;STRICT_TRANS_TABLES,PAD_CHAR_TO_FULL_LENGTH,only_full_group_by&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1 每个部门的最高薪资</span></span><br><span class="line">select post,<span class="built_in">max</span>(salary) <span class="keyword">from</span> emp group by post;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 每个部门的最低薪资</span></span><br><span class="line">select post,<span class="built_in">min</span>(salary) <span class="keyword">from</span> emp group by post;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3 每个部门的平均薪资</span></span><br><span class="line">select post avg(salary) <span class="keyword">from</span> emp group by post;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4 每个部门的人数</span></span><br><span class="line">select post,count(<span class="built_in">id</span>) <span class="keyword">from</span> emp group by post;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5 每个部门的月工资总和</span></span><br><span class="line">select post,<span class="built_in">sum</span>(salary) fromm emp group by post;</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">可以给字段起别名(as还可以给表起别名)</span></span><br><span class="line"><span class="string">    select post as&#x27;部门&#x27;，sum(salary) as &#x27;总和&#x27; from emp group by post;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6 查询分组之后的部门名称和每个部门下所有的员工姓名</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">group_concat()  ---&gt; 获取分组以外的字段数据，并且支持拼接操作(掌握)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">select post,group_concat(name) from emp group by post;</span></span><br><span class="line"><span class="string">select post,group_concat(name,&#x27;:&#x27;,salary) from emp group by post;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">concat()   ---&gt; 未分组之前使用的拼接功能(了解)</span></span><br><span class="line"><span class="string">select concat(name,&#x27;:&#x27;,sex) from emp;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">concat_ws()    ---&gt; 省步骤(了解)</span></span><br><span class="line"><span class="string">select concat_ws(&#x27;:&#x27;,name,sex,salary,age) from emp</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">分组之后频繁需要使用的</span><br><span class="line">　　　　<span class="built_in">max</span>     最大值</span><br><span class="line">　　　　<span class="built_in">min</span>     最小值　　　　<span class="built_in">sum</span>     求和　　　　count   计数　　　　avg     平均值</span><br></pre></td></tr></table></figure>



<h2 id="查询关键字之having-过滤"><a href="#查询关键字之having-过滤" class="headerlink" title="查询关键字之having(过滤)"></a>查询关键字之having(过滤)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">功能上having与where是一模一样的</span><br><span class="line">但是使用位置上有有所不同</span><br><span class="line">    -where在分组之前使用</span><br><span class="line">    -having在分组之后使用</span><br><span class="line">    </span><br><span class="line"><span class="number">1</span> 统计各部门年龄在<span class="number">30</span>岁以上的员工平均工资，并且保留工资大于<span class="number">10000</span>的部门</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.1 先筛选出所有30岁以上的员工</span></span><br><span class="line">select * <span class="keyword">from</span> emp where age &gt;<span class="number">30</span>;</span><br><span class="line"><span class="comment"># 1.2 然后再按照部门分组</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;SQL语句的查询结果我们也可以直接看成是一张表&#x27;&#x27;&#x27;</span></span><br><span class="line">select post,avg(salary) <span class="keyword">from</span> emp where age &gt;<span class="number">30</span> group by post;</span><br><span class="line"><span class="comment"># 1.3 分组之后再做过滤操作</span></span><br><span class="line">select post,avg(salary) <span class="keyword">from</span> emp</span><br><span class="line">    where age&gt;<span class="number">30</span></span><br><span class="line">    group by post</span><br><span class="line">    having avg(salary)&gt;<span class="number">10000</span></span><br><span class="line">    ;</span><br></pre></td></tr></table></figure>

<h2 id="查询关键字之distinct-去重"><a href="#查询关键字之distinct-去重" class="headerlink" title="查询关键字之distinct(去重)"></a>查询关键字之distinct(去重)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">去重有一个非常严格的前提条件 数据必须是完全一样</span><br><span class="line">    如果数据带有主键name肯定无法去重</span><br><span class="line">    select distinct age <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>



<h2 id="查询关键字之order-by-排序"><a href="#查询关键字之order-by-排序" class="headerlink" title="查询关键字之order by(排序)"></a>查询关键字之order by(排序)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">select * <span class="keyword">from</span> emp order by salary; <span class="comment"># 默认是升序</span></span><br><span class="line">select * <span class="keyword">from</span> emp order by salary asc; <span class="comment"># 升序关键字(可不写)</span></span><br><span class="line">select * <span class="keyword">from</span> emp order by salary desc; <span class="comment"># 降序</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 排序也可以指定多个字段</span></span><br><span class="line">select <span class="keyword">from</span> emp order by age desc,salary asc;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计各部门年龄在10岁以上的员工平均工资，并且保留平均工资大于1000的部门，然后对平均工资进行排序</span></span><br><span class="line">select post,avg(salary) <span class="keyword">from</span> emp</span><br><span class="line">    where age &gt; <span class="number">10</span></span><br><span class="line">    group by post</span><br><span class="line">    having avg(salary)&gt;<span class="number">1000</span></span><br><span class="line">    order by avg(salary);</span><br></pre></td></tr></table></figure>

<h2 id="查询关键字之limit-分页"><a href="#查询关键字之limit-分页" class="headerlink" title="查询关键字之limit(分页)"></a>查询关键字之limit(分页)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">用来限制数据的展示条数</span><br><span class="line">select * <span class="keyword">from</span> emp limit <span class="number">5</span>;<span class="comment"># 前五条</span></span><br><span class="line">select * <span class="keyword">from</span> emp limit <span class="number">5</span>,<span class="number">5</span>; <span class="comment"># 起始位置、条数</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询工资最高的人的详细信息</span></span><br><span class="line">    <span class="comment"># 1 先按照工资排序，然后限制展示条数</span></span><br><span class="line">    select * <span class="keyword">from</span> emp order by salary desc limit <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h2 id="查询关键字之regexp正则"><a href="#查询关键字之regexp正则" class="headerlink" title="查询关键字之regexp正则"></a>查询关键字之regexp正则</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">正则表达式</span><br><span class="line">    用一些特殊符号的组合去字符串中筛选出符合条件的数据</span><br><span class="line">    </span><br><span class="line">select * <span class="keyword">from</span> emp where name regexp <span class="string">&#x27;^j.*(n|y)$&#x27;</span>;</span><br><span class="line"><span class="comment"># &#x27;^j.*(n|y)$&#x27;  j开头 中间无所谓 n或者y结尾</span></span><br></pre></td></tr></table></figure>

<h2 id="多表查询思想"><a href="#多表查询思想" class="headerlink" title="多表查询思想"></a>多表查询思想</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 子查询</span><br><span class="line">    分步解决问题</span><br><span class="line">    将一条SQL语句的查询结果用括号括起来，当做另一条SQL语句的查询条件</span><br><span class="line">    </span><br><span class="line"><span class="number">2</span> 连表操作</span><br><span class="line">    先将所有需要用到的表拼接到一起(一张表)</span><br><span class="line">    然后就是转换成单表查询</span><br></pre></td></tr></table></figure>



<h2 id="前期表准备"><a href="#前期表准备" class="headerlink" title="前期表准备"></a>前期表准备</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#建表</span></span><br><span class="line">create table dep(</span><br><span class="line"><span class="built_in">id</span> <span class="built_in">int</span> primary key auto_increment,</span><br><span class="line">name varchar(<span class="number">20</span>) </span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">create table emp(</span><br><span class="line"><span class="built_in">id</span> <span class="built_in">int</span> primary key auto_increment,</span><br><span class="line">name varchar(<span class="number">20</span>),</span><br><span class="line">sex enum(<span class="string">&#x27;male&#x27;</span>,<span class="string">&#x27;female&#x27;</span>) <span class="keyword">not</span> null default <span class="string">&#x27;male&#x27;</span>,</span><br><span class="line">age <span class="built_in">int</span>,</span><br><span class="line">dep_id <span class="built_in">int</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">#插入数据</span></span><br><span class="line">insert into dep values</span><br><span class="line">(<span class="number">200</span>,<span class="string">&#x27;技术&#x27;</span>),</span><br><span class="line">(<span class="number">201</span>,<span class="string">&#x27;人力资源&#x27;</span>),</span><br><span class="line">(<span class="number">202</span>,<span class="string">&#x27;销售&#x27;</span>),</span><br><span class="line">(<span class="number">203</span>,<span class="string">&#x27;运营&#x27;</span>);</span><br><span class="line"></span><br><span class="line">insert into emp(name,sex,age,dep_id) values</span><br><span class="line">(<span class="string">&#x27;jason&#x27;</span>,<span class="string">&#x27;male&#x27;</span>,<span class="number">18</span>,<span class="number">200</span>),</span><br><span class="line">(<span class="string">&#x27;egon&#x27;</span>,<span class="string">&#x27;female&#x27;</span>,<span class="number">48</span>,<span class="number">201</span>),</span><br><span class="line">(<span class="string">&#x27;kevin&#x27;</span>,<span class="string">&#x27;male&#x27;</span>,<span class="number">18</span>,<span class="number">201</span>),</span><br><span class="line">(<span class="string">&#x27;nick&#x27;</span>,<span class="string">&#x27;male&#x27;</span>,<span class="number">28</span>,<span class="number">202</span>),</span><br><span class="line">(<span class="string">&#x27;owen&#x27;</span>,<span class="string">&#x27;male&#x27;</span>,<span class="number">18</span>,<span class="number">203</span>),</span><br><span class="line">(<span class="string">&#x27;jerry&#x27;</span>,<span class="string">&#x27;female&#x27;</span>,<span class="number">18</span>,<span class="number">204</span>);</span><br></pre></td></tr></table></figure>

<h2 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询Jason所在的部门名称</span></span><br><span class="line">    <span class="comment"># 第一步 先获取Jason所在的部门id</span></span><br><span class="line">    select dep_id <span class="keyword">from</span> emp where name=<span class="string">&#x27;jason&#x27;</span>;</span><br><span class="line">    <span class="comment"># 第二步 根据id号去部门表中筛选</span></span><br><span class="line">    select * <span class="keyword">from</span> dep where <span class="built_in">id</span> = <span class="number">200</span>;</span><br><span class="line">    <span class="comment"># 完整句式</span></span><br><span class="line">    select * <span class="keyword">from</span> dep where <span class="built_in">id</span> = (select dep_id <span class="keyword">from</span> emp where name=<span class="string">&#x27;jason&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="连表操作"><a href="#连表操作" class="headerlink" title="连表操作"></a>连表操作</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 前戏(了解)</span></span><br><span class="line">select * <span class="keyword">from</span> emp,dep;</span><br><span class="line"><span class="comment"># 基于上表筛选数据(了解)</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;为了避免字段冲突 可以在字段名前面加表明确&#x27;&#x27;&#x27;</span></span><br><span class="line">    select * <span class="keyword">from</span> emp,dep where emp.dep_id = dep.<span class="built_in">id</span>;</span><br><span class="line">    </span><br><span class="line">--------------------------------------- 掌握 -------------------------------------------</span><br><span class="line">inner join   ---  内连接  拼接公共的部分</span><br><span class="line">    select * <span class="keyword">from</span> emp inner join dep on emp.dep_id = dep.<span class="built_in">id</span>;</span><br><span class="line">left join    ---  左连接 以左表为基准展示所有数据 没有的null填充  (用得少)</span><br><span class="line">    select * <span class="keyword">from</span> emp left join dep on emp.dep_id=dep.<span class="built_in">id</span>;</span><br><span class="line">right join     ---  右连接 以右表为基准展示所有数据 没有的null填充  (用得少)      </span><br><span class="line">    select * <span class="keyword">from</span> emp right join dep on emp.dep_id=dep.<span class="built_in">id</span>;</span><br><span class="line">union    全连接</span><br><span class="line">    select * <span class="keyword">from</span> emp left join dep on emp.dep_id=dep.<span class="built_in">id</span></span><br><span class="line">    union</span><br><span class="line">    select * <span class="keyword">from</span> emp right join dep on emp.dep_id=dep.<span class="built_in">id</span>;</span><br></pre></td></tr></table></figure>

<h2 id="Navicat可视化软件"><a href="#Navicat可视化软件" class="headerlink" title="Navicat可视化软件"></a>Navicat可视化软件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">可以充当很多数据库软件的客户端 封装了很多快捷方法</span><br><span class="line"></span><br><span class="line">该软件默认也是收费的 需要破解</span><br><span class="line">正版不破解免费试用<span class="number">14</span>天</span><br><span class="line">破解版(老版本):https://pan.baidu.com/s/1bpo5mqj</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>下载与安装</span><br><span class="line"><span class="number">2.</span>使用方法</span><br><span class="line">	创建库 表 记录</span><br><span class="line">    	注意主键</span><br><span class="line">     外键字段</span><br><span class="line">    逆向数据库到模型</span><br><span class="line">    转储SQL文件</span><br><span class="line">  	查询</span><br></pre></td></tr></table></figure>



<h2 id="多表查询练习题"><a href="#多表查询练习题" class="headerlink" title="多表查询练习题"></a>多表查询练习题</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、 查询所有的课程的名称以及对应的任课老师姓名</span><br><span class="line"><span class="number">4</span>、 查询平均成绩大于八十分的同学的姓名和平均成绩</span><br><span class="line"><span class="number">7</span>、 查询没有报李平老师课的学生姓名</span><br><span class="line"><span class="number">8</span>、 查询没有同时选修物理课程和体育课程的学生姓名</span><br><span class="line"><span class="number">9</span>、 查询挂科超过两门(包括两门)的学生姓名和班级</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#####################关键字习惯都用大写#######################</span></span><br><span class="line"><span class="comment"># 建议:在书写SQL语句的时候一定不要想着一次性成功 写一点看一点再写一点  慢慢拼凑起来</span></span><br><span class="line">-- <span class="number">1</span>、 查询所有的课程的名称以及对应的任课老师姓名</span><br><span class="line"><span class="comment"># 1.先明确需要的表    course表 teacher表</span></span><br><span class="line">--     select * <span class="keyword">from</span> course;</span><br><span class="line">--     select * <span class="keyword">from</span> teacher;</span><br><span class="line"><span class="comment"># 2.连表操作 明确字段</span></span><br><span class="line">-- SELECT</span><br><span class="line">--     course.cname,</span><br><span class="line">--     teacher.tname</span><br><span class="line">-- FROM</span><br><span class="line">--     course</span><br><span class="line">--     INNER JOIN teacher ON course.teacher_id = teacher.tid;</span><br><span class="line">-- <span class="number">4</span>、 查询平均成绩大于八十分的同学的姓名和平均成绩</span><br><span class="line"><span class="comment"># 1.先查看成绩表 </span></span><br><span class="line">--     select * <span class="keyword">from</span> score;</span><br><span class="line"><span class="comment"># 2.求所有学生的平均成绩</span></span><br><span class="line">--     select score.student_id,avg(num) <span class="keyword">from</span> score group by score.student_id;</span><br><span class="line"><span class="comment"># 3.筛选出大于80分</span></span><br><span class="line">--     select score.student_id,avg(num) <span class="keyword">as</span> <span class="string">&#x27;avg_num&#x27;</span> <span class="keyword">from</span> score group by score.student_id having avg(num)&gt;<span class="number">80</span></span><br><span class="line">--     ;</span><br><span class="line"><span class="comment"># 4.学生表与上述查询出来的表连接</span></span><br><span class="line">-- SELECT</span><br><span class="line">--     student.sname,</span><br><span class="line">--     t1.avg_num </span><br><span class="line">-- FROM</span><br><span class="line">--     student</span><br><span class="line">--     INNER JOIN ( SELECT score.student_id, avg( num ) AS <span class="string">&#x27;avg_num&#x27;</span> FROM score GROUP BY score.student_id HAVING avg( num )&gt; <span class="number">80</span> ) AS t1 ON student.sid = t1.student_id;</span><br><span class="line">-- <span class="number">7</span>、 查询没有报李平老师课的学生姓名</span><br><span class="line"><span class="comment"># 1.正向思路:课下可以尝试一下</span></span><br><span class="line"><span class="comment"># 2.反向思路:先找所有报了李平老师课程的学生 再取反</span></span><br><span class="line"><span class="comment"># 1.先查询李平老师教授的课程id号</span></span><br><span class="line">-- select tid <span class="keyword">from</span> teacher WHERE tname=<span class="string">&#x27;李平老师&#x27;</span>;</span><br><span class="line">-- select cid <span class="keyword">from</span> course where teacher_id <span class="keyword">in</span> (select tid <span class="keyword">from</span> teacher WHERE tname=<span class="string">&#x27;李平老师&#x27;</span>);</span><br><span class="line"><span class="comment"># 2.去成绩表中筛选出所有报了李平老师课程的学生id号</span></span><br><span class="line">-- select distinct student_id <span class="keyword">from</span> score where course_id <span class="keyword">in</span> (select cid <span class="keyword">from</span> course where teacher_id <span class="keyword">in</span> (select tid <span class="keyword">from</span> teacher WHERE tname=<span class="string">&#x27;李平老师&#x27;</span>)); </span><br><span class="line"><span class="comment"># 3.去学生表中 取反获取没有报李平老师课程的学生姓名</span></span><br><span class="line">-- SELECT</span><br><span class="line">--     sname </span><br><span class="line">-- FROM</span><br><span class="line">--     student </span><br><span class="line">-- WHERE</span><br><span class="line">--     sid NOT IN (</span><br><span class="line">--     SELECT DISTINCT</span><br><span class="line">--         student_id </span><br><span class="line">--     FROM</span><br><span class="line">--         score </span><br><span class="line">--     WHERE</span><br><span class="line">--         course_id IN (</span><br><span class="line">--         SELECT</span><br><span class="line">--             cid </span><br><span class="line">--         FROM</span><br><span class="line">--             course </span><br><span class="line">--         WHERE</span><br><span class="line">--         teacher_id IN ( SELECT tid FROM teacher WHERE tname = <span class="string">&#x27;李平老师&#x27;</span> )));</span><br><span class="line">-- <span class="number">8</span>、 查询没有同时选修物理课程和体育课程的学生姓名(只要报了一门的 两门和都不报都不要)</span><br><span class="line"><span class="comment"># 1.先查询物理 和 体育课程的id号</span></span><br><span class="line">--     select cid <span class="keyword">from</span> course where cname <span class="keyword">in</span> (<span class="string">&#x27;物理&#x27;</span>,<span class="string">&#x27;体育&#x27;</span>);</span><br><span class="line"><span class="comment"># 2.去成绩表中先筛选出所有报了课程的数据(报了一门 报了两门)</span></span><br><span class="line">-- select * <span class="keyword">from</span> score where course_id <span class="keyword">in</span> (select cid <span class="keyword">from</span> course where cname <span class="keyword">in</span> (<span class="string">&#x27;物理&#x27;</span>,<span class="string">&#x27;体育&#x27;</span>));</span><br><span class="line"><span class="comment"># 3.按照学生id分组 统计每个学生报了的课程数目</span></span><br><span class="line">-- select student_id <span class="keyword">from</span> score where course_id <span class="keyword">in</span> (select cid <span class="keyword">from</span> course where cname <span class="keyword">in</span> (<span class="string">&#x27;物理&#x27;</span>,<span class="string">&#x27;体育&#x27;</span>))</span><br><span class="line">--     group by student_id</span><br><span class="line">--     having count(course_id) = <span class="number">1</span></span><br><span class="line">-- ;</span><br><span class="line"><span class="comment"># 4.去学生表中根据id获取学生姓名</span></span><br><span class="line">-- SELECT</span><br><span class="line">--     sname </span><br><span class="line">-- FROM</span><br><span class="line">--     student </span><br><span class="line">-- WHERE</span><br><span class="line">--     sid IN (</span><br><span class="line">--     SELECT</span><br><span class="line">--         student_id </span><br><span class="line">--     FROM</span><br><span class="line">--         score </span><br><span class="line">--     WHERE</span><br><span class="line">--         course_id IN (</span><br><span class="line">--         SELECT</span><br><span class="line">--             cid </span><br><span class="line">--         FROM</span><br><span class="line">--             course </span><br><span class="line">--         WHERE</span><br><span class="line">--         cname IN ( <span class="string">&#x27;物理&#x27;</span>, <span class="string">&#x27;体育&#x27;</span> ))</span><br><span class="line">--     group by student_id</span><br><span class="line">--     having count(course_id) = <span class="number">1</span>);</span><br><span class="line">-- <span class="number">9</span>、 查询挂科超过两门(包括两门)的学生姓名和班级</span><br><span class="line"><span class="comment"># 1.先去成绩表中 筛选出分数小于60分的数据</span></span><br><span class="line">-- select * <span class="keyword">from</span> score where num&lt;<span class="number">60</span>;</span><br><span class="line"><span class="comment"># 2.按照学生id分组 然后统计个数</span></span><br><span class="line">-- select student_id <span class="keyword">from</span> score where num&lt;<span class="number">60</span> group by student_id</span><br><span class="line">--     having count(num) &gt;= <span class="number">2</span></span><br><span class="line">-- ;</span><br><span class="line"><span class="comment"># 3.将班级表与学生表拼接起来</span></span><br><span class="line">SELECT</span><br><span class="line">    <span class="keyword">class</span>.caption,</span><br><span class="line">    student.sname </span><br><span class="line">FROM</span><br><span class="line">    <span class="class"><span class="keyword">class</span></span></span><br><span class="line"><span class="class">    <span class="title">INNER</span> <span class="title">JOIN</span> <span class="title">student</span> <span class="title">ON</span> <span class="title">class</span>.<span class="title">cid</span> = <span class="title">student</span>.<span class="title">class_id</span> </span></span><br><span class="line"><span class="class"><span class="title">WHERE</span></span></span><br><span class="line"><span class="class">    <span class="title">student</span>.<span class="title">sid</span> <span class="title">IN</span> (<span class="params"> SELECT student_id FROM score WHERE num &lt; <span class="number">60</span> GROUP BY student_id HAVING count(<span class="params"> num </span>) &gt;= <span class="number">2</span> </span>);</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/02/11/MySQL%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%88%9D%E8%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/02/11/MySQL%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%88%9D%E8%AF%86/" class="post-title-link" itemprop="url">MySQL基础之数据库初识</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-02-11 07:20:25" itemprop="dateCreated datePublished" datetime="2020-02-11T07:20:25+08:00">2020-02-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-03-01 12:22:34" itemprop="dateModified" datetime="2020-03-01T12:22:34+08:00">2020-03-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MySQL%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">MySQL系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="数据库前戏"><a href="#数据库前戏" class="headerlink" title="数据库前戏"></a>数据库前戏</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">储存数据</span><br><span class="line"></span><br><span class="line"><span class="number">1</span> 文件：</span><br><span class="line">    文件地址与数据格式杂乱(每个人都可以按自己的格式来存) 例如：</span><br><span class="line">    user:xxx:age:xxx</span><br><span class="line">    user.xxx.age.xxx</span><br><span class="line">    user-xxx-age-xxx</span><br><span class="line">    从而出现↓↓↓</span><br><span class="line"></span><br><span class="line"><span class="number">2</span> 软件开发目录规范：</span><br><span class="line">    规定了数据存储的位置，例如：</span><br><span class="line">    <span class="built_in">bin</span>：启动文件</span><br><span class="line">    conf：配置文件</span><br><span class="line">    core：核心逻辑代码文件</span><br><span class="line">    db：数据文件</span><br><span class="line">    log：日志文件</span><br><span class="line">    lib：公共模块文件</span><br><span class="line">    ...</span><br><span class="line">    (现在还是自己和自己玩，每个人的数据都自己储存---&gt;单机游戏)</span><br><span class="line">    接着出现↓↓↓</span><br><span class="line">    </span><br><span class="line"><span class="number">3</span> 数据库：</span><br><span class="line">    实现了数据共享，每个人的数据都储存在一个数据库里---&gt;网络游戏</span><br><span class="line">    但是存在安全问题---&gt;所有人的数据都放在一个数据库里，这个数据库没了，所有人的数据就都没了</span><br><span class="line">    所以出现了---&gt;数据库集群 图解↓↓↓</span><br><span class="line">    (从原先一个数据库存储数据到现在每收到一份数据，就往其他所以数据库发送一份数据，这样一个数据库没了，还有其他数据库，从而避免了一个数据库挂了，所有数据陪葬的问题)</span><br></pre></td></tr></table></figure>

<p><img src="https://img2020.cnblogs.com/blog/2342210/202106/2342210-20210616212931824-1569182429.png" alt="img"></p>
<h2 id="数据库分类"><a href="#数据库分类" class="headerlink" title="数据库分类"></a>数据库分类</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">数据库本质就是一款cs架构软件(client---&gt;客户端，server---&gt;服务端)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">数据库相关软件：</span><br><span class="line">        <span class="number">1</span> 关系型数据库：(记)</span><br><span class="line">        固定表结构并且表与表之间可以建关系</span><br><span class="line">        常见软件：mysql --- postgresql---sqlite---db2---oracle---access---sql server</span><br><span class="line">        </span><br><span class="line">        <span class="number">2</span> 非关系型数据库：(记)</span><br><span class="line">        没有固定表结构并且储存数据以key value键值对的形式(类似字典)</span><br><span class="line">        常见软件：MongoDB---redis---memcache(逐渐淘汰)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="MySQL简介"><a href="#MySQL简介" class="headerlink" title="MySQL简介"></a>MySQL简介</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">MySQL本质上也是一款基于网络通信的应用程序</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">任何基于网络通信的软件底层肯定都是socket</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        服务端</span><br><span class="line">    基于socket通信</span><br><span class="line">    本地文件操作</span><br><span class="line">    解析指令(SQL语句)</span><br><span class="line">    </span><br><span class="line">        客户端</span><br><span class="line">    基于socket通信</span><br><span class="line">    发送指令</span><br><span class="line">    解析指令(SQL语句)</span><br><span class="line">    </span><br><span class="line">SQL语句的由来：</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">mysql不单单支持mysql客户端操作，也支持其他编程语言来操作</span></span><br><span class="line"><span class="string">    python、Java、php、c++、go...</span></span><br><span class="line"><span class="string">    这些编程语言语法都不一样，mysql如何做到兼容↓↓↓</span></span><br><span class="line"><span class="string">    两种思路</span></span><br><span class="line"><span class="string">        1 自己精通多种语言，自由切换(不现实，且切换也需要耗费资源)</span></span><br><span class="line"><span class="string">        2 统一的思想(采用统一的一种语言---&gt;sql语句)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>



<h2 id="重要概念介绍"><a href="#重要概念介绍" class="headerlink" title="重要概念介绍"></a>重要概念介绍</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">库    ------&gt;    文件夹</span></span><br><span class="line"><span class="string">表    ------&gt;    文件夹里的文件</span></span><br><span class="line"><span class="string">记录  ------&gt;     文件内一行行的数据</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">表头      ---&gt;      表格的第一行数据</span></span><br><span class="line"><span class="string">字段      ---&gt;      字段名 + 字段类型</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>



<h2 id="下载与安装"><a href="#下载与安装" class="headerlink" title="下载与安装"></a>下载与安装</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 版本问题</span><br><span class="line">    <span class="number">5.6</span>(主流，逐渐向 <span class="number">5.7</span> 过度)</span><br><span class="line">    <span class="number">5.7</span>(主流)</span><br><span class="line">    <span class="number">8.0</span>(最新版，一般不采用最新版本)</span><br><span class="line"></span><br><span class="line"><span class="number">2</span> 下载</span><br><span class="line">    官网 ---&gt; 选择版本 ---&gt; 下载压缩包 ---&gt; 解压安装</span><br></pre></td></tr></table></figure>



<h2 id="系统服务配置"><a href="#系统服务配置" class="headerlink" title="系统服务配置"></a>系统服务配置</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 环境变量添加</span><br><span class="line">    我的电脑 ---&gt; 属性 ---&gt; 高级配置 ---&gt; 环境变量 ---&gt; path ---&gt; 将<span class="built_in">bin</span>目录路径添加进去</span><br><span class="line">    </span><br><span class="line"><span class="number">2</span> 系统服务制作(全部在管理员身份下操作)</span><br><span class="line">        <span class="comment"># 初始化(5.7之前需要先初始化)</span></span><br><span class="line">        mysqld --initialize-insecure</span><br><span class="line">        <span class="comment"># 查看系统服务</span></span><br><span class="line">        services.msc</span><br><span class="line">        <span class="comment"># 制作成系统服务</span></span><br><span class="line">        mysqld --install</span><br><span class="line">        <span class="comment"># 启动服务</span></span><br><span class="line">        net start mysql</span><br><span class="line">        <span class="comment"># 停止服务          </span></span><br><span class="line">        net stop mysql</span><br><span class="line">        ps(windows操作系统上没有重启mysql服务的命令，如果需要重启服务，只能先stop再start)</span><br></pre></td></tr></table></figure>



<h2 id="用户登录"><a href="#用户登录" class="headerlink" title="用户登录"></a>用户登录</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 管理员初次登录无需密码</span></span><br><span class="line">mysql -u用户名 -p密码 ---&gt; 密码可以换行再输入，会将输入的密码隐藏成*****，如果在-p后直接输入密码，则是明文</span><br><span class="line"></span><br><span class="line"><span class="comment"># 游客模式</span></span><br><span class="line">直接输入mysql 则进入游客模式，有很多限制</span><br><span class="line"></span><br><span class="line"><span class="comment"># 忘记密码</span></span><br><span class="line">    <span class="number">1</span> 跳过授权表启动</span><br><span class="line">    mysqld --skip-grant-tables</span><br><span class="line">    <span class="number">2</span> 无密码登录</span><br><span class="line">    mysql -uroot -p</span><br><span class="line">    <span class="number">3</span> 修改用户密码(修改对应用户的密码)</span><br><span class="line">    update mysql.user <span class="built_in">set</span> password=password(新密码) where user=<span class="string">&quot;root&quot;</span> <span class="keyword">and</span> host=<span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">    <span class="number">4</span> 退出正常启动</span><br></pre></td></tr></table></figure>

<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql默认配置文件my-default.ini不能修改</span><br><span class="line">自己创建并命名my.ini</span><br><span class="line"><span class="comment"># \s 查看基本信息</span></span><br><span class="line"></span><br><span class="line">my.ini文件内容 ---&gt; 将字符编码改成utf8，Windows默认gbk</span><br><span class="line">[mysqld]</span><br><span class="line">character-<span class="built_in">set</span>-server=utf8</span><br><span class="line">collation-server=utf8_general_ci</span><br><span class="line">[client]</span><br><span class="line">default-character-<span class="built_in">set</span>=utf8</span><br><span class="line">[mysql]</span><br><span class="line">default-character-<span class="built_in">set</span>=utf8</span><br></pre></td></tr></table></figure>

<h2 id="基本SQL语句"><a href="#基本SQL语句" class="headerlink" title="基本SQL语句"></a>基本SQL语句</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-------------------------------- 库的增删改查 -----------------------------------------</span><br><span class="line"><span class="comment"># 增：</span></span><br><span class="line">create database 库名(文件夹名)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 改</span></span><br><span class="line">alter database 库名(文件夹名) charset=<span class="string">&#x27;gbk&#x27;</span>;</span><br><span class="line">alter database ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查</span></span><br><span class="line">show database；</span><br><span class="line">show create database db1(按创建的库名查)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删</span></span><br><span class="line">drop database 库名(文件夹名);</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">--------------------------------- 表的增删改查 --------------------------------------</span><br><span class="line">注意：要先切换到需要操作的库里(文件夹里)---&gt;use 库名(文件夹名)</span><br><span class="line">查看当前所在的库(文件夹)：select database();</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增：</span></span><br><span class="line">create table 表名(文件名) (<span class="built_in">id</span> <span class="built_in">int</span>,name char(<span class="number">4</span>)); <span class="comment"># 创建出来的可能是多个文件，解耦管理</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 改</span></span><br><span class="line">alter table 表名 modify name char(<span class="number">16</span>); <span class="comment"># 更改名字的最大字符长度</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查</span></span><br><span class="line">show tables; <span class="comment"># 查所有表</span></span><br><span class="line">show create table 表名; <span class="comment"># 根据表名查看该表的详细信息</span></span><br><span class="line">describe 表名; == desc 表名; <span class="comment"># 根据表名查看该表的表结构</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删</span></span><br><span class="line">drop table 表名;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">----------------------------------- 记录的增删改查 -------------------------------------</span><br><span class="line"><span class="comment"># 增</span></span><br><span class="line">insert into 库名.表名 values(<span class="number">1</span>,<span class="string">&#x27;xxx&#x27;</span>); <span class="comment"># 增加单条数据</span></span><br><span class="line">insert into 库名.表名 values(<span class="number">2</span>,<span class="string">&#x27;xxx&#x27;</span>),(<span class="number">3</span>,<span class="string">&#x27;xxx&#x27;</span>),(<span class="number">4</span>,<span class="string">&#x27;xxx&#x27;</span>) <span class="comment"># 增加多条数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 改</span></span><br><span class="line">update 库名.表名 <span class="built_in">set</span> name=<span class="string">&#x27;XXX&#x27;</span> where <span class="built_in">id</span> &gt; <span class="number">1</span>; <span class="comment"># 修改名字，条件放在where后</span></span><br><span class="line">update 库名.表名 <span class="built_in">set</span> name=<span class="string">&#x27;XXX&#x27;</span> where <span class="built_in">id</span> = <span class="number">2</span> <span class="keyword">or</span> <span class="built_in">id</span> = <span class="number">3</span>; <span class="comment"># where后可以用逻辑运算符</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查</span></span><br><span class="line">select <span class="built_in">id</span>,name <span class="keyword">from</span> 库名.表名; <span class="comment"># 库名可不指定，默认当前库</span></span><br><span class="line">select * <span class="keyword">from</span> 表名; <span class="comment"># 根据表名查看该表下所有记录</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删</span></span><br><span class="line">delete <span class="keyword">from</span> 库名.表名 where <span class="built_in">id</span> &gt; <span class="number">3</span>; <span class="comment"># 根据where后的条件判断需要删除哪些记录(数据)</span></span><br><span class="line">delete <span class="keyword">from</span> 库名.表名 where name=<span class="string">&#x27;XXX&#x27;</span>;</span><br><span class="line">delete <span class="keyword">from</span> 库名.表名; <span class="comment"># 删除该表中的所有记录(数据)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 总结：</span></span><br><span class="line">库 == 表：show(查)、alter(改)、create(增)、drop(删)  ps(表：查看当前所在库：select 库名())</span><br><span class="line">(关键字后要带database/table 再+具体库名/表名)</span><br><span class="line"></span><br><span class="line">记录：select(查)、update(改)、insert into(增)、delete(删)</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 数据库发展史：</span><br><span class="line">	bs/cs架构</span><br><span class="line">    </span><br><span class="line">	文件存储(单机) ---&gt; 存储在一个数据库上(不安全) ---&gt; 数据库集群(联机)</span><br><span class="line">    </span><br><span class="line"><span class="number">2</span> 数据库分类</span><br><span class="line">	</span><br><span class="line">    <span class="number">2.1</span> 关系型数据库</span><br><span class="line">    		-固定的表结构，表与表之间可以简历关联</span><br><span class="line">        	-常见软件：mysql、postgresql、oracl、sqlite、db2、sql server access</span><br><span class="line">            </span><br><span class="line">    <span class="number">2.2</span> 非关系型数据库</span><br><span class="line">    		-没有固定的表结构，存储数据按照kv键值对的格式(类似字典)</span><br><span class="line">        	-常见软件：MongoDB、redis、memcache</span><br><span class="line">            </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">常见软件最好能记住默认端口号</span></span><br><span class="line"><span class="string">	-mysql        -3306</span></span><br><span class="line"><span class="string">	-redis        -6379</span></span><br><span class="line"><span class="string">	-MongoDB      -27017</span></span><br><span class="line"><span class="string">	-Django		  -8000</span></span><br><span class="line"><span class="string">	-flask		  -5000</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span> mysql简介</span><br><span class="line">	<span class="comment"># ps：防呆思想</span></span><br><span class="line">    <span class="number">3.1</span> 版本问题</span><br><span class="line">    	-SQL语句的由来</span><br><span class="line">        	-统一思想</span><br><span class="line">            </span><br><span class="line">    <span class="number">3.2</span> 下载与安装</span><br><span class="line"></span><br><span class="line"><span class="number">4</span> 环境变量及系统服务</span><br><span class="line">	</span><br><span class="line">    <span class="number">4.1</span> 先添加环境变量</span><br><span class="line">    </span><br><span class="line">    <span class="number">4.2</span> 命令</span><br><span class="line">    		mysqld --install</span><br><span class="line">        	net start mysql</span><br><span class="line">            net stop mysql</span><br><span class="line">            mysqld --remove</span><br><span class="line">            </span><br><span class="line"><span class="number">5</span> 用户登录及密码相关</span><br><span class="line">	mysql 游客模式</span><br><span class="line">    mysql -u用户名 -p密码</span><br><span class="line">    </span><br><span class="line">    <span class="number">5.1</span> 直接修改</span><br><span class="line">    	mysqladmin -u用户名 -p原密码 password 新密码</span><br><span class="line">    </span><br><span class="line">    <span class="number">5.2</span> 忘记密码</span><br><span class="line">    	...</span><br><span class="line"></span><br><span class="line"><span class="number">6</span> 重要概念</span><br><span class="line">	-库  ---&gt; 文件夹</span><br><span class="line">    -表  ---&gt; 文件</span><br><span class="line">    -数据 ---&gt; 文件内一行行数据</span><br><span class="line"></span><br><span class="line"><span class="number">7</span> 配置文件</span><br><span class="line">	my.ini</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="number">8</span> 基本SQL语句</span><br><span class="line">	...</span><br><span class="line">        </span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/02/11/MySQL%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E4%B8%8E%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/02/11/MySQL%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E4%B8%8E%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" class="post-title-link" itemprop="url">MySQL基础之存储引擎与基本数据类型</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-02-11 07:20:25" itemprop="dateCreated datePublished" datetime="2020-02-11T07:20:25+08:00">2020-02-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-03-01 12:22:34" itemprop="dateModified" datetime="2020-03-01T12:22:34+08:00">2020-03-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MySQL%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">MySQL系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="存储引擎"><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">存储数据的方式不一样</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有的存储引擎</span></span><br><span class="line">    show engines;</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 需要知道的四个引擎</span></span><br><span class="line">    <span class="number">1</span> myisam</span><br><span class="line">        -mysql <span class="number">5.5</span> 及之前的版本默认的存储引擎</span><br><span class="line">        -存储数据的速度都非常快，但是功能较少，安全性较低</span><br><span class="line">    </span><br><span class="line">    <span class="number">2</span> innodb</span><br><span class="line">        -mysql <span class="number">5.6</span> 及之后的版本默认的存储引擎</span><br><span class="line">        -存取速度没有myisam快，但是功能更多，安全性更高</span><br><span class="line">    </span><br><span class="line">    <span class="number">3</span> blackhole</span><br><span class="line">        -往里面写入任何数据都会直接消失(黑洞)</span><br><span class="line">        </span><br><span class="line">    <span class="number">4</span> menory</span><br><span class="line">        -用内存存储数据，断电数据消失</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 文件个数不一致</span></span><br><span class="line">    innodb</span><br><span class="line">        .frm  ---  表结构</span><br><span class="line">        .ibd  ---  表数据和索引</span><br><span class="line">    myisam</span><br><span class="line">        .frm  ---  表结构</span><br><span class="line">        .MYD  ---  表数据</span><br><span class="line">        .MYI  ---  索引</span><br><span class="line">    blackhole</span><br><span class="line">        .frm  ---  表结构</span><br><span class="line">    menory</span><br><span class="line">        .frm  ---  表结构</span><br></pre></td></tr></table></figure>

<h1 id="MySQL基本数据类型"><a href="#MySQL基本数据类型" class="headerlink" title="MySQL基本数据类型"></a>MySQL基本数据类型</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 整型</span><br><span class="line">    tinyint smallint <span class="built_in">int</span> bigint</span><br><span class="line">        <span class="number">1.1</span> 不同的类型能够存储的数字范围不一样</span><br><span class="line"></span><br><span class="line"><span class="comment"># 结论：所有的整型都是自带符号</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">(了解)如果不想让整型有符号：</span></span><br><span class="line"><span class="string">    create table t6(id tinyint unsigned);</span></span><br><span class="line"><span class="string">    insert into t6 values(-129),(256);</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">2</span> 浮点型</span><br><span class="line">    <span class="built_in">float</span>(<span class="number">255</span>, <span class="number">30</span>)</span><br><span class="line">        -总共<span class="number">255</span>位，小数占<span class="number">30</span>位</span><br><span class="line">    double(<span class="number">255</span>, <span class="number">30</span>)</span><br><span class="line">        -总共<span class="number">255</span>位，小数占<span class="number">30</span>位</span><br><span class="line">    decimal(<span class="number">65</span>, <span class="number">30</span>)</span><br><span class="line">        -总共<span class="number">65</span>位，小数占<span class="number">30</span>位</span><br><span class="line">        </span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    精确度不一样</span></span><br><span class="line"><span class="string">        float &lt; double &lt; decimal</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">    在实际开发中，很多时候看似需要用数字存储的数据</span></span><br><span class="line"><span class="string">    其实我们可能都是使用的字符串存储</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3</span> 字符类型</span><br><span class="line">    char(<span class="number">4</span>)</span><br><span class="line">        最大存储四个字符 超出了直接报错 不超过空格填充至四位</span><br><span class="line">    varchar(<span class="number">4</span>)</span><br><span class="line">        最大存储四个字符，超出了直接报错 不超过有几位存几位</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">4</span> 日期类型</span><br><span class="line"></span><br><span class="line">    datetime  ---  年月日 时分秒</span><br><span class="line">    time      ---  时分秒</span><br><span class="line">    date      ---  年月日</span><br><span class="line">    year      ---  年</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">5</span> 枚举与集合</span><br><span class="line">    枚举  ---  多选一        ---&gt; (例如性别)</span><br><span class="line">        create table t1(</span><br><span class="line">        <span class="built_in">id</span> <span class="built_in">int</span>,</span><br><span class="line">        name varchar(<span class="number">32</span>)</span><br><span class="line">        gender enum(<span class="string">&#x27;male&#x27;</span>,<span class="string">&#x27;female&#x27;</span>)</span><br><span class="line">        );</span><br><span class="line">    </span><br><span class="line">    集合  ---  多选多(多选一) ---&gt; (例如爱好)</span><br><span class="line">        create table t2(</span><br><span class="line">        <span class="built_in">id</span> <span class="built_in">int</span>,</span><br><span class="line">        name varchar(<span class="number">32</span>)</span><br><span class="line">        hobby <span class="built_in">set</span>(<span class="string">&#x27;read&#x27;</span>,<span class="string">&#x27;study&#x27;</span>,<span class="string">&#x27;music&#x27;</span>)</span><br><span class="line">        )</span><br></pre></td></tr></table></figure>

<h1 id="严格模式"><a href="#严格模式" class="headerlink" title="严格模式"></a>严格模式</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看sql_mode</span></span><br><span class="line">    show variables like <span class="string">&#x27;%mode%&#x27;</span>;</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 修改</span></span><br><span class="line">    get <span class="keyword">global</span> sql_mode=<span class="string">&#x27;strict_trans_tables&#x27;</span>;</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 修改完成后退出客户端重新进入即可</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证char是否自动填充</span></span><br><span class="line">    <span class="built_in">set</span> <span class="keyword">global</span> sql_mode=<span class="string">&#x27;strict_trans_tables,pad_char_to_full_length&#x27;</span></span><br></pre></td></tr></table></figure>

<h1 id="字符类型对比"><a href="#字符类型对比" class="headerlink" title="字符类型对比"></a>字符类型对比</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">char(<span class="number">4</span>)</span><br><span class="line">    优点：整存整取 速度快</span><br><span class="line">    缺点：浪费硬盘空间</span><br><span class="line">    </span><br><span class="line">varchar(<span class="number">4</span>)</span><br><span class="line">    优点：节省硬盘空间</span><br><span class="line">    缺点：速度没有char快</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 各有优缺点，具体结合实际情况</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    针对整型字段，括号里面的数字不是用来限制存储长度的而是用来控制显示长度的</span></span><br><span class="line"><span class="string">    ---&gt; 定义整型字段无需自己写括号和数字</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h1 id="创建表的完整语法"><a href="#创建表的完整语法" class="headerlink" title="创建表的完整语法"></a>创建表的完整语法</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">create table 表名(</span><br><span class="line">    字段名<span class="number">1</span> 字段类型(宽度) 约束条件<span class="number">1</span> 约束条件<span class="number">2.</span>..，</span><br><span class="line">    字段名<span class="number">2</span> 字段类型(宽度) 约束条件，</span><br><span class="line">    字段名<span class="number">3</span> 字段类型(宽度) 约束条件</span><br><span class="line">)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">易错点：</span></span><br><span class="line"><span class="string">    1 字段名和字段类型是必须的，宽度和约束条件是可选的</span></span><br><span class="line"><span class="string">    2 约束条件可以有多个</span></span><br><span class="line"><span class="string">    3 最后一个字段结尾不能加逗号，否则报错</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/02/11/MySQL%E5%9F%BA%E7%A1%80%E4%B9%8B%E7%BA%A6%E6%9D%9F%E6%9D%A1%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/02/11/MySQL%E5%9F%BA%E7%A1%80%E4%B9%8B%E7%BA%A6%E6%9D%9F%E6%9D%A1%E4%BB%B6/" class="post-title-link" itemprop="url">MySQL基础之约束条件</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-02-11 07:20:25" itemprop="dateCreated datePublished" datetime="2020-02-11T07:20:25+08:00">2020-02-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-03-01 12:22:34" itemprop="dateModified" datetime="2020-03-01T12:22:34+08:00">2020-03-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MySQL%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">MySQL系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="内容概要"><a href="#内容概要" class="headerlink" title="内容概要"></a>内容概要</h1><ul>
<li>约束条件</li>
<li>约束条件之外键(重点)</li>
<li>表与表之间建立关系</li>
<li>查询关键字(重点)</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">where</span><br><span class="line">group by</span><br><span class="line">having</span><br><span class="line">distinct</span><br><span class="line">order by</span><br><span class="line">limit</span><br><span class="line">regexp</span><br></pre></td></tr></table></figure>

<h1 id="内容详细"><a href="#内容详细" class="headerlink" title="内容详细"></a>内容详细</h1><h2 id="约束条件"><a href="#约束条件" class="headerlink" title="约束条件"></a>约束条件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在字段类型的基础之上添加额外的约束</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span> unsigned ---&gt; 无符号(正负号)</span><br><span class="line"></span><br><span class="line"><span class="number">2</span> zerofill ---&gt; 填充</span><br><span class="line"></span><br><span class="line"><span class="number">3</span> <span class="keyword">not</span> null ---&gt; 非空</span><br><span class="line">    create table t1(</span><br><span class="line">        <span class="built_in">id</span> <span class="built_in">int</span>,</span><br><span class="line">        name varchar(<span class="number">32</span>) <span class="keyword">not</span> null</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line"><span class="number">4</span> default ---&gt; 默认值</span><br><span class="line">    create table t2(</span><br><span class="line">        <span class="built_in">id</span> <span class="built_in">int</span>,</span><br><span class="line">        name char(<span class="number">32</span>),</span><br><span class="line">        gender enum(<span class="string">&#x27;male&#x27;</span>,<span class="string">&#x27;female&#x27;</span>) default <span class="string">&#x27;male&#x27;</span></span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line"><span class="number">5</span> unique ---&gt; 唯一</span><br><span class="line"><span class="comment"># 单列唯一：</span></span><br><span class="line">    create table t3(</span><br><span class="line">        <span class="built_in">id</span> <span class="built_in">int</span>,</span><br><span class="line">        name varchar(<span class="number">32</span>) unique</span><br><span class="line">    );</span><br><span class="line"><span class="comment"># 多列唯一</span></span><br><span class="line">    create table t4(</span><br><span class="line">        <span class="built_in">id</span> <span class="built_in">int</span>,</span><br><span class="line">        host varchar(<span class="number">32</span>),</span><br><span class="line">        port <span class="built_in">int</span>,</span><br><span class="line">        unique(host,port)</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line"><span class="number">6</span> primary key ---&gt; 主键</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    1 单从限制角度上来看 主键相当于是非空且唯一</span></span><br><span class="line"><span class="string">        id int primary key == id int not null unique</span></span><br><span class="line"><span class="string">        create table t5(</span></span><br><span class="line"><span class="string">            id int primary key                        ------&gt;书写规范</span></span><br><span class="line"><span class="string">        );</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    2 innodb存储引擎规定了再创建表的时候必须有且只有一个主键</span></span><br><span class="line"><span class="string">        2.1 为什么之前创建表的时候没有主键也可以呢？</span></span><br><span class="line"><span class="string">            当表中没有任何的约束条件字段，为了能够顺利的创建出表，innodb存储引擎会采用内部隐藏的字段作为         主键</span></span><br><span class="line"><span class="string">            隐藏主键意味着我们无法使用到，正常主键其实可以帮助我们加快数据的查询速度，但因为被隐藏了，所以          其实在速度上并没有变化 ---&gt; 要自己设定主键</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">        2.2 没有主键但是有非空且唯一的字段，那么会自动将该字段升级为主键</span></span><br><span class="line"><span class="string">            create table t6(</span></span><br><span class="line"><span class="string">                id int,</span></span><br><span class="line"><span class="string">                age int not null unique,    &lt;----- 会自动将age升级为主键</span></span><br><span class="line"><span class="string">                pwd int not null unique</span></span><br><span class="line"><span class="string">                );</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    结论：   我们在创建表的时候一般都会创建一个id字段(序号\编号)</span></span><br><span class="line"><span class="string">         并且我们会将该字段设置为主键</span></span><br><span class="line"><span class="string">            id int primery key</span></span><br><span class="line"><span class="string">            ps：(id的名称可以不固定，uid、cid、pid...)</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line"><span class="number">7</span> auto_increment ---&gt; 自增</span><br><span class="line"><span class="comment"># 单一主键</span></span><br><span class="line">    专门用来给key键使用(就理解成是专门给主键用的)</span><br><span class="line">    create table t7(</span><br><span class="line">        <span class="built_in">id</span> <span class="built_in">int</span> primary key auto_increment,</span><br><span class="line">        name varchar(<span class="number">32</span>)</span><br><span class="line">    );</span><br><span class="line"><span class="comment"># 联合主键(了解)</span></span><br><span class="line">    create table t8(</span><br><span class="line">        <span class="built_in">id</span> <span class="built_in">int</span>,</span><br><span class="line">        nid <span class="built_in">int</span>,</span><br><span class="line">        name varchar(<span class="number">32</span>),</span><br><span class="line">        primary key(<span class="built_in">id</span>,nid)...</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">以后的主键字段固定写法：id int primary key atuo_increment</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="主键的特征"><a href="#主键的特征" class="headerlink" title="主键的特征"></a>主键的特征</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1 delete from   ---&gt; 不会影响主键的自增</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 truncate(了解) ---&gt; 清空数据并且重置主键 (还不如删表重建)</span></span><br></pre></td></tr></table></figure>

<h2 id="添加数据的两种方式"><a href="#添加数据的两种方式" class="headerlink" title="添加数据的两种方式"></a>添加数据的两种方式</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> insert into t1 values(...) <span class="comment"># 按照字段顺序一一传值(用得少)</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span> insert into t2(name) values(...) <span class="comment"># 指名道姓的传值</span></span><br></pre></td></tr></table></figure>

<h2 id="外键前戏"><a href="#外键前戏" class="headerlink" title="外键前戏"></a>外键前戏</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;员工表&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">id</span> emp_name emp_salary dep_name dep_desc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 问题</span></span><br><span class="line"><span class="number">1</span> 表结构不够明确</span><br><span class="line">    - 到底是员工表还是部门表</span><br><span class="line"></span><br><span class="line"><span class="number">2</span> 浪费存储空间</span><br><span class="line"></span><br><span class="line"><span class="number">3</span> 表拓展性极差</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拆分</span></span><br><span class="line">上诉三个问题都能够解决，但员工与部门之间就没有了关联</span><br><span class="line"></span><br><span class="line">---&gt; 外键字段</span><br><span class="line">       ---&gt; 用来建立表与表之间的关系的字段</span><br></pre></td></tr></table></figure>

<h2 id="表关系判断"><a href="#表关系判断" class="headerlink" title="表关系判断"></a>表关系判断</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">表关系分类</span><br><span class="line">    <span class="number">1</span> 一对多</span><br><span class="line">    <span class="number">2</span> 多对多</span><br><span class="line">    <span class="number">3</span> 一对一</span><br><span class="line">    </span><br><span class="line">表关系判断  ---&gt; <span class="string">&#x27;换位思考&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="number">1</span> 以员工表与部门表为例</span><br><span class="line">        <span class="number">1.1</span> 先站在员工表角度</span><br><span class="line">            问：一名员工能否对应多个部门</span><br><span class="line">            答：否</span><br><span class="line">        <span class="number">2.1</span> 再站在部门表角度</span><br><span class="line">            问：一个部门能否对应多名员工</span><br><span class="line">            答：能</span><br><span class="line">        结论：两边一个能一个否 ---&gt; 表关系就是：<span class="string">&#x27;一对多&#x27;</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    针对一对多的表关系</span></span><br><span class="line"><span class="string">        外键字段建立在多的一方 ---&gt; 建在员工表中</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="number">2</span> 以书籍表与作者表为例</span><br><span class="line">        <span class="number">2.1</span> 先站在书籍表角度</span><br><span class="line">            问：一本书能否对应多名作者</span><br><span class="line">            答：能</span><br><span class="line">            </span><br><span class="line">        <span class="number">2.2</span> 再站在作者表角度</span><br><span class="line">            问：一本书能否对应多名作者</span><br><span class="line">            答：能</span><br><span class="line">        结论：两边都能  ---&gt; 表关系就是：<span class="string">&#x27;多对多&#x27;</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    针对多对多表关系</span></span><br><span class="line"><span class="string">        外键字段并不会建在任何一张关系表</span></span><br><span class="line"><span class="string">        而是单独开设一张新表专门存储</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="number">3</span> 以用户表与用户详情表为例</span><br><span class="line">        <span class="number">3.1</span> 先站在用户表角度</span><br><span class="line">            问：一名用户能否对应多个用户详情</span><br><span class="line">            答：否</span><br><span class="line">        <span class="number">3.2</span> 再站在用户详情表角度</span><br><span class="line">            问：一个用户详情能否对应多名用户</span><br><span class="line">            答：否</span><br><span class="line">        结论：两边都否  ---&gt; 表关系就是：<span class="string">&#x27;一对一&#x27;</span></span><br><span class="line">        </span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    针对一对一表关系</span></span><br><span class="line"><span class="string">        外键字段建在任何一方都可以</span></span><br><span class="line"><span class="string">        但是推荐建在查询评率较高的表中   ---&gt; 用户表</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="SQL语句实现"><a href="#SQL语句实现" class="headerlink" title="SQL语句实现"></a>SQL语句实现</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">--------------------------------- 一对多 --------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1 先创建基本字段</span></span><br><span class="line"><span class="comment"># 2 再考虑外键字段</span></span><br><span class="line">create table emp(</span><br><span class="line">    <span class="built_in">id</span> <span class="built_in">int</span> primary key auto_increment,</span><br><span class="line">    emp_name varchar(<span class="number">32</span>),</span><br><span class="line">    emp_salary <span class="built_in">int</span>,</span><br><span class="line">    dep_id <span class="built_in">int</span>,</span><br><span class="line">    foregin key(dep_id) references dep(<span class="built_in">id</span>)</span><br><span class="line">);</span><br><span class="line">create table dep(</span><br><span class="line">    <span class="built_in">id</span> <span class="built_in">int</span> primary key auto_increment,</span><br><span class="line">    dep_name varchar(<span class="number">32</span>),</span><br><span class="line">    dep_desc varchar(<span class="number">64</span>)</span><br><span class="line">);</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">1 在创建表的是先创建被关联的表(没有外键字段的表)</span></span><br><span class="line"><span class="string">2 在录入数据的时候先录入被关联表的数据</span></span><br><span class="line"><span class="string">3 修改或者删除被关联表数据</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">------------------------------------ 多对多 -------------------------------------</span><br><span class="line">create table book(</span><br><span class="line">    <span class="built_in">id</span> <span class="built_in">int</span> primary key auto_increment,</span><br><span class="line">    title varchar(<span class="number">32</span>),</span><br><span class="line">    price <span class="built_in">int</span></span><br><span class="line">);</span><br><span class="line">create table author(</span><br><span class="line">    <span class="built_in">id</span> <span class="built_in">int</span> primary key auto_increment,</span><br><span class="line">    name varchar(<span class="number">32</span>),</span><br><span class="line">    age <span class="built_in">int</span></span><br><span class="line">);</span><br><span class="line">create table book2author(</span><br><span class="line">    <span class="built_in">id</span> <span class="built_in">int</span> primary key auto_increment,</span><br><span class="line">    author_id <span class="built_in">int</span>,</span><br><span class="line">    foreign key(author_id) references author(<span class="built_in">id</span>)</span><br><span class="line">    on update cascade</span><br><span class="line">    on delete cascade,</span><br><span class="line">    book_id <span class="built_in">int</span>,</span><br><span class="line">    foreign key(book_id) references book(<span class="built_in">id</span>)</span><br><span class="line">    on update cascade</span><br><span class="line">    on delete cascade</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">------------------------------------ 一对一 -------------------------------------</span><br><span class="line">create table userinfo(</span><br><span class="line">    <span class="built_in">id</span> <span class="built_in">int</span> primary key auto_increment,</span><br><span class="line">    name varchar(<span class="number">32</span>),</span><br><span class="line">    age <span class="built_in">int</span>,</span><br><span class="line">    detail_id <span class="built_in">int</span> unique,</span><br><span class="line">    foreign key(detail_id) reference userinfo_detail(<span class="built_in">id</span>)</span><br><span class="line">    on update cascade</span><br><span class="line">    on delete cascade</span><br><span class="line">);</span><br><span class="line">create table userinfo_detail(</span><br><span class="line">    <span class="built_in">id</span> <span class="built_in">int</span> primary key auto_increment,</span><br><span class="line">    addr varchar(<span class="number">64</span>),</span><br><span class="line">    phone varchar(<span class="number">32</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="级联更新级联删除"><a href="#级联更新级联删除" class="headerlink" title="级联更新级联删除"></a>级联更新级联删除</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">create table dep(</span><br><span class="line">    <span class="built_in">id</span> <span class="built_in">int</span> primary key auto_increment,</span><br><span class="line">    dep_name varchar(<span class="number">32</span>),</span><br><span class="line">    dep_desc varchar(<span class="number">64</span>)</span><br><span class="line">);</span><br><span class="line">create table dep(</span><br><span class="line">    <span class="built_in">id</span> <span class="built_in">int</span> primary key auto_increment,</span><br><span class="line">    emp_name varchar(<span class="number">32</span>),</span><br><span class="line">    emp_salary <span class="built_in">int</span></span><br><span class="line">    dep_id <span class="built_in">int</span>,</span><br><span class="line">    foreign key(dep_id) references dep(<span class="built_in">id</span>)</span><br><span class="line">    on update cascade <span class="comment"># 级联更新</span></span><br><span class="line">    on delete cascade <span class="comment"># 级联删除</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h1 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">七个约束条件：unsigned，zerofill，<span class="keyword">not</span> null，default，unique，primary key，auto_increment</span><br><span class="line"></span><br><span class="line">表关系判断(外键)：一对多 --- 多对多 --- 一对一  </span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/02/11/MySQL%E5%9F%BA%E7%A1%80%E4%B9%8B%E9%9B%B6%E6%95%A3%E7%9F%A5%E8%AF%86%E7%82%B9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/02/11/MySQL%E5%9F%BA%E7%A1%80%E4%B9%8B%E9%9B%B6%E6%95%A3%E7%9F%A5%E8%AF%86%E7%82%B9/" class="post-title-link" itemprop="url">MySQL基础之零散知识点</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-02-11 07:20:25" itemprop="dateCreated datePublished" datetime="2020-02-11T07:20:25+08:00">2020-02-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-03-01 12:22:34" itemprop="dateModified" datetime="2020-03-01T12:22:34+08:00">2020-03-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MySQL%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">MySQL系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="内容概要"><a href="#内容概要" class="headerlink" title="内容概要"></a>内容概要</h1><ul>
<li>表字段操作补充</li>
<li>python操作MySQL</li>
<li>视图</li>
<li>触发器</li>
<li>存储过程</li>
<li>事务</li>
<li>内置函数</li>
<li>流程控制</li>
<li>索引</li>
</ul>
<h1 id="内容详细"><a href="#内容详细" class="headerlink" title="内容详细"></a>内容详细</h1><h2 id="表字段操作补充"><a href="#表字段操作补充" class="headerlink" title="表字段操作补充"></a>表字段操作补充</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1 添加表字段</span></span><br><span class="line">alter table 表名 add 字段名 字段类型 约束条件; <span class="comment"># 默认尾部追加</span></span><br><span class="line">alter table 表名 add 字段名 字段类型 约束条件 after 已经存在的字段名;</span><br><span class="line">alter table 表名 add 字段名 字段类型 约束条件 first; <span class="comment"># 了解</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 修改字段</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;modify只能修改字段数据类型完整约束，不能修改字段名，但是change二者都可以修改&#x27;&#x27;&#x27;</span></span><br><span class="line">ALTER TABLE 表名 </span><br><span class="line">                          MODIFY  字段名 数据类型 [完整性约束条件…];</span><br><span class="line">ALTER TABLE 表名 </span><br><span class="line">                          CHANGE 旧字段名 新字段名 数据类型 [完整性约束条件…];</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.删除字段</span></span><br><span class="line">ALTER TABLE 表名 </span><br><span class="line">                          DROP 字段名;</span><br></pre></td></tr></table></figure>

<h2 id="python操作mysql"><a href="#python操作mysql" class="headerlink" title="python操作mysql"></a>python操作mysql</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>下载模块</span><br><span class="line">    pip3 install pymysql</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">python默认下载模块的地址是国外的网站</span></span><br><span class="line"><span class="string">速度有时候会非常的慢 如果想要提升速度我们可以切换下载源</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">（<span class="number">1</span>）阿里云 http://mirrors.aliyun.com/pypi/simple/</span><br><span class="line">（<span class="number">2</span>）豆瓣http://pypi.douban.com/simple/</span><br><span class="line">（<span class="number">3</span>）清华大学 https://pypi.tuna.tsinghua.edu.cn/simple/</span><br><span class="line">（<span class="number">4</span>）中国科学技术大学 http://pypi.mirrors.ustc.edu.cn/simple/</span><br><span class="line">（<span class="number">5</span>）华中科技大学http://pypi.hustunique.com/</span><br><span class="line"><span class="comment"># 1.命令行切换源</span></span><br><span class="line">    pip3 install pymysql -i 源地址</span><br><span class="line"><span class="comment"># 2.pycharm永久切换</span></span><br><span class="line">    file</span><br><span class="line">        setting</span><br><span class="line">            interpreter</span><br><span class="line">                双击</span><br><span class="line">                    manage 仓库</span><br><span class="line">                    </span><br><span class="line"><span class="number">2</span> 基本使用</span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建连接对象</span></span><br><span class="line">conn = pymysql.connect(</span><br><span class="line">    host = <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">    port = <span class="number">3306</span>,</span><br><span class="line">    user = <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">    password = <span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">    database = <span class="string">&#x27;db4_29&#x27;</span>,</span><br><span class="line">    charset = <span class="string">&#x27;utf8&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成游标对象</span></span><br><span class="line">cursor = conn.cursor(cursor = pymysql.cursor.DictCursor) <span class="comment"># 括号内不写参数使元组组织不够明确</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义SQL语句</span></span><br><span class="line"><span class="comment"># sql = &#x27;show tables&#x27;</span></span><br><span class="line">sql = <span class="string">&#x27;select * from teacher&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行SQL语句</span></span><br><span class="line">affect_rows = cursor.execute(sql)</span><br><span class="line"><span class="built_in">print</span>(affect_rows) <span class="comment"># 执行SQL语句所影响的行数</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取结果</span></span><br><span class="line">res = cursor.fetchall()</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure>

<h2 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">利用特殊符号的组合绕过相应的机制</span><br><span class="line"></span><br><span class="line">如何解决</span><br><span class="line">    不要自己手动处理敏感数据</span><br><span class="line"> </span><br><span class="line">sql = <span class="string">&quot;select * from userinfo where name=%s and password=%s&quot;</span></span><br><span class="line"><span class="comment"># 执行sql语句</span></span><br><span class="line">cursor.execute(sql,(username,password))  <span class="comment"># 交由execute自动拼接 自动筛选</span></span><br></pre></td></tr></table></figure>



<h2 id="其他操作"><a href="#其他操作" class="headerlink" title="其他操作"></a>其他操作</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">针对增删改查</span><br><span class="line">    查的重要程度很低，无需二次确认</span><br><span class="line">    增改删重要程度很高，都需要二次确认</span><br><span class="line">    </span><br><span class="line">    conn = pymysql.connect(</span><br><span class="line">        host=<span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">        port=<span class="number">3306</span>,</span><br><span class="line">        user=<span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        password=<span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        database=<span class="string">&#x27;db5&#x27;</span>,</span><br><span class="line">        charset=<span class="string">&#x27;utf8&#x27;</span>,</span><br><span class="line">        autocommit=<span class="literal">True</span>  <span class="comment"># 自动二次确认</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><h4 id="什么是视图"><a href="#什么是视图" class="headerlink" title="什么是视图"></a>什么是视图</h4><p><strong>视图就是通过查询得到一张虚拟表，然后保存下来，下次直接使用即可</strong></p>
<h4 id="为什么要用视图"><a href="#为什么要用视图" class="headerlink" title="为什么要用视图"></a>为什么要用视图</h4><p><strong>如果要频繁使用一张虚拟表，可以不用重复查询</strong></p>
<h4 id="如何用视图"><a href="#如何用视图" class="headerlink" title="如何用视图"></a>如何用视图</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create view teacher2course <span class="keyword">as</span></span><br><span class="line">select * <span class="keyword">from</span> teacher inner join course on teacher.tid = course.teacher_id;</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">创建好了之后 验证它的存在navicat验证 cmd终端验证</span></span><br><span class="line"><span class="string">最后文件验证 得出下面的结论 视图只有表结构数据还是来源于之前的表</span></span><br><span class="line"><span class="string">delete from teacher2course where id=1;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>强调</strong> 1、在硬盘中，视图只有表结构文件，没有表数据文件 2、视图通常是用于查询，尽量不要修改视图中的数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop view teacher2course;</span><br></pre></td></tr></table></figure>



<p><strong>思考:开发过程中会不会去使用视图？</strong></p>
<p>不会！视图是mysql的功能，如果你的项目里面大量的使用到了视图，那意味着你后期想要扩张某个功能的时候这个功能恰巧又需要对视图进行修改，意味着你需要先在mysql这边将视图先修改一下，然后再去应用程序中修改对应的sql语句，这就涉及到跨部门沟通的问题，所以通常不会使用视图，而是通过重新修改sql语句来扩展功能</p>
<h2 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h2><p><strong>在满足对某张表数据的增、删、改的情况下，自动触发的功能称之为触发器</strong></p>
<h4 id="为何要用触发器"><a href="#为何要用触发器" class="headerlink" title="为何要用触发器"></a>为何要用触发器</h4><p><strong>触发器专门针对我们对某一张表数据增insert、删delete、改update的行为，这类行为一旦执行</strong><br><strong>就会触发触发器的执行，即自动运行另外一段sql代码</strong></p>
<h4 id="创建触发器语法"><a href="#创建触发器语法" class="headerlink" title="创建触发器语法"></a>创建触发器语法</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;语法结构</span></span><br><span class="line"><span class="string">create trigger 触发器的名字 before/after insert/update/delete on 表名 for each row</span></span><br><span class="line"><span class="string">begin</span></span><br><span class="line"><span class="string">    sql语句</span></span><br><span class="line"><span class="string">end</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 针对插入</span></span><br><span class="line">create trigger tri_after_insert_t1 after insert on 表名 <span class="keyword">for</span> each row</span><br><span class="line">begin</span><br><span class="line">    sql代码。。。</span><br><span class="line">end </span><br><span class="line">create trigger tri_after_insert_t2 before insert on 表名 <span class="keyword">for</span> each row</span><br><span class="line">begin</span><br><span class="line">    sql代码。。。</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"><span class="comment"># 针对删除</span></span><br><span class="line">create trigger tri_after_delete_t1 after delete on 表名 <span class="keyword">for</span> each row</span><br><span class="line">begin</span><br><span class="line">    sql代码。。。</span><br><span class="line">end</span><br><span class="line">create trigger tri_after_delete_t2 before delete on 表名 <span class="keyword">for</span> each row</span><br><span class="line">begin</span><br><span class="line">    sql代码。。。</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"><span class="comment"># 针对修改</span></span><br><span class="line">create trigger tri_after_update_t1 after update on 表名 <span class="keyword">for</span> each row</span><br><span class="line">begin</span><br><span class="line">    sql代码。。。</span><br><span class="line">end</span><br><span class="line">create trigger tri_after_update_t2 before update on 表名 <span class="keyword">for</span> each row</span><br><span class="line">begin</span><br><span class="line">    sql代码。。。</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">需要注意 在书写sql代码的时候结束符是; 而整个触发器的结束也需要分号;</span></span><br><span class="line"><span class="string">这就会出现语法冲突 需要我们临时修改结束符号</span></span><br><span class="line"><span class="string">delimiter $$</span></span><br><span class="line"><span class="string">delimiter ; </span></span><br><span class="line"><span class="string">该语法只在当前窗口有效  </span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 案例</span></span><br><span class="line">CREATE TABLE cmd (</span><br><span class="line">    <span class="built_in">id</span> INT PRIMARY KEY auto_increment,</span><br><span class="line">    USER CHAR (<span class="number">32</span>),</span><br><span class="line">    priv CHAR (<span class="number">10</span>),</span><br><span class="line">    cmd CHAR (<span class="number">64</span>),</span><br><span class="line">    sub_time datetime, <span class="comment">#提交时间</span></span><br><span class="line">    success enum (<span class="string">&#x27;yes&#x27;</span>, <span class="string">&#x27;no&#x27;</span>) <span class="comment">#0代表执行失败</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">CREATE TABLE errlog (</span><br><span class="line">    <span class="built_in">id</span> INT PRIMARY KEY auto_increment,</span><br><span class="line">    err_cmd CHAR (<span class="number">64</span>),</span><br><span class="line">    err_time datetime</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">delimiter $$  <span class="comment"># 将mysql默认的结束符由;换成$$</span></span><br><span class="line">create trigger tri_after_insert_cmd after insert on cmd <span class="keyword">for</span> each row</span><br><span class="line">begin</span><br><span class="line">    <span class="keyword">if</span> NEW.success = <span class="string">&#x27;no&#x27;</span> then  <span class="comment"># 新记录都会被MySQL封装成NEW对象</span></span><br><span class="line">        insert into errlog(err_cmd,err_time) values(NEW.cmd,NEW.sub_time);</span><br><span class="line">    end <span class="keyword">if</span>;</span><br><span class="line">end $$</span><br><span class="line">delimiter ;  <span class="comment"># 结束之后记得再改回来，不然后面结束符就都是$$了</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#往表cmd中插入记录，触发触发器，根据IF的条件决定是否插入错误日志</span></span><br><span class="line">INSERT INTO cmd (</span><br><span class="line">    USER,</span><br><span class="line">    priv,</span><br><span class="line">    cmd,</span><br><span class="line">    sub_time,</span><br><span class="line">    success</span><br><span class="line">)</span><br><span class="line">VALUES</span><br><span class="line">    (<span class="string">&#x27;egon&#x27;</span>,<span class="string">&#x27;0755&#x27;</span>,<span class="string">&#x27;ls -l /etc&#x27;</span>,NOW(),<span class="string">&#x27;yes&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;egon&#x27;</span>,<span class="string">&#x27;0755&#x27;</span>,<span class="string">&#x27;cat /etc/passwd&#x27;</span>,NOW(),<span class="string">&#x27;no&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;egon&#x27;</span>,<span class="string">&#x27;0755&#x27;</span>,<span class="string">&#x27;useradd xxx&#x27;</span>,NOW(),<span class="string">&#x27;no&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;egon&#x27;</span>,<span class="string">&#x27;0755&#x27;</span>,<span class="string">&#x27;ps aux&#x27;</span>,NOW(),<span class="string">&#x27;yes&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询errlog表记录</span></span><br><span class="line">select * <span class="keyword">from</span> errlog;</span><br><span class="line"><span class="comment"># 删除触发器</span></span><br><span class="line">drop trigger tri_after_insert_cmd;</span><br></pre></td></tr></table></figure>

<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><h4 id="什么是事务"><a href="#什么是事务" class="headerlink" title="什么是事务"></a>什么是事务</h4><p><strong>开启一个事务可以包含一些sql语句，这些sql语句要么同时成功</strong><br><strong>要么一个都别想成功，称之为事务的原子性</strong></p>
<h4 id="事务的作用"><a href="#事务的作用" class="headerlink" title="事务的作用"></a>事务的作用</h4><p>保证了对数据操作的数据安全性</p>
<p>案例:用交行的卡操作建行ATM机给工商的账户转钱</p>
<p><strong>事务应该具有4个属性：</strong>原子性、一致性、隔离性、持久性。这四个属性通常称为<strong>ACID特性</strong>。</p>
<p>原子性（atomicity）。一个事务是一个不可分割的工作单位，事务中包括的诸操作要么都做，要么都不做。</p>
<p>一致性（consistency）。事务必须是使数据库从一个一致性状态变到另一个一致性状态。一致性与原子性是密切相关的。</p>
<p>隔离性（isolation）。一个事务的执行不能被其他事务干扰。即一个事务内部的操作及使用的数据对并发的其他事务是隔离的，并发执行的各个事务之间不能互相干扰。</p>
<p>持久性（durability）。持久性也称永久性（permanence），指一个事务一旦提交，它对数据库中数据的改变就应该是永久性的。接下来的其他操作或故障不应该对其有任何影响。</p>
<h4 id="如何用"><a href="#如何用" class="headerlink" title="如何用"></a>如何用</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先介绍事务的三个关键字 再去用表实际展示效果</span></span><br><span class="line"></span><br><span class="line">create table user(</span><br><span class="line"><span class="built_in">id</span> <span class="built_in">int</span> primary key auto_increment,</span><br><span class="line">name char(<span class="number">32</span>),</span><br><span class="line">balance <span class="built_in">int</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">insert into user(name,balance)</span><br><span class="line">values</span><br><span class="line">(<span class="string">&#x27;jason&#x27;</span>,<span class="number">1000</span>),</span><br><span class="line">(<span class="string">&#x27;egon&#x27;</span>,<span class="number">1000</span>),</span><br><span class="line">(<span class="string">&#x27;tank&#x27;</span>,<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改数据之前先开启事务操作</span></span><br><span class="line">start transaction;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改操作</span></span><br><span class="line">update user <span class="built_in">set</span> balance=<span class="number">900</span> where name=<span class="string">&#x27;jason&#x27;</span>; <span class="comment">#买支付100元</span></span><br><span class="line">update user <span class="built_in">set</span> balance=<span class="number">1010</span> where name=<span class="string">&#x27;egon&#x27;</span>; <span class="comment">#中介拿走10元</span></span><br><span class="line">update user <span class="built_in">set</span> balance=<span class="number">1090</span> where name=<span class="string">&#x27;tank&#x27;</span>; <span class="comment">#卖家拿到90元</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 回滚到上一个状态</span></span><br><span class="line">rollback;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启事务之后，只要没有执行commit操作，数据其实都没有真正刷新到硬盘</span></span><br><span class="line">commit;</span><br><span class="line"><span class="string">&quot;&quot;&quot;开启事务检测操作是否完整，不完整主动回滚到上一个状态，如果完整就应该执行commit操作&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 站在python代码的角度，应该实现的伪代码逻辑，</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    update user <span class="built_in">set</span> balance=<span class="number">900</span> where name=<span class="string">&#x27;jason&#x27;</span>; <span class="comment">#买支付100元</span></span><br><span class="line">    update user <span class="built_in">set</span> balance=<span class="number">1010</span> where name=<span class="string">&#x27;egon&#x27;</span>; <span class="comment">#中介拿走10元</span></span><br><span class="line">    update user <span class="built_in">set</span> balance=<span class="number">1090</span> where name=<span class="string">&#x27;tank&#x27;</span>; <span class="comment">#卖家拿到90元</span></span><br><span class="line"><span class="keyword">except</span> 异常:</span><br><span class="line">    rollback;</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    commit;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h2><p><strong>存储过程包含了一系列可执行的sql语句，存储过程存放于MySQL中，通过调用它的名字可以执行其内部的一堆sql,类似于python中的自定义函数</strong></p>
<h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$</span><br><span class="line">create procedure p1()</span><br><span class="line">begin</span><br><span class="line">    select * <span class="keyword">from</span> user;</span><br><span class="line">end $$</span><br><span class="line">delimiter ;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用</span></span><br><span class="line">call p1()</span><br></pre></td></tr></table></figure>

<h2 id="三种开发模型"><a href="#三种开发模型" class="headerlink" title="三种开发模型"></a>三种开发模型</h2><h3 id="第一种"><a href="#第一种" class="headerlink" title="第一种"></a>第一种</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">应用程序：只需要开发应用程序的逻辑</span></span><br><span class="line"><span class="string">mysql:编写好存储过程，以供应用程序调用</span></span><br><span class="line"><span class="string">优点：开发效率，执行效率都高</span></span><br><span class="line"><span class="string">缺点：考虑到人为因素、跨部门沟通等问题，会导致扩展性差</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="第二种"><a href="#第二种" class="headerlink" title="第二种"></a>第二种</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">应用程序：除了开发应用程序的逻辑，还需要编写原生sql</span></span><br><span class="line"><span class="string">优点：比方式1，扩展性高(非技术性的)</span></span><br><span class="line"><span class="string">缺点：</span></span><br><span class="line"><span class="string">1、开发效率，执行效率都不如方式1</span></span><br><span class="line"><span class="string">2、编写原生sql太过于复杂，而且需要考虑到sql语句的优化问题</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="第三种"><a href="#第三种" class="headerlink" title="第三种"></a>第三种</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">应用程序：开发应用程序的逻辑，不需要编写原生sql，基于别人编写好的框架来处理数据，ORM</span></span><br><span class="line"><span class="string">优点：不用再编写纯生sql，这意味着开发效率比方式2高，同时兼容方式2扩展性高的好处</span></span><br><span class="line"><span class="string">缺点：执行效率连方式2都比不过</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="创建存储过程"><a href="#创建存储过程" class="headerlink" title="创建存储过程"></a>创建存储过程</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 介绍形参特点  再写具体功能</span></span><br><span class="line"></span><br><span class="line">delimiter $$</span><br><span class="line">create procedure p2(</span><br><span class="line">    <span class="keyword">in</span> m <span class="built_in">int</span>,  <span class="comment"># in表示这个参数必须只能是传入不能被返回出去</span></span><br><span class="line">    <span class="keyword">in</span> n <span class="built_in">int</span>,  </span><br><span class="line">    out res <span class="built_in">int</span>  <span class="comment"># out表示这个参数可以被返回出去</span></span><br><span class="line">)</span><br><span class="line">begin</span><br><span class="line">    select tname <span class="keyword">from</span> teacher where tid &gt; m <span class="keyword">and</span> tid &lt; n;</span><br><span class="line">    <span class="built_in">set</span> res=<span class="number">0</span>;  <span class="comment"># 用来标志存储过程是否执行</span></span><br><span class="line">end $$</span><br><span class="line">delimiter ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 针对res需要先提前定义</span></span><br><span class="line"><span class="built_in">set</span> @res=<span class="number">10</span>;  定义</span><br><span class="line">select @res;  查看</span><br><span class="line">call p1(<span class="number">1</span>,<span class="number">5</span>,@res)  调用</span><br><span class="line">select @res  查看</span><br></pre></td></tr></table></figure>

<h3 id="如何用存储过程"><a href="#如何用存储过程" class="headerlink" title="如何用存储过程"></a>如何用存储过程</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 大前提:存储过程在哪个库下面创建的只能在对应的库下面才能使用！！！</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1、直接在mysql中调用</span></span><br><span class="line"><span class="built_in">set</span> @res=<span class="number">10</span>  <span class="comment"># res的值是用来判断存储过程是否被执行成功的依据，所以需要先定义一个变量@res存储10</span></span><br><span class="line">call p1(<span class="number">2</span>,<span class="number">4</span>,<span class="number">10</span>);  <span class="comment"># 报错</span></span><br><span class="line">call p1(<span class="number">2</span>,<span class="number">4</span>,@res);  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看结果</span></span><br><span class="line">select @res;  <span class="comment"># 执行成功，@res变量值发生了变化</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、在python程序中调用</span></span><br><span class="line">pymysql链接mysql</span><br><span class="line">产生的游表cursor.callproc(<span class="string">&#x27;p1&#x27;</span>,(<span class="number">2</span>,<span class="number">4</span>,<span class="number">10</span>))  <span class="comment"># 内部原理：@_p1_0=2,@_p1_1=4,@_p1_2=10;</span></span><br><span class="line">cursor.excute(<span class="string">&#x27;select @_p1_2;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、存储过程与事务使用举例(了解)</span></span><br><span class="line">delimiter //</span><br><span class="line">create PROCEDURE p5(</span><br><span class="line">    OUT p_return_code tinyint</span><br><span class="line">)</span><br><span class="line">BEGIN</span><br><span class="line">    DECLARE exit handler <span class="keyword">for</span> sqlexception</span><br><span class="line">    BEGIN</span><br><span class="line">        -- ERROR</span><br><span class="line">        <span class="built_in">set</span> p_return_code = <span class="number">1</span>;</span><br><span class="line">        rollback;</span><br><span class="line">    END;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  DECLARE exit handler <span class="keyword">for</span> sqlwarning</span><br><span class="line">  BEGIN</span><br><span class="line">      -- WARNING</span><br><span class="line">      <span class="built_in">set</span> p_return_code = <span class="number">2</span>;</span><br><span class="line">      rollback;</span><br><span class="line">  END;</span><br><span class="line"></span><br><span class="line">  START TRANSACTION;</span><br><span class="line">      update user <span class="built_in">set</span> balance=<span class="number">900</span> where <span class="built_in">id</span> =<span class="number">1</span>;</span><br><span class="line">      update user123 <span class="built_in">set</span> balance=<span class="number">1010</span> where <span class="built_in">id</span> = <span class="number">2</span>;</span><br><span class="line">      update user <span class="built_in">set</span> balance=<span class="number">1090</span> where <span class="built_in">id</span> =<span class="number">3</span>;</span><br><span class="line">  COMMIT;</span><br><span class="line"></span><br><span class="line">  -- SUCCESS</span><br><span class="line">  <span class="built_in">set</span> p_return_code = <span class="number">0</span>; <span class="comment">#0代表执行成功</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>

<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>注意与存储过程的区别，mysql内置的函数只能在sql语句中使用！</p>
<p>参考博客：<a target="_blank" rel="noopener" href="http://www.cnblogs.com/linhaifeng/articles/7495918.html#_label2">http://www.cnblogs.com/linhaifeng/articles/7495918.html#_label2</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE blog (</span><br><span class="line">    <span class="built_in">id</span> INT PRIMARY KEY auto_increment,</span><br><span class="line">    NAME CHAR (<span class="number">32</span>),</span><br><span class="line">    sub_time datetime</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO blog (NAME, sub_time)</span><br><span class="line">VALUES</span><br><span class="line">    (<span class="string">&#x27;第1篇&#x27;</span>,<span class="string">&#x27;2015-03-01 11:31:21&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;第2篇&#x27;</span>,<span class="string">&#x27;2015-03-11 16:31:21&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;第3篇&#x27;</span>,<span class="string">&#x27;2016-07-01 10:21:31&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;第4篇&#x27;</span>,<span class="string">&#x27;2016-07-22 09:23:21&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;第5篇&#x27;</span>,<span class="string">&#x27;2016-07-23 10:11:11&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;第6篇&#x27;</span>,<span class="string">&#x27;2016-07-25 11:21:31&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;第7篇&#x27;</span>,<span class="string">&#x27;2017-03-01 15:33:21&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;第8篇&#x27;</span>,<span class="string">&#x27;2017-03-01 17:32:21&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;第9篇&#x27;</span>,<span class="string">&#x27;2017-03-01 18:31:21&#x27;</span>);</span><br><span class="line"></span><br><span class="line">select date_format(sub_time,<span class="string">&#x27;%Y-%m&#x27;</span>),count(<span class="built_in">id</span>) <span class="keyword">from</span> blog group by date_format(sub_time,<span class="string">&#x27;%Y-%m&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># if条件语句</span></span><br><span class="line">delimiter //</span><br><span class="line">CREATE PROCEDURE proc_if ()</span><br><span class="line">BEGIN</span><br><span class="line">    </span><br><span class="line">    declare i <span class="built_in">int</span> default <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> i = <span class="number">1</span> THEN</span><br><span class="line">        SELECT <span class="number">1</span>;</span><br><span class="line">    ELSEIF i = <span class="number">2</span> THEN</span><br><span class="line">        SELECT <span class="number">2</span>;</span><br><span class="line">    ELSE</span><br><span class="line">        SELECT <span class="number">7</span>;</span><br><span class="line">    END IF;</span><br><span class="line"></span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br><span class="line"><span class="comment"># while循环</span></span><br><span class="line">delimiter //</span><br><span class="line">CREATE PROCEDURE proc_while ()</span><br><span class="line">BEGIN</span><br><span class="line"></span><br><span class="line">    DECLARE num INT ;</span><br><span class="line">    SET num = <span class="number">0</span> ;</span><br><span class="line">    WHILE num &lt; <span class="number">10</span> DO</span><br><span class="line">        SELECT</span><br><span class="line">            num ;</span><br><span class="line">        SET num = num + <span class="number">1</span> ;</span><br><span class="line">    END WHILE ;</span><br><span class="line"></span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>

<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><p>知识回顾:数据都是存在硬盘上的，那查询数据不可避免的需要进行IO操作</p>
<p>索引就是一种数据结构，类似于书的目录。意味着以后再查数据应该先找目录再找数据，而不是用翻页的方式查询数据</p>
<p><em>索引在MySQL中也叫做“键”，是存储引擎用于快速找到记录的一种数据结构。</em></p>
<ul>
<li>primary key</li>
<li>unique key</li>
<li>index key</li>
</ul>
<p>注意foreign key不是用来加速查询用的，不在我们研究范围之内,上面三种key前两种除了有加速查询的效果之外还有额外的约束条件(primary key:非空且唯一，unique key:唯一)，而index key没有任何约束功能只会帮你加速查询</p>
<p><strong>本质都是：通过不断地缩小想要获取数据的范围来筛选出最终想要的结果，同时把随机的事件变成顺序的事件，也就是说，有了这种索引机制，我们可以总是用同一种查找方式来锁定数据。</strong></p>
<p><strong>索引的影响:</strong></p>
<ul>
<li>在表中有大量数据的前提下，创建索引速度会很慢</li>
<li>在索引创建完毕后，对表的查询性能会大幅度提升，但是写的性能会降低</li>
</ul>
<h4 id="b-树"><a href="#b-树" class="headerlink" title="b+树"></a>b+树</h4><p><a target="_blank" rel="noopener" href="https://images2017.cnblogs.com/blog/1036857/201709/1036857-20170912011123500-158121126.png">https://images2017.cnblogs.com/blog/1036857/201709/1036857-20170912011123500-158121126.png</a></p>
<p>只有叶子结点存放真实数据，根和树枝节点存的仅仅是虚拟数据</p>
<p>查询次数由树的层级决定，层级越低次数越少</p>
<p>一个磁盘块儿的大小是一定的，那也就意味着能存的数据量是一定的。如何保证树的层级最低呢？一个磁盘块儿存放占用空间比较小的数据项</p>
<p>思考我们应该给我们一张表里面的什么字段字段建立索引能够降低树的层级高度&gt;&gt;&gt; 主键id字段</p>
<h4 id="聚集索引-primary-key"><a href="#聚集索引-primary-key" class="headerlink" title="聚集索引(primary key)"></a>聚集索引(primary key)</h4><p>聚集索引其实指的就是表的主键，innodb引擎规定一张表中必须要有主键。先来回顾一下存储引擎。</p>
<p>myisam在建表的时候对应到硬盘有几个文件(三个)？</p>
<p>innodb在建表的时候对应到硬盘有几个文件(两个)？frm文件只存放表结构，不可能放索引，也就意味着innodb的索引跟数据都放在idb表数据文件中。</p>
<p>**特点:**叶子结点放的一条条完整的记录</p>
<h4 id="辅助索引-unique-index"><a href="#辅助索引-unique-index" class="headerlink" title="辅助索引(unique,index)"></a>辅助索引(unique,index)</h4><p>辅助索引:查询数据的时候不可能都是用id作为筛选条件，也可能会用name，password等字段信息，那么这个时候就无法利用到聚集索引的加速查询效果。就需要给其他字段建立索引，这些索引就叫辅助索引</p>
<p><strong>特点：</strong>叶子结点存放的是辅助索引字段对应的那条记录的主键的值(比如:按照name字段创建索引，那么叶子节点存放的是:{name对应的值:name所在的那条记录的主键值})</p>
<p>select name from user where name=’jason’;</p>
<p>上述语句叫覆盖索引:只在辅助索引的叶子节点中就已经找到了所有我们想要的数据</p>
<p>select age from user where name=’jason’;</p>
<p>上述语句叫非覆盖索引,虽然查询的时候命中了索引字段name，但是要查的是age字段，所以还需要利用主键才去查找</p>
<h2 id="测试索引"><a href="#测试索引" class="headerlink" title="测试索引"></a>测试索引</h2><h3 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1. 准备表</span></span><br><span class="line">create table s1(</span><br><span class="line"><span class="built_in">id</span> <span class="built_in">int</span>,</span><br><span class="line">name varchar(<span class="number">20</span>),</span><br><span class="line">gender char(<span class="number">6</span>),</span><br><span class="line">email varchar(<span class="number">50</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">#2. 创建存储过程，实现批量插入记录</span></span><br><span class="line">delimiter $$ <span class="comment">#声明存储过程的结束符号为$$</span></span><br><span class="line">create procedure auto_insert1()</span><br><span class="line">BEGIN</span><br><span class="line">    declare i <span class="built_in">int</span> default <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(i&lt;<span class="number">3000000</span>)do</span><br><span class="line">        insert into s1 values(i,<span class="string">&#x27;jason&#x27;</span>,<span class="string">&#x27;male&#x27;</span>,concat(<span class="string">&#x27;jason&#x27;</span>,i,<span class="string">&#x27;@oldboy&#x27;</span>));</span><br><span class="line">        <span class="built_in">set</span> i=i+<span class="number">1</span>;</span><br><span class="line">    end <span class="keyword">while</span>;</span><br><span class="line">END$$ <span class="comment">#$$结束</span></span><br><span class="line">delimiter ; <span class="comment">#重新声明分号为结束符号</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3. 查看存储过程</span></span><br><span class="line">show create procedure auto_insert1\G </span><br><span class="line"></span><br><span class="line"><span class="comment">#4. 调用存储过程</span></span><br><span class="line">call auto_insert1();</span><br><span class="line"><span class="comment"># 表没有任何索引的情况下</span></span><br><span class="line">select * <span class="keyword">from</span> s1 where <span class="built_in">id</span>=<span class="number">30000</span>;</span><br><span class="line"><span class="comment"># 避免打印带来的时间损耗</span></span><br><span class="line">select count(<span class="built_in">id</span>) <span class="keyword">from</span> s1 where <span class="built_in">id</span> = <span class="number">30000</span>;</span><br><span class="line">select count(<span class="built_in">id</span>) <span class="keyword">from</span> s1 where <span class="built_in">id</span> = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 给id做一个主键</span></span><br><span class="line">alter table s1 add primary key(<span class="built_in">id</span>);  <span class="comment"># 速度很慢</span></span><br><span class="line"></span><br><span class="line">select count(<span class="built_in">id</span>) <span class="keyword">from</span> s1 where <span class="built_in">id</span> = <span class="number">1</span>;  <span class="comment"># 速度相较于未建索引之前两者差着数量级</span></span><br><span class="line">select count(<span class="built_in">id</span>) <span class="keyword">from</span> s1 where name = <span class="string">&#x27;jason&#x27;</span>  <span class="comment"># 速度仍然很慢</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">范围问题</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 并不是加了索引，以后查询的时候按照这个字段速度就一定快   </span></span><br><span class="line">select count(<span class="built_in">id</span>) <span class="keyword">from</span> s1 where <span class="built_in">id</span> &gt; <span class="number">1</span>;  <span class="comment"># 速度相较于id = 1慢了很多</span></span><br><span class="line">select count(<span class="built_in">id</span>) <span class="keyword">from</span> s1 where <span class="built_in">id</span> &gt;<span class="number">1</span> <span class="keyword">and</span> <span class="built_in">id</span> &lt; <span class="number">3</span>;</span><br><span class="line">select count(<span class="built_in">id</span>) <span class="keyword">from</span> s1 where <span class="built_in">id</span> &gt; <span class="number">1</span> <span class="keyword">and</span> <span class="built_in">id</span> &lt; <span class="number">10000</span>;</span><br><span class="line">select count(<span class="built_in">id</span>) <span class="keyword">from</span> s1 where <span class="built_in">id</span> != <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">alter table s1 drop primary key;  <span class="comment"># 删除主键 单独再来研究name字段</span></span><br><span class="line">select count(<span class="built_in">id</span>) <span class="keyword">from</span> s1 where name = <span class="string">&#x27;jason&#x27;</span>;  <span class="comment"># 又慢了</span></span><br><span class="line"></span><br><span class="line">create index idx_name on s1(name);  <span class="comment"># 给s1表的name字段创建索引</span></span><br><span class="line">select count(<span class="built_in">id</span>) <span class="keyword">from</span> s1 where name = <span class="string">&#x27;jason&#x27;</span>  <span class="comment"># 仍然很慢！！！</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">再来看b+树的原理，数据需要区分度比较高，而我们这张表全是jason，根本无法区分</span></span><br><span class="line"><span class="string">那这个树其实就建成了“一根棍子”</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">select count(<span class="built_in">id</span>) <span class="keyword">from</span> s1 where name = <span class="string">&#x27;xxx&#x27;</span>;  </span><br><span class="line"><span class="comment"># 这个会很快，我就是一根棍，第一个不匹配直接不需要再往下走了</span></span><br><span class="line">select count(<span class="built_in">id</span>) <span class="keyword">from</span> s1 where name like <span class="string">&#x27;xxx&#x27;</span>;</span><br><span class="line">select count(<span class="built_in">id</span>) <span class="keyword">from</span> s1 where name like <span class="string">&#x27;xxx%&#x27;</span>;</span><br><span class="line">select count(<span class="built_in">id</span>) <span class="keyword">from</span> s1 where name like <span class="string">&#x27;%xxx&#x27;</span>;  <span class="comment"># 慢 最左匹配特性</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 区分度低的字段不能建索引</span></span><br><span class="line">drop index idx_name on s1;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 给id字段建普通的索引</span></span><br><span class="line">create index idx_id on s1(<span class="built_in">id</span>);</span><br><span class="line">select count(<span class="built_in">id</span>) <span class="keyword">from</span> s1 where <span class="built_in">id</span> = <span class="number">3</span>;  <span class="comment"># 快了</span></span><br><span class="line">select count(<span class="built_in">id</span>) <span class="keyword">from</span> s1 where <span class="built_in">id</span>*<span class="number">12</span> = <span class="number">3</span>;  <span class="comment"># 慢了  索引的字段一定不要参与计算</span></span><br><span class="line"></span><br><span class="line">drop index idx_id on s1;</span><br><span class="line">select count(<span class="built_in">id</span>) <span class="keyword">from</span> s1 where name=<span class="string">&#x27;jason&#x27;</span> <span class="keyword">and</span> gender = <span class="string">&#x27;male&#x27;</span> <span class="keyword">and</span> <span class="built_in">id</span> = <span class="number">3</span> <span class="keyword">and</span> email = <span class="string">&#x27;xxx&#x27;</span>;</span><br><span class="line"><span class="comment"># 针对上面这种连续多个and的操作，mysql会从左到右先找区分度比较高的索引字段，先将整体范围降下来再去比较其他条件</span></span><br><span class="line">create index idx_name on s1(name);</span><br><span class="line">select count(<span class="built_in">id</span>) <span class="keyword">from</span> s1 where name=<span class="string">&#x27;jason&#x27;</span> <span class="keyword">and</span> gender = <span class="string">&#x27;male&#x27;</span> <span class="keyword">and</span> <span class="built_in">id</span> = <span class="number">3</span> <span class="keyword">and</span> email = <span class="string">&#x27;xxx&#x27;</span>;  <span class="comment"># 并没有加速</span></span><br><span class="line"></span><br><span class="line">drop index idx_name on s1;</span><br><span class="line"><span class="comment"># 给name，gender这种区分度不高的字段加上索引并不难加快查询速度</span></span><br><span class="line"></span><br><span class="line">create index idx_id on s1(<span class="built_in">id</span>);</span><br><span class="line">select count(<span class="built_in">id</span>) <span class="keyword">from</span> s1 where name=<span class="string">&#x27;jason&#x27;</span> <span class="keyword">and</span> gender = <span class="string">&#x27;male&#x27;</span> <span class="keyword">and</span> <span class="built_in">id</span> = <span class="number">3</span> <span class="keyword">and</span> email = <span class="string">&#x27;xxx&#x27;</span>;  <span class="comment"># 快了  先通过id已经讲数据快速锁定成了一条了</span></span><br><span class="line">select count(<span class="built_in">id</span>) <span class="keyword">from</span> s1 where name=<span class="string">&#x27;jason&#x27;</span> <span class="keyword">and</span> gender = <span class="string">&#x27;male&#x27;</span> <span class="keyword">and</span> <span class="built_in">id</span> &gt; <span class="number">3</span> <span class="keyword">and</span> email = <span class="string">&#x27;xxx&#x27;</span>;  <span class="comment"># 慢了  基于id查出来的数据仍然很多，然后还要去比较其他字段</span></span><br><span class="line"></span><br><span class="line">drop index idx_id on s1</span><br><span class="line"></span><br><span class="line">create index idx_email on s1(email);</span><br><span class="line">select count(<span class="built_in">id</span>) <span class="keyword">from</span> s1 where name=<span class="string">&#x27;jason&#x27;</span> <span class="keyword">and</span> gender = <span class="string">&#x27;male&#x27;</span> <span class="keyword">and</span> <span class="built_in">id</span> &gt; <span class="number">3</span> <span class="keyword">and</span> email = <span class="string">&#x27;xxx&#x27;</span>;  <span class="comment"># 快 通过email字段一剑封喉 </span></span><br></pre></td></tr></table></figure>

<h3 id="联合索引"><a href="#联合索引" class="headerlink" title="联合索引"></a>联合索引</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">select count(<span class="built_in">id</span>) <span class="keyword">from</span> s1 where name=<span class="string">&#x27;jason&#x27;</span> <span class="keyword">and</span> gender = <span class="string">&#x27;male&#x27;</span> <span class="keyword">and</span> <span class="built_in">id</span> &gt; <span class="number">3</span> <span class="keyword">and</span> email = <span class="string">&#x27;xxx&#x27;</span>;  </span><br><span class="line"><span class="comment"># 如果上述四个字段区分度都很高，那给谁建都能加速查询</span></span><br><span class="line"><span class="comment"># 给email加然而不用email字段</span></span><br><span class="line">select count(<span class="built_in">id</span>) <span class="keyword">from</span> s1 where name=<span class="string">&#x27;jason&#x27;</span> <span class="keyword">and</span> gender = <span class="string">&#x27;male&#x27;</span> <span class="keyword">and</span> <span class="built_in">id</span> &gt; <span class="number">3</span>; </span><br><span class="line"><span class="comment"># 给name加然而不用name字段</span></span><br><span class="line">select count(<span class="built_in">id</span>) <span class="keyword">from</span> s1 where gender = <span class="string">&#x27;male&#x27;</span> <span class="keyword">and</span> <span class="built_in">id</span> &gt; <span class="number">3</span>; </span><br><span class="line"><span class="comment"># 给gender加然而不用gender字段</span></span><br><span class="line">select count(<span class="built_in">id</span>) <span class="keyword">from</span> s1 where <span class="built_in">id</span> &gt; <span class="number">3</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment"># 带来的问题是所有的字段都建了索引然而都没有用到，还需要花费四次建立的时间</span></span><br><span class="line">create index idx_all on s1(email,name,gender,<span class="built_in">id</span>);  <span class="comment"># 最左匹配原则，区分度高的往左放</span></span><br><span class="line">select count(<span class="built_in">id</span>) <span class="keyword">from</span> s1 where name=<span class="string">&#x27;jason&#x27;</span> <span class="keyword">and</span> gender = <span class="string">&#x27;male&#x27;</span> <span class="keyword">and</span> <span class="built_in">id</span> &gt; <span class="number">3</span> <span class="keyword">and</span> email = <span class="string">&#x27;xxx&#x27;</span>;  <span class="comment"># 速度变快</span></span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结:"></a>总结:</h2><p>上面这些操作，你感兴趣可以敲一敲，不感兴趣你就可以不用敲了，权当看个乐呵。理论掌握了就行了</p>
<p>慢查询日志</p>
<p>设定一个时间检测所有超出该时间的sql语句，然后针对性的进行优化！</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/02/11/MySQL%E9%AB%98%E7%BA%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/02/11/MySQL%E9%AB%98%E7%BA%A7/" class="post-title-link" itemprop="url">MySQL高级</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-02-11 07:20:25" itemprop="dateCreated datePublished" datetime="2020-02-11T07:20:25+08:00">2020-02-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-03-01 12:22:34" itemprop="dateModified" datetime="2020-03-01T12:22:34+08:00">2020-03-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MySQL%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">MySQL系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="链接管理"><a href="#链接管理" class="headerlink" title="链接管理"></a>链接管理</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql</span><br><span class="line"></span><br><span class="line">-u      指定用户</span><br><span class="line">-p      指定密码</span><br><span class="line">-h      指定主机域</span><br><span class="line">-S      指定socket文件</span><br><span class="line">-P      指定端口</span><br><span class="line">-e      指定SQL语句</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置优先级</span></span><br><span class="line">/etc/my.cnf                                     <span class="number">1</span></span><br><span class="line">/etc/mysql/my.cnf                               <span class="number">10</span></span><br><span class="line">/application/mysql/my.cnf       				<span class="number">20</span></span><br><span class="line">~/.my.cnf                                       <span class="number">30</span></span><br></pre></td></tr></table></figure>



<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">什么是实例？</span><br><span class="line"></span><br><span class="line">进程+多个线程+预分配内存结构</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">什么是多实例？</span><br><span class="line"></span><br><span class="line">（进程+多个线程+预分配内存结构）*多个</span><br><span class="line"></span><br><span class="line">多个端口</span><br><span class="line">多套配置文件</span><br><span class="line">多个socket文件</span><br><span class="line">datadir（多套数据目录）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">多套配置文件：端口，多个data目录，多个socket文件</span><br></pre></td></tr></table></figure>



<h3 id="SQL结构化查询语言包含6个部分"><a href="#SQL结构化查询语言包含6个部分" class="headerlink" title="SQL结构化查询语言包含6个部分"></a><strong>SQL结构化查询语言包含6个部分</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.数据查询语言（DQL: Data Query Language）</span></span><br><span class="line">数据检索语句，用于从表中获取数据。通常最常用的为保留字SELECT,并且常与FROM子句、WHERE子句组成查询SQL查询语句。</span><br><span class="line">语法：</span><br><span class="line">    SELECT &lt;字段名&gt; FROM &lt;表或视图名&gt; WHERE &lt;查询条件&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.数据操纵语言（DML：Data Manipulation Language）</span></span><br><span class="line">主要用来对数据库的数据进行一些操作，常用的就是INSERT、UPDATE、DELETE。</span><br><span class="line">语法：</span><br><span class="line">    INSERT INTO &lt;表名&gt;(列<span class="number">1</span>,列<span class="number">2</span>,...) VALUES (值<span class="number">1</span>,值<span class="number">2</span>,...);</span><br><span class="line">    UPDATE &lt;表名&gt; SET &lt;列名&gt;=新值 WHERE &lt;列名&gt;=某值;</span><br><span class="line">    DELETE FROM &lt;表名&gt; WHERE &lt;列名&gt;=某值;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.事务处理语言（DPL）</span></span><br><span class="line"></span><br><span class="line">事务处理语句能确保被DML语句影响的表的所有行及时得以更新。TPL语句包括BEGIN TRANSACTION、COMMIT和ROLLBACK。</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.数据控制语言（DCL）</span></span><br><span class="line">通过GRANT和REVOKE，确定单个用户或用户组对数据库对象的访问权限。</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.数据定义语言（DDL）</span></span><br><span class="line">常用的有CREATE和DROP，用于在数据库中创建新表或删除表，以及为表加入索引等。</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.指针控制语言（CCL）</span></span><br><span class="line">它的语句，想DECLARE CURSOR、FETCH INTO和UPDATE WHERE CURRENT用于对一个或多个表单独行的操作。</span><br></pre></td></tr></table></figure>



<h3 id="字段注释"><a href="#字段注释" class="headerlink" title="字段注释"></a>字段注释</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># comment字段注释</span></span><br><span class="line"><span class="built_in">id</span> <span class="built_in">int</span> <span class="keyword">not</span> null primary key auto_increment comment <span class="string">&#x27;学号&#x27;</span>,</span><br><span class="line">name varchar(<span class="number">10</span>) <span class="keyword">not</span> null comment <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">age tinyint unsigned comment <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">sex enum(<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;m&#x27;</span>,<span class="string">&#x27;bgx&#x27;</span>) <span class="keyword">not</span> null default <span class="string">&#x27;bgx&#x27;</span> comment <span class="string">&#x27;性别&#x27;</span>,</span><br><span class="line">date datetime <span class="keyword">not</span> null default NOW() comment <span class="string">&#x27;入学时间&#x27;</span>);</span><br></pre></td></tr></table></figure>



<h3 id="查询优化"><a href="#查询优化" class="headerlink" title="查询优化"></a>查询优化</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#范围查询OR语句</span></span><br><span class="line">select * <span class="keyword">from</span> city where countrycode=<span class="string">&#x27;CHN&#x27;</span> <span class="keyword">or</span> countrycode=<span class="string">&#x27;USA&#x27;</span>;</span><br><span class="line"><span class="comment">#范围查询IN语句</span></span><br><span class="line">select * <span class="keyword">from</span> city where countrycode <span class="keyword">in</span> (<span class="string">&#x27;CHN&#x27;</span>,<span class="string">&#x27;USA&#x27;</span>);</span><br><span class="line">-- 上述两条sql语句等价且效率一致</span><br><span class="line"></span><br><span class="line"><span class="comment"># 效率更高(推荐)</span></span><br><span class="line">select * <span class="keyword">from</span> city where countrycode=<span class="string">&#x27;CHN&#x27;</span> </span><br><span class="line">union  <span class="built_in">all</span></span><br><span class="line">select * <span class="keyword">from</span> city where countrycode=<span class="string">&#x27;USA&#x27;</span> limit <span class="number">10</span></span><br></pre></td></tr></table></figure>



<h3 id="MySQL索引管理"><a href="#MySQL索引管理" class="headerlink" title="MySQL索引管理"></a>MySQL索引管理</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">btree       叶子结点不能直接跨(指针)</span><br><span class="line">b+tree  叶子结点可以直接跨(指针)(<span class="number">5.6</span>/<span class="number">5.7</span>用的都是该算法)</span><br><span class="line">b*tree  除了叶子结点、枝结点也能跨(指针)</span><br><span class="line"></span><br><span class="line">这些指针的添加都是为了提升范围查询的效率</span><br><span class="line">优化范围查询</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建索引</span></span><br><span class="line">alter table test add index index_name(name);</span><br><span class="line"><span class="comment">#创建索引</span></span><br><span class="line">create index index_name on test(name);</span><br><span class="line"><span class="comment">#查看索引</span></span><br><span class="line">desc table;</span><br><span class="line"><span class="comment">#查看索引</span></span><br><span class="line">show index <span class="keyword">from</span> table;</span><br><span class="line"><span class="comment">#删除索引</span></span><br><span class="line">alter table test drop key index_name;</span><br><span class="line"><span class="comment">#添加唯一性索引</span></span><br><span class="line">alter table student add unique key uni_xxx(xxx);</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">添加唯一索引需要事先判断是否有重复数据 没有重复才能创建</span></span><br><span class="line"><span class="string">#查看表中数据行数</span></span><br><span class="line"><span class="string">select count(name) from city;</span></span><br><span class="line"><span class="string">#查看去重数据行数</span></span><br><span class="line"><span class="string">select count(distinct name) from city;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 前缀索引</span></span><br><span class="line">根据字段的前N个字符建立索引</span><br><span class="line">    避免对大列建索引</span><br><span class="line">    如果有，就使用前缀索引</span><br><span class="line">  alter table test add index idx_name(name(<span class="number">10</span>));</span><br><span class="line">  </span><br><span class="line"><span class="comment"># 联合索引</span></span><br><span class="line">多个字段建立一个索引</span><br><span class="line">例：</span><br><span class="line">    where a.女生 <span class="keyword">and</span> b.身高 <span class="keyword">and</span> c.体重 <span class="keyword">and</span> d.身材好</span><br><span class="line">    index(a,b,c)</span><br><span class="line">    特点：前缀生效特性</span><br><span class="line">    a,ab,ac,abc,abcd 可以走索引或部分走索引</span><br><span class="line">    b bc bcd cd c d ba ... 不走索引</span><br><span class="line">创建people表</span><br><span class="line">create table people (<span class="built_in">id</span> <span class="built_in">int</span>,name varchar(<span class="number">20</span>),age tinyint,money <span class="built_in">int</span> ,gender enum(<span class="string">&#x27;m&#x27;</span>,<span class="string">&#x27;f&#x27;</span>));</span><br><span class="line"><span class="comment">#创建联合索引</span></span><br><span class="line">alter table people add index idx_all(gender,age,money);</span><br></pre></td></tr></table></figure>



<h3 id="explain"><a href="#explain" class="headerlink" title="explain"></a>explain</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>全表扫描</span><br><span class="line">    在explain语句结果中<span class="built_in">type</span>为ALL</span><br><span class="line"><span class="number">2.</span>什么时候出现全表扫描?</span><br><span class="line">  <span class="number">2.1</span> 业务确实要获取所有数据</span><br><span class="line">  <span class="number">2.2</span> 不走索引导致的全表扫描</span><br><span class="line">    <span class="number">2.2</span><span class="number">.1</span> 没索引</span><br><span class="line">    <span class="number">2.2</span><span class="number">.2</span> 索引创建有问题</span><br><span class="line">    <span class="number">2.2</span><span class="number">.3</span> 语句有问题</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;mysql在使用全表扫描时的性能是极其差的，所以MySQL尽量避免出现全表扫描&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># explain命令使用方法</span></span><br><span class="line">explain select name,countrycode <span class="keyword">from</span> city where <span class="built_in">id</span>=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>索引扫描</span><br><span class="line">    常见的索引扫描类型:</span><br><span class="line">    <span class="number">1</span>）index</span><br><span class="line">    <span class="number">2</span>）<span class="built_in">range</span></span><br><span class="line">    <span class="number">3</span>）ref</span><br><span class="line">    <span class="number">4</span>）eq_ref</span><br><span class="line">    <span class="number">5</span>）const</span><br><span class="line">    <span class="number">6</span>）system</span><br><span class="line">    <span class="number">7</span>）null</span><br><span class="line"><span class="string">&quot;&quot;&quot;从上到下，性能从最差到最好，我们认为至少要达到range级别&quot;&quot;&quot;</span></span><br><span class="line"><span class="number">1.</span>index：Full Index Scan，index与ALL区别为index类型只遍历索引树</span><br><span class="line"><span class="number">2.</span><span class="built_in">range</span>：索引范围扫描，对索引的扫描开始于某一点，返回匹配值域的行。显而易见的索引范围扫描是带有between或者where子句里带有&lt;,&gt;查询</span><br><span class="line"><span class="number">3.</span>ref：使用非唯一索引扫描或者唯一索引的前缀扫描，返回匹配某个单独值的记录行</span><br><span class="line"><span class="number">4.</span>eq_ref：类似ref，区别就在使用的索引是唯一索引，对于每个索引键值，表中只有一条记录匹配，简单来说，就是多表连接中使用primary key或者 unique key作为关联条件A</span><br><span class="line"><span class="number">5.</span>const、system：当MySQL对查询某部分进行优化，并转换为一个常量时，使用这些类型访问:如将主键置于where列表中，MySQL就能将该查询转换为一个常量</span><br><span class="line"><span class="number">6.</span>NULL：MySQL在优化过程中分解语句，执行时甚至不用访问表或索引(条件不存在)，例如从一个索引列里选取最小值可以通过单独索引查找完成。 </span><br><span class="line"></span><br><span class="line">查询语句最好</span><br><span class="line">    key_len: 越小越好</span><br><span class="line">  rows: 越小越好</span><br></pre></td></tr></table></figure>



<h3 id="建立索引原则"><a href="#建立索引原则" class="headerlink" title="建立索引原则"></a>建立索引原则</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>选择唯一性索引(尽量考虑这个)</span><br><span class="line">    唯一性索引的值是唯一的，可以更快速的通过该索引来确定某条记录</span><br><span class="line">    <span class="comment"># 如果重复值较多，可以考虑采用联合索引</span></span><br><span class="line"><span class="number">2.</span>为经常需要排序、分组和联合操作的字段建立索引</span><br><span class="line"><span class="number">3.</span>为常作为查询条件的字段建立索引</span><br><span class="line">    <span class="number">3.1</span> 经常查询</span><br><span class="line">  <span class="number">3.2</span> 列值的重复值少</span><br><span class="line">    注:如果经常作为条件的列，重复值特别多，可以建立联合索引</span><br><span class="line"><span class="number">4</span>．尽量使用前缀来索引</span><br><span class="line">    如果索引字段的值很长，最好使用值的前缀来索引</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">5．限制索引的数目</span></span><br><span class="line"><span class="string">索引的数目不是越多越好。每个索引都需要占用磁盘空间，索引越多，需要的磁盘空间就越大。</span></span><br><span class="line"><span class="string">修改表时，对索引的重构和更新很麻烦。越多的索引，会使更新表变得很浪费时间。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">6．删除不再使用或者很少使用的索引</span></span><br><span class="line"><span class="string">表中的数据被大量更新，或者数据的使用方式被改变后，原有的一些索引可能不再需要。数据库管理</span></span><br><span class="line"><span class="string">员应当定期找出这些索引，将它们删除，从而减少索引对更新操作的影响。</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*******************不走索引的情况*******************</span><br><span class="line"><span class="number">1.</span>没有查询条件，或者查询条件没有建立索引</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    在业务数据库中，特别是数据量比较大的表,是没有全表扫描这种需求。</span></span><br><span class="line"><span class="string">    1）对用户查看是非常痛苦的。</span></span><br><span class="line"><span class="string">    2）对服务器来讲毁灭性的。</span></span><br><span class="line"><span class="string">    3）SQL改写成以下语句：</span></span><br><span class="line"><span class="string">    #情况1</span></span><br><span class="line"><span class="string">    #全表扫描</span></span><br><span class="line"><span class="string">    select * from table;</span></span><br><span class="line"><span class="string">    #需要在price列上建立索引</span></span><br><span class="line"><span class="string">    selec  * from tab  order by  price  limit 10;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    #情况2</span></span><br><span class="line"><span class="string">    #name列没有索引</span></span><br><span class="line"><span class="string">    select * from table where name=&#x27;zhangsan&#x27;; </span></span><br><span class="line"><span class="string">    1、换成有索引的列作为查询条件</span></span><br><span class="line"><span class="string">    2、将name列建立索引</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"><span class="number">2.</span>查询结果集是原表中的大部分数据大概<span class="number">25</span>％以上</span><br><span class="line">    哪怕建了索引也不会走，所以这个时候一般会用limit限制</span><br><span class="line"><span class="number">3.</span>索引本身失效，统计数据不真实</span><br><span class="line">    索引有自我维护的能力</span><br><span class="line">    对于表内容变化比较频繁的情况下，有可能会出现索引失效。</span><br><span class="line">    <span class="comment"># 重建索引就可以解决</span></span><br><span class="line"><span class="number">4.</span>查询条件使用函数在索引列上或者对索引列进行运算，运算包括(+，-，*等)</span><br><span class="line">    错误的例子：select * <span class="keyword">from</span> test where <span class="built_in">id</span>-<span class="number">1</span>=<span class="number">9</span>; </span><br><span class="line">    正确的例子：select * <span class="keyword">from</span> test where <span class="built_in">id</span>=<span class="number">10</span>;</span><br><span class="line"><span class="number">5.</span>隐式转换导致索引失效.这一点应当引起重视.也是开发中经常会犯的错误</span><br><span class="line">    <span class="comment"># telnum定义的时候用的是varchar</span></span><br><span class="line">    create table test (<span class="built_in">id</span> <span class="built_in">int</span> ,name varchar(<span class="number">20</span>),telnum varchar(<span class="number">10</span>));</span><br><span class="line">    insert into test values(<span class="number">1</span>,<span class="string">&#x27;zs&#x27;</span>,<span class="string">&#x27;110&#x27;</span>),(<span class="number">2</span>,<span class="string">&#x27;l4&#x27;</span>,<span class="number">120</span>),(<span class="number">3</span>,<span class="string">&#x27;w5&#x27;</span>,<span class="number">119</span>),(<span class="number">4</span>,<span class="string">&#x27;z4&#x27;</span>,<span class="number">112</span>);</span><br><span class="line">    explain select * <span class="keyword">from</span> test where telnum=<span class="number">120</span>;</span><br><span class="line">    alter table test add index idx_tel(telnum);</span><br><span class="line">  <span class="comment"># 查询的时候给的确实数字类型</span></span><br><span class="line">    explain select * <span class="keyword">from</span> test where telnum=<span class="number">120</span>;</span><br><span class="line">    explain select * <span class="keyword">from</span> test where telnum=<span class="number">120</span>;</span><br><span class="line">    explain select * <span class="keyword">from</span> test where telnum=<span class="string">&#x27;120&#x27;</span>;</span><br><span class="line"><span class="number">6</span>． &lt;&gt; ，<span class="keyword">not</span> <span class="keyword">in</span> 不走索引</span><br><span class="line">    单独的&gt;,&lt;,<span class="keyword">in</span> 有可能走，也有可能不走，和结果集有关，尽量结合业务添加limit</span><br><span class="line">    <span class="keyword">or</span>或<span class="keyword">in</span>尽量改成union</span><br><span class="line">  EXPLAIN  SELECT * FROM teltab WHERE telnum IN (<span class="string">&#x27;110&#x27;</span>,<span class="string">&#x27;119&#x27;</span>);</span><br><span class="line">    <span class="comment">#改写成</span></span><br><span class="line">    EXPLAIN SELECT * FROM teltab WHERE telnum=<span class="string">&#x27;110&#x27;</span></span><br><span class="line">    UNION ALL</span><br><span class="line">    SELECT * FROM teltab WHERE telnum=<span class="string">&#x27;119&#x27;</span></span><br><span class="line"><span class="number">7</span>．like <span class="string">&quot;%_&quot;</span> 百分号在最前面不走</span><br><span class="line">    <span class="comment">#不走索引</span></span><br><span class="line">    EXPLAIN SELECT * FROM teltab WHERE telnum LIKE <span class="string">&#x27;%110&#x27;</span>;</span><br><span class="line">    <span class="comment">#走range索引扫描</span></span><br><span class="line">    EXPLAIN SELECT * FROM teltab WHERE telnum LIKE <span class="string">&#x27;31%&#x27;</span>;</span><br><span class="line">    <span class="comment"># %linux%类的搜索需求，可以使用Elasticsearch -------&gt; ELK</span></span><br><span class="line"><span class="number">8.</span>单独引用联合索引里非第一位置的索引列</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/10/11/Docker-compose/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/10/11/Docker-compose/" class="post-title-link" itemprop="url">Docker-compose</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-10-11 07:20:25" itemprop="dateCreated datePublished" datetime="2019-10-11T07:20:25+08:00">2019-10-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2019-11-01 12:22:34" itemprop="dateModified" datetime="2019-11-01T12:22:34+08:00">2019-11-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">Linux系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>docker-compose是容器编排工具，需要注意的是，docker-compose只是单机的容器编排工具</p>
<p>docker-compose 默认的配置文件为 : ==docker-compose.yaml==</p>
<h2 id="安装docker-compose"><a href="#安装docker-compose" class="headerlink" title="安装docker-compose"></a>安装docker-compose</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载</span></span><br><span class="line"></span><br><span class="line">docker文档 : `https://docs.docker.com/compose/install/`</span><br><span class="line">	</span><br><span class="line">1	sudo curl -L <span class="string">&quot;https://github.com/docker/compose/releases/download/1.29.2/docker-compose-<span class="subst">$(uname -s)</span>-<span class="subst">$(uname -m)</span>&quot;</span> -o /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line">	</span><br><span class="line">2	sudo chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line"></span><br><span class="line">3	sudo ln -s /usr/<span class="built_in">local</span>/bin/docker-compose /usr/bin/docker-compose</span><br><span class="line"></span><br><span class="line">4	docker-compose --version</span><br></pre></td></tr></table></figure>



<h2 id="docker-compose模板文件"><a href="#docker-compose模板文件" class="headerlink" title="docker-compose模板文件"></a>docker-compose模板文件</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.0&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">django:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">django:v2</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">django</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">django</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:5.7</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">admin123</span></span><br><span class="line">      <span class="attr">MYSQL_DATABASE:</span> <span class="string">bbs09</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;/root/docker-compose/mysql/data:/var/lib/mysql&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">django</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">        </span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">django</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">django:</span></span><br></pre></td></tr></table></figure>



<h2 id="docker-compose指令"><a href="#docker-compose指令" class="headerlink" title="docker-compose指令"></a>docker-compose指令</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># build</span></span><br><span class="line"></span><br><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.0&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">django:</span></span><br><span class="line">    <span class="attr">build:</span></span><br><span class="line">      <span class="string">./django</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.0&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">django:</span></span><br><span class="line">    <span class="attr">build:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">./django</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile</span></span><br><span class="line">      <span class="attr">args:</span></span><br><span class="line">        <span class="attr">NAME:</span> <span class="string">python</span></span><br><span class="line">        </span><br><span class="line"><span class="comment"># command	 : 设置容器启动命令</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># depends_on : 指定在某容器之后启动(依赖于某容器)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># env_file	 : 指定环境变量文件</span></span><br></pre></td></tr></table></figure>



<h2 id="docker-compose参数"><a href="#docker-compose参数" class="headerlink" title="docker-compose参数"></a>docker-compose参数</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">`启动`		 : docker-compose up</span><br><span class="line"></span><br><span class="line">`停止并删除`	   : docker-compose down</span><br><span class="line"></span><br><span class="line">`停止`		 : docker-compose stop</span><br><span class="line"></span><br><span class="line">`删除容器`		: docker-compose rm</span><br><span class="line"></span><br><span class="line">`重启`		 : docker-compose restart 容器名称</span><br><span class="line"></span><br><span class="line">`进入容器`		: docker-compose <span class="built_in">exec</span> 参数 service CMD</span><br><span class="line"></span><br><span class="line">`容器列表`		: docker-compose ps</span><br><span class="line"></span><br><span class="line">`查看容器进程`   : docker-compose top</span><br><span class="line"></span><br><span class="line">`暂停运行`		: docker-compose pause</span><br><span class="line"></span><br><span class="line">`恢复运行`		: docker-compose unpause</span><br></pre></td></tr></table></figure>



<h2 id="可视化工具"><a href="#可视化工具" class="headerlink" title="可视化工具"></a>可视化工具</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.0&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">portainer:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">portainer/portainer-ce</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;8001:8000&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;9001:9000&quot;</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">portainer</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;portainer&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;/root/docker-compose/portainer_data:/data&quot;</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">&quot;CMD&quot;</span>, <span class="string">&quot;ping&quot;</span>, <span class="string">&quot;-c1&quot;</span>, <span class="string">&quot;-t1&quot;</span>, <span class="string">&quot;portainer&quot;</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">30s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">10s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">portainer:</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/07/12/Django%E7%BC%93%E5%AD%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/07/12/Django%E7%BC%93%E5%AD%98/" class="post-title-link" itemprop="url">Django缓存</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-12 07:20:25" itemprop="dateCreated datePublished" datetime="2019-07-12T07:20:25+08:00">2019-07-12</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2019-08-01 12:22:34" itemprop="dateModified" datetime="2019-08-01T12:22:34+08:00">2019-08-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">Django系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>​        </p>
<p>​        <strong>缓存是将一些常用的数据保存在内存或者memcache中，在设置好的时间内，如果有请求访问这些数据，则不会再去操作数据库、执行逻辑、渲染等操作，而是直接从内存或者memcache的缓存中取取出数据，返回给用户</strong></p>
<p>​        <strong>在动态网站中，用户向服务端发起请求，服务器都会去数据库中进行相应的增删改查 —&gt; 执行逻辑 —&gt; 渲染模板 —&gt; 返回响应 —&gt; 最后生成用户所看到的页面</strong></p>
<p><strong>出现的问题：</strong></p>
<ul>
<li>当用户访问量很庞大时，每一次都去操作一遍数据库，会消耗非常多的服务器资源</li>
</ul>
<p><strong>解决方案：</strong></p>
<ul>
<li>使用缓存来减轻后端服务器的压力</li>
</ul>
<h2 id="缓存方式"><a href="#缓存方式" class="headerlink" title="缓存方式"></a>缓存方式</h2><ul>
<li>开发调试缓存</li>
<li>内存缓存</li>
<li>文件缓存</li>
<li>数据库缓存</li>
<li>Memcache缓存（使用python-memcached模块/使用pylibmc模块）</li>
</ul>
<p><strong>常用：文件缓存、Memcache缓存</strong></p>
<h2 id="缓存配置"><a href="#缓存配置" class="headerlink" title="缓存配置"></a>缓存配置</h2><p><strong>开发调试（此模式为开发调试使用，实际上不执行任何操作）</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># settings.py</span></span><br><span class="line"></span><br><span class="line">CACHES = &#123;</span><br><span class="line"> <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">  <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.core.cache.backends.dummy.DummyCache&#x27;</span>,  <span class="comment"># 缓存后台使用的引擎</span></span><br><span class="line">  <span class="string">&#x27;TIMEOUT&#x27;</span>: <span class="number">300</span>,            <span class="comment"># 缓存超时时间（默认300秒，None表示永不过期，0表示立即过期）</span></span><br><span class="line">  <span class="string">&#x27;OPTIONS&#x27;</span>:&#123;</span><br><span class="line">   <span class="string">&#x27;MAX_ENTRIES&#x27;</span>: <span class="number">300</span>,          <span class="comment"># 最大缓存记录的数量（默认300）</span></span><br><span class="line">   <span class="string">&#x27;CULL_FREQUENCY&#x27;</span>: <span class="number">3</span>,          <span class="comment"># 缓存到达最大个数之后，剔除缓存个数的比例，即：1/CULL_FREQUENCY（默认3）</span></span><br><span class="line">  &#125;,</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>内存缓存（将缓存内容保存至内存区域中）</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># settings.py</span></span><br><span class="line"></span><br><span class="line">CACHES = &#123;</span><br><span class="line"> <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">  <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.core.cache.backends.locmem.LocMemCache&#x27;</span>,  <span class="comment"># 指定缓存使用的引擎</span></span><br><span class="line">  <span class="string">&#x27;LOCATION&#x27;</span>: <span class="string">&#x27;unique-snowflake&#x27;</span>,         <span class="comment"># 写在内存中的变量的唯一值 </span></span><br><span class="line">  <span class="string">&#x27;TIMEOUT&#x27;</span>:<span class="number">300</span>,             <span class="comment"># 缓存超时时间(默认为300秒,None表示永不过期)</span></span><br><span class="line">  <span class="string">&#x27;OPTIONS&#x27;</span>:&#123;</span><br><span class="line">   <span class="string">&#x27;MAX_ENTRIES&#x27;</span>: <span class="number">300</span>,           <span class="comment"># 最大缓存记录的数量（默认300）</span></span><br><span class="line">   <span class="string">&#x27;CULL_FREQUENCY&#x27;</span>: <span class="number">3</span>,          <span class="comment"># 缓存到达最大个数之后，剔除缓存个数的比例，即：1/CULL_FREQUENCY（默认3）</span></span><br><span class="line">  &#125;  </span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>文件缓存（把缓存数据存储在文件中）</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># settings.py</span></span><br><span class="line"></span><br><span class="line">CACHES = &#123;</span><br><span class="line"> <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">  <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.core.cache.backends.filebased.FileBasedCache&#x27;</span>, <span class="comment">#指定缓存使用的引擎</span></span><br><span class="line">  <span class="string">&#x27;LOCATION&#x27;</span>: <span class="string">&#x27;/var/tmp/django_cache&#x27;</span>,        <span class="comment">#指定缓存的路径</span></span><br><span class="line">  <span class="string">&#x27;TIMEOUT&#x27;</span>:<span class="number">300</span>,              <span class="comment">#缓存超时时间(默认为300秒,None表示永不过期)</span></span><br><span class="line">  <span class="string">&#x27;OPTIONS&#x27;</span>:&#123;</span><br><span class="line">   <span class="string">&#x27;MAX_ENTRIES&#x27;</span>: <span class="number">300</span>,            <span class="comment"># 最大缓存记录的数量（默认300）</span></span><br><span class="line">   <span class="string">&#x27;CULL_FREQUENCY&#x27;</span>: <span class="number">3</span>,           <span class="comment"># 缓存到达最大个数之后，剔除缓存个数的比例，即：1/CULL_FREQUENCY（默认3）</span></span><br><span class="line">  &#125;</span><br><span class="line"> &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>数据库缓存（把缓存数据存储在数据库中）</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># settings.py</span></span><br><span class="line"></span><br><span class="line">CACHES = &#123;</span><br><span class="line"> <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">  <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.core.cache.backends.db.DatabaseCache&#x27;</span>,  <span class="comment"># 指定缓存使用的引擎</span></span><br><span class="line">  <span class="string">&#x27;LOCATION&#x27;</span>: <span class="string">&#x27;cache_table&#x27;</span>,          <span class="comment"># 数据库表    </span></span><br><span class="line">  <span class="string">&#x27;OPTIONS&#x27;</span>:&#123;</span><br><span class="line">   <span class="string">&#x27;MAX_ENTRIES&#x27;</span>: <span class="number">300</span>,           <span class="comment"># 最大缓存记录的数量（默认300）</span></span><br><span class="line">   <span class="string">&#x27;CULL_FREQUENCY&#x27;</span>: <span class="number">3</span>,          <span class="comment"># 缓存到达最大个数之后，剔除缓存个数的比例，即：1/CULL_FREQUENCY（默认3）</span></span><br><span class="line">  &#125;  </span><br><span class="line"> &#125;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">注意：</span></span><br><span class="line"><span class="string">	python manage.py createcachetable</span></span><br><span class="line"><span class="string">	(创建缓存的数据库表使用的语句)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>



<p><strong>Memcache缓存（使用python-memcached模块连接memcache）</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Memcached是Django原生支持的缓存系统，要使用Memcached，需要下载Memcached的支持库python-memcached或者pylibmc</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># settings.py</span></span><br><span class="line"></span><br><span class="line">CACHES = &#123;</span><br><span class="line"> <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">  <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.core.cache.backends.memcached.MemcachedCache&#x27;</span>, <span class="comment"># 指定缓存使用的引擎</span></span><br><span class="line">  <span class="string">&#x27;LOCATION&#x27;</span>: <span class="string">&#x27;192.168.10.100:11211&#x27;</span>,         <span class="comment"># 指定Memcache缓存服务器的IP地址和端口</span></span><br><span class="line">  <span class="string">&#x27;OPTIONS&#x27;</span>:&#123;</span><br><span class="line">   <span class="string">&#x27;MAX_ENTRIES&#x27;</span>: <span class="number">300</span>,            <span class="comment"># 最大缓存记录的数量（默认300）</span></span><br><span class="line">   <span class="string">&#x27;CULL_FREQUENCY&#x27;</span>: <span class="number">3</span>,           <span class="comment"># 缓存到达最大个数之后，剔除缓存个数的比例，即：1/CULL_FREQUENCY（默认3）</span></span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># LOCATION也可以配置成如下：</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;LOCATION&#x27;</span>: <span class="string">&#x27;unix:/tmp/memcached.sock&#x27;</span>,   <span class="comment"># 指定局域网内的主机名加socket套接字为Memcache缓存服务器</span></span><br><span class="line"><span class="string">&#x27;LOCATION&#x27;</span>: [         <span class="comment"># 指定一台或多台其他主机ip地址加端口为Memcache缓存服务器</span></span><br><span class="line"> <span class="string">&#x27;192.168.10.100:11211&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;192.168.10.101:11211&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;192.168.10.102:11211&#x27;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>



<p><strong>Memcache缓存（使用pylibmc模块连接memcache）</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># settings.py文件配置</span></span><br><span class="line">    </span><br><span class="line">CACHES = &#123;</span><br><span class="line">  <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">   <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.core.cache.backends.memcached.PyLibMCCache&#x27;</span>,  <span class="comment"># 指定缓存使用的引擎</span></span><br><span class="line">   <span class="string">&#x27;LOCATION&#x27;</span>:<span class="string">&#x27;192.168.10.100:11211&#x27;</span>,         <span class="comment"># 指定本机的11211端口为Memcache缓存服务器</span></span><br><span class="line">   <span class="string">&#x27;OPTIONS&#x27;</span>:&#123;</span><br><span class="line">    <span class="string">&#x27;MAX_ENTRIES&#x27;</span>: <span class="number">300</span>,            <span class="comment"># 最大缓存记录的数量（默认300）</span></span><br><span class="line">    <span class="string">&#x27;CULL_FREQUENCY&#x27;</span>: <span class="number">3</span>,           <span class="comment"># 缓存到达最大个数之后，剔除缓存个数的比例，即：1/CULL_FREQUENCY（默认3）</span></span><br><span class="line">   &#125;,  </span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># LOCATION也可以配置成如下：</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;LOCATION&#x27;</span>: <span class="string">&#x27;/tmp/memcached.sock&#x27;</span>,  <span class="comment"># 指定某个路径为缓存目录</span></span><br><span class="line"><span class="string">&#x27;LOCATION&#x27;</span>: [       <span class="comment"># 分布式缓存,在多台服务器上运行Memcached进程,程序会把多台服务器当作一个单独的缓存,而不会在每台服务器上复制缓存值</span></span><br><span class="line"> <span class="string">&#x27;192.168.10.100:11211&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;192.168.10.101:11211&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;192.168.10.102:11211&#x27;</span>,</span><br><span class="line">]</span><br><span class="line">    </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">注意：</span></span><br><span class="line"><span class="string">	Memcache是基于内存的缓存，数据存储在内存中，所以如果服务器宕机的话，数据就会丢失，所以Memcache一般与其他缓存配合使用</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>



<h2 id="缓存应用"><a href="#缓存应用" class="headerlink" title="缓存应用"></a>缓存应用</h2><p><strong>Django提供了不同力度的缓存，可以只缓存一个页面的某个部分，也可以缓存整个页面，甚至可以缓存整个网站</strong></p>
<h3 id="视图函数使用缓存"><a href="#视图函数使用缓存" class="headerlink" title="视图函数使用缓存"></a>视图函数使用缓存</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># views.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.views.decorators.cache <span class="keyword">import</span> cache_page</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="meta">@cache_page(<span class="params"><span class="number">15</span></span>)          </span><span class="comment">#超时时间为15秒</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">request</span>):</span></span><br><span class="line">　　t=time.time()      <span class="comment">#获取当前时间</span></span><br><span class="line">　　bookList=Book.objects.<span class="built_in">all</span>()</span><br><span class="line">　　<span class="keyword">return</span> render(request,<span class="string">&quot;index.html&quot;</span>,<span class="built_in">locals</span>())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># index.html</span></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h3&gt;当前时间:-----&#123;&#123; t &#125;&#125;&lt;/h3&gt;</span><br><span class="line"></span><br><span class="line">&lt;ul&gt;</span><br><span class="line">    &#123;% <span class="keyword">for</span> book <span class="keyword">in</span> bookList %&#125;</span><br><span class="line">       &lt;li&gt;&#123;&#123; book.name &#125;&#125;---------&gt;&#123;&#123; book.price &#125;&#125;$&lt;/li&gt;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># settings.py</span></span><br><span class="line"></span><br><span class="line">CACHES = &#123;</span><br><span class="line"> <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">  <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.core.cache.backends.filebased.FileBasedCache&#x27;</span>, <span class="comment"># 指定缓存使用的引擎</span></span><br><span class="line">  <span class="string">&#x27;LOCATION&#x27;</span>: <span class="string">&#x27;E:\django_cache&#x27;</span>,          <span class="comment"># 指定缓存的路径</span></span><br><span class="line">  <span class="string">&#x27;TIMEOUT&#x27;</span>: <span class="number">300</span>,              <span class="comment"># 缓存超时时间(默认为300秒,None表示永不过期)</span></span><br><span class="line">  <span class="string">&#x27;OPTIONS&#x27;</span>: &#123;</span><br><span class="line">   <span class="string">&#x27;MAX_ENTRIES&#x27;</span>: <span class="number">300</span>,            <span class="comment"># 最大缓存记录的数量（默认300）</span></span><br><span class="line">   <span class="string">&#x27;CULL_FREQUENCY&#x27;</span>: <span class="number">3</span>,           <span class="comment"># 缓存到达最大个数之后，剔除缓存个数的比例，即：1/CULL_FREQUENCY（默认3）</span></span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="全站使用缓存"><a href="#全站使用缓存" class="headerlink" title="全站使用缓存"></a>全站使用缓存</h3><p><strong>用户的请求通过中间件，经过一系列的认证的操作</strong></p>
<p><strong>如果请求的内容在缓存中存在，则使用FetchFromCacheMiddleware获取内容并返回给用户</strong></p>
<p><strong>如果请求的内容在缓存中不存在，则使用UpdateCacheMiddleware将缓存保存至Django的缓存中，并返回，实现全站缓存</strong></p>
<p><strong>缓存整个站点，是最简单的缓存方式(用的少)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在 MIDDLEWARE_CLASSES 中加入 “update” 和 “fetch” 中间件</span></span><br><span class="line"></span><br><span class="line">MIDDLEWARE_CLASSES = (</span><br><span class="line">    <span class="string">&#x27;django.middleware.cache.UpdateCacheMiddleware&#x27;</span>, 	<span class="comment"># 第一个</span></span><br><span class="line">    <span class="string">&#x27;django.middleware.common.CommonMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.cache.FetchFromCacheMiddleware&#x27;</span>, <span class="comment"># 最后一个</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">“update” 必须配置在第一个</span></span><br><span class="line"><span class="string">“fetch” 必须配置在最后一个</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># settings.py</span></span><br><span class="line"></span><br><span class="line">MIDDLEWARE_CLASSES = (</span><br><span class="line">    <span class="string">&#x27;django.middleware.cache.UpdateCacheMiddleware&#x27;</span>,   <span class="comment">#响应HttpResponse中设置几个headers</span></span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.common.CommonMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth.middleware.AuthenticationMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth.middleware.SessionAuthenticationMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages.middleware.MessageMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.clickjacking.XFrameOptionsMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.security.SecurityMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.cache.FetchFromCacheMiddleware&#x27;</span>,   <span class="comment">#用来缓存通过GET和HEAD方法获取的状态码为200的响应</span></span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CACHE_MIDDLEWARE_SECONDS=<span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># views.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.views.decorators.cache <span class="keyword">import</span> cache_page</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">request</span>):</span></span><br><span class="line"></span><br><span class="line">     t=time.time()      <span class="comment">#获取当前时间</span></span><br><span class="line">     bookList=Book.objects.<span class="built_in">all</span>()</span><br><span class="line">     <span class="keyword">return</span> render(request,<span class="string">&quot;index.html&quot;</span>,<span class="built_in">locals</span>())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">request</span>):</span></span><br><span class="line">    t=time.time()      <span class="comment">#获取当前时间</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&quot;HELLO:&quot;</span>+<span class="built_in">str</span>(t))</span><br><span class="line"></span><br><span class="line"><span class="comment"># index.html</span></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h3 style=<span class="string">&quot;color: green&quot;</span>&gt;当前时间:-----&#123;&#123; t &#125;&#125;&lt;/h3&gt;</span><br><span class="line"></span><br><span class="line">&lt;ul&gt;</span><br><span class="line">    &#123;% <span class="keyword">for</span> book <span class="keyword">in</span> bookList %&#125;</span><br><span class="line">       &lt;li&gt;&#123;&#123; book.name &#125;&#125;---------&gt;&#123;&#123; book.price &#125;&#125;$&lt;/li&gt;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>



<h3 id="局部视图缓存"><a href="#局部视图缓存" class="headerlink" title="局部视图缓存"></a>局部视图缓存</h3><p><strong>刷新页面时，网页的一部分实现缓存</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># views.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.views.decorators.cache <span class="keyword">import</span> cache_page</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> *</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">request</span>):</span></span><br><span class="line">     t=time.time()      <span class="comment">#获取当前时间</span></span><br><span class="line">     bookList=Book.objects.<span class="built_in">all</span>()</span><br><span class="line">     <span class="keyword">return</span> render(request,<span class="string">&quot;index.html&quot;</span>,<span class="built_in">locals</span>())</span><br><span class="line">    </span><br><span class="line"><span class="comment"># index.html</span></span><br><span class="line"></span><br><span class="line">&#123;% load cache %&#125;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"> &lt;h3 style=<span class="string">&quot;color: green&quot;</span>&gt;不缓存:-----&#123;&#123; t &#125;&#125;&lt;/h3&gt;</span><br><span class="line"></span><br><span class="line">&#123;% cache <span class="number">2</span> <span class="string">&#x27;name&#x27;</span> %&#125;</span><br><span class="line"> &lt;h3&gt;缓存:-----:&#123;&#123; t &#125;&#125;&lt;/h3&gt;</span><br><span class="line">&#123;% endcache %&#125;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/07/11/Docker(%E8%AF%A6%E7%BB%86)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/07/11/Docker(%E8%AF%A6%E7%BB%86)/" class="post-title-link" itemprop="url">Docker(详细)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-11 07:20:25" itemprop="dateCreated datePublished" datetime="2019-07-11T07:20:25+08:00">2019-07-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2019-09-01 12:22:34" itemprop="dateModified" datetime="2019-09-01T12:22:34+08:00">2019-09-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">Linux系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>Docker学习</p>
</blockquote>
<ul>
<li>Docker概述</li>
<li>Docker安装</li>
<li>Docker命令<ul>
<li>镜像命令</li>
<li>容器命令</li>
<li>操作命令</li>
<li>…</li>
</ul>
</li>
<li>Docker镜像</li>
<li>容器的数据卷</li>
<li>DockerFIle</li>
<li>Docker网络原理</li>
<li>IDEA整合Docker</li>
<li>Docker Compose</li>
<li>Docker Swarm</li>
<li>CI\CD jenkins</li>
</ul>
<h1 id="Docker概述"><a href="#Docker概述" class="headerlink" title="Docker概述"></a>Docker概述</h1><h2 id="Docker为什么会出现"><a href="#Docker为什么会出现" class="headerlink" title="Docker为什么会出现?"></a>Docker为什么会出现?</h2><p>一款产品:开发-上线 两套环境,应用配置!</p>
<p>开发 — 运维 问题: 项目在我的电脑上可以运行!版本更新,导致服务不可用!对于运维来说,考验就十分大</p>
<p>环境配置是十分的麻烦.每一个机器都要部署环境(集群Redis, ES, Hadoop…)! 费时费力</p>
<p>发布一个项目(Jar+ (Redis,ES, Hadoop)),项目为什么不带上环境安装打包</p>
<p>在服务器上配置十分麻烦,不能够跨平台</p>
<p>Windows开发,发布到Linux</p>
<p>传统开发: 开发人员做项目,运维人员做部署</p>
<p>现在: 开发打包部署上线,一套流程做完</p>
<p>java – apk – 发布(应用商店) –使用者使用apk– 安装即用</p>
<p>java — jar(环境) — 打包上线自带环境(镜像) —(Docker仓库: 商店) — 下载我们发布的镜像 — 直接运行即可</p>
<p>Docker是基于Go语言开发的开源项目!</p>
<p>官网: <a target="_blank" rel="noopener" href="https://www.docker.com/">https://www.docker.com/</a></p>
<p><img src="https://img-blog.csdnimg.cn/20200619182507251.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>文档地址: <a target="_blank" rel="noopener" href="https://docs.docker.com/get-docker/">https://docs.docker.com/get-docker/</a></p>
<p>仓库地址: <a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a></p>
<h2 id="Docker能干嘛"><a href="#Docker能干嘛" class="headerlink" title="Docker能干嘛?"></a>Docker能干嘛?</h2><blockquote>
<p>之前的虚拟机技术</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20200619182528481.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>虚拟机技术缺点:</p>
<ul>
<li><p>资源占用十分多</p>
</li>
<li><p>冗余技术多</p>
</li>
<li><p>启动很慢</p>
</li>
</ul>
<blockquote>
<p>容器化技术</p>
</blockquote>
<p>容器化技术不是一个完整的操作系统</p>
<p><img src="https://img-blog.csdnimg.cn/20200619182542242.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>比较Docker和虚拟机技术的不同</p>
<ul>
<li>传统的虚拟机,虚拟出一条硬件,运行一个完整的操作系统,然后在这个系统上安装和运行软件</li>
<li>容器内的应用直接运行在宿主机的内容,容器是没有自己的内核的,也没有虚拟我们的硬件,所以就轻便了</li>
<li>每个容器间都是互相隔离的,每一个容器内都有一个属于自己的文件系统,互不影响</li>
</ul>
<blockquote>
<p>DevOps(开发,运维)</p>
</blockquote>
<p><strong>更快速的交付和部署</strong></p>
<p>传统: 一堆帮助文档,安装程序</p>
<p>Docker: 一键运行打包镜像发布测试</p>
<p><strong>更便捷的升级和扩缩容</strong></p>
<p>使用了Docker之后,我们部署应用就像搭积木一样!</p>
<p>项目打包为一个镜像,扩展,服务器A!服务器B</p>
<p><strong>更简单的系统运维</strong></p>
<p>在容器化之后,我们开发,测试环境都是高度一致的</p>
<p><strong>更高效的计算资源利用:</strong></p>
<p>Docker是内核级别的虚拟化, 可以在一个物理机上运行很多的容器实例! 服务器的性能可以被压榨到极致</p>
<h1 id="Docker安装"><a href="#Docker安装" class="headerlink" title="Docker安装"></a>Docker安装</h1><h2 id="Docker的基本组成"><a href="#Docker的基本组成" class="headerlink" title="Docker的基本组成"></a>Docker的基本组成</h2><p><img src="https://img-blog.csdnimg.cn/20200619182558320.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p><strong>镜像(image)</strong>:</p>
<p>docker镜像好比一个模板,可以通过这个模板来创建容器服务,tomcat镜像===&gt;run ==&gt;tomcat01容器(提供服务器)</p>
<p>通过这个镜像可以创建多个容器(最终服务运行或者项目运行就是在容器中的)</p>
<p><strong>容器(container)</strong>:</p>
<p>Docker利用容器技术,独立运行一个或者一个组应用,通过镜像来创建的</p>
<p>启动,停止,删除,基本命令!</p>
<p><strong>仓库(repository)</strong>:</p>
<p>仓库就是存放镜像的地方!</p>
<p>仓库分为共有仓库和私有仓库</p>
<p>Docker Hub(默认是国外的)</p>
<p>阿里云… 都有容器服务器(配置镜像加速)</p>
<h2 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h2><blockquote>
<p>环境准备</p>
</blockquote>
<ol>
<li>需要会一点点Linux基础</li>
<li>CentOS7</li>
<li>使用Xshell连接远程服务器</li>
</ol>
<blockquote>
<p>环境查看</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment"># 查看系统内核</span></span><br><span class="line">[root@iZ2zeheduaqlfxyl598si8Z /]<span class="comment"># uname -r</span></span><br><span class="line">3.10.0-1062.18.1.el7.x86_64</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 系统版本</span></span><br><span class="line">[root@CZP ~]<span class="comment"># cat /etc/os-release</span></span><br><span class="line">NAME=<span class="string">&quot;CentOS Linux&quot;</span></span><br><span class="line">VERSION=<span class="string">&quot;7 (Core)&quot;</span></span><br><span class="line">ID=<span class="string">&quot;centos&quot;</span></span><br><span class="line">ID_LIKE=<span class="string">&quot;rhel fedora&quot;</span></span><br><span class="line">VERSION_ID=<span class="string">&quot;7&quot;</span></span><br><span class="line">PRETTY_NAME=<span class="string">&quot;CentOS Linux 7 (Core)&quot;</span></span><br><span class="line">ANSI_COLOR=<span class="string">&quot;0;31&quot;</span></span><br><span class="line">CPE_NAME=<span class="string">&quot;cpe:/o:centos:centos:7&quot;</span></span><br><span class="line">HOME_URL=<span class="string">&quot;https://www.centos.org/&quot;</span></span><br><span class="line">BUG_REPORT_URL=<span class="string">&quot;https://bugs.centos.org/&quot;</span></span><br><span class="line"></span><br><span class="line">CENTOS_MANTISBT_PROJECT=<span class="string">&quot;CentOS-7&quot;</span></span><br><span class="line">CENTOS_MANTISBT_PROJECT_VERSION=<span class="string">&quot;7&quot;</span></span><br><span class="line">REDHAT_SUPPORT_PRODUCT=<span class="string">&quot;centos&quot;</span></span><br><span class="line">REDHAT_SUPPORT_PRODUCT_VERSION=<span class="string">&quot;7&quot;</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p>安装Docker</p>
</blockquote>
<p>查看帮助文档</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一, 卸载旧的版本</span></span><br><span class="line">$ sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br><span class="line">                 </span><br><span class="line"><span class="comment"># 2, 需要安装的包</span></span><br><span class="line">yum install -y yum-utils</span><br><span class="line"></span><br><span class="line"><span class="comment">#3. 设置镜像仓库</span></span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo <span class="comment"># 默认是国外的</span></span><br><span class="line"></span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo <span class="comment"># 推荐使用</span></span><br><span class="line"><span class="comment"># 更新yum软件包索引</span></span><br><span class="line">yum makecache fast</span><br><span class="line"><span class="comment"># 安装docker    </span></span><br><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io </span><br><span class="line"><span class="comment"># 启动docker</span></span><br><span class="line">systemctl start docker</span><br><span class="line"><span class="comment"># 查看docker版本</span></span><br><span class="line">docker version</span><br></pre></td></tr></table></figure>



<blockquote>
<p>下载镜像</p>
<p>docker pull [要下载的软件]</p>
</blockquote>
<blockquote>
<p>查看下载的镜像</p>
<p>docker images</p>
</blockquote>
<blockquote>
<p>卸载docker</p>
</blockquote>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum remove docker-ce docker-ce-cli containerd.io</span><br><span class="line"></span><br><span class="line">rm -rf /var/lib/docker<span class="comment">#docker默认工作路径</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>阿里云配置Docker镜像加速</p>
<p><img src="https://img-blog.csdnimg.cn/20200619182621805.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>执行命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line"></span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;阿里云镜像加速地址&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>



<p><img src="https://img-blog.csdnimg.cn/20200619182635129.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<h2 id="底层原理"><a href="#底层原理" class="headerlink" title="底层原理"></a>底层原理</h2><p><strong>Docker是怎么工作的?</strong></p>
<p>Docker是一个C/S结构的系统,Docker的守护进程运行在主机上.通过Socket从客户端访问!</p>
<p>DockerServer接收到Docker-Client的指令,就会执行这个命令!</p>
<p><img src="https://img-blog.csdnimg.cn/20200619182647757.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>Docker为什么比VM快?</p>
<ol>
<li><p>Docker有着比虚拟机更少的抽象层</p>
</li>
<li><p>Docker利用的是宿主机的内核,vm需要的是Guest OS</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9zczEuYmRzdGF0aWMuY29tLzcwY0Z1WFNoX1ExWW54R2twb1dLMUhGNmhoeS9pdC91PTE0ODQyNDAxNzIsMTcwMjc1MjA3MSZmbT0yNiZncD0wLmpwZw?x-oss-process=image/format,png" alt="img"></p>
<p>所以说,新建一个容器的时候,docker不需要像虚拟机一样重新安装一个操作系统内核,虚拟机是加载Guest OS,分钟级别的,而docker是利用宿主机的操作系统,省略了这个复杂的过程</p>
</li>
</ol>
<h1 id="Docker的常用命令"><a href="#Docker的常用命令" class="headerlink" title="Docker的常用命令"></a>Docker的常用命令</h1><h2 id="帮助命令"><a href="#帮助命令" class="headerlink" title="帮助命令"></a>帮助命令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker version 			# docker版本 </span><br><span class="line">docker info 			# 显示docker的系统信息,包括镜像和容器的数量</span><br><span class="line">docker [命令] --help     # 查看某个具体的命令</span><br></pre></td></tr></table></figure>



<h2 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h2><p><strong>查看下载的所有镜像</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker images</span></span><br><span class="line">REPOSITORY                TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">mysql                     5.6                 8de95e6026c3        20 hours ago        302MB</span><br><span class="line">redis                     latest              36304d3b4540        12 days ago         104MB</span><br><span class="line">mysql                     latest              30f937e841c8        2 weeks ago         541MB</span><br><span class="line">centos/mysql-57-centos7   latest              f83a2938370c        8 months ago        452MB</span><br><span class="line"><span class="meta">#</span><span class="bash"> 解释</span></span><br><span class="line">REPOSITORY 镜像的仓库名</span><br><span class="line">TAG 镜像的标签</span><br><span class="line">IMAGE ID 镜像ID</span><br><span class="line">CREATED 镜像创建时间</span><br><span class="line">SIZE 镜像的大小</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 可选项</span></span><br><span class="line">Options:</span><br><span class="line">  -a, --all             # 列出所有镜像</span><br><span class="line">  -q, --quiet           # 只显示镜像ID</span><br></pre></td></tr></table></figure>



<p><strong>搜索镜像</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker search</span> </span><br><span class="line"></span><br><span class="line">[root@CZP ~]# docker search mysql</span><br><span class="line">NAME	DESCRIPTION									STARS	OFFICIAL	AUTOMATED	</span><br><span class="line">mysql	MySQL is a widely used, open-source relation…  9604     [OK]                </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 可选项,通过收藏来过滤</span></span><br><span class="line">--filter=stars=3000 # 搜索出来的镜像收藏就是大于3000的</span><br></pre></td></tr></table></figure>



<p><strong>下载镜像</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker pull</span> </span><br><span class="line"></span><br><span class="line">[root@CZP ~] # docker pull nginx [:tag]</span><br><span class="line">Using default tag: latest # 如果不写tag 默认使用最新版本</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">8559a31e96f4: Pull complete  # 分层下载,docker image核心 联合文件系统</span><br><span class="line">8d69e59170f7: Pull complete </span><br><span class="line">3f9f1ec1d262: Pull complete </span><br><span class="line">d1f5ff4f210d: Pull complete </span><br><span class="line">1e22bfa8652e: Pull complete </span><br><span class="line">Digest: sha256:21f32f6c08406306d822a0e6e8b7dc81f53f336570e852e25fbe1e3e3d0d0133 # 签名</span><br><span class="line">Status: Downloaded newer image for nginx:latest</span><br><span class="line">docker.io/library/nginx:latest # 真实地址</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker pull nginx 等价于 dicker pull docker.io/library/nginx:latest</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">指定版本下载</span></span><br></pre></td></tr></table></figure>





<p><strong>删除镜像</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker rmi</span> </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除指定的容器</span></span><br><span class="line">[root@CZP ~]# docker rm -f 8de95e6026c3 </span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除全部的容器</span></span><br><span class="line">[root@CZP ~]# docker rm -f $(docker -ap) </span><br></pre></td></tr></table></figure>



<h2 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h2><p>说明 : 有了镜像才可以创建容器,</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull [image]</span><br></pre></td></tr></table></figure>



<p><strong>新建容器并启动</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker run  [可选参数] image</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 参数说明</span></span><br><span class="line">--name=&quot;&quot;  容器名字 用于区分容器</span><br><span class="line">-d         后台方式运行</span><br><span class="line">-it        使用交互方式运行,进入容器查看内容</span><br><span class="line">-p	       指定容器的端口 -p 80:8080  主机端口:容器端口</span><br><span class="line">-P(大写)    随机指定容器的端口</span><br></pre></td></tr></table></figure>



<p><strong>列出所有运行的容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker ps 命令	（不加参数）列出当前正在运行的容器</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 参数说明</span></span><br><span class="line">-a		# 列出当前正在运行的容器+历史运行过的容器</span><br><span class="line">-n=?	# 显示最近创建的容器</span><br><span class="line">-q		# 只显示容器的编号</span><br><span class="line"></span><br><span class="line">[root@CZP ~]# docker ps </span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">[root@CZP ~]# docker ps -a </span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                    PORTS               NAMES</span><br><span class="line">919e58ff5521        redis               &quot;docker-entrypoint.s…&quot;   20 hours ago        Exited (0) 16 hours ago                       redis</span><br></pre></td></tr></table></figure>



<p><strong>退出容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exit 		 # 直接容器停止并退出</span><br><span class="line">ctrl + p + q # 直接退出容器</span><br></pre></td></tr></table></figure>



<p><strong>删除容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker rm 容器id						# 删除指定容器(可一次删除多个，各id之间用空格隔开)</span><br><span class="line">docker rm -f[递归] $(docker ps -aq) 	# 递归删除所有的容器</span><br><span class="line">docker ps -a | xargs docker rm 		 # 递归删除所有的容器</span><br></pre></td></tr></table></figure>



<p><strong>启动和停止容器的操作</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker start 容器id  		# 启动容器</span><br><span class="line">docker restart 容器id  	# 重启容器</span><br><span class="line">docker stop 容器id		# 停止当前正在运行的容器</span><br><span class="line">docker kill 容器id 		# 强制停止当前容器</span><br></pre></td></tr></table></figure>



<h2 id="常用的其他命令"><a href="#常用的其他命令" class="headerlink" title="常用的其他命令"></a>常用的其他命令</h2><p><strong>后台启动容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 命令docker run -d 镜像名</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 常见的坑: docker容器后台运行,就必须要有一个前台进程,docker发现没有应用,就会自动停止</span></span><br><span class="line"><span class="meta">#</span><span class="bash">nginx, 容器启动后,发现自己没有提供服务,就会立刻停止,就是没有程序了</span></span><br></pre></td></tr></table></figure>





<p><strong>查看日志</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">docker logs -f -t --tail 容器</span><br><span class="line"></span><br><span class="line"><span class="comment"># 参数说明</span></span><br><span class="line">	-tf				<span class="comment"># 显示日志</span></span><br><span class="line">	--tail number 	<span class="comment"># 要显示的日志条数</span></span><br><span class="line">	</span><br><span class="line">    [root@localhost ~]<span class="comment"># docker logs -tf --tail 10 centosv1</span></span><br><span class="line">    2021-06-26T01:38:12.739000465Z [root@ef24fc0af36a /]<span class="comment"># docker ps</span></span><br><span class="line">    2021-06-26T01:38:12.739180686Z bash: docker: <span class="built_in">command</span> not found</span><br><span class="line">    2021-06-26T01:38:21.504914487Z [root@ef24fc0af36a /]<span class="comment"># exit</span></span><br><span class="line">    2021-06-26T01:38:21.504931415Z <span class="built_in">exit</span></span><br><span class="line">	</span><br></pre></td></tr></table></figure>



<p><strong>查看容器中进程信息</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker top 容器id </span><br><span class="line"></span><br><span class="line">[root@CZP ~]# docker top 63d4c4115212</span><br><span class="line">UID                 PID                 PPID                C                   STIME </span><br><span class="line">polkitd             2319                2301                0                   12:33</span><br></pre></td></tr></table></figure>



<p><strong>查看镜像元数据</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 命令</span></span><br><span class="line">docker inspect 容器id</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试</span></span><br><span class="line">[root@CZP ~]# docker inspect 63d4c4115212 </span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;63d4c41152126cae276b69e1100520f9d6d867f950e488b5488de68181b7870b&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2020-06-10T04:33:13.666827714Z&quot;,</span><br><span class="line">        &quot;Path&quot;: &quot;docker-entrypoint.sh&quot;,</span><br><span class="line">        &quot;Args&quot;: [</span><br><span class="line">            &quot;redis-server&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;State&quot;: &#123;</span><br><span class="line">            &quot;Status&quot;: &quot;running&quot;,</span><br><span class="line">            &quot;Running&quot;: true,</span><br><span class="line">            &quot;Paused&quot;: false,</span><br><span class="line">            &quot;Restarting&quot;: false,</span><br><span class="line">            &quot;OOMKilled&quot;: false,</span><br><span class="line">            &quot;Dead&quot;: false,</span><br><span class="line">            &quot;Pid&quot;: 2319,</span><br><span class="line">            &quot;ExitCode&quot;: 0,</span><br><span class="line">            &quot;Error&quot;: &quot;&quot;,</span><br><span class="line">            &quot;StartedAt&quot;: &quot;2020-06-10T04:33:14.008260846Z&quot;,</span><br><span class="line">            &quot;FinishedAt&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Image&quot;: &quot;sha256:36304d3b4540c5143673b2cefaba583a0426b57c709b5a35363f96a3510058cd&quot;,</span><br><span class="line">        &quot;ResolvConfPath&quot;: &quot;/var/lib/docker/containers/63d4c41152126cae276b69e1100520f9d6d867f950e488b5488de68181b7870b/resolv.conf&quot;,</span><br><span class="line">        &quot;HostnamePath&quot;: &quot;/var/lib/docker/containers/63d4c41152126cae276b69e1100520f9d6d867f950e488b5488de68181b7870b/hostname&quot;,</span><br><span class="line">        &quot;HostsPath&quot;: &quot;/var/lib/docker/containers/63d4c41152126cae276b69e1100520f9d6d867f950e488b5488de68181b7870b/hosts&quot;,</span><br><span class="line">        &quot;LogPath&quot;: &quot;/var/lib/docker/containers/63d4c41152126cae276b69e1100520f9d6d867f950e488b5488de68181b7870b/63d4c41152126cae276b69e1100520f9d6d867f950e488b5488de68181b7870b-json.log&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;/redis&quot;,</span><br><span class="line">        &quot;RestartCount&quot;: 0,</span><br><span class="line">        &quot;Driver&quot;: &quot;overlay2&quot;,</span><br><span class="line">        &quot;Platform&quot;: &quot;linux&quot;,</span><br><span class="line">        &quot;MountLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ProcessLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;AppArmorProfile&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ExecIDs&quot;: null,</span><br><span class="line">        &quot;HostConfig&quot;: &#123;</span><br><span class="line">            &quot;Binds&quot;: null,</span><br><span class="line">            &quot;ContainerIDFile&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LogConfig&quot;: &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;json-file&quot;,</span><br><span class="line">                &quot;Config&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;NetworkMode&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;PortBindings&quot;: &#123;</span><br><span class="line">                &quot;6379/tcp&quot;: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;HostIp&quot;: &quot;&quot;,</span><br><span class="line">                        &quot;HostPort&quot;: &quot;6379&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;RestartPolicy&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;no&quot;,</span><br><span class="line">                &quot;MaximumRetryCount&quot;: 0</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;AutoRemove&quot;: false,</span><br><span class="line">            &quot;VolumeDriver&quot;: &quot;&quot;,</span><br><span class="line">            &quot;VolumesFrom&quot;: null,</span><br><span class="line">            &quot;CapAdd&quot;: null,</span><br><span class="line">            &quot;CapDrop&quot;: null,</span><br><span class="line">            &quot;Capabilities&quot;: null,</span><br><span class="line">            &quot;Dns&quot;: [],</span><br><span class="line">            &quot;DnsOptions&quot;: [],</span><br><span class="line">            &quot;DnsSearch&quot;: [],</span><br><span class="line">            &quot;ExtraHosts&quot;: null,</span><br><span class="line">            &quot;GroupAdd&quot;: null,</span><br><span class="line">            &quot;IpcMode&quot;: &quot;private&quot;,</span><br><span class="line">            &quot;Cgroup&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Links&quot;: null,</span><br><span class="line">            &quot;OomScoreAdj&quot;: 0,</span><br><span class="line">            &quot;PidMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Privileged&quot;: false,</span><br><span class="line">            &quot;PublishAllPorts&quot;: false,</span><br><span class="line">            &quot;ReadonlyRootfs&quot;: false,</span><br><span class="line">            &quot;SecurityOpt&quot;: null,</span><br><span class="line">            &quot;UTSMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;UsernsMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;ShmSize&quot;: 67108864,</span><br><span class="line">            &quot;Runtime&quot;: &quot;runc&quot;,</span><br><span class="line">            &quot;ConsoleSize&quot;: [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            &quot;Isolation&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpuShares&quot;: 0,</span><br><span class="line">            &quot;Memory&quot;: 0,</span><br><span class="line">            &quot;NanoCpus&quot;: 0,</span><br><span class="line">            &quot;CgroupParent&quot;: &quot;&quot;,</span><br><span class="line">            &quot;BlkioWeight&quot;: 0,</span><br><span class="line">            &quot;BlkioWeightDevice&quot;: [],</span><br><span class="line">            &quot;BlkioDeviceReadBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceReadIOps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteIOps&quot;: null,</span><br><span class="line">            &quot;CpuPeriod&quot;: 0,</span><br><span class="line">            &quot;CpuQuota&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimePeriod&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimeRuntime&quot;: 0,</span><br><span class="line">            &quot;CpusetCpus&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpusetMems&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Devices&quot;: [],</span><br><span class="line">            &quot;DeviceCgroupRules&quot;: null,</span><br><span class="line">            &quot;DeviceRequests&quot;: null,</span><br><span class="line">            &quot;KernelMemory&quot;: 0,</span><br><span class="line">            &quot;KernelMemoryTCP&quot;: 0,</span><br><span class="line">            &quot;MemoryReservation&quot;: 0,</span><br><span class="line">            &quot;MemorySwap&quot;: 0,</span><br><span class="line">            &quot;MemorySwappiness&quot;: null,</span><br><span class="line">            &quot;OomKillDisable&quot;: false,</span><br><span class="line">            &quot;PidsLimit&quot;: null,</span><br><span class="line">            &quot;Ulimits&quot;: null,</span><br><span class="line">            &quot;CpuCount&quot;: 0,</span><br><span class="line">            &quot;CpuPercent&quot;: 0,</span><br><span class="line">            &quot;IOMaximumIOps&quot;: 0,</span><br><span class="line">            &quot;IOMaximumBandwidth&quot;: 0,</span><br><span class="line">            &quot;MaskedPaths&quot;: [</span><br><span class="line">                &quot;/proc/asound&quot;,</span><br><span class="line">                &quot;/proc/acpi&quot;,</span><br><span class="line">                &quot;/proc/kcore&quot;,</span><br><span class="line">                &quot;/proc/keys&quot;,</span><br><span class="line">                &quot;/proc/latency_stats&quot;,</span><br><span class="line">                &quot;/proc/timer_list&quot;,</span><br><span class="line">                &quot;/proc/timer_stats&quot;,</span><br><span class="line">                &quot;/proc/sched_debug&quot;,</span><br><span class="line">                &quot;/proc/scsi&quot;,</span><br><span class="line">                &quot;/sys/firmware&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;ReadonlyPaths&quot;: [</span><br><span class="line">                &quot;/proc/bus&quot;,</span><br><span class="line">                &quot;/proc/fs&quot;,</span><br><span class="line">                &quot;/proc/irq&quot;,</span><br><span class="line">                &quot;/proc/sys&quot;,</span><br><span class="line">                &quot;/proc/sysrq-trigger&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;GraphDriver&quot;: &#123;</span><br><span class="line">            &quot;Data&quot;: &#123;</span><br><span class="line">                &quot;LowerDir&quot;: &quot;/var/lib/docker/overlay2/db63749d3abd5e587a88360e27fc9b5b0db7069b45e2bd8c48c75e25eba89100-init/diff:/var/lib/docker/overlay2/30d298e0d46edd68a8cbb588247384b9516d1140f5ca592b7f0b1c04618111f0/diff:/var/lib/docker/overlay2/af6963cd652870740eec10549b2a6c8f08b94edb3a3cea1a42d727026bb6d5a0/diff:/var/lib/docker/overlay2/af514c78199cdcfb30194921b892782dacbe1a3f439167f2f434b2f5a55ab5c3/diff:/var/lib/docker/overlay2/b1e020f1a03a66483794af0cf20d59e8dfa471f692ecaa145398d30500370a2a/diff:/var/lib/docker/overlay2/e55685d1f4ea504c3df5c3cbe822ab000f6412d3eff50b6b8ba097fb551ad922/diff:/var/lib/docker/overlay2/df78a0d3f0dbc449650ce5605d67ff45e93dbadc4fe93d2b7552203a31ab46a8/diff&quot;,</span><br><span class="line">                &quot;MergedDir&quot;: &quot;/var/lib/docker/overlay2/db63749d3abd5e587a88360e27fc9b5b0db7069b45e2bd8c48c75e25eba89100/merged&quot;,</span><br><span class="line">                &quot;UpperDir&quot;: &quot;/var/lib/docker/overlay2/db63749d3abd5e587a88360e27fc9b5b0db7069b45e2bd8c48c75e25eba89100/diff&quot;,</span><br><span class="line">                &quot;WorkDir&quot;: &quot;/var/lib/docker/overlay2/db63749d3abd5e587a88360e27fc9b5b0db7069b45e2bd8c48c75e25eba89100/work&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Name&quot;: &quot;overlay2&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">                &quot;Name&quot;: &quot;f544b94e9e0129e7f438b851edbfc94a82c96e6fdda44179d38e20f800878a6a&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/f544b94e9e0129e7f438b851edbfc94a82c96e6fdda44179d38e20f800878a6a/_data&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;/data&quot;,</span><br><span class="line">                &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        &quot;Config&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;63d4c4115212&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: false,</span><br><span class="line">            &quot;AttachStdout&quot;: false,</span><br><span class="line">            &quot;AttachStderr&quot;: false,</span><br><span class="line">            &quot;ExposedPorts&quot;: &#123;</span><br><span class="line">                &quot;6379/tcp&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Tty&quot;: false,</span><br><span class="line">            &quot;OpenStdin&quot;: false,</span><br><span class="line">            &quot;StdinOnce&quot;: false,</span><br><span class="line">            &quot;Env&quot;: [</span><br><span class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;,</span><br><span class="line">                &quot;GOSU_VERSION=1.12&quot;,</span><br><span class="line">                &quot;REDIS_VERSION=6.0.4&quot;,</span><br><span class="line">                &quot;REDIS_DOWNLOAD_URL=http://download.redis.io/releases/redis-6.0.4.tar.gz&quot;,</span><br><span class="line">                &quot;REDIS_DOWNLOAD_SHA=3337005a1e0c3aa293c87c313467ea8ac11984921fab08807998ba765c9943de&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Cmd&quot;: [</span><br><span class="line">                &quot;redis-server&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Image&quot;: &quot;36304d3b4540&quot;,</span><br><span class="line">            &quot;Volumes&quot;: &#123;</span><br><span class="line">                &quot;/data&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;/data&quot;,</span><br><span class="line">            &quot;Entrypoint&quot;: [</span><br><span class="line">                &quot;docker-entrypoint.sh&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;NetworkSettings&quot;: &#123;</span><br><span class="line">            &quot;Bridge&quot;: &quot;&quot;,</span><br><span class="line">            &quot;SandboxID&quot;: &quot;5f8321169dfd067e45f2921d73984d0d76e953cd642d93990d1ed8a3227ad53f&quot;,</span><br><span class="line">            &quot;HairpinMode&quot;: false,</span><br><span class="line">            &quot;LinkLocalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LinkLocalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;Ports&quot;: &#123;</span><br><span class="line">                &quot;6379/tcp&quot;: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;HostIp&quot;: &quot;0.0.0.0&quot;,</span><br><span class="line">                        &quot;HostPort&quot;: &quot;6379&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;SandboxKey&quot;: &quot;/var/run/docker/netns/5f8321169dfd&quot;,</span><br><span class="line">            &quot;SecondaryIPAddresses&quot;: null,</span><br><span class="line">            &quot;SecondaryIPv6Addresses&quot;: null,</span><br><span class="line">            &quot;EndpointID&quot;: &quot;33eafd9f86d5e7a3b29ed09fe75d8eb27e0227a07607960550dfef7f620a6872&quot;,</span><br><span class="line">            &quot;Gateway&quot;: &quot;172.18.0.1&quot;,</span><br><span class="line">            &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;IPAddress&quot;: &quot;172.18.0.2&quot;,</span><br><span class="line">            &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">            &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">            &quot;MacAddress&quot;: &quot;02:42:ac:12:00:02&quot;,</span><br><span class="line">            &quot;Networks&quot;: &#123;</span><br><span class="line">                &quot;bridge&quot;: &#123;</span><br><span class="line">                    &quot;IPAMConfig&quot;: null,</span><br><span class="line">                    &quot;Links&quot;: null,</span><br><span class="line">                    &quot;Aliases&quot;: null,</span><br><span class="line">                    &quot;NetworkID&quot;: &quot;228826a97a0b066a01811c098e4c4985804598571b9c8d9ad4205a0ee75c8b5b&quot;,</span><br><span class="line">                    &quot;EndpointID&quot;: &quot;33eafd9f86d5e7a3b29ed09fe75d8eb27e0227a07607960550dfef7f620a6872&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.18.0.1&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.18.0.2&quot;,</span><br><span class="line">                    &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">                    &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">                    &quot;MacAddress&quot;: &quot;02:42:ac:12:00:02&quot;,</span><br><span class="line">                    &quot;DriverOpts&quot;: null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p><strong>进入当前正在运行的容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 我们通常容器都是使用后台方式运行的,需要进入容器,修改一些配置</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 命令</span></span><br><span class="line">docker exec -it 容器id  bashshell 默认命令行</span><br><span class="line"></span><br><span class="line">docker attach 容器id</span><br><span class="line"><span class="meta">#</span><span class="bash"> docker <span class="built_in">exec</span> 	<span class="comment"># 进入容器后开启一个新的终端,可以在里面操作(常用)</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker attach <span class="comment"># 进入容器正在执行的终端,不会启动新的进程</span></span></span><br></pre></td></tr></table></figure>



<p><strong>从容器内拷贝文件到主机上</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp 容器id:容器内路径 目的主机路径</span><br></pre></td></tr></table></figure>



<p><img src="https://img-blog.csdnimg.cn/20200619182742864.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">attach      Attach  to a running container 											<span class="comment"># 进入容器内部,不启动新的进程</span></span><br><span class="line">build       Build an image from a Dockerfile 											<span class="comment"># 通过dockerfile 定制镜像</span></span><br><span class="line">commit      Create a new image from a container<span class="string">&#x27;s changes 							# 提交当前容器为新的镜像</span></span><br><span class="line"><span class="string">cp          Copy files/folders between a container and the local filesystem 			# 从容器中拷贝指定的文件或者目录到宿主机上</span></span><br><span class="line"><span class="string">create      Create a new container 													# 创建一个新的容器,同run 但不启动容器</span></span><br><span class="line"><span class="string">diff        Inspect changeson a container&#x27;</span>s filesystem 								<span class="comment"># 查看docker容器变化</span></span><br><span class="line">events      Get real time events from the server										<span class="comment"># 从docker服务获取容器实时事件</span></span><br><span class="line"><span class="built_in">exec</span>        Run a <span class="built_in">command</span> <span class="keyword">in</span> a running container										<span class="comment"># 在已存在的容器上运行命令</span></span><br><span class="line"><span class="built_in">export</span>      Export a container<span class="string">&#x27;s filesystem as a tar archive							# 导出容器的内容流作为一个tar归档文件[对应import]</span></span><br><span class="line"><span class="string">history     Show the history of an image												# 展示一个镜像形成历史</span></span><br><span class="line"><span class="string">images      List images																# 列出系统当前镜像</span></span><br><span class="line"><span class="string">import      Import the contents from a tarball to create a filesystem image			# 从tar包中的内容创建一个新的文件系统映像[对应export]</span></span><br><span class="line"><span class="string">info        Display system-wide information											# 显示系统相关信息</span></span><br><span class="line"><span class="string">inspect     Return low-level information on Docker objects							# 查看容器详细信息</span></span><br><span class="line"><span class="string">kill        Kill one or more running containers										# kill指定docker容器</span></span><br><span class="line"><span class="string">load        Load an image from a tar archive or STDIN									# 从一个tar包加载一个镜像[对应save]</span></span><br><span class="line"><span class="string">login       Log in to a Docker registry												# 注册或者登录一个docker源服务器</span></span><br><span class="line"><span class="string">logout      Log out from a Docker registry											# 从当前docker registry退出</span></span><br><span class="line"><span class="string">logs        Fetch the logs of a container												# 输出当前容器日志信息</span></span><br><span class="line"><span class="string">pause       Pause all processes within one or more containers							# 暂停容器</span></span><br><span class="line"><span class="string">port        List port mappings or a specific mapping for the container				# 查看映射端口对应的容器内部源端口</span></span><br><span class="line"><span class="string">ps          List containers															# 列出容器列表</span></span><br><span class="line"><span class="string">pull        Pull an image or a repository from a registry								# 从docker镜像源服务器拉取指定镜像或库镜像</span></span><br><span class="line"><span class="string">push        Push an image or a repository to a registry								# 推送指定镜像或库镜像至docker源服务器</span></span><br><span class="line"><span class="string">rename      Rename a container														# 重命名容器</span></span><br><span class="line"><span class="string">restart     Restart one or more containers											# 重启运行的容器</span></span><br><span class="line"><span class="string">rm          Remove one or more containers												# 移除一个或多个容器</span></span><br><span class="line"><span class="string">rmi         Remove one or more images													# 移除一个或多个镜像(没有容器使用当前镜像才可删除，否则需要删除相关容器或者使用-f参数强制删除)</span></span><br><span class="line"><span class="string">run         Run a command in a new container											# 创建一个新的容器并运行一个命令</span></span><br><span class="line"><span class="string">save        Save one or more images to a tar archive (streamed to STDOUT by default)	# 保存一个镜像为一个tar包[对应load]</span></span><br><span class="line"><span class="string">search      Search the Docker Hub for images											# 在docker hub中搜索镜像</span></span><br><span class="line"><span class="string">start       Start one or more stopped containers										# 启动容器</span></span><br><span class="line"><span class="string">stats       Display a live stream of container(s) resource usage statistics			# 查看cpu的状态</span></span><br><span class="line"><span class="string">stop        Stop one or more running containers										# 停止容器</span></span><br><span class="line"><span class="string">tag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE						# 给源中镜像打标签</span></span><br><span class="line"><span class="string">top         Display the running processes of a container								# 查看容器中运行的进程信息</span></span><br><span class="line"><span class="string">unpause     Unpause all processes within one or more containers						# 取消暂停容器</span></span><br><span class="line"><span class="string">update      Update configuration of one or more containers							# 更新一个或多个容器的配置</span></span><br><span class="line"><span class="string">version     Show the Docker version information										# 查看docker版本号</span></span><br><span class="line"><span class="string">wait        Block until one or more containers stop, then print their exit codes		# 截取容器停止时的退出状态值</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p>Docker 安装Nginx</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">1. 搜索镜像 search 建议大家去docker搜索，可以看到帮助文档</span></span><br><span class="line"><span class="meta">#</span><span class="bash">2. 拉取镜像 pull</span></span><br><span class="line"><span class="meta">#</span><span class="bash">3、运行测试</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -d 后台运行</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --name 给容器命名</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -p 宿主机端口：容器内部端口</span></span><br><span class="line">➜  ~ docker run -d --name nginx00 -p 82:80 nginx</span><br><span class="line">75943663c116f5ed006a0042c42f78e9a1a6a52eba66311666eee12e1c8a4502</span><br><span class="line">➜  ~ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                NAMES</span><br><span class="line">75943663c116        nginx               &quot;nginx -g &#x27;daemon of…&quot;   41 seconds ago      Up 40 seconds       0.0.0.0:82-&gt;80/tcp   nginx00</span><br><span class="line">➜  ~ curl localhost:82   #测试</span><br><span class="line">&lt;!DOCTYPE html&gt;,,,,</span><br></pre></td></tr></table></figure>



<p>思考问题：我们每次改动nginx配置文件，都需要进入容器内部？十分的麻烦，要是可以在容器外部提供一个映射路径，达到在容器修改文件名，容器内部就可以自动修改数据卷！</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoZW5nY29kZXgvY2xvdWRpbWcvbWFzdGVyL2ltZy9pbWFnZS0yMDIwMDUxNDIxNTkxNTY1MC5wbmc?x-oss-process=image/format,png" alt="img"></p>
<blockquote>
<p>作业：docker 来装一个tomcat</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 官方的使用</span></span><br><span class="line">docker run -it --rm tomcat:9.0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 之前的启动都是后台，停止了容器，容器还是可以查到， docker run -it --rm image 一般是用来测试，用完就删除</span></span><br><span class="line">--rm       Automatically remove the container when it exits</span><br><span class="line"><span class="meta">#</span><span class="bash">下载</span></span><br><span class="line">docker pull tomcat</span><br><span class="line"><span class="meta">#</span><span class="bash">启动运行</span></span><br><span class="line">docker run -d -p 8080:8080 --name tomcat01 tomcat</span><br><span class="line"><span class="meta">#</span><span class="bash">测试访问有没有问题</span></span><br><span class="line">curl localhost:8080</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">进入容器</span></span><br><span class="line">➜  ~ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">db09851cf82e        tomcat              &quot;catalina.sh run&quot;   28 seconds ago      Up 27 seconds       0.0.0.0:8080-&gt;8080/tcp   tomcat01</span><br><span class="line">➜  ~ docker exec -it db09851cf82e /bin/bash             </span><br><span class="line">root@db09851cf82e:/usr/local/tomcat# </span><br><span class="line"><span class="meta">#</span><span class="bash"> 发现问题：1、linux命令少了。 2.没有webapps</span></span><br></pre></td></tr></table></figure>



<p>思考问题：我们以后要部署项目，如果每次都要进入容器是不是十分麻烦？要是可以在容器外部提供一个映射路径，webapps，我们在外部放置项目，就自动同步内部就好了！</p>
<blockquote>
<p>作业：部署es+kibana</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> es 暴露的端口很多！</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> es 的数据一般需要放置到安全目录！挂载</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --net somenetwork ? 网络配置</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动elasticsearch</span></span><br><span class="line">docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; elasticsearch:7.6.2</span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试一下es是否成功启动</span></span><br><span class="line">➜  ~ curl localhost:9200</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot; : &quot;d73ad2f22dd3&quot;,</span><br><span class="line">  &quot;cluster_name&quot; : &quot;docker-cluster&quot;,</span><br><span class="line">  &quot;cluster_uuid&quot; : &quot;atFKgANxS8CzgIyCB8PGxA&quot;,</span><br><span class="line">  &quot;version&quot; : &#123;</span><br><span class="line">    &quot;number&quot; : &quot;7.6.2&quot;,</span><br><span class="line">    &quot;build_flavor&quot; : &quot;default&quot;,</span><br><span class="line">    &quot;build_type&quot; : &quot;docker&quot;,</span><br><span class="line">    &quot;build_hash&quot; : &quot;ef48eb35cf30adf4db14086e8aabd07ef6fb113f&quot;,</span><br><span class="line">    &quot;build_date&quot; : &quot;2020-03-26T06:34:37.794943Z&quot;,</span><br><span class="line">    &quot;build_snapshot&quot; : false,</span><br><span class="line">    &quot;lucene_version&quot; : &quot;8.4.0&quot;,</span><br><span class="line">    &quot;minimum_wire_compatibility_version&quot; : &quot;6.8.0&quot;,</span><br><span class="line">    &quot;minimum_index_compatibility_version&quot; : &quot;6.0.0-beta1&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;tagline&quot; : &quot;You Know, for Search&quot;</span><br><span class="line">&#125;</span><br><span class="line">➜  ~ docker stats # 查看docker容器使用内存情况</span><br><span class="line"></span><br><span class="line">CONTAINER ID        NAME                CPU %               MEM USAGE / LIMIT   MEM %               NET I/O             BLOCK I/O           PIDS</span><br><span class="line">bd4094db247f        elasticsearch       1.57%               1.226GiB / 3.7GiB   33.13%              0B / 0B             0B / 0B             42</span><br><span class="line">94b00b6f6172        tomcat              0.18%               78.58MiB / 3.7GiB   2.07%               1.69kB / 2.47kB     0B / 0B             37</span><br><span class="line">d458bc50a808        nginx01             0.00%               1.883MiB / 3.7GiB   0.05%               5.22kB / 6.32kB     0B / 0B             3</span><br><span class="line">63d4c4115212        redis               0.14%               9.637MiB / 3.7GiB   0.25%               10.8kB / 14.2kB     0B / 0B             7</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> elasticsearch十分占用内存,需要修改配置文件 -e 限制其启动的内存</span></span><br><span class="line">docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e ES_JAVA_OPTS= </span><br><span class="line">&quot;-Xms64m -Xmx 512m&quot;  elasticsearch:7.6.2</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@CZP ~]# curl localhost:9200</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot; : &quot;bd4094db247f&quot;,</span><br><span class="line">  &quot;cluster_name&quot; : &quot;docker-cluster&quot;,</span><br><span class="line">  &quot;cluster_uuid&quot; : &quot;U3TfPp1rQ6uitn0WMh6pRQ&quot;,</span><br><span class="line">  &quot;version&quot; : &#123;</span><br><span class="line">    &quot;number&quot; : &quot;7.6.2&quot;,</span><br><span class="line">    &quot;build_flavor&quot; : &quot;default&quot;,</span><br><span class="line">    &quot;build_type&quot; : &quot;docker&quot;,</span><br><span class="line">    &quot;build_hash&quot; : &quot;ef48eb35cf30adf4db14086e8aabd07ef6fb113f&quot;,</span><br><span class="line">    &quot;build_date&quot; : &quot;2020-03-26T06:34:37.794943Z&quot;,</span><br><span class="line">    &quot;build_snapshot&quot; : false,</span><br><span class="line">    &quot;lucene_version&quot; : &quot;8.4.0&quot;,</span><br><span class="line">    &quot;minimum_wire_compatibility_version&quot; : &quot;6.8.0&quot;,</span><br><span class="line">    &quot;minimum_index_compatibility_version&quot; : &quot;6.0.0-beta1&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;tagline&quot; : &quot;You Know, for Search&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>docker和kibana如何连接</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20200619182808443.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<h2 id="可视化"><a href="#可视化" class="headerlink" title="可视化"></a>可视化</h2><ul>
<li>portainer(先用这个)</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8080:9000 \</span><br><span class="line">--restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer</span><br></pre></td></tr></table></figure>



<ul>
<li>Rancher(CI/CD再用)</li>
</ul>
<p><strong>什么是portainer?</strong></p>
<p>Docker图形化界面管理工具! 提供一个后台面板供我们操作</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8080:9000 \</span><br><span class="line">--restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer</span><br></pre></td></tr></table></figure>



<p>访问测试: 外网: 8088 http://外网ip:8088/</p>
<p><img src="https://img-blog.csdnimg.cn/20200619182828579.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>进入之后的面板</p>
<p><img src="https://img-blog.csdnimg.cn/20200619182840991.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<h1 id="Docker镜像讲解"><a href="#Docker镜像讲解" class="headerlink" title="Docker镜像讲解"></a>Docker镜像讲解</h1><h2 id="镜像是什么"><a href="#镜像是什么" class="headerlink" title="镜像是什么"></a>镜像是什么</h2><p>镜像就是一个轻量级的,可执行的独立软件包,用来打包软件运行环境和基于运行环境开发的软件,它包含运行某个软件所需的所有内容,包括代码,运行时,库,环境变量和配置文件。</p>
<p>所有的应用,直接打包docker镜像,就可以直接跑起来!</p>
<p><strong>如何得到镜像:</strong></p>
<ul>
<li>从远程仓库下载</li>
<li>朋友拷贝给你</li>
<li>自己制作一个镜像 DockerFile</li>
</ul>
<h2 id="Docker镜像加载原理"><a href="#Docker镜像加载原理" class="headerlink" title="Docker镜像加载原理"></a>Docker镜像加载原理</h2><blockquote>
<p>UnionFs(联合文件系统查询)</p>
</blockquote>
<p>我们下载的时候看到的一层一层就是这个</p>
<p>UnionFs(联合文件系统): Union文件系统(UnionFS)是一种分层,轻量级并且高性能的文件系统,它支持对文件系统的修改作为一次提交来一层层的叠加,同时可以将不同目录挂载到同一个虚拟文件系统下,Union文件系统是Docker镜像的基础,镜像可以通过分层来进行继承,基于基础镜像(没有父镜像),可以制作各种具体的应用镜像</p>
<p>特性: 一次同时加载多个文件系统,但从外面看起来,只能看到一个文件系统,联合加载会把各层文件系统叠加起来,这样最终的文件系统会包含所有底层的文件和目录结构</p>
<blockquote>
<p>Docker镜像加载原理</p>
</blockquote>
<p>docker的镜像实际上由一层一层的文件系统组成,这种层级的文件系统UnionFS</p>
<p>bootfs(boot file system)主要包含bootlloader和kernel,bootfs主要是引导加载kernel,Linux刚启动时会加载bootfs文件系统,在docker镜像的最底层是bootfs,这一层与我们典型的Linux/Unix系统是一样的,包含boot加载器和内核,当boot加载完成之后整个内核就在内存中了,此时内存的使用权已由bootfa转交给内核,此时系统也会卸载bootfs</p>
<p>rootfs(root file system),在bootfs之上,包含的就是典型Linux系统中的/dev, /proc,/bin, /etc等标准目录和文件,rootfs就是各种不同的操作系统发行版,比如Ubuntu, CentOS等等<br><img src="https://img-blog.csdnimg.cn/20200619182900538.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>平时我们安装进虚拟机的CentOS都是好几个G,为什么Docker这里才200M?</p>
<p><img src="https://img-blog.csdnimg.cn/20200619182913433.png#pic_center" alt="在这里插入图片描述"></p>
<p>对于一个精简的OS,rootfs可以很小,只需要包含基本的命令,工具和程序库就可以了,因为底层直接用Host的kernel,自己只需要提供rootFS就可以了。由此可见对于不同的linux发行版,bootfs基本是一致的,rootfs会有差别,因此不同的发行版可以共用bootfs</p>
<h2 id="分层理解"><a href="#分层理解" class="headerlink" title="分层理解"></a>分层理解</h2><blockquote>
<p>分层的镜像</p>
</blockquote>
<p>我们可以去下载一个镜像,注意观察下载的日志输出,可以看到是一层一层的在下载!</p>
<p><img src="https://img-blog.csdnimg.cn/20200619182926659.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>思考: 为什么Docker镜像要采用这种分层的结构呢?</p>
<p>最大好处,我觉得莫过于资源共享了!比如有多个镜像都从相同的Base镜像构建而来,那么宿主机</p>
<p>只需在磁盘上保留一份base镜像,同时内存中也只需要加载一份base镜像,这样就可以为所有的容器服务了,而且镜像的每一层都可以被共享</p>
<p>查看镜像分层的方式可以通过 docker image inspect 命令!</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@CZP ~]# docker images</span><br><span class="line">REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">nginx                 latest              2622e6cca7eb        32 hours ago        132MB</span><br><span class="line">portainer/portainer   latest              cd645f5a4769        9 days ago          79.1MB</span><br><span class="line">redis                 latest              36304d3b4540        13 days ago         104MB</span><br><span class="line">mysql                 latest              30f937e841c8        2 weeks ago         541MB</span><br><span class="line">tomcat                9.0                 1b6b1fe7261e        3 weeks ago         647MB</span><br><span class="line">elasticsearch         7.6.2               f29a1ee41030        2 months ago        791MB</span><br><span class="line">elasticsearch         latest              5acf0e8da90b        20 months ago       486MB</span><br><span class="line">[root@CZP ~]# docker image inspect redis</span><br><span class="line">[</span><br><span class="line">        &quot;RootFS&quot;: &#123;</span><br><span class="line">            &quot;Type&quot;: &quot;layers&quot;,</span><br><span class="line">            &quot;Layers&quot;: [</span><br><span class="line">                &quot;sha256:ffc9b21953f4cd7956cdf532a5db04ff0a2daa7475ad796f1bad58cfbaf77a07&quot;,</span><br><span class="line">                &quot;sha256:d4e681f320297add0ede0554524eb9106d8c3eb3a43e6e99d79db6f76f020248&quot;,</span><br><span class="line">                &quot;sha256:59bd5a888296b623ae5a9efc8f18285c8ac1a8662e5d3775a0d2d736c66ba825&quot;,</span><br><span class="line">                &quot;sha256:c112794a20c5eda6a791cbec8700fb98eab30671a2248ac7e2059b475c46c45f&quot;,</span><br><span class="line">                &quot;sha256:bf8b736583f08c02b92f8a75ac5ea181e4d74107876177caa80ddad8b6b57a72&quot;,</span><br><span class="line">                &quot;sha256:6ef422d19214800243b28017d346c7ab9bfe63cb198a39312d1714394b232449&quot;</span><br><span class="line">            ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>



<p><strong>理解:</strong></p>
<p>所有的镜像都起始于一个基础镜像层,当进行修改或增加新的内容时,就会在当前镜像层之上,创建一个新的镜像层,</p>
<p>举一个简单的例子,假如基于Ubuntu Linux 16.64创建一个新的镜像,这就是新镜像的第一层,如果在该镜像中添加python包,就会在该镜像之上创建第二个镜像层; 如果继续添加一个安全补丁,就会创建第三个镜像层</p>
<p>该镜像已经包含3个镜像层,如下图所示(这只是一个简单的例子)</p>
<p><img src="https://img-blog.csdnimg.cn/202006191829432.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>在添加额外的镜像层的同时,镜像始终保持是当前所有镜像的组合,理解这一点非常重要,下图举了一个简单的例子,每个镜像层包含3个文件,而镜像包含了两个镜像层的6个文件<br><img src="https://img-blog.csdnimg.cn/2020061918295560.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>上图中的镜像层跟之前图中的略有区别,主要是便于展示文件</p>
<p>下图中展示了一个稍微复杂的三层镜像,在外部看来整个镜像只有6个文件,这是因为最上层的文件7是文件5的一个更新版本</p>
<p><img src="https://img-blog.csdnimg.cn/20200619183009764.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>这种情况下,上层镜像层中的文件覆盖了底层镜像层中的文件,这样就使得文件的更新版本作为一个新镜像层添加到镜像当中</p>
<p>Docker通过存储引擎(新版本采用快照机制)的方式来实现镜像层堆栈,并保证多层镜像层对外展示为统一的文件系统</p>
<p>Lunux上可用的存储引擎有AUFS,Overlay2,Device Mapper,Btrfs以及ZFS,顾名思义,每种存储引擎都是基于Linux对应的文件系统或者块设备技术,并且每种存储引擎都有其独有的性能特点</p>
<p>Docker在Windows上仅支持windosfilter一种存储引擎,该引擎基于NTFS文件系统之上实现了分层和CoW[1]</p>
<p>下图展示了与系统显示相同的三层镜像,所有的镜像层堆叠合并,对外提供统一的视图层<br><img src="https://img-blog.csdnimg.cn/20200619183024727.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<blockquote>
<p>特点</p>
</blockquote>
<p>Docker镜像都是只读的,当容器启动时,一个新的可写层被加载到镜像的顶部!</p>
<p>这一层就是我们通常所说的容器层,容器之下的都叫镜像层<br><img src="https://img-blog.csdnimg.cn/20200619183036853.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>如何提交一个自己的镜像</p>
<h2 id="commit镜像"><a href="#commit镜像" class="headerlink" title="commit镜像"></a>commit镜像</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker commit 提交容器成为一个新的镜像</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 命令和git原理类似</span></span><br><span class="line">docker commit -m=&quot;提交的描述信息&quot; -a=&quot;作者&quot; 容器ID 目标镜像名:[tag]</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@CZP ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE                 COMMAND                  CREATED             STATUS              PORTS                                            NAMES</span><br><span class="line">db186da947d7        portainer/portainer   &quot;/portainer&quot;             16 hours ago        Up 16 hours         0.0.0.0:8088-&gt;9000/tcp                           interesting_shockley</span><br><span class="line">bd4094db247f        elasticsearch:7.6.2   &quot;/usr/local/bin/dock…&quot;   17 hours ago        Up 17 hours         0.0.0.0:9200-&gt;9200/tcp, 0.0.0.0:9300-&gt;9300/tcp   elasticsearch</span><br><span class="line">94b00b6f6172        tomcat:9.0            &quot;catalina.sh run&quot;        17 hours ago        Up 17 hours         0.0.0.0:8080-&gt;8080/tcp                           tomcat</span><br><span class="line">d458bc50a808        nginx                 &quot;/docker-entrypoint.…&quot;   18 hours ago        Up 18 hours         0.0.0.0:80-&gt;80/tcp                               nginx01</span><br><span class="line">63d4c4115212        36304d3b4540          &quot;docker-entrypoint.s…&quot;   22 hours ago        Up 22 hours         0.0.0.0:6379-&gt;6379/tcp                           redis</span><br><span class="line">[root@CZP ~]# docker commit -a=&quot;czp&quot; -m=&quot;add basic webapps app&quot; 94b00b6f6172 tomcat_9.0:1.0</span><br><span class="line">sha256:75e6ea173695b146c9ddf9d5865e7bdeb78e69c84d2d3520e516cd9f498a1e9a</span><br><span class="line">[root@CZP ~]# docker images</span><br><span class="line">REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">tomcat_9.0            1.0                 75e6ea173695        8 seconds ago       652MB</span><br><span class="line">nginx                 latest              2622e6cca7eb        33 hours ago        132MB</span><br><span class="line">portainer/portainer   latest              cd645f5a4769        9 days ago          79.1MB</span><br><span class="line">redis                 latest              36304d3b4540        13 days ago         104MB</span><br><span class="line">mysql                 latest              30f937e841c8        2 weeks ago         541MB</span><br><span class="line">tomcat                9.0                 1b6b1fe7261e        3 weeks ago         647MB</span><br><span class="line">elasticsearch         7.6.2               f29a1ee41030        2 months ago        791MB</span><br><span class="line">elasticsearch         latest              5acf0e8da90b        20 months ago       486MB</span><br></pre></td></tr></table></figure>



<h1 id="容器数据卷"><a href="#容器数据卷" class="headerlink" title="容器数据卷"></a>容器数据卷</h1><h2 id="什么是容器数据卷"><a href="#什么是容器数据卷" class="headerlink" title="什么是容器数据卷"></a>什么是容器数据卷</h2><p><strong>docker的理念回顾</strong></p>
<p>将应用和环境打包成一个镜像!</p>
<p>如果数据都在容器中,那么我们容器删除,数据就会丢失! ==需求: 数据可以持久化==</p>
<p>MYSQL, 容器删了,删库跑路! ==需求: mysql数据可以存储在本地!==</p>
<p>容器之间可以有一个数据共享的技术! Docker 容器中产生的数据,同步到本地!</p>
<p>这就是卷技术! 目录的挂载,将容器内的目录挂载到Linux上面!</p>
<p><img src="https://img-blog.csdnimg.cn/20200619183052229.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p><strong>总结一句话: 容器的持久化和同步操作! 容器间也可以数据共享的!</strong></p>
<h2 id="使用数据卷"><a href="#使用数据卷" class="headerlink" title="使用数据卷"></a>使用数据卷</h2><blockquote>
<p>方式一: 直接使用命令来挂载 -v</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v 主机目录: 容器内目录  -p 主机端口: 容器端口</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动起来我们可以使用 docker inspect 容器id</span></span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将宿主机的/root/<span class="built_in">test</span>挂载到tomcat的/home目录</span></span><br><span class="line">[root@CZP ~]# docker run -d -p 9999:8080 -v /root/test:/home --name=&quot;tomcat01&quot;  1b6b1fe7261e</span><br><span class="line">015001911b67f5e357b93c6bb05ebaf07aebe4f3abc455f9aa439afd83b9af78</span><br><span class="line">[root@CZP ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE                 COMMAND                  CREATED             STATUS              PORTS                                            NAMES</span><br><span class="line">015001911b67        1b6b1fe7261e          &quot;catalina.sh run&quot;        16 seconds ago      Up 15 seconds       0.0.0.0:9999-&gt;8080/tcp                           tomcat01</span><br><span class="line">db186da947d7        portainer/portainer   &quot;/portainer&quot;             17 hours ago        Up 17 hours         0.0.0.0:8088-&gt;9000/tcp                           interesting_shockley</span><br><span class="line">bd4094db247f        elasticsearch:7.6.2   &quot;/usr/local/bin/dock…&quot;   18 hours ago        Up 17 hours         0.0.0.0:9200-&gt;9200/tcp, 0.0.0.0:9300-&gt;9300/tcp   elasticsearch</span><br><span class="line">94b00b6f6172        tomcat:9.0            &quot;catalina.sh run&quot;        18 hours ago        Up 18 hours         0.0.0.0:8080-&gt;8080/tcp                           tomcat</span><br><span class="line">d458bc50a808        nginx                 &quot;/docker-entrypoint.…&quot;   18 hours ago        Up 18 hours         0.0.0.0:80-&gt;80/tcp                               nginx01</span><br><span class="line">63d4c4115212        36304d3b4540          &quot;docker-entrypoint.s…&quot;   22 hours ago        Up 22 hours         0.0.0.0:6379-&gt;6379/tcp                           redis</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入tomcat内部</span></span><br><span class="line">[root@CZP test]# docker exec -it tomcat01 /bin/bash</span><br><span class="line">root@015001911b67:/usr/local/tomcat# cd /home</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在home目录创建b.java</span></span><br><span class="line">root@015001911b67:/home# touch b.java</span><br><span class="line">root@015001911b67:/home# read escape sequence</span><br><span class="line">[root@CZP test]# cd /root/test</span><br><span class="line">[root@CZP test]# ll</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 root root 0 Jun 11 11:03 b.java # b.java显示挂载成功</span><br></pre></td></tr></table></figure>





<p><img src="https://img-blog.csdnimg.cn/20200619183107741.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<h2 id="实战-安装Mysql"><a href="#实战-安装Mysql" class="headerlink" title="实战: 安装Mysql"></a>实战: 安装Mysql</h2><p>思考: mysql的数据持久化的问题, data目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 获取镜像</span></span><br><span class="line">[root@CZP ~]# docker pull mysql:5.7</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 运行容器,需要做数据挂载! <span class="comment"># 安装启动mysql,需要配置密码,这是官方的</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 官方测试: docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=密码 -d mysql:tag</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动mysql</span></span><br><span class="line">-d  后台运行</span><br><span class="line">-p  端口映射</span><br><span class="line">-v  端口映射</span><br><span class="line">-e  环境配置</span><br><span class="line">--name 容器名</span><br><span class="line"></span><br><span class="line">[root@CZP czp]# docker run -d -p 3306:3306 -v /usr/czp/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=sa --name mysql mysql:5.7</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动成功之后,我们在本地使用sqlyog来连接测试一下</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sqlyog-连接到服务器的端口 ---服务器端口和容器端口映射,这个时候我们就可以连接上了</span></span><br></pre></td></tr></table></figure>



<p>假设我们将容器删除</p>
<p><img src="https://img-blog.csdnimg.cn/20200619183120835.png#pic_center" alt="在这里插入图片描述"></p>
<p>发现,我们挂载到本地的数据卷依旧没有丢失,这就实现了容器数据持久化功能</p>
<h2 id="具名挂载和匿名挂载"><a href="#具名挂载和匿名挂载" class="headerlink" title="具名挂载和匿名挂载"></a>具名挂载和匿名挂载</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 匿名挂载</span></span><br><span class="line">-v 容器内路径!</span><br><span class="line">docker -run -P -name nginx01 -v /etc/nginx nginx</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看所有的卷的情况</span></span><br><span class="line">[root@CZP data]# docker volume ls</span><br><span class="line"></span><br><span class="line">local               2c04226b82b31e3cddb80b5fffa17685883ff8c256024525b3a65b07b8281110</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这里发现,这种就是匿名挂载, 我们在 -v只写了容器内的路径,没有写容器外的路径</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 具名挂载</span></span><br><span class="line">[root@CZP data]# docker run -d -p 9099:80 -v nginxConfig:/etc/nginx 2622e6cca7eb</span><br><span class="line">bd7ebf502166e5569ea3fb5eddaf41f4ff9a70df62b9143861dd702ae8c1cb31</span><br><span class="line">[root@CZP data]# docker volume ls</span><br><span class="line">DRIVER              VOLUME NAME</span><br><span class="line">local               nginxConfig</span><br><span class="line"><span class="meta">#</span><span class="bash"> 通过 -v 卷名:容器内路径</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看一下这个卷</span></span><br></pre></td></tr></table></figure>



<p><img src="https://img-blog.csdnimg.cn/20200619183132733.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>所有的docker容器内的卷,没有指定目录的情况下都是在/var/lib/docker/volumes/卷名/_data</p>
<p>我们通过具名挂载可以方便的找到一个卷,大多数情况在使用的’具名挂载’</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 如何确定是具名挂载还是匿名挂载,还是指定路径挂载</span></span><br><span class="line">-v 容器内路径 				# 匿名挂载</span><br><span class="line">-v 卷名:容器内路径 		   # 具名挂载</span><br><span class="line">-v 宿主机路径 : 容器内路径     # 指定路径挂载</span><br></pre></td></tr></table></figure>



<p>扩展:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 通过 -v  容器内路径: ro rw 改变读写权限</span></span><br><span class="line">ro read only</span><br><span class="line">read and write</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 一旦设置了容器权限,容器对挂载出来的内容就有限定了!</span></span><br><span class="line">docker -run -P -name nginx01 -v /etc/nginx:ro nginx</span><br><span class="line">docker -run -P -name nginx01 -v /etc/nginx:rw nginx</span><br><span class="line">ro : 只要看到ro就说明这个路径只能通过宿主机来改变,容器内部无法操作</span><br></pre></td></tr></table></figure>



<p><strong>初始Dockerfile</strong></p>
<p>Dockerfile就是用来构建Dockerfile镜像的文件! 命令脚本!</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建一个dockerfile文件,名字可以随机 建议 dockerfile</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 文件中的内容</span></span><br><span class="line"></span><br><span class="line">FROM centos</span><br><span class="line"></span><br><span class="line">VOLUME [&quot;volume01&quot;,&quot;volume02&quot;]</span><br><span class="line"></span><br><span class="line">CMD echo &quot;---end---&quot;</span><br><span class="line">CMD /bin/hash</span><br></pre></td></tr></table></figure>



<p><img src="https://img-blog.csdnimg.cn/20200619183147416.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/20200619183159322.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>这个卷和外部一定有一个同步的目录</p>
<p><img src="https://img-blog.csdnimg.cn/20200619183210681.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>查看一下卷挂载的路径</p>
<p><img src="https://img-blog.csdnimg.cn/20200619183221422.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>测试一下刚才的文件是否同步出去了</p>
<p>这种方式我们未来使用的十分多,因为我们通常会构建自己的镜像!</p>
<p>假设构建镜像时没有挂载卷,要手动镜像挂载 -v 卷名: 容器内路径</p>
<h2 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a><strong>数据卷容器</strong></h2><p>两个Mysql同步数据!</p>
<p><img src="https://img-blog.csdnimg.cn/20200619183235195.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动三个容器,通过我们刚才自己的镜像启动</span></span><br></pre></td></tr></table></figure>



<p><img src="https://img-blog.csdnimg.cn/20200619183249590.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/20200619183300521.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 测试: 可以删除docker01,查看一下docker02和docker03是否还可以访问这个文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试依旧可以访问</span></span><br></pre></td></tr></table></figure>



<p><img src="https://img-blog.csdnimg.cn/20200619183313165.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p><strong>结论:</strong></p>
<p>容器之间配置信息的传递,数据卷容器的生命周期一直持续到没有人使用为止</p>
<p>但是一旦你持久化到了本地,这个时候,本地的数据是不hi删除的</p>
<h1 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h1><p>DockerFile是用来构建docker镜像的文件!命令参数脚本!</p>
<p>构建步骤:</p>
<ol>
<li>编写一个dockerfile脚本</li>
<li>docker build 构建成为一个镜像</li>
<li>docker run 运行镜像</li>
<li>docker push发布镜像(Docker hub , 阿里云镜像仓库! )</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20200619183412937.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/20200619183425960.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>很多官方镜像都是基础包, 很多功能没有,我们通常会自己搭建自己的镜像!</p>
<p>官方可以制作镜像,那么我们也可以!</p>
<h2 id="Dockerfile构建过程"><a href="#Dockerfile构建过程" class="headerlink" title="Dockerfile构建过程"></a>Dockerfile构建过程</h2><p>很多指令:</p>
<ol>
<li>每个保留关键字(指令)都是必须要大写</li>
<li>执行从上到下顺序执行</li>
<li>‘#’ 表示注释</li>
<li>每一个指令都会创建提交一个新的镜像层,并提交 !</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20200619183442209.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>dockerfile是面向开发的,我们以后要发布项目,做镜像就需要编写dockerfile文件,这个文件十分简单</p>
<p>Docker镜像 逐渐成为了一个企业交付的标准,必须要掌握 !</p>
<p>步骤: 开发,部署,上线,运维…缺一不可</p>
<p>DockerFIle: 构建文件,定义了一切的步骤 ,源代码</p>
<p>DockerImages: 通过DockerFile构建生成的镜像,最终发布运行的产品,原来是一个jar,war</p>
<p>Docker容器: 容器就是镜像运行起来提供服务的</p>
<h2 id="DockerFile的指令"><a href="#DockerFile的指令" class="headerlink" title="DockerFile的指令"></a>DockerFile的指令</h2><p>以前的话我们是使用的别人的,现在我们知道了这些指令后,我们来练习自己写一个镜像!</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">FROM 			# 基础镜像, 一切从这里开始构建</span><br><span class="line">MANTAINER 		# 镜像是谁写的, 姓名+邮箱</span><br><span class="line">RUN 			# 镜像构建的时候需要运行的命令</span><br><span class="line">ADD 			# 步骤, tomcat镜像,压缩包! 添加内容</span><br><span class="line">WORKDIR 		# 镜像的工作目录</span><br><span class="line">VOLUME 			# 挂载的目录</span><br><span class="line">EXPOSE 			# 暴露端口配置</span><br><span class="line">RUN 			# 运行</span><br><span class="line">CMD 			# 指定这个容器启动的时候要运行的命令,只有最后一个会生效,可被替代</span><br><span class="line">ENTRYPOINT 		# 指定这个容器启动的时候要运行的命令,可以追加命令</span><br><span class="line">ONBUILD 		# 当构建一个被继承 DockerFile 这个时候就会运行ONBUILD的指令,触发指令</span><br><span class="line">COPY			# 类似ADD,将我们文件拷贝到镜像中</span><br><span class="line">ENV 			# 构建的时候设置环境变量! </span><br></pre></td></tr></table></figure>



<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9zczAuYmRzdGF0aWMuY29tLzcwY0Z1SFNoX1ExWW54R2twb1dLMUhGNmhoeS9pdC91PTI2ODk3NDY0OSwyNjA3MDE5OTExJmZtPTI2JmdwPTAuanBn?x-oss-process=image/format,png" alt="img"></p>
<h2 id="实战测试"><a href="#实战测试" class="headerlink" title="实战测试"></a>实战测试</h2><p>Docker Hub 中99%镜像都是从centos基础镜像过来的,然后配置需要的软件</p>
<p><img src="https://img-blog.csdnimg.cn/20200619184350120.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<blockquote>
<p>创建一个自己的centos</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1 编写一个DOckerfile的文件</span></span><br><span class="line"></span><br><span class="line">FROM centos</span><br><span class="line"></span><br><span class="line">MAINTAINER czp&lt;2432688105@qq.com&gt;</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line"></span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line">RUN yum -y  install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line">CMD echo $MYPATH</span><br><span class="line">CMD echo &quot;---end---&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 通过这个文件构建镜像</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 命令 docker build -f dockerfile文件路径 -t</span></span><br><span class="line">Successfully built 5ebc296aad5a</span><br><span class="line">Successfully tagged mycentos:1.0</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 测试运行</span></span><br></pre></td></tr></table></figure>



<p>增强之后的镜像</p>
<p><img src="https://img-blog.csdnimg.cn/20200619184405292.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>我们可以列出本地进程的历史</p>
<p><img src="https://img-blog.csdnimg.cn/20200619184416447.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>我们平时拿到一个镜像,可以研究一下它是怎么做的</p>
<blockquote>
<p>CMD 和ENTRYPOINT的区别</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CMD 		# 指定这个容器启动的时候要运行的命令,只有最后一个会生效,可被替代</span><br><span class="line">ENTRYPOINT 	# 指定这个容器启动的时候要运行的命令,可以追加命令</span><br></pre></td></tr></table></figure>



<p>测试cmd命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 编写</span></span><br><span class="line">[root@CZP dockerfile]# cat dockerfile-centos-test </span><br><span class="line">FROM centos</span><br><span class="line">CMD [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 构建镜像</span></span><br><span class="line">[root@CZP dockerfile]# docker build -f dockerfile-centos-test -t centostest .</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 想要追加一个命令 -l  ls -al</span></span><br><span class="line">docker: Error response from daemon: OCI runtime create failed: container_linux.go:349: starting container process caused &quot;exec: \&quot;-l\&quot;: executable file not found in $PATH&quot;: unknown.</span><br><span class="line">ERRO[0000] error waiting for container: context canceled </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cmd的情况下 替换了CMD[<span class="string">&quot;ls&quot;</span>,<span class="string">&quot;-a&quot;</span>]命令,-不是命令追加</span></span><br></pre></td></tr></table></figure>



<p>ENTRYPOINT是往命令之后追加</p>
<h2 id="实战-Tomcat镜像"><a href="#实战-Tomcat镜像" class="headerlink" title="实战:Tomcat镜像"></a>实战:Tomcat镜像</h2><ol>
<li>准备镜像文件. tomcat压缩包, jdk压缩包!</li>
<li><img src="https://img-blog.csdnimg.cn/20200619184436678.png#pic_center" alt="在这里插入图片描述"></li>
<li>编写Dockerfile文件, 官方命名 Dockerfile, build会自动寻找这个文件,就不需要 -f 指定了!</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">MAINTAINER czp&lt;2432688105@qq.com&gt;</span><br><span class="line"></span><br><span class="line">COPY readme.txt /usr/local/readme.txt</span><br><span class="line"></span><br><span class="line">ADD apache-tomcat-9.0.33.tar.gz /usr/local/</span><br><span class="line"></span><br><span class="line">ADD jdk-8u221-linux-x64.rpm /usr/local/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line"> </span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line"> </span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"> </span><br><span class="line">ENV JAVA_HOME /usr/local/jdk1.8.0_11</span><br><span class="line">ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line"></span><br><span class="line">ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.33</span><br><span class="line"></span><br><span class="line">ENV CATALINA_BASH /usr/local/apache-tomcat-9.0.33</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 配置环境变量</span></span><br><span class="line">ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:/CATALINA_HOME/bin</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line">CMD /usr/local/apache-tomcat-9.0.33/bin/startup.sh &amp;&amp; tail -F /usr/local/apache-tomcat-9.0.33/bin/logs/catalina.out</span><br></pre></td></tr></table></figure>



<ol>
<li>构建镜像</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker build -t diytomcat .</span></span><br></pre></td></tr></table></figure>



<ol>
<li>本地测试</li>
</ol>
<blockquote>
<p>curl localhost:9090</p>
</blockquote>
<h2 id="发布自己的镜像"><a href="#发布自己的镜像" class="headerlink" title="发布自己的镜像"></a>发布自己的镜像</h2><blockquote>
<p>DockerHub</p>
</blockquote>
<ol>
<li>地址hub.docker.com 注册自己的账号!</li>
<li>确定这个账号可以登录</li>
<li>在服务器上提交自己的镜像</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@CZP ~]# docker login --help</span><br><span class="line"></span><br><span class="line">Usage:	docker login [OPTIONS] [SERVER]</span><br><span class="line"></span><br><span class="line">Log in to a Docker registry.</span><br><span class="line">If no server is specified, the default is defined by the daemon.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -p, --password string   Password</span><br><span class="line">      --password-stdin    Take the password from stdin</span><br><span class="line">  -u, --username string   Username</span><br></pre></td></tr></table></figure>



<ol>
<li>登录完毕就可以提交镜像了,就是一步 docker push</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">push自己的镜像到服务器上一定要带上版本号</span></span><br><span class="line">[root@CZP ~]# docker push czp/centos:1.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker tag [id] [tag] 为容器添加一个版本</span><br></pre></td></tr></table></figure>



<blockquote>
<p>提交到阿里云镜像仓库</p>
</blockquote>
<ol>
<li>登录阿里云</li>
<li>找到容器镜像服务</li>
<li>创建命名空间</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20200619184533739.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<ol>
<li>创建容器镜像</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20200619184546684.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<ol>
<li>浏览阿里云</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/2020061918455938.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p><img src="https://img-blog.csdnimg.cn/20200619184610970.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<h1 id="Docker网络"><a href="#Docker网络" class="headerlink" title="Docker网络"></a>Docker网络</h1><p>理解docker0</p>
<blockquote>
<p>测试</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20200619184654885.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>三个网络</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 问题: docker 是如何处理容器网络访问的?</span></span><br></pre></td></tr></table></figure>



<p><img src="https://img-blog.csdnimg.cn/20200619184742153.png#pic_center" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/20200619184814123.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<blockquote>
<p>原理</p>
</blockquote>
<ol>
<li>我们每启动一个docker容器,docker就会给docker容器分配一个ip,我们只要安装了docker,就会有一个网卡docker0,桥接模式,使用的技术是evth-pair技术!</li>
</ol>
<p>再次测试 ip addr</p>
<p><img src="https://img-blog.csdnimg.cn/2020061918485148.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<ol>
<li>再启动一个容器</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20200619184905708.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 我们发现这个容器带来网卡, 都是一对对的</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> evth-pair 就是一对虚拟机设备接口,他们都是成对出现的,一端连着协议,一端彼此相连</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 正因为有这个特性,veth-pair 充当桥梁,连接各种虚拟网络设备的</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> openStac,Docker容器之间的连接,OVS的连接,都是使用 evth-pair 技术</span></span><br></pre></td></tr></table></figure>



<ol>
<li>我们来测试一下</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20200619184921826.png#pic_center" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/20200619184934900.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>结论: tomcat01和tomcat02是共用的一个路由器,docker0</p>
<p>所有的容器不指定网络的情况下,都是docker0路由的,docker会给我们的容器分配一个默认的可用IP</p>
<blockquote>
<p>小结</p>
</blockquote>
<p>Docker 使用的是Linux的桥接,宿主机中是一个Docker容器的网桥,docker0</p>
<p><img src="https://img-blog.csdnimg.cn/20200619184949651.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>Docker中所有的网络接口都是虚拟的,虚拟的转发效率高</p>
<p>只要容器删除,对应网桥的一对就没了</p>
<p><img src="https://img-blog.csdnimg.cn/20200619185002288.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<h2 id="–link"><a href="#–link" class="headerlink" title="–link"></a>–link</h2><blockquote>
<p>思考一个场景,我们编写了一个微服务,database url=ip: 项目不重启,数据库IP换掉了,我们希望可以通过名字来访问服务</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@CZP ~]# docker exec -it tomcat02 ping tomcat01</span><br><span class="line">ping: tomcat01: Name or service not known</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如何可以解决呢?</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 通过 --link 就可以解决网络问题</span></span><br><span class="line">[root@CZP ~]# docker exec -it tomcat03 ping tomcat02</span><br><span class="line">PING tomcat02 (172.18.0.4) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat02 (172.18.0.4): icmp_seq=1 ttl=64 time=0.128 ms</span><br><span class="line">64 bytes from tomcat02 (172.18.0.4): icmp_seq=2 ttl=64 time=0.097 ms</span><br><span class="line">64 bytes from tomcat02 (172.18.0.4): icmp_seq=3 ttl=64 time=0.091 ms</span><br><span class="line">64 bytes from tomcat02 (172.18.0.4): icmp_seq=4 ttl=64 time=0.109 ms</span><br><span class="line">64 bytes from tomcat02 (172.18.0.4): icmp_seq=5 ttl=64 time=0.097 ms</span><br><span class="line">64 bytes from tomcat02 (172.18.0.4): icmp_seq=6 ttl=64 time=0.096 ms</span><br><span class="line">64 bytes from tomcat02 (172.18.0.4): icmp_seq=7 ttl=64 time=0.092 ms</span><br><span class="line">64 bytes from tomcat02 (172.18.0.4): icmp_seq=8 ttl=64 time=0.094 ms</span><br><span class="line">64 bytes from tomcat02 (172.18.0.4): icmp_seq=9 ttl=64 time=0.102 ms</span><br><span class="line">^C</span><br><span class="line">--- tomcat02 ping statistics ---</span><br><span class="line">9 packets transmitted, 9 received, 0% packet loss, time 1007ms</span><br><span class="line">rtt min/avg/max/mdev = 0.091/0.100/0.128/0.015 ms</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 反向是否可以ping通吗</span></span><br><span class="line">[root@CZP ~]# docker exec -it tomcat02 ping tomcat03</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/hosts  配置端口和域名的绑定</span><br></pre></td></tr></table></figure>



<p><img src="https://img-blog.csdnimg.cn/20200619185017414.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>本地探究 – link 就是我们在host配置中增加了一个172.18.0.3 tomcat02 312857784cd4</p>
<p>我们现在玩Docker已经不建议使用–link了!</p>
<p>自定义网络,不使用docker0!</p>
<p>docker0问题: 它不支持容器名连接访问!</p>
<h2 id="自定义网络"><a href="#自定义网络" class="headerlink" title="自定义网络"></a>自定义网络</h2><blockquote>
<p>查看所有的docker网络</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20200619185041987.png#pic_center" alt="在这里插入图片描述"></p>
<p><strong>网络模式</strong></p>
<p>bridge : 桥接 docker 大桥</p>
<p>none: 不配置网络</p>
<p>host: 和宿主机共享网络</p>
<p>container: 容器内网络联通!</p>
<p><strong>测试</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 直接启动的命令 --net brodge,默认docker0</span></span><br><span class="line">docker run -d -P --name tomcat01 --net bridge tomcat</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker0的特点: 默认的,域名是不能访问的, --link可以打通连接</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 自定义</span></span><br><span class="line"></span><br><span class="line">[root@CZP ~]# docker network create --help</span><br><span class="line"></span><br><span class="line">Usage:	docker network create [OPTIONS] NETWORK</span><br><span class="line"></span><br><span class="line">Create a network</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --attachable           Enable manual container attachment</span><br><span class="line">      --aux-address map      Auxiliary IPv4 or IPv6 addresses used by Network driver (default map[])</span><br><span class="line">      --config-from string   The network from which copying the configuration</span><br><span class="line">      --config-only          Create a configuration only network</span><br><span class="line">  -d, --driver string        Driver to manage the Network (default &quot;bridge&quot;)</span><br><span class="line">      --gateway strings      IPv4 or IPv6 Gateway for the master subnet</span><br><span class="line">      --ingress              Create swarm routing-mesh network</span><br><span class="line">      --internal             Restrict external access to the network</span><br><span class="line">      --ip-range strings     Allocate container ip from a sub-range</span><br><span class="line">      --ipam-driver string   IP Address Management Driver (default &quot;default&quot;)</span><br><span class="line">      --ipam-opt map         Set IPAM driver specific options (default map[])</span><br><span class="line">      --ipv6                 Enable IPv6 networking</span><br><span class="line">      --label list           Set metadata on a network</span><br><span class="line">  -o, --opt map              Set driver specific options (default map[])</span><br><span class="line">      --scope string         Control the network&#x27;s scope</span><br><span class="line">      --subnet strings       Subnet in CIDR format that represents a network segment</span><br><span class="line"></span><br><span class="line">[root@CZP ~]# docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet</span><br><span class="line">677fae13a48c634dc03c56641b9ba31354846d31a196fdcb92c9ef6ddff73150</span><br><span class="line">[root@CZP ~]# docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">228826a97a0b        bridge              bridge              local</span><br><span class="line">c3b4884cd4db        host                host                local</span><br><span class="line">677fae13a48c        mynet               bridge              local</span><br><span class="line">35885200f93d        none                null                local</span><br></pre></td></tr></table></figure>



<p>我们自己的网络就创建好了</p>
<p><img src="https://img-blog.csdnimg.cn/20200619185056508.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[root@CZP ~]#  docker run -d -P --name tomcat-net-01 --net mynet tomcat:9.0</span><br><span class="line">336dd072ca17ac1adf514c44c8dcbd3358146d6d60667f3a0f99dbbb3e305f09</span><br><span class="line">[root@CZP ~]#  docker run -d -P --name tomcat-net-02 --net mynet tomcat:9.0</span><br><span class="line">2cea3bb29350ae99ce26c1bf6f8d1f2dcfb25bf8042193263ce275308e9eb42d</span><br><span class="line">[root@CZP ~]# docker network inspect mynet</span><br><span class="line">[</span><br><span class="line">   &#123;</span><br><span class="line">       &quot;Name&quot;: &quot;mynet&quot;,</span><br><span class="line">       &quot;Id&quot;: &quot;677fae13a48c634dc03c56641b9ba31354846d31a196fdcb92c9ef6ddff73150&quot;,</span><br><span class="line">       &quot;Created&quot;: &quot;2020-06-14T16:49:14.554786193+08:00&quot;,</span><br><span class="line">       &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">       &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">       &quot;EnableIPv6&quot;: false,</span><br><span class="line">       &quot;IPAM&quot;: &#123;</span><br><span class="line">           &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">           &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">           &quot;Config&quot;: [</span><br><span class="line">               &#123;</span><br><span class="line">                   &quot;Subnet&quot;: &quot;192.168.0.0/16&quot;,</span><br><span class="line">                   &quot;Gateway&quot;: &quot;192.168.0.1&quot;</span><br><span class="line">               &#125;</span><br><span class="line">           ]</span><br><span class="line">       &#125;,</span><br><span class="line">       &quot;Internal&quot;: false,</span><br><span class="line">       &quot;Attachable&quot;: false,</span><br><span class="line">       &quot;Ingress&quot;: false,</span><br><span class="line">       &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">           &quot;Network&quot;: &quot;&quot;</span><br><span class="line">       &#125;,</span><br><span class="line">       &quot;ConfigOnly&quot;: false,</span><br><span class="line">       &quot;Containers&quot;: &#123;</span><br><span class="line">           &quot;2cea3bb29350ae99ce26c1bf6f8d1f2dcfb25bf8042193263ce275308e9eb42d&quot;: &#123;</span><br><span class="line">               &quot;Name&quot;: &quot;tomcat-net-02&quot;,</span><br><span class="line">               &quot;EndpointID&quot;: &quot;ebff8e9ef22bd3d66d0de4229d1f3a3c610785b23005294f60f96f3089d52c3d&quot;,</span><br><span class="line">               &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:03&quot;,</span><br><span class="line">               &quot;IPv4Address&quot;: &quot;192.168.0.3/16&quot;,</span><br><span class="line">               &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">           &#125;,</span><br><span class="line">           &quot;336dd072ca17ac1adf514c44c8dcbd3358146d6d60667f3a0f99dbbb3e305f09&quot;: &#123;</span><br><span class="line">               &quot;Name&quot;: &quot;tomcat-net-01&quot;,</span><br><span class="line">               &quot;EndpointID&quot;: &quot;69451bb0c95ed27d207cd2bade9c57fd2625c245b8b8cb3e5d0dea530a368683&quot;,</span><br><span class="line">               &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:02&quot;,</span><br><span class="line">               &quot;IPv4Address&quot;: &quot;192.168.0.2/16&quot;,</span><br><span class="line">               &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;,</span><br><span class="line">       &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">       &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">   &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>



<p>现在不使用–link也可以ping名字了,推荐使用这种网络</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@CZP ~]# docker exec tomcat-net-01 ping tomcat-net-02</span><br><span class="line">PING tomcat-net-02 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=1 ttl=64 time=0.080 ms</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=2 ttl=64 time=0.096 ms</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=3 ttl=64 time=0.086 ms</span><br><span class="line">^C</span><br><span class="line">[root@CZP ~]# </span><br></pre></td></tr></table></figure>



<p>好处:</p>
<p>不同的集群使用不同的集群,保证集群之间是安全和健康的</p>
<h2 id="网络联通"><a href="#网络联通" class="headerlink" title="网络联通"></a>网络联通</h2><p><img src="https://img-blog.csdnimg.cn/20200619185116312.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/2020061918520685.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 测试打通 tomcat01到tomcat-net-01</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 连通之后就是将 tomcat01 放到了mynet网络下</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 一个容器两个ip   阿里云: 公网ip 私网ip</span></span><br></pre></td></tr></table></figure>



<p><img src="https://img-blog.csdnimg.cn/20200619185223260.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>这样容器之间就可以ping通了</p>
<h2 id="实战-redis集群部署"><a href="#实战-redis集群部署" class="headerlink" title="实战 redis集群部署"></a>实战 redis集群部署</h2><p><img src="https://img-blog.csdnimg.cn/20200619185253550.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建网卡</span></span><br><span class="line">docker network create --subnet 172.38.0.0/16 redis</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 通过脚本创建六个redis配置</span></span><br><span class="line">for port in $(seq 1 6);\</span><br><span class="line">do \</span><br><span class="line">mkdir -p /mydata/redis/node-$&#123;port&#125;/conf</span><br><span class="line">touch /mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">cat &lt;&lt; EOF &gt;&gt; /mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">port 6379</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">cluster-announce-ip 172.38.0.1$&#123;port&#125;</span><br><span class="line">cluster-announce-port 6379</span><br><span class="line">cluster-announce-bus-port 16379</span><br><span class="line">appendonly yes</span><br><span class="line">EOF</span><br><span class="line">done</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 通过脚本运行六个redis</span></span><br><span class="line">for port in $(seq 1 6);\</span><br><span class="line">do \</span><br><span class="line">docker run -p 637$&#123;port&#125;:6379 -p 1637$&#123;port&#125;:16379 --name redis-$&#123;port&#125; \</span><br><span class="line">-v /mydata/redis/node-$&#123;port&#125;/data:/data \</span><br><span class="line">-v /mydata/redis/node-$&#123;port&#125;/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.1$&#123;port&#125; redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf </span><br><span class="line">done</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 停止redis并删除容器</span></span><br><span class="line">for port in $(seq 1 6);\</span><br><span class="line">do \</span><br><span class="line">docker stop redis-$&#123;port&#125;; \</span><br><span class="line">docker rm redis-$&#123;port&#125;;</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">docker exec -it redis-1 /bin/sh #redis默认没有bash</span><br><span class="line">redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379  --cluster-replicas 1</span><br></pre></td></tr></table></figure>



<p>集群搭建成功</p>
<p><img src="https://img-blog.csdnimg.cn/20200619185407282.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<h1 id="SpringBoot微服务打包Docker镜像"><a href="#SpringBoot微服务打包Docker镜像" class="headerlink" title="SpringBoot微服务打包Docker镜像"></a>SpringBoot微服务打包Docker镜像</h1><ol>
<li><strong>构建springBoot项目</strong></li>
<li><strong>打包应用</strong></li>
<li><strong>编写dockerfile</strong></li>
<li><strong>构建镜像</strong></li>
<li><strong>发布运行</strong></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/06/22/Django-rest-framework/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="池劲涛">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="池劲涛的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/06/22/Django-rest-framework/" class="post-title-link" itemprop="url">drf(详细)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-06-22 09:20:25" itemprop="dateCreated datePublished" datetime="2019-06-22T09:20:25+08:00">2019-06-22</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2019-07-01 12:22:34" itemprop="dateModified" datetime="2019-07-01T12:22:34+08:00">2019-07-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">Django系列</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="DRF-APIView请求生命周期流程图"><a href="#DRF-APIView请求生命周期流程图" class="headerlink" title="DRF APIView请求生命周期流程图"></a>DRF APIView请求生命周期流程图</h2><p><img src="https://img2018.cnblogs.com/blog/1736414/202002/1736414-20200218223701411-338089898.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/blog/1736414/202002/1736414-20200223221801476-717815335.png" alt="img"></p>
<h2 id="drf入门规范"><a href="#drf入门规范" class="headerlink" title="drf入门规范"></a>drf入门规范</h2><h3 id="Web应用模式"><a href="#Web应用模式" class="headerlink" title="Web应用模式"></a>Web应用模式</h3><p><strong>前后端不分离</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 模板渲染在后端完成</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gggfnzeg2xj31k80smjv1.jpg" alt="前后端不分离"></p>
<p><strong>前后端分离(主流)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 后端就只负责写接口，前端来调用，通信使用json格式</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 多端(web、app...)都可以使用同一个接口</span></span><br></pre></td></tr></table></figure>





<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gggfo3sdg9j31aw0u0jxr.jpg" alt="前后端分离"></p>
<h3 id="API接口"><a href="#API接口" class="headerlink" title="API接口"></a>API接口</h3><p><strong>通过网络，规定了前后台信息交互规则的url链接，也就是前后台信息交互的媒介</strong></p>
<p><strong>四大特点</strong></p>
<p>==url==</p>
<ul>
<li>长得像返回数据的url链接</li>
</ul>
<p>==请求方式==</p>
<ul>
<li>get、post、put、patch、delete</li>
</ul>
<p>==请求参数==</p>
<ul>
<li>json或xml(老项目)格式的key-value类型数据</li>
</ul>
<p>==相应结果==</p>
<ul>
<li>json或xml格式的数据</li>
</ul>
<h3 id="接口测试工具：Postman"><a href="#接口测试工具：Postman" class="headerlink" title="接口测试工具：Postman"></a>接口测试工具：Postman</h3><p><strong>官网下载</strong>：<a target="_blank" rel="noopener" href="https://www.getpostman.com/downloads/">https://www.getpostman.com/downloads/</a></p>
<h3 id="RESTful-API规范-3星"><a href="#RESTful-API规范-3星" class="headerlink" title="RESTful API规范(3星)"></a>RESTful API规范(3星)</h3><p><strong>写接口的规范，大部分接口都会按照这个规范去写(Web API接口的设计风格)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1 使用https协议进行传输数据(保证数据安全)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 url中带关键字api</span></span><br><span class="line">	https://api.baidu.com</span><br><span class="line">    https://www.baidu.com/api</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 3 url中带版本信息</span></span><br><span class="line">	https://api.baidu.com/v1</span><br><span class="line">	https://api.baidu.com/v2</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 4 数据即资源，均使用名词(重要)</span></span><br><span class="line">	https://api.baidu.com/users</span><br><span class="line">    https://api.baidu.com/books</span><br><span class="line">    https://api.baidu.com/book</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 5 资源操作由请求方式决定(重要)</span></span><br><span class="line">	<span class="string">&#x27;查询操作&#x27;</span> : get</span><br><span class="line">    <span class="string">&#x27;新增操作&#x27;</span> : post</span><br><span class="line">    <span class="string">&#x27;修改操作&#x27;</span> : put</span><br><span class="line">    <span class="string">&#x27;删除操作&#x27;</span> : delete</span><br><span class="line">    </span><br><span class="line">    https://api.baidu.com/books - get请求：获取所有书</span><br><span class="line">    https://api.baidu.com/books/<span class="number">1</span> - get请求：获取主键为<span class="number">1</span>的书</span><br><span class="line">    https://api.baidu.com/books - post请求：新增一本书书</span><br><span class="line">    https://api.baidu.com/books/<span class="number">1</span> - put请求：整体修改主键为<span class="number">1</span>的书</span><br><span class="line">    https://api.baidu.com/books/<span class="number">1</span> - patch请求：局部修改主键为<span class="number">1</span>的书</span><br><span class="line">    https://api.baidu.com/books/<span class="number">1</span> - delete请求：删除主键为<span class="number">1</span>的书</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 6 请求url中带搜索筛选条件(重要)</span></span><br><span class="line">	https://api.example.com/v1/zoos?limit=<span class="number">10</span>：指定返回记录的数量</span><br><span class="line">	https://api.example.com/v1/zoos?offset=<span class="number">10</span>：指定返回记录的开始位置、</span><br><span class="line">    https://api.example.com/v1/zoos?animal_type_id=<span class="number">1</span>：指定筛选条件</span><br><span class="line">     </span><br><span class="line"><span class="comment"># 7 响应中要带状态码(自己定义，http响应状态码)</span></span><br><span class="line">	&#123;</span><br><span class="line">    status:<span class="number">200</span></span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 8 响应返回错误信息</span></span><br><span class="line">	&#123;</span><br><span class="line">        status:<span class="number">200</span></span><br><span class="line">        msg: <span class="string">&quot;无权限操作&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 9 返回结果，遵循如下规范(大概率都没有遵循)</span></span><br><span class="line">	GET /collection：返回资源对象的列表（数组）</span><br><span class="line">    GET /collection/resource：返回单个资源对象</span><br><span class="line">    POST /collection：返回新生成的资源对象</span><br><span class="line">    PUT /collection/resource：返回完整的资源对象</span><br><span class="line">    PATCH /collection/resource：返回完整的资源对象</span><br><span class="line">    DELETE /collection/resource：返回一个空文档</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 10 返回数据中带有链接地址</span></span><br><span class="line">	&#123;</span><br><span class="line">  	<span class="string">&quot;status&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  	<span class="string">&quot;msg&quot;</span>: <span class="string">&quot;ok&quot;</span>,</span><br><span class="line">  	<span class="string">&quot;results&quot;</span>:[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>:<span class="string">&quot;肯德基(罗餐厅)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;img&quot;</span>: <span class="string">&quot;https://image.baidu.com/kfc/001.png&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">		]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="drf介绍与安装"><a href="#drf介绍与安装" class="headerlink" title="drf介绍与安装"></a>drf介绍与安装</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Django-Rest-Framework: 是django的一个app，可以借助它快速在django框架开发出符合restful规范的接口</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Django-Rest-Framework提供了: 认证、权限、限流、过滤、分页、接口文档等功能支持</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 官方文档: https://www.django-rest-framework.org/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># python Django版本的支持情况</span></span><br><span class="line">	Python(<span class="number">3.5</span>、<span class="number">3.6</span>、<span class="number">3.7</span>、<span class="number">3.8</span>、<span class="number">3.9</span>)</span><br><span class="line">    Django(<span class="number">2.2</span>、<span class="number">3.0</span>、<span class="number">3.1</span>)		<span class="number">2.</span>x用的多，<span class="number">1.</span>x(老项目)</span><br></pre></td></tr></table></figure>



<h3 id="CBV源码分析-2星"><a href="#CBV源码分析-2星" class="headerlink" title="CBV源码分析(2星)"></a>CBV源码分析(2星)</h3><p><strong>1 views.Book.as_view()执行完，一定是一个函数的内存地址</strong></p>
<p><strong>2 as_view是View类的类方法，类来调用</strong></p>
<p><img src="https://i.loli.net/2021/07/13/Ib7snRkHaWqUyXl.png" alt="image-20210712230515567.png"></p>
<p><strong>3 as_view中的view是一个闭包函数</strong></p>
<p><img src="https://i.loli.net/2021/07/13/o6SsLTcX4gyf3kZ.png" alt="t6yClDvJ1mSqBz7.png"></p>
<p><strong>4 执行了View类的dispatch</strong></p>
<p><img src="https://i.loli.net/2021/07/13/IY8ja5QpveFOcEg.png" alt="YnVcwmbhOkAz1NC.png"></p>
<p><img src="https://i.loli.net/2021/07/13/RjJSxWDNdgBmcp8.png" alt="X4UrdcEtFkosxhm.png"></p>
<p><strong>拓展</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果在当前视图类中重写dispatch方法，则可以实现：在get、post等方法执行之前或执行之后去执行重写的代码，完成类似装饰器的效果</span></span><br><span class="line"></span><br><span class="line">例如</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">dispatch</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="comment"># 代码(get、post等方法执行之前执行)</span></span><br><span class="line">        response = <span class="built_in">super</span>().dispatch(request, *args, **kwargs)</span><br><span class="line">        <span class="comment"># 代码(get、post等方法执行之后执行)</span></span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>



<h3 id="drf基本使用及流程分析-3星"><a href="#drf基本使用及流程分析-3星" class="headerlink" title="drf基本使用及流程分析(3星)"></a>drf基本使用及流程分析(3星)</h3><p><strong>继承APIView使用</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Student</span><br><span class="line"><span class="keyword">from</span> .serializers <span class="keyword">import</span> Student_serializers</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student_serializers_APIView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">    <span class="comment"># 查询所有学生信息</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        student_list = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">        ser = Student_serializers(instance=student_list, many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(ser.data)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 新增学生信息</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        ser = Student_serializers(data=request.data)</span><br><span class="line">        <span class="keyword">if</span> ser.is_valid():</span><br><span class="line">            ser.save()</span><br><span class="line">            <span class="keyword">return</span> Response(ser.data)</span><br></pre></td></tr></table></figure>



<p><strong>APIView的执行流程</strong></p>
<p>==1 APIView继承了django的View==</p>
<p><img src="https://i.loli.net/2021/07/13/SEe18PrpIxoBRqV.png" alt="EuNedGk5KbrJHwx.png"></p>
<p>==2 APIView中重写了as_view==</p>
<p><img src="https://i.loli.net/2021/07/13/ljb5H4esAzFyCGP.png" alt="rXMFCHUbcgnSOVh.png"></p>
<p>==3 执行self.dispatch() —&gt; APIView的dispatch==</p>
<p><img src="https://i.loli.net/2021/07/13/dNkwtysqrG3YMVK.png" alt="ti937vJdkYojVL1.png"></p>
<p><img src="https://i.loli.net/2021/07/13/dIJu91GOgZYymq4.png" alt="WwzN8m5tXhKVcID.png"></p>
<p>==4 在视图类中使用的request对象是新的request对象，而老的则是request._request==</p>
<p><img src="https://i.loli.net/2021/07/13/agAH9oRb3P2rOMu.png" alt="dhVZj9XbIBoweHx.png"></p>
<p><img src="https://i.loli.net/2021/07/13/QeqjWh3VfH9w2B5.png" alt="dMvBYCriDjX93z4.png"></p>
<p>==5 新的request对象中有一个属性：data==</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">1 data是post请求携带的数据 ---&gt; 字典</span></span><br><span class="line"><span class="string">2 无论是什么编码格式，只要是post提交的数据，都在request.data中</span></span><br><span class="line"><span class="string">3 以后再取值，都从request.data中取</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>==6 结论：继承了APIView后，request对象变成新的request，其他大部分和原来一样使用==</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 以后如果使用了drf，继承APIView(drf提供了很多view，他们都是继承自APIView)</span><br><span class="line">	注意：</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    包装出了一个新的request，在视图函数中使用时，跟原先没有区别</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    取post提交的数据，不要再从request.POST中取了，要从request.data中取</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    取get提交的参数，尽量不从request。GET中取了，要从request.query_params中取</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">   </span><br><span class="line"><span class="number">2</span> Request类(drf的)需要掌握</span><br><span class="line">	</span><br><span class="line">    <span class="number">2.1</span> request.data			<span class="comment"># 方法包装成了数据属性</span></span><br><span class="line">    <span class="number">2.2</span> request.query_params	<span class="comment"># 就是request._request.GET</span></span><br><span class="line">    <span class="number">2.3</span> request.FILES			<span class="comment"># 上传的文件</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 大部分用起来和原来一样</span></span><br><span class="line">    </span><br><span class="line"><span class="number">3</span> APIView类</span><br><span class="line">	<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">	包装了新的request</span></span><br><span class="line"><span class="string">	执行了认证、权限、频率...</span></span><br><span class="line"><span class="string">	处理了全局异常</span></span><br><span class="line"><span class="string">	包装了response对象</span></span><br><span class="line"><span class="string">	&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>





<h2 id="drf配置"><a href="#drf配置" class="headerlink" title="drf配置"></a>drf配置</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置</span></span><br><span class="line">    <span class="comment"># 1 后期，drf的所有配置，都写在这个字典中</span></span><br><span class="line">    <span class="comment"># 2 drf有个默认配置文件(drf源码的 ---&gt; setting.py),如果项目的配置文件配置了，优先使用项目的，如果没有配置，使用内置的</span></span><br><span class="line">    <span class="comment"># 3 返回样式的配置，一般不配置</span></span><br><span class="line">    REST_FRAMEWORK=&#123;</span><br><span class="line">		...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h2 id="序列化组件"><a href="#序列化组件" class="headerlink" title="序列化组件"></a>序列化组件</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p><strong>作用</strong></p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 序列化，序列化器(类)会把模型对象(Book对象，Queryset对象)转换成字典，经过response以后变成json字符串</span><br><span class="line"></span><br><span class="line"><span class="number">2</span> 反序列化，把客户端发送过来的数据，经过request以后变成字典(request.data)，序列化器(类)可以把字典转成模型</span><br><span class="line"></span><br><span class="line"><span class="number">3</span> 反序列化，完成数据校验功能</span><br></pre></td></tr></table></figure>



<p><strong>本质</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 本质就是写一个类，继承一个基类，可以完成序列化、反序列化和数据校验</span></span><br></pre></td></tr></table></figure>



<h3 id="序列化器之Serializer类的使用-跟表模型没有必然联系-5星"><a href="#序列化器之Serializer类的使用-跟表模型没有必然联系-5星" class="headerlink" title="序列化器之Serializer类的使用(跟表模型没有必然联系)(5星)"></a>序列化器之Serializer类的使用(跟表模型没有必然联系)(5星)</h3><p><strong>视图类</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Student</span><br><span class="line"><span class="keyword">from</span> .serializers <span class="keyword">import</span> Student_serializers</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student_serializers_APIView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">    <span class="comment"># 查询所有学生信息</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        student_list = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">        ser = Student_serializers(instance=student_list, many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(ser.data)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 新增学生信息</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        ser = Student_serializers(data=request.data)</span><br><span class="line">        <span class="keyword">if</span> ser.is_valid():</span><br><span class="line">            ser.save()</span><br><span class="line">            <span class="keyword">return</span> Response(ser.data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student_Detial_serializers_APIView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">    <span class="comment"># 查询单个学生信息</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">        student = Student.objects.<span class="built_in">filter</span>(pk=pk).first()</span><br><span class="line">        ser = Student_serializers(instance=student)</span><br><span class="line">        <span class="keyword">return</span> Response(ser.data)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 修改单个学生信息</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">        student = Student.objects.<span class="built_in">filter</span>(pk=pk).first()</span><br><span class="line">        ser = Student_serializers(instance=student, data=request.data)</span><br><span class="line">        <span class="keyword">if</span> ser.is_valid():</span><br><span class="line">            ser.save()</span><br><span class="line">        <span class="keyword">return</span> Response(ser.data)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 删除单个学生信息</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">        Student.objects.<span class="built_in">filter</span>(pk=pk).delete()</span><br><span class="line">        <span class="keyword">return</span> Response()</span><br></pre></td></tr></table></figure>



<p><strong>序列化类</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Student</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student_serializers</span>(<span class="params">serializers.Serializer</span>):</span></span><br><span class="line">    name = serializers.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    age = serializers.IntegerField()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span>(<span class="params">self, validated_data</span>):</span></span><br><span class="line">        student = Student.objects.create(**validated_data)</span><br><span class="line">        <span class="keyword">return</span> student</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">self, instance, validated_data</span>):</span></span><br><span class="line">        instance.name = validated_data.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">        instance.age = validated_data.get(<span class="string">&#x27;age&#x27;</span>)</span><br><span class="line">        instance.save()</span><br><span class="line">        <span class="keyword">return</span> instance</span><br></pre></td></tr></table></figure>



<p><strong>路由</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">&#x27;student/&#x27;</span>, views.Student_serializers_APIView.as_view()),</span><br><span class="line">    path(<span class="string">&#x27;student/&lt;int:pk&gt;&#x27;</span>, views.Student_Detial_serializers_APIView.as_view())</span><br><span class="line">]</span><br></pre></td></tr></table></figure>



<p><strong>模型</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    name = models.CharField(<span class="string">&#x27;姓名&#x27;</span>, max_length=<span class="number">32</span>)</span><br><span class="line">    age = models.IntegerField(<span class="string">&#x27;年龄&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="Serializers高级使用-5星"><a href="#Serializers高级使用-5星" class="headerlink" title="Serializers高级使用(5星)"></a>Serializers高级使用(5星)</h3><p><strong>1 source字段的作用</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># source：可以对应表模型的字段和方法(返回结果是什么，字段就是什么)</span></span><br><span class="line">	<span class="comment"># 一般用来做一对多，多对多的字段返回</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    注:</span></span><br><span class="line"><span class="string">    	source如果是字段，会显示字段，如果是方法，会执行方法，不用加括号</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>2 SerializerMethodFidld使用方法</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一般用来添加需要查询该表以外的其他表(或关联表)的字段、方法</span></span><br><span class="line"></span><br><span class="line">course_detail = serializers.SerializerMethodField()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_course_detail</span>(<span class="params">self, obj</span>):</span></span><br><span class="line">	<span class="keyword">return</span> &#123;<span class="string">&#x27;name&#x27;</span>:obj.course.name,<span class="string">&#x27;teacher&#x27;</span>:obj.course.course_teacher&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3 数据校验</strong></p>
<p>==反序列化时需要进行数据校验==</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;使用序列化器进行反序列化时，需要对数据进行验证后，才能获取验证成功的数据或者保存成模型类对象&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在获取反序列化的数据前，必须调用is_valid()方法进行验证，验证成功返回True，否者返回False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1 验证失败，可以通过序列化器对象的error属性获取错误信息，返回字典，包含了字段和字段的错误.如果是非字段错误，可以通过修改REST-framework配置中的NON_FIELD_ERRORS_KEY来控制错误字典中的key值</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 验证成功，可以通过序列化器对象validdated_data属性获取数据</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3 字段自己的校验规则</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookInfoSerializer</span>(<span class="params">serializers.Serializer</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">id</span> = serializers.IntegerField(label=<span class="string">&#x27;ID&#x27;</span>, read_only=<span class="literal">True</span>)</span><br><span class="line">    btitle = serializers.CharField(label=<span class="string">&#x27;名称&#x27;</span>, max_length=<span class="number">20</span>)</span><br><span class="line">    bpub_date = serializers.DateField(label=<span class="string">&#x27;发布日期&#x27;</span>, required=<span class="literal">False</span>)</span><br><span class="line">    bread = serializers.IntegerField(label=<span class="string">&#x27;阅读量&#x27;</span>, required=<span class="literal">False</span>)</span><br><span class="line">    bcomment = serializers.IntegerField(label=<span class="string">&#x27;评论量&#x27;</span>, required=<span class="literal">False</span>)</span><br><span class="line">    image = serializers.ImageField(label=<span class="string">&#x27;图片&#x27;</span>, required=<span class="literal">False</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 3.1 通过构造序列化器对象，并将要反序列化的数据传递给data构造参数，进行验证(views.py)</span></span><br><span class="line">	</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">    ser = Publish_modelserializers(request.data)</span><br><span class="line">    <span class="keyword">if</span> ser.is_valid():</span><br><span class="line">        ser.save()</span><br><span class="line">        <span class="keyword">return</span> Response(ser.data)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> Response(&#123;msg:ser.errors.get(<span class="string">&#x27;name&#x27;</span>)&#125;)</span><br><span class="line">    </span><br><span class="line">ps: is_valid()方法还会在验证失败时抛出异常serializers.ValidationError，可以通过传递raise_exception=<span class="literal">True</span>参数开启，REST-framework接收到此异常，会向前端返回HTTP <span class="number">400</span> Bad Request</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 3.2 补充定义验证行为</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;注意&#x27;</span></span><br><span class="line">	验证顺序是：字段自己的限制 ---&gt; 自己的局部钩子 ---&gt;(全部字段以及局部验证完毕以后再验证全局钩子)</span><br><span class="line"></span><br><span class="line">	<span class="number">3.2</span><span class="number">.1</span> validate_字段名(局部钩子)</span><br><span class="line">    </span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">validate_name</span>(<span class="params">self,name</span>):</span></span><br><span class="line">        <span class="keyword">if</span> name.startswith(<span class="string">&#x27;sb&#x27;</span>):</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;不能以sb开头&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> name</span><br><span class="line">    </span><br><span class="line">    <span class="number">3.2</span><span class="number">.2</span> validate(全局钩子)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate</span>(<span class="params">self, attrs</span>):</span></span><br><span class="line">        bread = attrs[<span class="string">&#x27;bread&#x27;</span>]</span><br><span class="line">        bcomment = attrs[<span class="string">&#x27;bcomment&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> bread &lt; bcomment:</span><br><span class="line">            <span class="keyword">raise</span> serializers.ValidationError(<span class="string">&#x27;阅读量小于评论量&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> attrs</span><br><span class="line">    </span><br><span class="line">    <span class="number">3.2</span><span class="number">.3</span> validators(在字段中添加validators参数，补充验证行为)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">about_django</span>(<span class="params">value</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;django&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> value.lower():</span><br><span class="line">        <span class="keyword">raise</span> serializers.ValidationError(<span class="string">&quot;图书不是关于Django的&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">BookInfoSerializer</span>(<span class="params">serializers.Serializer</span>):</span></span><br><span class="line">    	<span class="string">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">id</span> = serializers.IntegerField(label=<span class="string">&#x27;ID&#x27;</span>, read_only=<span class="literal">True</span>)</span><br><span class="line">        btitle = serializers.CharField(label=<span class="string">&#x27;名称&#x27;</span>, max_length=<span class="number">20</span>, validators=[about_django])</span><br><span class="line">        bpub_date = serializers.DateField(label=<span class="string">&#x27;发布日期&#x27;</span>, required=<span class="literal">False</span>)</span><br><span class="line">        bread = serializers.IntegerField(label=<span class="string">&#x27;阅读量&#x27;</span>, required=<span class="literal">False</span>)</span><br><span class="line">        bcomment = serializers.IntegerField(label=<span class="string">&#x27;评论量&#x27;</span>, required=<span class="literal">False</span>)</span><br><span class="line">        image = serializers.ImageField(label=<span class="string">&#x27;图片&#x27;</span>, required=<span class="literal">False</span>)</span><br><span class="line">    </span><br></pre></td></tr></table></figure>



<h3 id="模型类序列化器ModelSerializer-跟表模型有关联-5星"><a href="#模型类序列化器ModelSerializer-跟表模型有关联-5星" class="headerlink" title="模型类序列化器ModelSerializer(跟表模型有关联)(5星)"></a>模型类序列化器ModelSerializer(跟表模型有关联)(5星)</h3><p><strong>1 介绍</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drf为我们提供了一个ModelSerializer模型序列化器来帮助我们快速创建一个Serializer类</span><br></pre></td></tr></table></figure>



<p><strong>2 ModelSerializer与Serializer的区别</strong></p>
<ul>
<li>基于模型类自动生成一系列字段</li>
<li>基于模型类自动为Serializer生成validators，比如unique_together</li>
<li>包含默认的create()和update()的实现</li>
</ul>
<p><strong>3 使用</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Publish_modelserializers</span>(<span class="params">serializers.ModelSerializer</span>):</span>	<span class="comment"># 继承ModelSerializer</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Publish			<span class="comment"># 表模型</span></span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span>		<span class="comment"># 1 序列化的字段</span></span><br><span class="line">        fields = [<span class="string">&#x27;id&#x27;</span>,<span class="string">&#x27;name&#x27;</span>]	<span class="comment"># 2 用来手动指定字段</span></span><br><span class="line">        exclude = [<span class="string">&#x27;id&#x27;</span>]		<span class="comment"># 3 排除的字段(1、2、3只能同时使用一个)</span></span><br><span class="line">        depth					<span class="comment"># 深度，一般不用</span></span><br></pre></td></tr></table></figure>



<p><strong>4 重写字段</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name = serializers.SerializerMethodField()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_name</span>(<span class="params">self, obj</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;出版社 : &quot;</span> + obj.name</span><br></pre></td></tr></table></figure>



<p><strong>5 扩写字段(表模型中没有的字段)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">注意：</span></span><br><span class="line"><span class="string">	嵌套反序列化时正常只能传pk值，需要两个字段(一个展示(read_only)，一个添加数据(write_only))</span></span><br><span class="line"><span class="string">	否则反序列化嵌套数据时报错</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">name2 = serializers.SerializerMethodField()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_name2</span>(<span class="params">self, obj</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot; 出版社2:东京出版社&quot;</span></span><br></pre></td></tr></table></figure>



<p><strong>6 反序列化时，字段自己的校验规则，是映射表模型的</strong></p>
<p><strong>7 局部钩子与全局钩子(与Serializer一样)</strong></p>
<p><strong>8 write_only与read_only</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name=serializers.CharField(write_only=<span class="literal">True</span>)		<span class="comment"># 反序列化的时候使用，序列化时不用(只读)</span></span><br><span class="line"></span><br><span class="line">name=serializers.CharField(read_only=<span class="literal">True</span>)		<span class="comment"># 序列化的时候使用，反序列化时不用(只写)</span></span><br></pre></td></tr></table></figure>



<p><strong>9 extra_kwargs(添加额外参数选项)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">    model = Publish</span><br><span class="line">    fields = <span class="string">&#x27;__all__&#x27;</span></span><br><span class="line">    extra_kwargs = &#123;</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>:&#123;</span><br><span class="line">            <span class="string">&#x27;required&#x27;</span>:<span class="literal">True</span>,</span><br><span class="line">            <span class="string">&#x27;min_length&#x27;</span>:<span class="number">3</span>,</span><br><span class="line">            <span class="string">&#x27;write_only&#x27;</span>:<span class="literal">True</span></span><br><span class="line">            <span class="string">&#x27;error_messages&#x27;</span>:&#123;</span><br><span class="line">                <span class="string">&#x27;required&#x27;</span>:<span class="string">&#x27;必须填&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;min_length&#x27;</span>:<span class="string">&#x27;最少三位&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">        <span class="string">&#x27;addr&#x27;</span>:&#123;</span><br><span class="line">            <span class="string">&#x27;read_only&#x27;</span>:<span class="literal">True</span></span><br><span class="line">            <span class="string">&#x27;required&#x27;</span>:<span class="literal">True</span></span><br><span class="line">        &#125; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="序列化器字段和字段参数-2星"><a href="#序列化器字段和字段参数-2星" class="headerlink" title="序列化器字段和字段参数(2星)"></a>序列化器字段和字段参数(2星)</h3><p><strong>常用字段类型：</strong></p>
<table>
<thead>
<tr>
<th align="left">字段</th>
<th align="left">字段构造方式</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>BooleanField</strong></td>
<td align="left">BooleanField()</td>
</tr>
<tr>
<td align="left"><strong>NullBooleanField</strong></td>
<td align="left">NullBooleanField()</td>
</tr>
<tr>
<td align="left"><strong>CharField</strong></td>
<td align="left">CharField(max_length=None, min_length=None, allow_blank=False, trim_whitespace=True)</td>
</tr>
<tr>
<td align="left"><strong>EmailField</strong></td>
<td align="left">EmailField(max_length=None, min_length=None, allow_blank=False)</td>
</tr>
<tr>
<td align="left"><strong>RegexField</strong></td>
<td align="left">RegexField(regex, max_length=None, min_length=None, allow_blank=False)</td>
</tr>
<tr>
<td align="left"><strong>SlugField</strong></td>
<td align="left">SlugField(max<em>length=50, min_length=None, allow_blank=False) 正则字段，验证正则模式 [a-zA-Z0-9</em>-]+</td>
</tr>
<tr>
<td align="left"><strong>URLField</strong></td>
<td align="left">URLField(max_length=200, min_length=None, allow_blank=False)</td>
</tr>
<tr>
<td align="left"><strong>UUIDField</strong></td>
<td align="left">UUIDField(format=’hex_verbose’) format: 1) <code>&#39;hex_verbose&#39;</code> 如<code>&quot;5ce0e9a5-5ffa-654b-cee0-1238041fb31a&quot;</code> 2） <code>&#39;hex&#39;</code> 如 <code>&quot;5ce0e9a55ffa654bcee01238041fb31a&quot;</code> 3）<code>&#39;int&#39;</code> - 如: <code>&quot;123456789012312313134124512351145145114&quot;</code> 4）<code>&#39;urn&#39;</code> 如: <code>&quot;urn:uuid:5ce0e9a5-5ffa-654b-cee0-1238041fb31a&quot;</code></td>
</tr>
<tr>
<td align="left"><strong>IPAddressField</strong></td>
<td align="left">IPAddressField(protocol=’both’, unpack_ipv4=False, **options)</td>
</tr>
<tr>
<td align="left"><strong>IntegerField</strong></td>
<td align="left">IntegerField(max_value=None, min_value=None)</td>
</tr>
<tr>
<td align="left"><strong>FloatField</strong></td>
<td align="left">FloatField(max_value=None, min_value=None)</td>
</tr>
<tr>
<td align="left"><strong>DecimalField</strong></td>
<td align="left">DecimalField(max_digits, decimal_places, coerce_to_string=None, max_value=None, min_value=None) max_digits: 最多位数 decimal_palces: 小数点位置</td>
</tr>
<tr>
<td align="left"><strong>DateTimeField</strong></td>
<td align="left">DateTimeField(format=api_settings.DATETIME_FORMAT, input_formats=None)</td>
</tr>
<tr>
<td align="left"><strong>DateField</strong></td>
<td align="left">DateField(format=api_settings.DATE_FORMAT, input_formats=None)</td>
</tr>
<tr>
<td align="left"><strong>TimeField</strong></td>
<td align="left">TimeField(format=api_settings.TIME_FORMAT, input_formats=None)</td>
</tr>
<tr>
<td align="left"><strong>DurationField</strong></td>
<td align="left">DurationField()</td>
</tr>
<tr>
<td align="left"><strong>ChoiceField</strong></td>
<td align="left">ChoiceField(choices) choices与Django的用法相同</td>
</tr>
<tr>
<td align="left"><strong>MultipleChoiceField</strong></td>
<td align="left">MultipleChoiceField(choices)</td>
</tr>
<tr>
<td align="left"><strong>FileField</strong></td>
<td align="left">FileField(max_length=None, allow_empty_file=False, use_url=UPLOADED_FILES_USE_URL)</td>
</tr>
<tr>
<td align="left"><strong>ImageField</strong></td>
<td align="left">ImageField(max_length=None, allow_empty_file=False, use_url=UPLOADED_FILES_USE_URL)</td>
</tr>
<tr>
<td align="left"><strong>ListField</strong></td>
<td align="left">ListField(child=, min_length=None, max_length=None)</td>
</tr>
<tr>
<td align="left"><strong>DictField</strong></td>
<td align="left">DictField(child=)</td>
</tr>
</tbody></table>
<p><strong>选项参数：</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><strong>max_length</strong></td>
<td>最大长度</td>
</tr>
<tr>
<td><strong>min_lenght</strong></td>
<td>最小长度</td>
</tr>
<tr>
<td><strong>allow_blank</strong></td>
<td>是否允许为空</td>
</tr>
<tr>
<td><strong>trim_whitespace</strong></td>
<td>是否截断空白字符</td>
</tr>
<tr>
<td><strong>max_value</strong></td>
<td>最小值</td>
</tr>
<tr>
<td><strong>min_value</strong></td>
<td>最大值</td>
</tr>
</tbody></table>
<p><strong>通用参数：</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>read_only</strong></td>
<td>表明该字段仅用于序列化输出，默认False</td>
</tr>
<tr>
<td><strong>write_only</strong></td>
<td>表明该字段仅用于反序列化输入，默认False</td>
</tr>
<tr>
<td><strong>required</strong></td>
<td>表明该字段在反序列化时必须输入，默认True</td>
</tr>
<tr>
<td><strong>default</strong></td>
<td>反序列化时使用的默认值</td>
</tr>
<tr>
<td><strong>allow_null</strong></td>
<td>表明该字段是否允许传入None，默认False</td>
</tr>
<tr>
<td><strong>validators</strong></td>
<td>该字段使用的验证器</td>
</tr>
<tr>
<td><strong>error_messages</strong></td>
<td>包含错误编号与错误信息的字典</td>
</tr>
<tr>
<td><strong>label</strong></td>
<td>用于HTML展示API页面时，显示的字段名称</td>
</tr>
<tr>
<td><strong>help_text</strong></td>
<td>用于HTML展示API页面时，显示的字段帮助提示信息</td>
</tr>
</tbody></table>
<h3 id="局部钩子和全局钩子源码分析-2星"><a href="#局部钩子和全局钩子源码分析-2星" class="headerlink" title="局部钩子和全局钩子源码分析(2星)"></a>局部钩子和全局钩子源码分析(2星)</h3><p><strong>1 入口是ser.is_valid()，是BaseSerializer的方法</strong></p>
<p><img src="https://i.loli.net/2021/07/13/6AsePhQvJu24LN8.png" alt="7dILKc5ksVWO4NR.png"></p>
<p><strong>2 找到全局钩子</strong></p>
<p><img src="https://i.loli.net/2021/07/13/woCEI1bMDNhiSLA.png" alt="OdbuBatSUYpG73C.png"></p>
<p><strong>3 找到局部钩子</strong></p>
<p><img src="https://i.loli.net/2021/07/13/EhTM4U1DFjuiPJl.png" alt="OHmK9NrponcjDXq.png"></p>
<p><img src="https://i.loli.net/2021/07/13/IYUbC436jgFuxtQ.png" alt="ImHyxpcjvD14gXC.png"></p>
<h3 id="序列化组件部分源码分析-2星"><a href="#序列化组件部分源码分析-2星" class="headerlink" title="序列化组件部分源码分析(2星)"></a>序列化组件部分源码分析(2星)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 前戏：对象的实例化过程：__new__在__init__之前执行</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1 序列化类在实例化的时候，先调用的是BaseSerializer中的__new__方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 ListSerializer与自己Serializer有什么联系？</span></span><br><span class="line">	[ser1,ser2,ser3]	ser</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/07/13/m7FdZEayzqhvXjC.png" alt="jgpMR7V3YW6BIdn.png"></p>
<p><img src="https://i.loli.net/2021/07/13/B4JjeihOfHAXU6z.png" alt="HxlAO1sVUpLuiq6.png"></p>
<h2 id="请求与响应-3星"><a href="#请求与响应-3星" class="headerlink" title="请求与响应(3星)"></a>请求与响应(3星)</h2><h3 id="drf请求全局和局部配置"><a href="#drf请求全局和局部配置" class="headerlink" title="drf请求全局和局部配置"></a>drf请求全局和局部配置</h3><p><strong>请求默认支持三种编码格式</strong></p>
<ul>
<li>urlencoded</li>
<li>json</li>
<li>formdata</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认支持三种</span></span><br><span class="line"></span><br><span class="line">   <span class="string">&#x27;DEFAULT_PARSER_CLASSES&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;rest_framework.parsers.JSONParser&#x27;</span>,  	 <span class="comment"># 解析application/json格式</span></span><br><span class="line">        <span class="string">&#x27;rest_framework.parsers.FormParser&#x27;</span>, 	 <span class="comment"># 解析application/x-www-form-urlencoded</span></span><br><span class="line">        <span class="string">&#x27;rest_framework.parsers.MultiPartParser&#x27;</span> <span class="comment"># multipart/form-data</span></span><br><span class="line">    ]</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 全局配置</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> rest_framework.parsers <span class="keyword">import</span> JSONParser</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookView</span>(<span class="params">ViewSetMixin,ListAPIView,CreateAPIView</span>):</span></span><br><span class="line">    parser_classes = [JSONParser,]</span><br></pre></td></tr></table></figure>





<h3 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rest-framework基于Django的request封装了一个新的Request类的request对象</span></span><br><span class="line">	rest-framework传入视图的request对象不再是Django默认的HttpRequest对象，而是rest-framework提供的扩展的HttpRequest类的Request类的对象</span><br><span class="line"></span><br><span class="line"><span class="comment"># Request对象的数据是根据前端发送数据的格式进行解析之后的结果(无论前端发送哪种格式的数据，都可以用统一的方式读取数据)</span></span><br><span class="line">	rest-framework提供了Parser解析器，在接收到请求后会自动根据Content-<span class="type">Type</span>指明的请求数据类型(如JSON、表单类型数据等)将请求数据进行parse解析，解析为类字典(QueryDict)对象保存在Request对象中</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 常用属性</span></span><br><span class="line">	<span class="number">1</span> request.data:</span><br><span class="line">        包含了对POST、PUT、PATCH请求方式解析后的数据</span><br><span class="line">        利用了rest-framework的parsers解析器，不仅支持表单类型数据，也支持JSON类型数据</span><br><span class="line">        </span><br><span class="line">    <span class="number">2</span> request.query_params</span><br><span class="line">    	request.query_params与Django的request.GET相同，只是更换了更正确的名字</span><br><span class="line">    </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">重点：</span></span><br><span class="line"><span class="string">	1 继承APIView后，视图类中的request对象是新的request对象</span></span><br><span class="line"><span class="string">	2 request.data、request.query_params的使用</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>



<h3 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># drf中的Response对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 继承关系：Response---&gt; SimSimpleTemplateResponse ---&gt; django的HttpResponse</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 属性、参数</span></span><br><span class="line">	</span><br><span class="line">    data=<span class="literal">None</span>				<span class="comment"># ser.data，传字典或列表，序列化成json格式字符串给前端</span></span><br><span class="line">    status=<span class="literal">None</span>				<span class="comment"># 状态码，http响应的状态码</span></span><br><span class="line">    template_name=<span class="literal">None</span>		<span class="comment"># 模板名字，在浏览器访问，看到的好看的模板(自定制)(用得少)</span></span><br><span class="line">    headers=<span class="literal">None</span>			<span class="comment"># 响应头，字典</span></span><br><span class="line">    exception=<span class="literal">False</span>			<span class="comment"># 异常(不用管)</span></span><br><span class="line">    content_type=<span class="literal">None</span>		<span class="comment"># 响应编码类型</span></span><br><span class="line">    </span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    重点：</span></span><br><span class="line"><span class="string">    	data</span></span><br><span class="line"><span class="string">    	status</span></span><br><span class="line"><span class="string">    	headers</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">	response=&#123;<span class="string">&#x27;code&#x27;</span>:<span class="number">100</span>, <span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;查询成功&#x27;</span>, <span class="string">&#x27;request&#x27;</span>:ser.data&#125;</span><br><span class="line">    <span class="keyword">return</span> Response(response,status=status.HTTP_201_CREATED,headers=&#123;<span class="string">&#x27;xxx&#x27;</span>:<span class="string">&quot;xxx&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置</span></span><br><span class="line">	<span class="number">1</span> 通过配置，设置响应格式(浏览器模板样子、纯json)</span><br><span class="line">    <span class="comment"># 1 后期，drf的所有配置，都写在这个字典中</span></span><br><span class="line">    <span class="comment"># 2 drf有个默认配置文件(drf源码的 ---&gt; setting.py),如果项目的配置文件配置了，优先使用项目的，如果没有配置，使用内置的</span></span><br><span class="line">    <span class="comment"># 3 返回样式的配置，一般不配置</span></span><br><span class="line">    REST_FRAMEWORK=&#123;</span><br><span class="line">        <span class="comment">#配置响应格式，默认有俩（json，浏览器的）</span></span><br><span class="line">         <span class="string">&#x27;DEFAULT_RENDERER_CLASSES&#x27;</span>: [</span><br><span class="line">            <span class="string">&#x27;rest_framework.renderers.JSONRenderer&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;rest_framework.renderers.BrowsableAPIRenderer&#x27;</span>,</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="number">2</span> 局部配置(只针对某一个视图函数)</span><br><span class="line">    	在视图类上写</span><br><span class="line">        	renderer_classes = [JSONRenderer]</span><br><span class="line">    <span class="number">3</span> 配置的三个层次(优先级)</span><br><span class="line">    	局部 ---&gt; 项目 ---&gt; drf默认</span><br></pre></td></tr></table></figure>



<h2 id="视图组件-5星"><a href="#视图组件-5星" class="headerlink" title="视图组件(5星)"></a>视图组件(5星)</h2><p><img src="https://i.loli.net/2021/07/13/QeyDj2BmxElJbg8.png" alt="Uc5s1hblaJnoNqA.png"></p>
<h3 id="两个视图基类"><a href="#两个视图基类" class="headerlink" title="两个视图基类"></a>两个视图基类</h3><h4 id="APIView"><a href="#APIView" class="headerlink" title="APIView"></a><strong>APIView</strong></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># APIView 是rest-framework提供的所有视图的基类，继承自Django的View父类</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在APIView中仍以常规的类视图定义方法来实现get()、post()...请求方式的方法</span></span><br></pre></td></tr></table></figure>



<p><strong>APIView与View的区别</strong></p>
<ul>
<li>传入到视图方法中的是rest-framework的Request类的request对象，而不是Django的HttpResponse对象</li>
<li>视图方法返回的是rest-framework的Response类的response对象，视图会因为响应数据设置(rander)符合前端要求的格式</li>
<li>任何APIException异常都会被捕获到，并处理成合适的响应信息</li>
<li>在进行dispatch()分发前，会对请求进行身份认证、权限检查、流量控制</li>
</ul>
<p><strong>支持定义的类属性</strong></p>
<ul>
<li>authentication_classes列表或元组（身份认证类）</li>
<li>permissoin_classes列表或元组（权限检查类）</li>
<li>throttle_classes列表或元组（流量/频率控制类）</li>
</ul>
<h4 id="GenericAPIView-通用视图类"><a href="#GenericAPIView-通用视图类" class="headerlink" title="GenericAPIView(通用视图类)"></a>GenericAPIView(通用视图类)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 继承自APIView，主要增加了操作序列化器和数据库查询的方法，作用是为Mixin扩展类的执行提供方法支持，通常在使用时，可搭配一个或多个Mixin扩展类</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">涉及到数据库操作，尽量选择GenericAPIView，减少代码量</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>



<p><strong>提供的关于序列化器使用的属性与方法</strong></p>
<ul>
<li>属性<ul>
<li>==serializer_class==                                            : 指明视图使用的序列化器</li>
</ul>
</li>
<li>方法<ul>
<li>==get_serializer_class(self)==                            : 当出现一个视图类中调用多个序列化器时，可以通过条件判断get_serializer_class方法中通过返回不同的序列器类名，就可以让视图方法执行不同的序列化器对象了</li>
<li>==get_serializer(self, *args, **kwargs)==        : 返回序列化器对象，主要用来提供给Mixin扩展类使用（该方法在提供序列化器对象的时候，会向序列化器对象的context属性补充三个数据：request、format、view，这三个数据对象可以在定义序列化器时使用）(可以传instance、data、many)<ul>
<li>request    ：当前视图的请求对象</li>
<li>view          ：当前请求的类视图对象</li>
<li>format      ：当前请求期望返回的数据格式</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>提供的关于数据库查询的属性与方法</strong></p>
<ul>
<li>属性<ul>
<li>==queryset==                        ：查询的表名.objects.all()    (这里不写all会自动添加上all，但推荐都写上)</li>
</ul>
</li>
<li>方法<ul>
<li>==get_queryset(self)==         ：获取查询需要用到的所有数据</li>
<li>==get_object(self)==              ：获取查询需要用到的单条数据    （若详情访问的模型类对象不存在，会返回404）</li>
</ul>
</li>
</ul>
<h3 id="五个视图扩展类"><a href="#五个视图扩展类" class="headerlink" title="五个视图扩展类"></a>五个视图扩展类</h3><p><strong>这五个扩展类需要搭配GenericAPIView父类，因为五个扩展类的实现需要调用GenericAPIView提供的序列化器与数据库查询的方法</strong></p>
<p><strong>CreateModelMixin</strong></p>
<ul>
<li>内部有create方法     ：新增</li>
</ul>
<p><strong>ListModelMixin</strong></p>
<ul>
<li>内部有list方法            ：查询所有</li>
</ul>
<p><strong>DestroyModelMixin</strong></p>
<ul>
<li>内部有destroy方法    ：删除单条</li>
</ul>
<p><strong>UpdateModelMixin</strong></p>
<ul>
<li>内部有update方法    ：修改一条</li>
</ul>
<p><strong>RetrieveModelMixin</strong></p>
<ul>
<li>内部有retrieve方法    ：查询单条</li>
</ul>
<h3 id="九个视图子类"><a href="#九个视图子类" class="headerlink" title="九个视图子类"></a>九个视图子类</h3><p><strong>ListAPIView</strong>            </p>
<ul>
<li>list</li>
</ul>
<p><strong>CreateAPIView</strong></p>
<ul>
<li>create</li>
</ul>
<p><strong>UpdateAPIView</strong></p>
<ul>
<li>update</li>
</ul>
<p><strong>DestroyAPIView</strong></p>
<ul>
<li>destroy</li>
</ul>
<p><strong>RetrieveAPIView</strong></p>
<ul>
<li>retrieve</li>
</ul>
<p><strong>ListCreateAPIView</strong></p>
<ul>
<li>list+create</li>
</ul>
<p><strong>RetrieveUpdateDestroyAPIView</strong></p>
<ul>
<li>retrieve+update+destroy</li>
</ul>
<p><strong>RetrieveDestroyAPIView</strong></p>
<ul>
<li>retrieve+destroy</li>
</ul>
<p><strong>RetrieveUpdateAPIView</strong></p>
<ul>
<li>retrieve+update</li>
</ul>
<h3 id="视图集"><a href="#视图集" class="headerlink" title="视图集"></a>视图集</h3><p><strong>ViewSetMixin</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 核心：重写了as_view方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 能够实现：请求方式和视图类中方法的映射</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 结论：只要继承ViewSetMixin的视图类，路由中as_view()里就要传action参数(字典)</span></span><br><span class="line"></span><br><span class="line">例</span><br><span class="line">	path(<span class="string">&#x27;books/&#x27;</span>, views.BookView.as_view(&#123;<span class="string">&#x27;get&#x27;</span>:<span class="string">&#x27;list&#x27;</span>,<span class="string">&#x27;post&#x27;</span>:<span class="string">&#x27;create&#x27;</span>&#125;))</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/07/13/b4dw7anUz5fkYvg.png" alt="Pt2UsRL61ycJu8W.png"></p>
<p><strong>ViewSet</strong></p>
<ul>
<li>继承自APIView与ViewSetMixin，作用与APIView类似，提供了身份认证、权限校验、流量管理…</li>
<li>主要通过继承ViewSetMixin来实现在调用as_view()时传入字典的映射处理</li>
<li>没有提供任何动作action方法，需要我们自己实现action方法</li>
<li>需要自己编写list、retrieve、create、update、destroy等方法</li>
</ul>
<p><strong>GeneriViewSet</strong></p>
<ul>
<li>继承自GenericAPIView与ViewSetMixin</li>
<li>实现了调用as_view()时传入字典的映射处理</li>
<li>提供了GenericAPIView提供的基础方法，可以直接搭配Mixin扩展类使用</li>
</ul>
<p><strong>ModelViewSet</strong></p>
<ul>
<li>继承自GenericViewSet，包括了五个视图扩展类</li>
</ul>
<p><strong>ReadOnlyModelViewSet</strong></p>
<ul>
<li>继承自GenericViewSet，包括了ListModelMixin、RetrieveModelMixin</li>
</ul>
<h2 id="路由组件-5星"><a href="#路由组件-5星" class="headerlink" title="路由组件(5星)"></a>路由组件(5星)</h2><h3 id="Routers"><a href="#Routers" class="headerlink" title="Routers"></a>Routers</h3><p><strong>对于视图集ViewSet，我们除了可以自己手动指明请求方式与动作action之间的对应关系外，还可以使用Routers来快速实现路由创建</strong></p>
<ul>
<li><p>SimpleRouter(常用)</p>
</li>
<li><p>DefaultRouter(多了一些花里胡哨的路由，用得少)</p>
</li>
</ul>
<h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, include</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line"><span class="keyword">from</span> rest_framework.routers <span class="keyword">import</span> SimpleRouter</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">router = SimpleRouter()</span><br><span class="line">router.register(<span class="string">&#x27;book&#x27;</span>, views.Book_modelviewset)</span><br><span class="line">router.register(<span class="string">&#x27;publish&#x27;</span>, views.Publish_modelviewset)</span><br><span class="line">router.register(<span class="string">&#x27;&#x27;</span>, views.Login, basename=<span class="string">&#x27;login&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">&#x27;&#x27;</span>, include(router.urls))		<span class="comment"># 方式一</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">urlpatterns += router.urls				<span class="comment"># 方式二(选一种使用)</span></span><br></pre></td></tr></table></figure>



<h3 id="试图类中派生的方法，自动生成路由-action"><a href="#试图类中派生的方法，自动生成路由-action" class="headerlink" title="试图类中派生的方法，自动生成路由(action)"></a>试图类中派生的方法，自动生成路由(action)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Login</span>(<span class="params">ViewSetMixin, APIView</span>):</span></span><br><span class="line">    authentication_classes = []</span><br><span class="line">    permission_classes = []</span><br><span class="line"><span class="meta">    @action(<span class="params">methods=[<span class="string">&#x27;POST&#x27;</span>], detail=<span class="literal">False</span></span>)		</span><span class="comment"># 自己扩展的方法(派生)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">self, request, *args, **kwargs</span>):</span>	</span><br><span class="line">        username = request.data.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        password = request.data.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        user_alive = models.User.objects.<span class="built_in">filter</span>(username=username, password=password).first()</span><br><span class="line">        <span class="keyword">if</span> user_alive:</span><br><span class="line">            token = uuid.uuid4()</span><br><span class="line">            models.User_token.objects.update_or_create(defaults=&#123;<span class="string">&#x27;token&#x27;</span>:token&#125;, user=user_alive)</span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;code&#x27;</span>:<span class="number">100</span>, <span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;登录成功&#x27;</span>, <span class="string">&#x27;token&#x27;</span>:token&#125;, headers=&#123;<span class="string">&#x27;token&#x27;</span>:token&#125;)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;code&#x27;</span>:<span class="number">101</span>, <span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;登录失败&#x27;</span>&#125;)</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 这样自动生成的路由是(books/login/) (如果prefix参数传空字符串，则是/login/)</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">参数解释：</span></span><br><span class="line"><span class="string">	method：		用来指定请求方式，默认GET</span></span><br><span class="line"><span class="string">	detail：		用来指定是否传入pk值(如：查所有或查单条)，False：不传pk，True：传pk</span></span><br><span class="line"><span class="string">	url_path：	用来指定url的路径，默认方法名</span></span><br><span class="line"><span class="string">	url_name：	用来指定url的别名</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">注意：</span></span><br><span class="line"><span class="string">	1 如果继承了APIView，那么想要自动创建路由，则必须写action动作并在urls.py中传basename参数来指定视图</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">	2 必须继承ViewSetMixin</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="认证组件-5星"><a href="#认证组件-5星" class="headerlink" title="认证组件(5星)"></a>认证组件(5星)</h2><p><strong>判断用户是否登录</strong></p>
<h3 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># auth.py(自己建的任意名称的py文件)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> rest_framework.authentication <span class="keyword">import</span> BaseAuthentication</span><br><span class="line"><span class="keyword">from</span> rest_framework.exceptions <span class="keyword">import</span> AuthenticationFailed</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Login_authentication</span>(<span class="params">BaseAuthentication</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">authenticate</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        token = request.META.get(<span class="string">&#x27;HTTP_TOKEN&#x27;</span>)</span><br><span class="line">        user_token = models.User_token.objects.<span class="built_in">filter</span>(token=token).first()</span><br><span class="line">        <span class="keyword">if</span> user_token:</span><br><span class="line">            <span class="keyword">return</span> user_token.user, token</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> AuthenticationFailed(<span class="string">&#x27;请先登录&#x27;</span>)</span><br><span class="line">            </span><br><span class="line"><span class="comment"># views.py</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Login</span>(<span class="params">ViewSetMixin, APIView</span>):</span></span><br><span class="line">    authentication_classes = [Login_authentication]		<span class="comment"># 局部使用</span></span><br><span class="line"><span class="meta">    @action(<span class="params">methods=[<span class="string">&#x27;POST&#x27;</span>], detail=<span class="literal">False</span></span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        username = request.data.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        password = request.data.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        user_alive = models.User.objects.<span class="built_in">filter</span>(username=username, password=password).first()</span><br><span class="line">        <span class="keyword">if</span> user_alive:</span><br><span class="line">            token = uuid.uuid4()</span><br><span class="line">            models.User_token.objects.update_or_create(defaults=&#123;<span class="string">&#x27;token&#x27;</span>:token&#125;, user=user_alive)</span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;code&#x27;</span>:<span class="number">100</span>, <span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;登录成功&#x27;</span>, <span class="string">&#x27;token&#x27;</span>:token&#125;, headers=&#123;<span class="string">&#x27;token&#x27;</span>:token&#125;)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;code&#x27;</span>:<span class="number">101</span>, <span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;登录失败&#x27;</span>&#125;)</span><br><span class="line">        </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">全局配置：</span></span><br><span class="line"><span class="string">	REST_FRAMEWORK = &#123;</span></span><br><span class="line"><span class="string">    &#x27;DEFAULT_AUTHENTICATION_CLASSES&#x27;:[</span></span><br><span class="line"><span class="string">        &#x27;app01.auth.Login_authentication&#x27;</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">局部禁用：</span></span><br><span class="line"><span class="string">	authentication_classes = []</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>



<h3 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h3><p><img src="https://i.loli.net/2021/07/13/gqlwv4FA9zBQGXT.png" alt="YcjEfW3CunFB9K4.png"></p>
<p><img src="https://i.loli.net/2021/07/13/vweS9dPYl3K2xjG.png" alt="image-20210705201337157.png"></p>
<p><img src="https://i.loli.net/2021/07/13/eJ4IxpXt9kKEDBl.png" alt="image-20210705201527608.png"></p>
<p><img src="https://i.loli.net/2021/07/13/HcPUrQDSewfILgj.png" alt="image-20210705201731741.png"></p>
<p><img src="https://i.loli.net/2021/07/13/CUnOqhfimyIgFba.png" alt="image-20210705205949346.png"></p>
<p><img src="https://i.loli.net/2021/07/13/OhcDHgkxtCB9Nna.png" alt="image-20210705210247174.png"></p>
<p><img src="https://i.loli.net/2021/07/13/w6uOeFcSjZGRCVk.png" alt="image-20210705210417976.png"></p>
<p><img src="https://i.loli.net/2021/07/13/17opTiSPhMu8Vsg.png" alt="image-20210705210543266.png"></p>
<p><img src="https://i.loli.net/2021/07/13/NAPy8owlSkOWgUJ.png" alt="image-20210705210958562.png"></p>
<h2 id="权限组件-4星"><a href="#权限组件-4星" class="headerlink" title="权限组件(4星)"></a>权限组件(4星)</h2><h3 id="简单使用-1"><a href="#简单使用-1" class="headerlink" title="简单使用"></a>简单使用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自己建的任意名字的py文件(auth.py)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> rest_framework.exceptions <span class="keyword">import</span> PermissionDenied</span><br><span class="line"><span class="keyword">from</span> rest_framework.permissions <span class="keyword">import</span> BasePermission</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User_permission</span>(<span class="params">BasePermission</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">has_permission</span>(<span class="params">self, request, view</span>):</span></span><br><span class="line">        <span class="keyword">if</span> models.User.user_type == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> PermissionDenied(request.user.get_user_type_display()+<span class="string">&#x27;权限不够&#x27;</span>)</span><br><span class="line">            </span><br><span class="line"><span class="comment"># views.py</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Login</span>(<span class="params">ViewSetMixin, APIView</span>):</span></span><br><span class="line">    permission_classes = [User_permission]		<span class="comment"># 局部使用</span></span><br><span class="line"><span class="meta">    @action(<span class="params">methods=[<span class="string">&#x27;POST&#x27;</span>], detail=<span class="literal">False</span></span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        username = request.data.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        password = request.data.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        user_alive = models.User.objects.<span class="built_in">filter</span>(username=username, password=password).first()</span><br><span class="line">        <span class="keyword">if</span> user_alive:</span><br><span class="line">            token = uuid.uuid4()</span><br><span class="line">            models.User_token.objects.update_or_create(defaults=&#123;<span class="string">&#x27;token&#x27;</span>:token&#125;, user=user_alive)</span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;code&#x27;</span>:<span class="number">100</span>, <span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;登录成功&#x27;</span>, <span class="string">&#x27;token&#x27;</span>:token&#125;, headers=&#123;<span class="string">&#x27;token&#x27;</span>:token&#125;)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;code&#x27;</span>:<span class="number">101</span>, <span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;登录失败&#x27;</span>&#125;)</span><br><span class="line">        </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">全局配置：</span></span><br><span class="line"><span class="string">	REST_FRAMEWORK = &#123;</span></span><br><span class="line"><span class="string">    &#x27;DEFAULT_PERMISSION_CLASSES&#x27;:[</span></span><br><span class="line"><span class="string">        &#x27;app01.auth.User_permission&#x27;</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">局部禁用：</span></span><br><span class="line"><span class="string">	permission_classes = []	</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>



<h3 id="源码分析-1"><a href="#源码分析-1" class="headerlink" title="源码分析"></a>源码分析</h3><p><img src="https://i.loli.net/2021/07/13/5meHTn9RJ74dFvA.png" alt="image-20210706172319765.png"></p>
<p><img src="https://i.loli.net/2021/07/13/oVFkBWeUsM1Qj5G.png" alt="image-20210706173120291.png"></p>
<h2 id="频率组件-5星"><a href="#频率组件-5星" class="headerlink" title="频率组件(5星)"></a>频率组件(5星)</h2><h3 id="自定义频率类"><a href="#自定义频率类" class="headerlink" title="自定义频率类"></a>自定义频率类</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自定义的逻辑</span></span><br><span class="line"><span class="comment">#（1）取出访问者ip</span></span><br><span class="line"><span class="comment">#（2）判断当前ip不在访问字典里，添加进去，并且直接返回True,表示第一次访问，在字典里，继续往下走</span></span><br><span class="line"><span class="comment">#（3）循环判断当前ip的列表，有值，并且当前时间减去列表的最后一个时间大于60s，把这种数据pop掉，这样列表中只有60s以内的访问时间，</span></span><br><span class="line"><span class="comment">#（4）判断，当列表小于3，说明一分钟以内访问不足三次，把当前时间插入到列表第一个位置，返回True，顺利通过</span></span><br><span class="line"><span class="comment">#（5）当大于等于3，说明一分钟内访问超过三次，返回False验证失败</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThrottles</span>():</span></span><br><span class="line">    VISIT_RECORD = &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.history=<span class="literal">None</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">allow_request</span>(<span class="params">self,request, view</span>):</span></span><br><span class="line">        <span class="comment">#（1）取出访问者ip</span></span><br><span class="line">        <span class="comment"># print(request.META)</span></span><br><span class="line">        ip=request.META.get(<span class="string">&#x27;REMOTE_ADDR&#x27;</span>)</span><br><span class="line">        <span class="keyword">import</span> time</span><br><span class="line">        ctime=time.time()</span><br><span class="line">        <span class="comment"># （2）判断当前ip不在访问字典里，添加进去，并且直接返回True,表示第一次访问</span></span><br><span class="line">        <span class="keyword">if</span> ip <span class="keyword">not</span> <span class="keyword">in</span> self.VISIT_RECORD:</span><br><span class="line">            self.VISIT_RECORD[ip]=[ctime,]</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        self.history=self.VISIT_RECORD.get(ip)</span><br><span class="line">        <span class="comment"># （3）循环判断当前ip的列表，有值，并且当前时间减去列表的最后一个时间大于60s，把这种数据pop掉，这样列表中只有60s以内的访问时间，</span></span><br><span class="line">        <span class="keyword">while</span> self.history <span class="keyword">and</span> ctime-self.history[-<span class="number">1</span>]&gt;<span class="number">60</span>:</span><br><span class="line">            self.history.pop()</span><br><span class="line">        <span class="comment"># （4）判断，当列表小于3，说明一分钟以内访问不足三次，把当前时间插入到列表第一个位置，返回True，顺利通过</span></span><br><span class="line">        <span class="comment"># （5）当大于等于3，说明一分钟内访问超过三次，返回False验证失败</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(self.history)&lt;<span class="number">3</span>:</span><br><span class="line">            self.history.insert(<span class="number">0</span>,ctime)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wait</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">import</span> time</span><br><span class="line">        ctime=time.time()</span><br><span class="line">        <span class="keyword">return</span> <span class="number">60</span>-(ctime-self.history[-<span class="number">1</span>])</span><br></pre></td></tr></table></figure>





<h3 id="简单使用-2"><a href="#简单使用-2" class="headerlink" title="简单使用"></a>简单使用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># until.py(任意名称py文件)</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User_throttle</span>(<span class="params">SimpleRateThrottle</span>):</span></span><br><span class="line">    scope = <span class="string">&#x27;user&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_cache_key</span>(<span class="params">self, request, view</span>):</span></span><br><span class="line">        <span class="keyword">return</span> request.user.username		<span class="comment"># 返回谁，就以谁做限制</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># views.py</span></span><br><span class="line">throttle_classes = [User_base_throttle,]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 全局配置</span></span><br><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="string">&#x27;DEFAULT_THROTTLE_RATES&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;user&#x27;</span>:<span class="string">&#x27;5/m&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 局部禁用</span></span><br><span class="line">throttle_classes = []</span><br></pre></td></tr></table></figure>



<h3 id="源码分析-2"><a href="#源码分析-2" class="headerlink" title="源码分析"></a>源码分析</h3><p><img src="https://i.loli.net/2021/07/13/5meHTn9RJ74dFvA.png" alt="image-20210706172319765.png"></p>
<p><img src="https://i.loli.net/2021/07/13/Kidfat1knMlF9cm.png" alt="image-20210706185151028.png"></p>
<p><img src="https://i.loli.net/2021/07/13/RJe7km51WZrF3DT.png" alt="image-20210706185449845.png"></p>
<p><img src="https://i.loli.net/2021/07/13/kBc9h3lorAyULSe.png" alt="image-20210706185753175.png"></p>
<p><img src="https://i.loli.net/2021/07/13/IiENjoSODkslCHL.png" alt="image-20210706190151150.png"></p>
<p><img src="https://i.loli.net/2021/07/13/WL9pSrasuU7iOJF.png" alt="image-20210706190316846.png"></p>
<h2 id="过滤与排序-4星"><a href="#过滤与排序-4星" class="headerlink" title="过滤与排序(4星)"></a>过滤与排序(4星)</h2><h3 id="简单使用-3"><a href="#简单使用-3" class="headerlink" title="简单使用"></a>简单使用</h3><p><strong>==查询所有==才需要过滤（根据条件过滤），排序（按某个规则排序）</strong></p>
<p><strong>内置类使用</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 内置过滤类(在视图类中配置)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> rest_framework.filters <span class="keyword">import</span> SearchFilter</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookView</span>(<span class="params">ViewSetMixin,ListAPIView</span>):</span></span><br><span class="line">    <span class="comment"># 在视图类中配置，最顶层的类至少是GenericAPIView</span></span><br><span class="line">    filter_backends = [SearchFilter,]</span><br><span class="line">    <span class="comment"># 过滤条件，按名字过滤</span></span><br><span class="line">    search_fields=[<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;publish&#x27;</span>]</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 查询使用</span></span><br><span class="line">	http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/books/?search=达   <span class="comment"># 出版社中或名字中有 达 就能查询出来</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 内置排序类(既有排序，又有过滤)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> rest_framework.filters <span class="keyword">import</span> OrderingFilter,SearchFilter</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookView</span>(<span class="params">ViewSetMixin,ListAPIView</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 在视图类中配置，最顶层的类至少是GenericAPIView</span></span><br><span class="line">    filter_backends = [SearchFilter,OrderingFilter,]</span><br><span class="line">    <span class="comment"># 过滤条件，按名字过滤</span></span><br><span class="line">    search_fields=[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">    <span class="comment"># 按哪个字段排序</span></span><br><span class="line">    ordering_fields=[<span class="string">&#x27;price&#x27;</span>,<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询使用</span></span><br><span class="line">	http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/books/?ordering=price,-<span class="built_in">id</span></span><br></pre></td></tr></table></figure>



<p><strong>第三方插件使用（django-filter）</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 视图类中</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django_filters.rest_framework <span class="keyword">import</span> DjangoFilterBackend</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookView</span>(<span class="params">ViewSetMixin,ListAPIView</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 在视图类中配置，最顶层的类至少是GenericAPIView</span></span><br><span class="line">    filter_backends = [DjangoFilterBackend,]</span><br><span class="line">    <span class="comment"># 按名字、价格过滤</span></span><br><span class="line">    filter_fields=[<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;price&#x27;</span>]</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 查询时</span></span><br><span class="line">http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/books/?name=红楼梦</span><br><span class="line">http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/books/?name=四方达&amp;price=<span class="number">15</span></span><br></pre></td></tr></table></figure>



<h2 id="异常处理-4星"><a href="#异常处理-4星" class="headerlink" title="异常处理(4星)"></a>异常处理(4星)</h2><h3 id="简单使用-4"><a href="#简单使用-4" class="headerlink" title="简单使用"></a>简单使用</h3><p><strong>全局统一捕获异常，返回固定的格式</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用步骤</span></span><br><span class="line">	<span class="number">1</span> 写一个函数</span><br><span class="line">    <span class="number">2</span> 在配置文件中配置</span><br><span class="line">    </span><br><span class="line"><span class="number">1</span> 写函数：</span><br><span class="line"></span><br><span class="line">	<span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> exception_handler</span><br><span class="line">	<span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">comment_exception_handler</span>(<span class="params">exc, context</span>):</span></span><br><span class="line">    response = exception_handler(exc, context)</span><br><span class="line">    <span class="keyword">if</span> response:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;code&#x27;</span>:<span class="number">1001</span>,</span><br><span class="line">            <span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;错误&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;detail&#x27;</span>:response.data</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Response(data)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;code&#x27;</span>:<span class="number">1002</span>,</span><br><span class="line">            <span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;未知错误&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Response(data)</span><br><span class="line">    </span><br><span class="line"><span class="number">2</span> 在配置文件中配置</span><br><span class="line"></span><br><span class="line">    REST_FRAMEWORK = &#123;</span><br><span class="line">        <span class="string">&#x27;EXCEPTION_HANDLER&#x27;</span>:<span class="string">&#x27;utils.comment_exception_handler&#x27;</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h2 id="分页功能-5星"><a href="#分页功能-5星" class="headerlink" title="分页功能(5星)"></a>分页功能(5星)</h2><p><strong>查询所有，才有分页功能（例如网站的下一页功能，app的下滑加载更多）</strong></p>
<h3 id="PageNumberPagination基本分页"><a href="#PageNumberPagination基本分页" class="headerlink" title="PageNumberPagination基本分页"></a>PageNumberPagination基本分页</h3><ul>
<li>重要类属性<ul>
<li>page_size = api_settings.PAGE_SIZE        （每页显示条数）</li>
<li>page_query_param = ‘page’                      （查询时用的参数）</li>
<li>page_size_query_param  = None             （更改返回条数）</li>
<li>max_page_size = None                               （每页最大显示条数）</li>
</ul>
</li>
<li>使用</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1 写一个类，继承PageNumberPagination，重写4个类属性</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommonPageNumberPagination</span>(<span class="params">PageNumberPagination</span>):</span></span><br><span class="line">    page_size = <span class="number">2</span></span><br><span class="line">    page_query_param = <span class="string">&#x27;page&#x27;</span></span><br><span class="line">    page_size_query_param = <span class="string">&#x27;search&#x27;</span></span><br><span class="line">    max_page_size = <span class="number">5</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 2 在视图类中配置写好的分页类</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookAPIView</span>(<span class="params">ViewSetMixin, ListAPIView</span>):</span></span><br><span class="line">    queryset = models.Books.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookModelSerializer</span><br><span class="line">    pagination_class = CommonPageNumberPagination</span><br></pre></td></tr></table></figure>



<h3 id="LimitOffsetPagination偏移分页"><a href="#LimitOffsetPagination偏移分页" class="headerlink" title="LimitOffsetPagination偏移分页"></a>LimitOffsetPagination偏移分页</h3><ul>
<li>重要的类属性<ul>
<li>default_limit = api_settings.PAGE_SIZE                （每页显示条数）</li>
<li>limit_query_param = ‘limit’                                    （查询时用的参数）</li>
<li>offset_query_param = ‘offset’                               （offset偏移的查询参数）</li>
<li>max_limit = None                                                    （每页最大显示条数）</li>
</ul>
</li>
<li>使用</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1 写一个类，继承LimitOffsetPagination，重写4个类属性</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommonLimitOffsetPagination</span>(<span class="params">LimitOffsetPagination</span>):</span></span><br><span class="line">    default_limit = <span class="number">3</span></span><br><span class="line">    limit_query_param = <span class="string">&#x27;limit&#x27;</span></span><br><span class="line">    offset_query_param = <span class="string">&#x27;offset&#x27;</span></span><br><span class="line">    max_limit = <span class="number">5</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 2 在视图类中配置写好的分页类</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookAPIView</span>(<span class="params">ViewSetMixin, ListAPIView</span>):</span></span><br><span class="line">    queryset = models.Books.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookModelSerializer</span><br><span class="line">    pagination_class = CommonLimitOffsetPagination</span><br></pre></td></tr></table></figure>



<h3 id="CursorPagination游标分页"><a href="#CursorPagination游标分页" class="headerlink" title="CursorPagination游标分页"></a>CursorPagination游标分页</h3><ul>
<li>重要的类属性<ul>
<li>cursor_query_param = ‘cursor’                          （查询条件）</li>
<li>page_size = api_settings.PAGE_SIZE                  （每页显示条数）</li>
<li>ordering = ‘-created’                                             （排序）</li>
<li>page_size_query_param = None                         （更改每页显示条数）</li>
<li>max_page_size = None                                         （每页最大显示条数）</li>
</ul>
</li>
<li>使用</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1 写一个类，继承LimitOffsetPagination，重写4个类属性</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommonCursorPagination</span>(<span class="params">CursorPagination</span>):</span></span><br><span class="line">    cursor_query_param = <span class="string">&#x27;cursor&#x27;</span></span><br><span class="line">    page_size = <span class="number">2</span></span><br><span class="line">    ordering = <span class="string">&#x27;-id&#x27;</span></span><br><span class="line">    page_size_query_param = <span class="string">&#x27;offset&#x27;</span></span><br><span class="line">    max_page_size = <span class="number">5</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 2 在视图类中配置写好的分页类</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookAPIView</span>(<span class="params">ViewSetMixin, ListAPIView</span>):</span></span><br><span class="line">    queryset = models.Books.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookModelSerializer</span><br><span class="line">    pagination_class = CommonCursorPagination</span><br></pre></td></tr></table></figure>



<ul>
<li>优缺点</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 优点：速度最快，数据量越大，越有优势(没有那么大的数据量，用的不多)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 缺点：只能前一页和后一页，不能直接跳到某一页</span></span><br></pre></td></tr></table></figure>



<h3 id="继承APIView实现三种分页方式"><a href="#继承APIView实现三种分页方式" class="headerlink" title="继承APIView实现三种分页方式"></a>继承APIView实现三种分页方式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookAPIView2</span>(<span class="params">APIView</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        book_list = models.Books.objects.<span class="built_in">all</span>()</span><br><span class="line">        pagination = CommonPageNumberPagination()</span><br><span class="line">        book_list2 = pagination.paginate_queryset(book_list, request, self)</span><br><span class="line">        ser = BookModelSerializer(instance=book_list2, many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> pagination.get_paginated_response(ser.data)</span><br></pre></td></tr></table></figure>



<h2 id="自动生成接口文档-3星"><a href="#自动生成接口文档-3星" class="headerlink" title="自动生成接口文档(3星)"></a>自动生成接口文档(3星)</h2><ul>
<li>coreapi</li>
<li>swagger</li>
</ul>
<h3 id="使用coreapi自动生成"><a href="#使用coreapi自动生成" class="headerlink" title="使用coreapi自动生成"></a>使用coreapi自动生成</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一步：安装coreapi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二步：路由中配置</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> rest_framework.documentation <span class="keyword">import</span> include_docs_urls</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;docs/&#x27;</span>, include_docs_urls(title=<span class="string">&#x27;查询所有&#x27;</span>)),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第三步：配置文件中配置</span></span><br><span class="line"></span><br><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="comment">## 接口文档配置</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_SCHEMA_CLASS&#x27;</span>: <span class="string">&#x27;rest_framework.schemas.coreapi.AutoSchema&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ps：<span class="string">&#x27;DEFAULT_SCHEMA_CLASS&#x27;</span>: <span class="string">&#x27;rest_framework.schemas.openapi.AutoSchema&#x27;</span>,</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 第四步：写接口，加注释</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第五步：访问</span></span><br><span class="line"></span><br><span class="line">ps：extra_kwargs = &#123;</span><br><span class="line">    <span class="string">&#x27;字段&#x27;</span>:&#123;<span class="string">&#x27;help_text&#x27;</span>:<span class="string">&#x27;xxxx&#x27;</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="RBAC-4星"><a href="#RBAC-4星" class="headerlink" title="RBAC(4星)"></a>RBAC(4星)</h2><p><img src="https://i.loli.net/2021/07/13/T3UGjvpaOLZyswX.png" alt="image-20210708172129848.png"></p>
<p><img src="https://img2018.cnblogs.com/blog/1736414/202002/1736414-20200223222136020-817505790.png" alt="img"></p>
<p><strong>RBAC：Role-Based Access Control    (基于角色的访问控制)</strong></p>
<p><strong>原理</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 权限与角色(组)相关联，用户通过称为适当角色(组)的成员而得到这些角色(组)的权限</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 极大的简化了权限的管理(相互依赖)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Django的Auth组件(app)采用的认证规则就是RBAC</span></span><br><span class="line"></span><br><span class="line">	<span class="number">1</span> User表		    		 :存用户信息</span><br><span class="line">    <span class="number">2</span> Permission表			 :存权限</span><br><span class="line">    <span class="number">3</span> Role表					 :存角色(组)</span><br><span class="line"></span><br><span class="line">    <span class="number">4</span> Group_Role中间表			:权限赋予角色(多对多)</span><br><span class="line">	<span class="number">5</span> User_Group中间表			:角色赋予用户(多对多)</span><br><span class="line">    <span class="number">6</span> User_Permission中间表	:权限临时赋予角色(多对多)</span><br><span class="line">        </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">ps:</span></span><br><span class="line"><span class="string">	1 Django后台管理admin自带RBAC</span></span><br><span class="line"><span class="string">	2 基于admin做二次开发(simple-ui)</span></span><br><span class="line"><span class="string">	3 基于前后端分离实现RBAC(https://github.com/liqianglog/django-vue-admin)</span></span><br><span class="line"><span class="string">	4 前后端混合的后台前端模板(X-admin---&gt;快速开发后台管理系统)</span></span><br><span class="line"><span class="string">	5 智慧大屏(https://gitee.com/kevin_chou/dataVIS.git)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>



<h2 id="JWT-5星"><a href="#JWT-5星" class="headerlink" title="JWT(5星)"></a>JWT(5星)</h2><h3 id="介绍-5星"><a href="#介绍-5星" class="headerlink" title="介绍(5星)"></a>介绍(5星)</h3><p><strong>Json Web Token（JWT）：一种前后端的认证方式</strong></p>
<p><strong>构成和工作原理</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 三段式：header，payload，signature</span></span><br><span class="line"></span><br><span class="line">header(头)：认证方式，加密方式，公司名字...</span><br><span class="line">	&#123;</span><br><span class="line">        <span class="string">&#x27;typ&#x27;</span>:<span class="string">&#x27;JWT&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;alg&#x27;</span>:<span class="string">&#x27;HS256&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">payload(荷载)：用户信息，过期时间，签发时间...</span><br><span class="line">	&#123;</span><br><span class="line">        <span class="string">&quot;userid&quot;</span>:<span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>:<span class="string">&quot;Jerry&quot;</span>,</span><br><span class="line">        <span class="string">&quot;exp&quot;</span>:<span class="number">121456</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">signature(签名)：把前面的头和荷载通过设置好的加密方式得到的串</span><br><span class="line"></span><br><span class="line"><span class="comment"># 签发和校验</span></span><br><span class="line">	</span><br><span class="line">    <span class="number">1</span> 用户登录成功：</span><br><span class="line">    	<span class="number">1.1</span> 构造token的头(固定)</span><br><span class="line">        <span class="number">1.2</span> 构造荷载</span><br><span class="line">        <span class="number">1.3</span> 使用设置好的加密方式对头和荷载加密，得到签名，三者用.拼接起来，生成一个token串(使用base64编码)</span><br><span class="line">        例如：	  eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ</span><br><span class="line">    </span><br><span class="line">    <span class="number">2</span> 用户携带token，来到后端，把头和荷载再使用相同的加密方式加密，得到签名，比较新签名和旧签名是否一致，如果一致，说明该token可以信任，解析出当前用户(荷载)，继续往后走</span><br></pre></td></tr></table></figure>



<h3 id="base64编码"><a href="#base64编码" class="headerlink" title="base64编码"></a>base64编码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编码</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">dic=&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;lqz&#x27;</span>,<span class="string">&#x27;id&#x27;</span>:<span class="number">1</span>&#125;</span><br><span class="line">user_info_str=json.dumps(dic)</span><br><span class="line"><span class="comment"># res=base64.b64encode(bytes(user_info_str,encoding=&#x27;utf-8&#x27;))</span></span><br><span class="line">res=base64.b64encode(user_info_str.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(res) <span class="comment"># eyJuYW1lIjogImxxeiIsICJpZCI6IDF9</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解码</span></span><br><span class="line"></span><br><span class="line">res=base64.b64decode(<span class="string">&#x27;TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ=&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">ps：</span></span><br><span class="line"><span class="string">	base64长度是4的倍数，如果不足，需要用=号补齐</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>



<h3 id="JWT快速使用-2星"><a href="#JWT快速使用-2星" class="headerlink" title="JWT快速使用(2星)"></a>JWT快速使用(2星)</h3><p><strong>使用第三方：</strong></p>
<ul>
<li>djangorestframework-jwt：好久不维护，还能用</li>
<li>djangorestframework-simplejwt：最新的（<a target="_blank" rel="noopener" href="https://django-rest-framework-simplejwt.readthedocs.io/en/latest/getting_started.html%EF%BC%89">https://django-rest-framework-simplejwt.readthedocs.io/en/latest/getting_started.html）</a></li>
</ul>
<p><strong>签发</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 只需要在路由中加入，向这个地址发送post请求，携带用户名密码，就可以签发token</span></span><br><span class="line"></span><br><span class="line">	path(<span class="string">&#x27;login/&#x27;</span>, obtain_jwt_token)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 内部使用的是Django自带的auth组件(app)的user表</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 只需要在前端向配置的地址，发送post请求，携带用户名密码，就可以签发token</span></span><br></pre></td></tr></table></figure>



<p><strong>认证</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在视图类中配置，认证类和权限类(simplejwt只需要认证类)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> rest_framework_jwt.authentication <span class="keyword">import</span> JSONWebTokenAuthentication</span><br><span class="line"><span class="keyword">from</span> rest_framework.permissions <span class="keyword">import</span> IsAuthenticated</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookView</span>(<span class="params">ViewSetMixin,ListAPIView</span>):</span></span><br><span class="line">    authentication_classes = [JSONWebTokenAuthentication,]</span><br><span class="line">    permission_classes = [IsAuthenticated,]</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 前端访问，需要在请求头中加入，如果不携带，或者篡改了，认证就无法通过</span></span><br><span class="line">	key：Authorization</span><br><span class="line">    value：jwt xxx(以空格切割取token)</span><br></pre></td></tr></table></figure>



<h3 id="JWT使用auth表签发token，自定制格式-3星"><a href="#JWT使用auth表签发token，自定制格式-3星" class="headerlink" title="JWT使用auth表签发token，自定制格式(3星)"></a>JWT使用auth表签发token，自定制格式(3星)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 只需要写一个函数，在配置文件中配置</span></span><br><span class="line">	</span><br><span class="line">    <span class="comment"># 函数</span></span><br><span class="line">    </span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">jwt_response_payload_handler</span>(<span class="params">token, user=<span class="literal">None</span>, request=<span class="literal">None</span></span>):</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&#x27;code&#x27;</span>:<span class="number">100</span>,</span><br><span class="line">        <span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;登录成功&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>:user.username,</span><br><span class="line">        <span class="string">&#x27;token&#x27;</span>: token,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 配置文件</span></span><br><span class="line">    </span><br><span class="line">    JWT_AUTH =&#123;</span><br><span class="line">            <span class="comment"># token的过期时间</span></span><br><span class="line">            <span class="string">&#x27;JWT_EXPIRATION_DELTA&#x27;</span>: datetime.timedelta(days=<span class="number">7</span>),</span><br><span class="line">            <span class="comment"># 自定义认证结果：见下方序列化user和自定义response</span></span><br><span class="line">            <span class="comment"># 如果不自定义，返回的格式是固定的，只有token字段</span></span><br><span class="line">            <span class="string">&#x27;JWT_RESPONSE_PAYLOAD_HANDLER&#x27;</span>: <span class="string">&#x27;app01.utils.jwt_response_payload_handler&#x27;</span>,</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>



<h3 id="obtain-jwt-token源码分析-2星"><a href="#obtain-jwt-token源码分析-2星" class="headerlink" title="obtain_jwt_token源码分析(2星)"></a>obtain_jwt_token源码分析(2星)</h3><p><img src="https://i.loli.net/2021/07/13/9rumdEt6PK1I7yA.png" alt="image-20210708200119777.png"></p>
<p><img src="https://i.loli.net/2021/07/13/LPtXQu3bgdAin1B.png" alt="image-20210708201115115.png"></p>
<p><img src="https://i.loli.net/2021/07/13/MzK2IUvlPBpLriO.png" alt="image-20210708202015404.png"></p>
<p><img src="https://i.loli.net/2021/07/13/PiKmHtro35d2WeL.png" alt="image-20210708202554768.png"></p>
<p><img src="https://i.loli.net/2021/07/13/UxjrVGat59z2MXl.png" alt="image-20210708202924385.png"></p>
<p><img src="https://i.loli.net/2021/07/13/4OnkJZKvwDhXGTi.png" alt="image-20210708203058131.png"></p>
<p><img src="https://i.loli.net/2021/07/13/qILVJNO9QZK8n6k.png" alt="image-20210708203535421.png"></p>
<p><img src="https://i.loli.net/2021/07/13/8mqvgdzAQW5a1hK.png" alt="image-20210708204823746.png"></p>
<h3 id="基于jwt的认证类-5星"><a href="#基于jwt的认证类-5星" class="headerlink" title="基于jwt的认证类(5星)"></a>基于jwt的认证类(5星)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">重点逻辑在authenticate方法中：</span></span><br><span class="line"><span class="string">	1 取出客户端传入的token(后端自己规定是从头/路径中拿)</span></span><br><span class="line"><span class="string">	2 验证jwt的签名(使用模块提供的)</span></span><br><span class="line"><span class="string">	3 通过payload得到当前登录用户对象(使用模块提供的)</span></span><br><span class="line"><span class="string">	4 返回user，token</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JWTAuthentication</span>(<span class="params">BaseJSONWebTokenAuthentication</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">authenticate</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(request.META)</span><br><span class="line">        <span class="comment"># token=request.query_params.get(&#x27;HTTP_AUTHORIZATION&#x27;,None)</span></span><br><span class="line">        token=request.META.get(<span class="string">&#x27;HTTP_AUTHORIZATION&#x27;</span>,<span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> token:</span><br><span class="line">            <span class="comment"># 校验token是不是过期了，是不是合法，</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                payload = jwt_decode_handler(token)</span><br><span class="line">            <span class="keyword">except</span> jwt.ExpiredSignature:</span><br><span class="line"></span><br><span class="line">                <span class="keyword">raise</span> AuthenticationFailed(<span class="string">&#x27;token过期&#x27;</span>)</span><br><span class="line">            <span class="keyword">except</span> jwt.DecodeError:</span><br><span class="line"></span><br><span class="line">                <span class="keyword">raise</span> AuthenticationFailed(<span class="string">&#x27;token认证失败&#x27;</span>)</span><br><span class="line">            <span class="keyword">except</span> jwt.InvalidTokenError:</span><br><span class="line">                <span class="keyword">raise</span> AuthenticationFailed(<span class="string">&#x27;token不合法&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">           <span class="keyword">raise</span> AuthenticationFailed(<span class="string">&#x27;token没有携带&#x27;</span>)</span><br><span class="line">        user = self.authenticate_credentials(payload)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (user, token)</span><br><span class="line">        </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">三种方式得到user：</span></span><br><span class="line"><span class="string">	1 继承，直接使用该类的方法</span></span><br><span class="line"><span class="string">	2 把方法copy出来，导入一箩筐</span></span><br><span class="line"><span class="string">	3 完全自己写(copy出来改吧改吧)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>



<h3 id="基于自定义User表，签发token-5星"><a href="#基于自定义User表，签发token-5星" class="headerlink" title="基于自定义User表，签发token(5星)"></a>基于自定义User表，签发token(5星)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># urls.py</span></span><br><span class="line"></span><br><span class="line">router=SimpleRouter()</span><br><span class="line">router.register(<span class="string">&#x27;books&#x27;</span>,views.BookView)</span><br><span class="line">router.register(<span class="string">&#x27;user&#x27;</span>,views.UserInfoView,basename=<span class="string">&#x27;user&#x27;</span>)</span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;&#x27;</span>, include(router.urls)),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># views.py</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfoView</span>(<span class="params">ViewSet</span>):</span></span><br><span class="line"><span class="meta">    @action(<span class="params">methods=[<span class="string">&#x27;POST&#x27;</span>],detail=<span class="literal">False</span></span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">self,request</span>):</span></span><br><span class="line">        username=request.data.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        password=request.data.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        res=&#123;<span class="string">&#x27;code&#x27;</span>:<span class="string">&#x27;100&#x27;</span>,<span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;登录成功&#x27;</span>&#125;</span><br><span class="line">        user=User.objects.<span class="built_in">filter</span>(username=username,password=password).first()</span><br><span class="line">        <span class="keyword">if</span> user:</span><br><span class="line">            <span class="comment"># 登录成功,生成token，提供了（去找）</span></span><br><span class="line">            payload = jwt_payload_handler(user)</span><br><span class="line">            token=jwt_encode_handler(payload)</span><br><span class="line">            res[<span class="string">&#x27;token&#x27;</span>]=token</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            res[<span class="string">&#x27;code&#x27;</span>]=<span class="number">101</span></span><br><span class="line">            res[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名或密码错误&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> Response(res)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># until.py(名字随意)</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JWTMyUserAuthentication</span>(<span class="params">BaseAuthentication</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">authenticate</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        token=request.META.get(<span class="string">&#x27;HTTP_AUTHORIZATION&#x27;</span>,<span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> token:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                payload = jwt_decode_handler(token)</span><br><span class="line">                <span class="built_in">print</span>(payload)</span><br><span class="line">            <span class="keyword">except</span> jwt.ExpiredSignature:</span><br><span class="line"></span><br><span class="line">                <span class="keyword">raise</span> AuthenticationFailed(<span class="string">&#x27;token过期&#x27;</span>)</span><br><span class="line">            <span class="keyword">except</span> jwt.DecodeError:</span><br><span class="line"></span><br><span class="line">                <span class="keyword">raise</span> AuthenticationFailed(<span class="string">&#x27;token认证失败&#x27;</span>)</span><br><span class="line">            <span class="keyword">except</span> jwt.InvalidTokenError:</span><br><span class="line">                <span class="keyword">raise</span> AuthenticationFailed(<span class="string">&#x27;token不合法&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">           <span class="keyword">raise</span> AuthenticationFailed(<span class="string">&#x27;token没有携带&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        user=User.objects.get(pk=payload.get(<span class="string">&#x27;user_id&#x27;</span>))</span><br><span class="line">        <span class="comment"># user=User(id=payload.get(&#x27;user_id&#x27;),username=payload.get(&#x27;username&#x27;))</span></span><br><span class="line">        <span class="comment"># 优化，减少数据库压力（）</span></span><br><span class="line">        <span class="comment"># user=&#123;&#x27;id&#x27;:payload.get(&#x27;user_id&#x27;),&#x27;username&#x27;:payload.get(&#x27;username&#x27;)&#125;</span></span><br><span class="line">        <span class="keyword">return</span> (user, token)</span><br></pre></td></tr></table></figure>



<h3 id="多方式登录-5星"><a href="#多方式登录-5星" class="headerlink" title="多方式登录(5星)"></a>多方式登录(5星)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 使用用户名、邮箱、手机号 + 密码都能登录成功</span><br><span class="line"></span><br><span class="line"><span class="number">2</span> 可以使用auth的User表，也可以自定义用户表</span><br><span class="line"></span><br><span class="line"><span class="number">3</span> 扩写auth的User表(没有迁移之前使用---&gt;继承AbstractUser)</span><br><span class="line">	硬写：</span><br><span class="line">    	<span class="number">3.1</span> 删库(要有备份)</span><br><span class="line">        <span class="number">3.2</span> 删除迁移记录(app的迁移记录，auth、admin的迁移记录(源码中))</span><br><span class="line">        </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># views.py</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Userinfo</span>(<span class="params">ViewSet</span>):</span></span><br><span class="line"><span class="meta">    @action(<span class="params">methods=[<span class="string">&#x27;POST&#x27;</span>], detail=<span class="literal">False</span></span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        response = &#123;<span class="string">&#x27;code&#x27;</span>:<span class="number">1000</span>, <span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;登录成功&#x27;</span>, <span class="string">&#x27;token&#x27;</span>:<span class="literal">None</span>&#125;</span><br><span class="line">        ser = UserModelSerializer(data=request.data)</span><br><span class="line">        <span class="keyword">if</span> ser.is_valid():</span><br><span class="line">            response[<span class="string">&#x27;token&#x27;</span>] = ser.context.get(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            response[<span class="string">&#x27;code&#x27;</span>] = <span class="number">1001</span></span><br><span class="line">            response[<span class="string">&#x27;msg&#x27;</span>] = ser.errors</span><br><span class="line">        <span class="keyword">return</span> Response(response)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment"># serializer.py(名字随意)</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserModelSerializer</span>(<span class="params">serializers.ModelSerializer</span>):</span></span><br><span class="line">    username = serializers.CharField()</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Userinfo</span><br><span class="line">        fields = [<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;password&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate</span>(<span class="params">self, attrs</span>):</span></span><br><span class="line">        user = self._get_user(attrs)</span><br><span class="line">        token = self._get_token(user)</span><br><span class="line">        self.context[<span class="string">&#x27;token&#x27;</span>] = token</span><br><span class="line">        <span class="keyword">return</span> attrs</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_get_user</span>(<span class="params">self, attrs</span>):</span></span><br><span class="line">        username = attrs.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        password = attrs.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> re.match(<span class="string">&#x27;^1(3[0-9]|4[01456879]|5[0-35-9]|6[2567]|7[0-8]|8[0-9]|9[0-35-9])\d&#123;8&#125;$&#x27;</span>, username):</span><br><span class="line">            user = Userinfo.objects.<span class="built_in">filter</span>(phone=username).first()</span><br><span class="line">        <span class="keyword">elif</span> re.match(<span class="string">&#x27;^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$&#x27;</span>, username):</span><br><span class="line">            user = Userinfo.objects.<span class="built_in">filter</span>(email=username).first()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            user = Userinfo.objects.<span class="built_in">filter</span>(username=username).first()</span><br><span class="line">        <span class="keyword">if</span> user:</span><br><span class="line">            <span class="keyword">if</span> user.check_password(password):</span><br><span class="line">                <span class="keyword">return</span> user</span><br><span class="line">            <span class="keyword">else</span>:<span class="keyword">raise</span> ValidationError(<span class="string">&#x27;用户名或密码错误&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;用户名或密码错误&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_get_token</span>(<span class="params">self, user</span>):</span></span><br><span class="line">        payload = jwt_payload_handler(user)</span><br><span class="line">        token = jwt_encode_handler(payload)</span><br><span class="line">        <span class="keyword">return</span> token</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment"># until.py(名字随意)</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User_jwt_authentication</span>(<span class="params">BaseJSONWebTokenAuthentication</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">authenticate</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="comment"># print(request.META)</span></span><br><span class="line">        token = request.META.get(<span class="string">&#x27;HTTP_AUTHORIZATION&#x27;</span>)</span><br><span class="line">        <span class="comment"># return None</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            payload = jwt_decode_handler(token)</span><br><span class="line">        <span class="keyword">except</span> jwt.ExpiredSignature:</span><br><span class="line">            <span class="keyword">raise</span> AuthenticationFailed(<span class="string">&#x27;签名过期，请重新登录&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span> jwt.DecodeError:</span><br><span class="line">            <span class="keyword">raise</span> AuthenticationFailed(<span class="string">&#x27;认证错误&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span> jwt.InvalidTokenError:</span><br><span class="line">            <span class="keyword">raise</span> AuthenticationFailed(<span class="string">&#x27;认证不合法&#x27;</span>)</span><br><span class="line">        user = self.authenticate_credentials(payload)</span><br><span class="line">        <span class="keyword">return</span> (user, token)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">authenticate_credentials</span>(<span class="params">self, payload</span>):</span></span><br><span class="line">        username = payload.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> username:</span><br><span class="line">            <span class="keyword">raise</span> AuthenticationFailed(<span class="string">&#x27;用户名不存在&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            user = Userinfo.objects.<span class="built_in">filter</span>(username=username).first()</span><br><span class="line">        <span class="keyword">except</span> Userinfo.DoesNotExist:</span><br><span class="line">            <span class="keyword">raise</span> AuthenticationFailed(<span class="string">&#x27;无效的签名&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> user.is_active:</span><br><span class="line">            <span class="keyword">raise</span> AuthenticationFailed(<span class="string">&#x27;用户已注销&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> user</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">池劲涛</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
